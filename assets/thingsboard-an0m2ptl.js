var bb=Object.defineProperty;var jd=e=>{throw TypeError(e)};var wb=(e,t,i)=>t in e?bb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var B=(e,t,i)=>wb(e,typeof t!="symbol"?t+"":t,i),Wd=(e,t,i)=>t.has(e)||jd("Cannot "+i);var ae=(e,t,i)=>(Wd(e,t,"read from private field"),i?i.call(e):t.get(e)),pr=(e,t,i)=>t.has(e)?jd("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),zi=(e,t,i,r)=>(Wd(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i);import{aG as Vi,i as Zs,aL as cl,aM as Ws,aN as Tb,aO as Eb,aj as ph,ak as _b,O as Kr,aP as Sb}from"./index-DAjeGngP.js";function Bn(e,t){const i=t||new Path2D;if(e.name==="combine"&&!e.draw)return i instanceof Path2D?i:void 0;e.setTheme||(e.setTheme=Ab);let r=e.calculative.borderRadius||0,n=r;const{x:a,y:s,width:o,height:l,ex:h,ey:c}=e.calculative.worldRect;r<1&&(r=o*r,n=l*n);let u=r<n?r:n;if(o<2*u&&(u=o/2),l<2*u&&(u=l/2),i.moveTo(a+u,s),i.arcTo(h,s,h,c,u),i.arcTo(h,c,a,c,u),i.arcTo(a,c,a,s,u),i.arcTo(a,s,h,s,u),i.closePath(),i instanceof Path2D)return i}function Ab(e,t){if(e.affectByTheme){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const r=t[i];e.hasOwnProperty(i)&&(e[i]=r),e.calculative.hasOwnProperty(i)&&(e.calculative[i]=r)}e.hoverTextColor=t.textPrimaryColor,e.iconColor=t.buttonBg,e.calculative.iconColor=t.buttonBg,e.hoverBackground=t.formBg,e.activeBackground=t.activeBg,e.color=t.borderColor,e.calculative.color=t.borderColor,e.textColor=t["textColor-9"],e.calculative.textColor=t["textColor-9"]}}const xb=Bn;function Rb(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.ellipse(r+a/2,n+s/2,a/2,s/2,0,0,Math.PI*2),i instanceof Path2D)return i}var $t;(function(e){e[e.Node=0]="Node",e[e.Line=1]="Line"})($t||($t={}));var jt;(function(e){e[e.None=0]="None",e[e.DisableEdit=1]="DisableEdit",e[e.DisableMove=2]="DisableMove",e[e.DisableScale=3]="DisableScale",e[e.DisableMoveScale=4]="DisableMoveScale",e[e.Disable=10]="Disable"})(jt||(jt={}));var zd;(function(e){e[e.Default=0]="Default",e[e.In=1]="In",e[e.Out=2]="Out"})(zd||(zd={}));var Oa;(function(e){e[e.None=0]="None",e[e.Linear=1]="Linear",e[e.Radial=2]="Radial"})(Oa||(Oa={}));var Ht;(function(e){e[e.CanvasTemplate=1]="CanvasTemplate",e[e.CanvasImageBottom=2]="CanvasImageBottom",e[e.CanvasMain=3]="CanvasMain",e[e.CanvasImage=4]="CanvasImage"})(Ht||(Ht={}));const kb=["text","textWidth","textHeight","textLeft","textTop","fontFamily","fontSize","lineHeight","fontStyle","fontWeight","textAlign","textBaseline","whiteSpace","ellipsis","keepDecimal","letterSpacing"],Ib=["x","y","width","height","flipX","flipY"],Cb=["paddingTop","paddingRight","paddingBottom","paddingLeft","flipX","flipY","visible","showChild"],Db=["iconLeft","iconTop","iconRotate"],Ep=["globalAlpha","flipY","flipX","x","y","width","height","iconWidth","iconHeight","imageRatio","iconLeft","iconTop","iconAlign","rotate","visible"];var ii;(function(e){e[e.Normal=0]="Normal",e[e.Beads=1]="Beads",e[e.Dot=2]="Dot",e[e.Arrow=3]="Arrow",e[e.WaterDrop=4]="WaterDrop",e[e.Custom=5]="Custom"})(ii||(ii={}));var da;(function(e){e[e.Image=0]="Image",e[e.Icon=1]="Icon",e[e.Pen=2]="Pen",e[e.Element=3]="Element"})(da||(da={}));const _p=["gif","iframe","video","echarts","highcharts","lightningCharts","vue"],Nc=["radio","checkbox","button","inputDom","slider","echarts"],rs=new Set(["borderRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","progress","progressColor","verticalProgress","reverseProgress","flipX","flipY","input","lineDash","lineCap","lineJoin","strokeType","lineGradientFromColor","lineGradientToColor","lineGradientAngle","color","hoverColor","activeColor","lineWidth","bkType","gradientFromColor","gradientToColor","gradientAngle","gradientRadius","hoverBackground","activeBackground","globalAlpha","anchorColor","anchorRadius","shadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textHasShadow","fontFamily","fontSize","textColor","hoverTextColor","activeTextColor","textBackground","fontStyle","fontWeight","textAlign","textBaseline","lineHeight","whiteSpace","textWidth","textHeight","textLeft","textTop","ellipsis","hiddenText","keepDecimal","borderWidth","borderColor","animateLineWidth","lineAnimateType","frames","animateColor","animateType","animateReverse","background","gradientColors","lineGradientColors","animateLineWidth","gradientSmooth","lineSmooth","animations","toArrow","fromArrow","lineName","textType","textGradientColors"]),Lc={textType:0,bkType:0,strokeType:0};function Ob(e){e.onAdd=void 0,e.onValue=void 0,e.onBeforeValue=void 0,e.onDestroy=void 0,e.onMove=void 0,e.onResize=void 0,e.onRotate=void 0,e.onClick=void 0,e.onMouseEnter=void 0,e.onMouseLeave=void 0,e.onMouseDown=void 0,e.onMouseMove=void 0,e.onMouseUp=void 0,e.onShowInput=void 0,e.onInput=void 0,e.onChangeId=void 0,e.onBinds=void 0,e.onStartVideo=void 0,e.onPauseVideo=void 0,e.onStopVideo=void 0,e.onRenderPenRaw=void 0,e.onKeyDown=void 0,e.onContextmenu=void 0,e.onScale=void 0,e.onWheel=void 0,e.onConnectLine=void 0}var Et;(function(e){e[e.None=0]="None",e[e.LineAnchor=1]="LineAnchor",e[e.NodeAnchor=2]="NodeAnchor",e[e.Line=3]="Line",e[e.Node=4]="Node",e[e.Resize=5]="Resize",e[e.Rotate=6]="Rotate",e[e.LineAnchorPrev=7]="LineAnchorPrev",e[e.LineAnchorNext=8]="LineAnchorNext"})(Et||(Et={}));var Xt;(function(e){e[e.None=0]="None",e[e.Translate=1]="Translate",e[e.Select=2]="Select",e[e.Resize=3]="Resize",e[e.AddAnchor=4]="AddAnchor"})(Xt||(Xt={}));var wr;(function(e){e[e.None=0]="None",e[e.Down=1]="Down",e[e.Translate=2]="Translate"})(wr||(wr={}));var Bt;(function(e){e[e.None=-1]="None",e[e.Up=0]="Up",e[e.Right=1]="Right",e[e.Bottom=2]="Bottom",e[e.Left=3]="Left"})(Bt||(Bt={}));const Vd=["nw-resize","ne-resize","se-resize","sw-resize"],Hd=["n-resize","e-resize","s-resize","w-resize"],Mb=["curve","polyline","line"],Sp=["dash","lineWidth","lineCap","lineJoin","strokeType","color","lineGradientFromColor","lineGradientToColor","lineGradientAngle","globalAlpha","bkType","background","gradientFromColor","gradientToColor","gradientAngle","gradientRadius","fontFamily","fontSize","textColor","hoverTextColor","activeTextColor","textBackground","fontStyle","fontWeight","textAlign","textBaseline","lineHeight","whiteSpace","textLeft","textTop","flipX","flipY","lineDash","visible","iconColor"];var jn;(function(e){e[e.Mirror=0]="Mirror",e[e.Bilateral=1]="Bilateral",e[e.Free=2]="Free"})(jn||(jn={}));var je;(function(e){e[e.Default=0]="Default",e[e.In=1]="In",e[e.Out=2]="Out",e[e.DisableConnected=3]="DisableConnected",e[e.DisableConnectTo=4]="DisableConnectTo",e[e.Disable=10]="Disable"})(je||(je={}));var Xi;(function(e){e[e.Default=0]="Default",e[e.Line=1]="Line"})(Xi||(Xi={}));function Zt(e,t,i){if(!t||t%360===0)return;const r=t*Math.PI/180,n=(e.x-i.x)*Math.cos(r)-(e.y-i.y)*Math.sin(r)+i.x,a=(e.x-i.x)*Math.sin(r)+(e.y-i.y)*Math.cos(r)+i.y;e.x=n,e.y=a,e.prev&&Zt(e.prev,t,i),e.next&&Zt(e.next,t,i)}function aa(e,t,i=5,r){if(t.type===Xi.Line){let n=r.rotate;r.flipX&&(n*=-1),r.flipY&&(n*=-1);let a=t.rotate+n;return r.flipX&&(a*=-1),r.flipY&&(a*=-1),yr(e,{x:t.x-t.length*r.calculative.canvas.store.data.scale/2,y:t.y-i,width:t.length*r.calculative.canvas.store.data.scale,height:i*2,rotate:a})}else return e.x>t.x-i&&e.x<t.x+i&&e.y>t.y-i&&e.y<t.y+i}function hl(e,t,i){e.x=i.x-(i.x-e.x)*t,e.y=i.y-(i.y-e.y)*t}function vi(e,t){if(e.x===t.x)return e.y<=t.y?0:180;if(e.y===t.y)return e.x<t.x?270:90;const i=e.x-t.x,r=e.y-t.y;let n=Math.atan(Math.abs(i/r))/(2*Math.PI)*360;return i>0&&r>0?n=180-n:i<0&&r>0?n+=180:i<0&&r<0&&(n=360-n),n}function Jl(e,t){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function Pb(e,t){let i=Bt.None;if(!t)return i;const r=e.x-t.x,n=e.y-t.y;return Math.abs(r)>Math.abs(n)?r>0?i=Bt.Right:i=Bt.Left:n>0?i=Bt.Bottom:i=Bt.Up,i}function bs(e,t,i){e&&(e.x+=t,e.y+=i,e.next&&(e.next.x+=t,e.next.y+=i),e.prev&&(e.prev.x+=t,e.prev.y+=i))}function Yd(e,t){return e.anchorId===t.anchorId&&e.connectTo===t.connectTo}function Ro(e,t,i){let r=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))/i.data.scale;t.rotate===0?e.x<t.x?i.pens[t.penId].flipX||(r*=-1):i.pens[t.penId].flipX&&(r*=-1):e.y<t.y?i.pens[t.penId].flipY||(r*=-1):i.pens[t.penId].flipY&&(r*=-1),e.distance=r}const Nb="1.1.3",Ap={version:Nb},St={version:Ap.version,path2dDraws:{},canvasDraws:{},anchors:{},lineAnimateDraws:{},htmlElements:{}};function Tr(e){Object.assign(St.path2dDraws,e)}function En(e){Object.assign(St.canvasDraws,e)}function vh(e){Object.assign(St.anchors,e)}function Lb(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r&&r.push(i)||e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&r.splice(r.indexOf(i)>>>0,1)},emit:function(t,i){(e.get(t)||[]).slice().map(function(r){r(i)}),(e.get("*")||[]).slice().map(function(r){r(t,i)})}}}var Mn;(function(e){e[e.None=-1]="None",e[e.Document=0]="Document",e[e.Canvas=1]="Canvas"})(Mn||(Mn={}));const Ub={fontFamily:'"Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Helvetica, Arial',fontSize:12,lineHeight:1.5,textAlign:"center",textBaseline:"middle",color:"#222222",activeColor:"#278df8",hoverColor:"rgba(39,141,248,0.50)",anchorColor:"#278DF8",hoverAnchorColor:"#FF4101",anchorRadius:4,anchorBackground:"#fff",dockColor:"rgba(39,141,248,0.50)",dockPenColor:"#1890FF",dragColor:"#1890ff",rotateCursor:"rotate.cur",rightCursor:"right.cur",downCursor:"down.cur",hoverCursor:"pointer",minScale:.1,maxScale:10,keydown:Mn.Document,gridSize:20,gridColor:"#e2e2e2",ruleColor:"#888888",drawingLineName:"curve",interval:30,animateInterval:30,autoPolyline:!0,autoAnchor:!0,autoAlignGrid:!1,animateColor:"#30EEDC",ruleLineColor:"#FF4101",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:64,shadowColor:"#00000014",globalAlpha:1,defaultAnchors:[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}],measureTextWidth:!0,moveConnectedLine:!0,mouseRightActive:!0,disableClipboard:!1,drawingLineLength:0,disableTouchPadScale:!1,cdn:"",polylineSpace:10,domShapes:[],containerShapes:["tablePlus"],textFlip:!0,textRotate:!0,unavailableKeys:[],diagramOptions:{},svgPathStroke:!0,reconnetTimes:10},Fb=["color","hoverColor","activeColor","disabledColor","background","activeBackground","hoverBackground","disabledBackground","anchorColor","hoverAnchorColor","anchorBackground","animateColor","textColor","ruleColor","ruleLineColor","gridColor","lineColor","penBackground","dockPenColor"],Bb={dark:{color:"#bdc7db",background:"#1e2430",parentBackground:"#080b0f",ruleColor:"#222E47",ruleOptions:{background:"#121924",textColor:"#6E7B91"}},light:{color:"#222222",background:"#FFFFFF",parentBackground:"#F0F1F2",ruleColor:"#C8D0E1",ruleOptions:{background:"#F7F8FA",textColor:"#C8D0E1"}}},us={cssRuleSelector:":root",style_prefix:"le5le_",vendor_css_prefix:"--le-",dark:["textColor-9: rgba(255,255,255,0.90)","textColor-6: rgba(255,255,255,0.60)","textColor-1: rgba(255,255,255,1)","textColor-4: rgba(255,255,255,0.40)","textPrimaryColor: #7f838c","textSecondColor: rgba(255,255,255,0.90)","textDisabledColor: rgba(255,255,255,0.40)","textActiveColor: #0052d9","buttonBg: #4583ff","buttonDisabledBg: #0057CC","buttonDisabledColor: #FFFFFF26","buttonGradient: linear-gradient(360deg,#4583ff, #33ccff)","containerBg: rgba(21,24,28,0.95)","tabBg: #303746","tabActiveBg: #4583ff","tabDisabledBg: #282e3b","tabDisabledColor: rgba(255,255,255,0.26)","tabActiveColor: rgba(255,255,255,0.90)","formBg: #2a2f36","datePickerCellActiveRangeBg: #2c4475","componentDisabledBg: #282e3b","dataPickerCellActiveBg: #001b52","activeBg: #25375b","popContentBg: #252b37","disabledBg: #7f838c","disabledBg-2: #282E3B","tableStripeColor: rgba(150,192,255,0.10)","tableMenuBg: #303746","tableMenuDividerBg: rgb(76 81 94)","tableMenuHandleBg: #454f64","tableMenuColor: #bdc7db","tableMenuBorderColor: transparent","tableColRowBg: #303746","tableColRowActiveBg: #4A5263","tableColRowColor: rgba(255,255,255,0.6)","paginationColor: rgba(255,255,255,0.6)","paginationActiveColor: #4583ff","paginationActiveBg: rgba(69,131,255,0.20)","sliderBg: #303746","sliderBtnBg: #000000","notificationBorderColor: transparent","notificationBg: #282e3b","borderColor: #424b61","borderOutsideColor: #4583ff","formBorderColor: #424b61","borderInsideColor: rgba(255,255,255,0.40)","shadow: 0px 1px 10px 0px rgba(0,0,0,0.05), 0px 4px 5px 0px rgba(0,0,0,0.08), 0px 2px 4px -1px rgba(0,0,0,0.12)","radius: 4px"],light:["textColor-9: rgba(0,0,0,0.90)","textColor-6: rgba(0,0,0,0.60)","textColor-1: rgba(0,0,0,1)","textColor-4: rgba(0,0,0,0.40)","textPrimaryColor: #7f838c","textSecondColor: #171B27","textDisabledColor: rgba(0, 0, 0, 0.6)","textActiveColor: #0052d9","buttonBg: #4583ff","buttonDisabledBg: #b5c7ff","buttonDisabledColor: #FFFFFF","buttonGradient: linear-gradient(360deg,#4583ff, #33ccff)","containerBg: #ffffff","tabBg: #f1f2f5","tabActiveBg: #4583ff","tabDisabledBg: #e2e6ea","tabDisabledColor: rgba(0,0,0,0.26)","tabActiveColor: #ffffff","formBg: #EFF1F4","datePickerCellActiveRangeBg: #f2f3ff","componentDisabledBg: #eee","dataPickerCellActiveBg: #edefff","activeBg: #f2f3ff","popContentBg: #ffffff","disabledBg: #7f838c","disabledBg-2: #E2E6EA","tableStripeColor: #f1f2f5","tableMenuBg: #ffffff","tableMenuDividerBg: #e2e6ea","tableMenuHandleBg: #ebedf1","tableMenuColor: rgba(0,0,0,0.60)","tableMenuBorderColor: #e2e6ea","tableColRowBg: #ebedf1","tableColRowActiveBg: #bcc4d0","tableColRowColor: rgba(0,0,0,0.4)","paginationColor: rgba(0,0,0,0.6)","paginationActiveColor: #ffffff","paginationActiveBg: #4583ff","sliderBg: #e2e6ea","sliderBtnBg: #ffffff","notificationBorderColor: transparent","notificationBg: #ffffff","borderColor: #d6dbe3","borderOutsideColor: #d6dbe3","formBorderColor: #d4d6d9","borderInsideColor: #e7e7e7","shadow: 0px 2px 4px 0px rgba(107,113,121,0.25)","radius: 4px"],camelCaseToHyphenated(e){return e.replace(/[A-Z]/g,t=>"-"+t.toLowerCase())},_addVendorCssPrefix(e){return e.map(t=>{const[i,r]=t.split(":");return`${this.vendor_css_prefix}${this.camelCaseToHyphenated(i.trim())}:${r.trim()}`})},createThemeSheet(e,t){const i=document.createElement("style");i.type="text/css",i.id=this.style_prefix+t,document.head.appendChild(i);const r=e||"dark",n=this.getTheme(r),a=`${this.cssRuleSelector} { ${n.join(";")} }`;i.innerHTML=a},destroyThemeSheet(e){const t=this.findStyleSheet(this.style_prefix+e);t&&document.head.removeChild(t.ownerNode)},addTheme(e,t){Object.assign(this,{[e]:t})},getTheme(e){return this._addVendorCssPrefix(this[e]||this.light)},getThemeObj(e="dark"){var r;return(r=this[e])==null?void 0:r.reduce((n,a)=>{const[s,o]=a.split(":");return n[s]=o,n},{})},findStyleSheet(e){const t=document.styleSheets;for(let i=0;i<t.length;i++){const r=t[i];if(r.ownerNode&&r.ownerNode.id===e)return r}return null},updateCssRule(e,t){const r=this.getTheme(t),n=this.findStyleSheet(this.style_prefix+e);if(!n)return;let a=!1;for(let s=0;s<n.cssRules.length;s++)if(n.cssRules[s].selectorText===this.cssRuleSelector){a=!0;break}if(a)for(let s=0;s<n.cssRules.length;s++){const o=n.cssRules[s];if(o.selectorText===this.cssRuleSelector)if(n.insertRule){n.deleteRule(s);const l=`${this.cssRuleSelector} { ${r.join(";")} }`;n.insertRule(l,s)}else n.addRule&&(o.style.cssText=r.join(";"))}else if(n.insertRule){const s=`${this.cssRuleSelector} { ${r.join(";")} }`;n.insertRule(s,n.cssRules.length)}else if(n.addRule){const s=n.cssRules.find(o=>o.selectorText===this.cssRuleSelector);if(s){const o=r.join(";");s.style.cssText+=`; ${o}`}else n.addRule(this.cssRuleSelector,r.join(";"))}}};var _t;(function(e){e[e.Add=0]="Add",e[e.Update=1]="Update",e[e.Delete=2]="Delete",e[e.Replace=3]="Replace"})(_t||(_t={}));const jb=()=>({data:{x:0,y:0,scale:1,pens:[],origin:{x:0,y:0},center:{x:0,y:0},paths:{}},histories:[],pens:{},path2dMap:new WeakMap,animateMap:new WeakMap,active:[],animates:new Set,options:{...Ub},theme:{...Bb},emitter:Lb(),bindDatas:{},bind:{},pensNetwork:{},cacheDatas:[],messageEvents:{},templatePens:{},globalTriggers:{}}),Wb=(e="default")=>(St[e]||(St[e]=jb(),St[e].id=e),St[e]),zb=(e,t)=>{const i=e.data.template===t;if(i)for(const r of e.data.pens)r.canvasLayer===Ht.CanvasTemplate&&(e.templatePens[r.id]=r);e.lastScale=e.data.scale,e.data={x:0,y:0,scale:1,pens:[],origin:{x:0,y:0},center:{x:0,y:0},paths:{},template:i?t:null,lineAnimateDraws:{}},e.sameTemplate=i,e.pens={},e.histories=[],e.historyIndex=null,e.path2dMap=new WeakMap,e.animateMap=new WeakMap,e.bindDatas={},e.bind={},e.pensNetwork={},e.active=[],e.hover=void 0,e.lastHover=void 0,e.animates.clear()};function Hi(e){return typeof e=="number"&&!isNaN(e)}function lu(e){return e==null||typeof e=="string"&&e.trim()===""||!e&&e!==0&&e!=="0"&&e!==!1}function Ji(e){const{paddingTop:t,paddingBottom:i,paddingLeft:r,paddingRight:n,worldRect:a,canvas:s,text:o}=e.calculative;let{textLeft:l,textTop:h,textWidth:c,textHeight:u}=e.calculative,d=r,f=t;const m=a.width-r-n,p=a.height-t-i;c&&c<1&&(c*=a.width),u&&u<1&&(u*=a.height),c<e.calculative.fontSize&&(c=e.calculative.fontSize),d+=(l||0)+a.x,f+=(h||0)+a.y;const g=e.textAlign||s.store.options.textAlign,y=e.textBaseline||s.store.options.textBaseline;switch(g){case"center":d+=(m-(c||m))/2;break;case"right":d+=m-(c||m);break}switch(y){case"middle":f+=(p-(u||p))/2;break;case"bottom":f+=p-(u||p);break}const T={x:d,y:f,width:c||m,height:u||p};le(T),e.calculative.worldTextRect=T,to(e),e.calculative.textDrawRect=void 0}function cu(e,t){const i=t.calculative;if(lu(i.text))return;const{worldTextRect:r,textLines:n,fontSize:a,lineHeight:s,canvas:o}=i,l=a*s,h=n.length*l;t.calculative.fontsChecked!==!1&&(document.fonts.check(e.font)?t.calculative.fontsChecked=!1:t.calculative.fontsChecked=!0);const c=Vb(e,t);let u=r.x+(r.width-c)/2,d=r.y+(r.height-h)/2;const{options:f}=o.store;switch(t.textAlign||f.textAlign){case"left":u=r.x;break;case"right":u=r.x+r.width-c;break}switch(t.textBaseline||f.textBaseline){case"top":d=r.y;break;case"bottom":d=r.ey-h;break}t.calculative.textDrawRect={x:u,y:d,width:c,height:h},le(t.calculative.textDrawRect)}function to(e,t=e.calculative.text){const i=e.calculative;if(lu(t)){i.textLines=void 0;return}let r=typeof t=="string"?t:t.toString();const{whiteSpace:n,ellipsis:a}=e,{keepDecimal:s}=i;if(s!=null&&r.trim()!==""){const d=Number(r);isNaN(d)||(r=d.toFixed(s))}let o=[];const l=i.fontSize*i.lineHeight,h=i.worldTextRect.height,c=Math.floor(h/l),u=c>1?c:1;switch(n){case"nowrap":if(a!==!1){const m=qd([...r],e);m[0]&&(o.push(m[0]),m.length>1&&Uc(o))}else o.push(r);break;case"pre-line":o=r.split(/[\n]/g),a!==!1&&o.length>u&&(o=o.slice(0,u),Uc(o));break;case"break-all":default:const d=r.split(/[\n]/g);let f=0;t:for(const m of d){const p=n==="break-all"?m.split(""):xp(m);let g=qd(p,e);if(g.length===0&&(g=[""]),a!=!1)for(const y of g)if(f++,f>u){Uc(o);break t}else o.push(y);else o.push(...g)}break}return i.textLines=o,o}function xp(e=""){const t=[];let i="";for(let r=0;r<e.length;++r){const n=e.charCodeAt(r);n<33||n>126?(i&&(t.push(i),i=""),t.push(e[r])):i+=e[r]}return i&&t.push(i),t}function qd(e,t){const i=t.calculative.canvas,r=i.offscreen.getContext("2d"),{fontStyle:n,fontWeight:a,fontSize:s,fontFamily:o,lineHeight:l}=t.calculative;r.save();const h=[];let c=e[0]||"";for(let u=1;u<e.length;++u){const d=e[u]||"",f=c+d;let m=0;if(i.store.options.measureTextWidth)r.font=Ne({fontStyle:n,fontWeight:a,fontFamily:o||i.store.options.fontFamily,fontSize:s,lineHeight:l}),m=r.measureText(f).width;else{const g=f.match(/[^\x00-\xff]/g)||"",y=g.length*s,T=f.match(/\s/g)||"",b=T.length*s*.3,S=(f.length-g.length-T.length)*s*.6;m=y+b+S}const p=t.calculative.worldTextRect.width;m<=p+.1?c+=d:(c.length&&h.push(c),c=d)}return c.length&&h.push(c),r.restore(),h}function Vb(e,t){let i=0;return t.calculative.textLineWidths=[],t.calculative.textLines&&t.calculative.textLines.forEach(r=>{let n;t.calculative.textType?n=Hb(r,t)+r.length*t.calculative.letterSpacing:n=e.measureText(r).width+r.length*t.calculative.letterSpacing,t.calculative.textLineWidths.push(n),i<n&&(i=n)}),i}function Hb(e,t){const i=t.calculative.fontSize,r=e.match(/[^\x00-\xff]/g)||"",n=r.length*i,a=e.match(/\s/g)||"",s=a.length*i*(t.CSmultiple||.5),o=(e.length-r.length-a.length)*i*(t.CEmultiple||.54);return n+s+o}function Uc(e){e[e.length-1]=e[e.length-1].slice(0,-3)+"..."}function Yb(e){let t=e.text.split(`
`);const i=e.calculative.canvas,r=i.offscreen.getContext("2d"),{fontStyle:n,fontWeight:a,fontSize:s,fontFamily:o,lineHeight:l}=e.calculative;let h=0,c=0;r.save();for(let d=0;d<t.length;d++){if(i.store.options.measureTextWidth)r.font=Ne({fontStyle:n,fontWeight:a,fontFamily:o||i.store.options.fontFamily,fontSize:s,lineHeight:l}),c=r.measureText(t[d]).width+t[d].length*e.calculative.letterSpacing;else{const f=t[d].match(/[^\x00-\xff]/g)||"",m=f.length*s,p=t[d].match(/\s/g)||"",g=p.length*s*.3,y=(t[d].length-f.length-p.length)*s*.6;c=m+g+y+t[d].length*e.calculative.letterSpacing}c>h&&(h=c)}r.restore();let u=t.length*s*l;e.textAlign==="left"||(e.textAlign==="right"?e.x=e.x-(h-e.width):e.x=e.x-(h-e.width)/2),e.textBaseline==="top"||(e.textBaseline==="bottom"?e.y=e.y-(u-e.height):e.y=e.y-(u-e.height)/2),e.height=u+5,e.width=h+5,e.calculative.canvas.updatePenRect(e),e.calculative.canvas.calcActiveRect()}function lt(e,t=!1){if(Array.isArray(e)){const i=[];return e.forEach(r=>{i.push(lt(r,t))}),i}else if(typeof e=="object"){if(e===null)return null;if(e.constructor===RegExp)return e;const i={};for(const r in e)if(!(["canvas","lastFrame","socketFn"].includes(r)||e[r]instanceof HTMLImageElement||e[r]instanceof HTMLMediaElement)){{if(r==="calculative"&&!t)continue;if(r==="singleton"){t?i[r]={}:i[r]=e[r];continue}}i[r]=lt(e[r],t)}return i}return e}function yh(e,t,i){if(Array.isArray(e)){const r=[];return e.forEach(n=>{r.push(yh(n,t,i))}),r}else if(typeof e=="object"){if(e===null)return null;for(const r in e)if(t.includes(r))if(Array.isArray(e[r]))e[r].forEach((n,a)=>{Number.isNaN(Number(n))||(e[r][a]=Number(n*i))});else{if(Number.isNaN(Number(e[r])))continue;e[r]=Number(e[r])*i}else e[r]=yh(e[r],t,i);return e}return e}const ci={};function Rp(e,t,i){if(!ci[t.fromArrow])return;const r=ge(t),{x:n,y:a}=r,s={x:n,y:a};if(s.step=(t.fromArrowSize||10)*i.data.scale,r.next)s.rotate=vi(r.next,r)+90;else{const l=t.calculative.worldAnchors[1];if(!l)return;l.prev?s.rotate=vi(l.prev,r)+90:s.rotate=vi(l,r)+90}e.save(),e.beginPath(),e.setLineDash([]);const o=t.fromArrowColor||t.calculative.color;o&&(e.strokeStyle=o),ci[t.fromArrow](e,t,i,s),e.restore()}function kp(e,t,i){if(!ci[t.toArrow]||t.calculative.worldAnchors.length<2)return;e.save();const r=Gt(t),{x:n,y:a}=r,s={x:n,y:a};if(s.step=(t.toArrowSize||10)*i.data.scale,r.prev)s.rotate=vi(r.prev,r)+90;else{const l=t.calculative.worldAnchors[t.calculative.worldAnchors.length-2];l.next?s.rotate=vi(l.next,r)+90:s.rotate=vi(l,r)+90}e.beginPath(),e.setLineDash([]);const o=t.toArrowColor||t.calculative.color;o&&(e.strokeStyle=o),ci[t.toArrow](e,t,i,s),e.restore()}ci.triangleSolid=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step;e.moveTo(n,r.y-r.step/4),e.lineTo(r.x,r.y),e.lineTo(n,r.y+r.step/4),e.closePath(),e.stroke(),e.fillStyle=e.strokeStyle,e.fill(),e.restore()};ci.reTriangleSolid=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step/2;e.moveTo(r.x,r.y-r.step/2),e.lineTo(n,r.y),e.lineTo(r.x,r.y+r.step/2),e.closePath(),e.stroke(),e.fillStyle=e.strokeStyle,e.fill(),e.restore()};ci.triangle=(e,t,i,r)=>{e.save(),e.lineWidth<2&&(e.lineWidth=2),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step;e.moveTo(n,r.y-r.step/4),e.lineTo(r.x,r.y),e.lineTo(n,r.y+r.step/4),e.closePath(),e.stroke(),e.fillStyle=i.data.background||"#ffffff",e.fill(),e.restore()};ci.circleSolid=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.step/2;e.arc(r.x-n,r.y,n,0,2*Math.PI),e.stroke(),e.fillStyle=e.strokeStyle,e.fill(),e.restore()};ci.circle=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.step/2;e.arc(r.x-n,r.y,n,0,2*Math.PI),e.stroke(),e.fillStyle=i.data.background||"#ffffff",e.fill(),e.restore()};ci.diamondSolid=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step,a=r.step/2;e.moveTo(n,r.y),e.lineTo(n+a,r.y-a/2),e.lineTo(r.x,r.y),e.lineTo(n+a,r.y+a/2),e.closePath(),e.stroke(),e.fillStyle=e.strokeStyle,e.fill(),e.restore()};ci.diamond=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step,a=r.step/2;e.moveTo(n,r.y),e.lineTo(n+a,r.y-a/2),e.lineTo(r.x,r.y),e.lineTo(n+a,r.y+a/2),e.closePath(),e.stroke(),e.fillStyle=i.data.background||"#ffffff",e.fill(),e.restore()};ci.line=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step;e.moveTo(n,r.y-r.step/3),e.lineTo(r.x,r.y),e.lineTo(n,r.y+r.step/3),e.stroke(),e.restore()};ci.lineUp=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step;e.moveTo(n,r.y-r.step/3),e.lineTo(r.x,r.y),e.stroke(),e.restore()};ci.lineDown=(e,t,i,r)=>{e.save(),e.translate(r.x,r.y),e.rotate(r.rotate*Math.PI/180),e.translate(-r.x,-r.y);const n=r.x-r.step;e.moveTo(n,r.y+r.step/3),e.lineTo(r.x,r.y),e.stroke(),e.restore()};function bh(e){const t=parseInt,i=Math.round;let r=e.length,n={};if(r>9){const[a,s,o,l]=e=e.split(",");if(r=e.length,r<3||r>4)return null;n.r=t(a[3]=="a"?a.slice(5):a.slice(4)),n.g=t(s),n.b=t(o),n.a=l?parseFloat(l):-1}else{if(r==8||r==6||r<4)return null;r<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(r>4?e[4]+e[4]:"")),e=t(e.slice(1),16),r==9||r==5?(n.r=e>>24&255,n.g=e>>16&255,n.b=e>>8&255,n.a=i((e&255)/.255)/1e3):(n.r=e>>16,n.g=e>>8&255,n.b=e&255,n.a=-1)}return n}function We(e,t,i,r){let n,a,s,o,l,h,c,u=Math.round,d=typeof i=="string";return typeof e!="number"||e<-1||e>1||typeof t!="string"||t[0]!="r"&&t[0]!="#"||i&&!d||(c=t.length>9,c=d?i.length>9?!0:i=="c"?!c:!1:c,l=bh(t),o=e<0,h=i&&i!="c"?bh(i):o?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},e=o?e*-1:e,o=1-e,!l||!h)?null:(r?(n=u(o*l.r+e*h.r),a=u(o*l.g+e*h.g),s=u(o*l.b+e*h.b)):(n=u((o*l.r**2+e*h.r**2)**.5),a=u((o*l.g**2+e*h.g**2)**.5),s=u((o*l.b**2+e*h.b**2)**.5)),d=l.a,h=h.a,l=d>=0||h>=0,d=l?d<0?h:h<0?d:d*o+h*e:0,c?"rgb"+(l?"a(":"(")+n+","+a+","+s+(l?","+u(d*1e3)/1e3:"")+")":"#"+(4294967296+n*16777216+a*65536+s*256+(l?u(d*255):0)).toString(16).slice(1,l?void 0:-2))}globalThis.pSBC=We;function ul(e,t){const i=bh(e)||{r:0,g:0,b:0};return i.a<0?`rgba(${i.r},${i.g},${i.b},${t})`:`rgba(${i.r},${i.g},${i.b},${t+i.a})`}function ea(e,t){if(isNaN(e)){console.warn("realValue not number");return}if(typeof t!="string"){console.warn("collection must be string");return}const[i,r]=[t[0],t[t.length-1]];if(!["[","("].includes(i)){console.warn('collection must start with "[" or "("');return}if(!["]",")"].includes(r)){console.warn('collection must end with "]" or ")"');return}const n=t.substring(1,t.length-1).split(",");if(n.length!==2){console.warn("collection must have 2 numbers");return}const[a,s]=[+n[0],+n[1]];if(a>=s){console.warn("startNum must less than endNum");return}return e>a||i==="["&&e===a?e<s||r==="]"&&e===s:!1}function ia(e,t){if(typeof t!="string"){console.warn("collection must be string");return}const[i,r]=[t[0],t[t.length-1]];if(i!=="["||r!=="]"){console.warn('collection must start with "[" and end with "]"');return}const n=t.substring(1,t.length-1).split(",");for(const a of n)if(a.includes("..")){const[s,o]=a.split(".."),[l,h]=[+s,+o];if(l>=h){console.warn("startNum must less than endNum");return}if(e>=l&&e<=h)return!0}else if(e==a)return!0;return!1}function qb(e,t,i){const r=1-e;return 3*r*r*e*t+3*r*e*e*i+e*e*e}function Mt(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}const Rr=e=>{let t=0,i=0,r=0,n=0;return typeof e=="number"?t=i=r=n=e:typeof e=="string"?t=i=r=n=parseInt(e,10):Array.isArray(e)&&(t=e[0],r=Fc(e[1])?e[0]:e[1],n=Fc(e[2])?e[0]:e[2],i=Fc(e[3])?r:e[3]),[t,r,n,i]};function Fc(e){return e==null}async function Kb(e){return new Promise((t,i)=>{const r=new FileReader;r.onload=n=>{t(n.target.result)},r.onerror=n=>{i(n)},r.readAsDataURL(e)})}async function Gb(e,t,i,r){const n=new FormData;if(n.append("file",e),i)for(const s in i)i.hasOwnProperty(s)&&n.append(s,i[s]);return(await(await fetch(t,{method:"POST",headers:r,body:n})).json()).url}function $b(e,t,i){var r=document.createElement("link");r.href=e,r.rel="stylesheet",t&&(r.onload=t),document.head.appendChild(r)}function fa(e){let t=e||window.location.search.split("?")[1];const i=new URLSearchParams(t);return Object.fromEntries(i.entries())}function dl(e){let t;const i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?decodeURIComponent(t[2]):""}var fl;(function(e){e[e.None=0]="None",e[e.LocalStorage=1]="LocalStorage",e[e.Cookie=2]="Cookie"})(fl||(fl={}));const Xb=location.host.indexOf("le5le.com")!==-1;function ds(){let e="";const t=globalThis.le5leTokenName??"token";switch(globalThis.le5leTokenType){case fl.LocalStorage:e=localStorage.getItem(t);break;case fl.Cookie:e=dl(t);break;default:e=Xb?dl(t):localStorage.getItem(t)}return(globalThis.TokenPrefix??"Bearer ")+(globalThis.le5leTokenD?Ip(e):e)}function Ip(e){if(!e)return e;const t=e.split("");for(let i=0;i<Math.min(10,t.length);i++){const r=t[i],n=i+1;if(new RegExp("[0-9]","").test(r)){let s=parseInt(r,10)-n;for(;s<0;)s+=10;t[i]=s.toString()}else if(new RegExp("[A-Z]","").test(r)){let s=r.charCodeAt(0)-65-n;for(;s<0;)s+=26;t[i]=String.fromCharCode(s+65)}else if(new RegExp("[a-z]","").test(r)){let s=r.charCodeAt(0)-97-n;for(;s<0;)s+=26;t[i]=String.fromCharCode(s+97)}}return t.join("")}async function Cp(e,t){var l,h;if(globalThis.getMeta2dData)return await globalThis.getMeta2dData(t);const i=e.options.navigatorNetWork;let n=`/api/data/${location.href.includes("2d.")||location.href.includes("/2d")?"2d":"v"}/get`,a=((l=fa())==null?void 0:l.id)||n.includes("${id}");if(!a&&((h=fa())==null?void 0:h.data)){n=`./projects/${t}`;const u=new URL(window.location);u.searchParams.set("data",t),history.pushState({},"",u)}i!=null&&i.url&&(i.url.includes("${id}")?n=i.url.replace("${id}",t):n=i.url+((i==null?void 0:i.method)==="GET"?`?id=${t}`:""));let s=(i==null?void 0:i.method)||"POST";a||(s="GET");const o=await fetch(n,{headers:{Authorization:ds()},method:s,body:s==="GET"?void 0:JSON.stringify({id:t})});if(o.ok){let c=await o.text();return c.constructor===Object||c.constructor===Array?c=JSON.parse(JSON.stringify(c)):typeof c=="string"&&(c=JSON.parse(c)),c.data&&(c=c.data),c}else e.emitter.emit("error",{type:"http",error:o})}function Zi(e,t){if(t==null)return e;const i=t.split(".");for(;i.length&&(e=e[i.shift()]););return e}function ml(e,t,i){t!=null&&t.split(".").reduce((r,n,a)=>r[n]=t.split(".").length===++a?i:r[n]||{},e)}function wh(e,t){const i=["天","一","二","三","四","五","六"];let r=new Date;t&&(r=new Date(t));const n=r.getFullYear(),a=r.getMonth()+1,s=r.getDate(),o=r.getDay(),l=r.getHours(),h=r.getMinutes(),c=r.getSeconds();let u=new Function("year","month","day","week","hours","minutes","seconds",e?`return ${e}`:"return `${year}:${month}:${day} ${hours}:${minutes}:${seconds} 星期${week}`");const d=u(n,a,s,i[o],l,h,c);return u=null,d}const Kd="line",gl="repeat";function Qb(e,t){if(!e||!t)return!1;let i=Ge(e);for(;i;){if(i.id===t.id)return!0;i=Ge(i)}return!1}function Ge(e,t){if(!e||!e.parentId||!e.calculative)return;const r=e.calculative.canvas.store.pens[e.parentId];return t&&Ge(r,t)||r}function di(e,t){if(!e||!e.children)return[];const i=[];return e.children.forEach(r=>{const n=t.pens[r];n&&(i.push(n),i.push(...di(n,t)))}),i}function hu(e,t){if(!e||!e.followers)return[];const i=[];return e.followers.forEach(r=>{const n=t.pens[r];n&&!n.parentId&&(i.push(n),i.push(...hu(n,t)))}),i}function Jb(e,t){const{worldRect:i,gradientFromColor:r,gradientToColor:n,gradientAngle:a}=t.calculative;return Op(e,i,r,n,a)}function Zb(e,t){const{worldRect:i,gradientFromColor:r,gradientToColor:n,gradientRadius:a}=t.calculative;if(!r||!n)return;const{width:s,height:o,center:l}=i,{x:h,y:c}=l;let u=s;u<o&&(u=o),u*=.5;const d=e.createRadialGradient(h,c,u*(a||0),h,c,u);return d.addColorStop(0,r),d.addColorStop(1,n),d}function tw(e,t,i,r,n){let a=0;a=Math.PI/2-Math.atan2(r-t,i-e);const s=(e+i)/2,o=(t+r)/2,l=s+n*Math.sin(90*Math.PI/180-a),h=o+n*-Math.cos(90*Math.PI/180-a),c=s+n*Math.sin(270*Math.PI/180-a),u=o+n*-Math.cos(270*Math.PI/180-a);return[l,h,c,u]}function ew(e,t){const{worldRect:i,gradientColors:r,gradientRadius:n}=t.calculative;if(!r)return;let a=t.calculative.gradientColors;t.calculative.checked&&(a=t.calculative.onGradientColors);const{width:s,height:o,center:l}=i,{x:h,y:c}=l;let u=s;u<o&&(u=o),u*=.5;const{colors:d}=Kn(a),f=e.createRadialGradient(h,c,u*(n||0),h,c,u);return d.forEach(m=>{f.addColorStop(m.i,m.color)}),f}function iw(e,t){const{x:i,y:r,ex:n,width:a,height:s,center:o}=t.calculative.worldRect;let l=[{x:n,y:r+s/2},{x:i,y:r+s/2}],h=t.calculative.gradientColors;t.calculative.checked&&(h=t.calculative.onGradientColors);const{angle:c,colors:u}=Kn(h);let d=uu(c,a,s);return l.forEach(f=>{Zt(f,c,o)}),Zl(e,l,u,d)}function rw(e,t){const{worldRect:i,textGradientColors:r}=t.calculative;if(!r)return;const{width:n,height:a,center:s}=i,{x:o,y:l}=s;let h=n;h<a&&(h=a),h*=.5;const{colors:c}=Kn(r),u=e.createRadialGradient(o,l,0,o,l,h);return c.forEach(d=>{u.addColorStop(d.i,d.color)}),u}function nw(e,t){!t.calculative.textDrawRect&&cu(e,t),ne(t.calculative.textDrawRect);const{x:i,y:r,ex:n,width:a,height:s,center:o}=t.calculative.textDrawRect;let l=[{x:n,y:r+s/2},{x:i,y:r+s/2}];const{angle:h,colors:c}=Kn(t.calculative.textGradientColors);let u=uu(h,a,s);return l.forEach(d=>{Zt(d,h,o)}),Zl(e,l,c,u)}function uu(e,t,i){const r=Math.atan(i/t)/Math.PI*180;let n=(e-90)%360,a=0;return n>r&&n<180-r||n>180+r&&n<360-r||n<0?(n>270?n=360-n:n>180?n=n-180:n>90&&(n=180-n),a=Math.abs(i/Math.sin(n/180*Math.PI)/2)):(n>270?n=360-n:n>180?n=n-180:n>90&&(n=180-n),a=Math.abs(t/Math.cos(n/180*Math.PI)/2)),a}function Kn(e){if(typeof e=="string"&&e.startsWith("linear-gradient")){let t=e.slice(16,-2).split("deg,");if(t.length>1){let i=t[1].split("%,");const r=[];return i.forEach(n=>{if(/rgba?/.test(n)){let a=n.split(") ");r.push({color:aw(a[0]+")"),i:parseFloat(a[1])/100})}else{let a=n.split(" ");a.length>2?r.push({color:a[1],i:parseFloat(a[2])/100}):r.push({color:a[0],i:parseFloat(a[1])/100})}}),{angle:parseFloat(t[0]),colors:r}}else return{angle:parseFloat(t[0]),colors:[]}}else return{angle:0,colors:[]}}function aw(e){if(/rgba?/.test(e)){let t=e.split(",");if(t.length<3)return"";e="#";for(let i=0,r;r=t[i++];)if(i<4)r=parseInt(r.replace(/[^\d]/gi,""),10).toString(16),e+=r.length==1?"0"+r:r;else{r=r.replace(")","");let a=parseInt(r*255+"").toString(16);a=a.length===2?a:"0"+a,e+=a}e=e.toUpperCase()}return e}function sw(e,t){const{x:i,y:r,ex:n,width:a,height:s,center:o}=t.calculative.worldRect;let l=[{x:n,y:r+s/2},{x:i,y:r+s/2}];const{angle:h,colors:c}=Kn(t.calculative.lineGradientColors);let u=uu(h,a,s);return l.forEach(d=>{Zt(d,h,o)}),Zl(e,l,c,u)}function Zl(e,t,i,r){let n=tw(t[0].x,t[0].y,t[1].x,t[1].y,r),a=e.createLinearGradient(n[0],n[1],n[2],n[3]);return i.forEach(s=>{a.addColorStop(s.i,s.color)}),a}function Qr(e,t,i){let r=[];t.calculative.gradientColorStop?r=t.calculative.gradientColorStop:(r=Kn(t.calculative.lineGradientColors).colors,t.calculative.gradientColorStop=r),e.strokeStyle=Zl(e,i,r,t.calculative.lineWidth/2),e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.stroke()}function Dp(e,t){const i=t.calculative.worldAnchors;let r=t.calculative.lineWidth*(t.calculative.gradientSmooth||t.calculative.lineSmooth||0);for(let n=0;n<i.length-1;n++)if((t.lineName==="curve"||t.lineName==="mind")&&i[n].curvePoints){if(n>0){let o=i[n-1].curvePoints;o?ko(e,t,r,o[o.length-1],i[n],i[n].curvePoints[0]):ko(e,t,r,i[n-1],i[n],i[n].curvePoints[0]);let l=Cr(r,i[n],i[n].curvePoints[0]);Qr(e,t,[l,i[n].curvePoints[1]])}else Qr(e,t,[i[n],i[n].curvePoints[0]]),Qr(e,t,[i[n].curvePoints[0],i[n].curvePoints[1]]);let a=i[n].curvePoints.length-1;for(let o=1;o<a;o++)Qr(e,t,[i[n].curvePoints[o],i[n].curvePoints[o+1]]);let s=Cr(r,i[n+1],i[n].curvePoints[a]);Qr(e,t,[i[n].curvePoints[a],s])}else{let a=i[n],s=i[n+1];if(n>0&&n<i.length-1){let l=i[n-1].curvePoints;l?ko(e,t,r,l[l.length-1],i[n],i[n+1]):ko(e,t,r,i[n-1],i[n],i[n+1])}n>0&&n<i.length-1&&(a=Cr(r,i[n],i[n+1])),n<i.length-2&&(s=Cr(r,i[n+1],i[n]));let o=!1;if(n===0&&t.fromLineCap&&t.fromLineCap!=="butt"&&(e.save(),o=!0,e.lineCap=t.fromLineCap),n!==0&&n===i.length-2&&t.toLineCap&&t.toLineCap!=="butt"&&(e.save(),o=!0,e.lineCap=t.toLineCap),Qr(e,t,[a,s]),o&&e.restore(),i.length===2&&n===0){e.save(),o=!0,e.lineCap=t.toLineCap;let l=.1,h=.1;a.x-s.x===0?h=0:l=(a.y-s.y)/(a.x-s.x)*.1,Qr(e,t,[{x:s.x-h,y:s.y-l},s]),e.restore()}}}function Cr(e,t,i){let r=Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y));return r===0?{x:t.x,y:t.y}:e<r?{x:t.x+(i.x-t.x)*e/r,y:t.y+(i.y-t.y)*e/r}:{x:t.x+(i.x-t.x)/r/2,y:t.y+(i.y-t.y)/r/2}}function ko(e,t,i,r,n,a){let s=Cr(i,n,r),o=Cr(i,n,a),l={x:n.x,y:n.y},h=ow(t.calculative.canvas.store.data.smoothNum||20,s,l,o);for(let c=0;c<h.length-1;c++)Qr(e,t,[{x:h[c].x,y:h[c].y},{x:h[c+1].x,y:h[c+1].y}])}function Gd(e,t,i,r){let n=Cr(t,i,r),a={x:i.x,y:i.y};e.quadraticCurveTo(a.x,a.y,n.x,n.y)}function du(e){const t=e.calculative.worldAnchors;let i=e.calculative.lineWidth*(e.calculative.gradientSmooth||e.calculative.lineSmooth||0);const r=new Path2D;for(let n=0;n<t.length-1;n++){t[n];let a=t[n+1];if(n==0&&r.moveTo(t[n].x,t[n].y),n>0&&n<t.length-1){let s=t[n-1].curvePoints;Gd(r,i,t[n],t[n+1])}n>0&&n<t.length-1&&Cr(i,t[n],t[n+1]),n<t.length-2&&(a=Cr(i,t[n+1],t[n])),r.lineTo(a.x,a.y)}return r}function ow(e=100,t,i,r,n){let a=null;const s=[];!r&&!n?a=lw:r&&!n&&(a=cw);for(let o=0;o<e;o++)s.push(a(o/e,t,i,r,n));return r&&s.push(r),s}function lw(e,t,i){const{x:r,y:n}=t,{x:a,y:s}=i;let o=r+(a-r)*e,l=n+(s-n)*e;return{x:o,y:l}}function cw(e,t,i,r){const{x:n,y:a}=t,{x:s,y:o}=i,{x:l,y:h}=r;let c=(1-e)*(1-e)*n+2*e*(1-e)*s+e*e*l,u=(1-e)*(1-e)*a+2*e*(1-e)*o+e*e*h;return{x:c,y:u}}function hw(e,t){const{worldRect:i,lineGradientFromColor:r,lineGradientToColor:n,lineGradientAngle:a}=t.calculative;return Op(e,i,r,n,a)}function Op(e,t,i,r,n){if(!i||!r)return;const{x:a,y:s,center:o,ex:l,ey:h}=t,c={x:a,y:o.y},u={x:l,y:o.y};n%90===0&&n%180?(c.x=o.x,u.x=o.x,n%270?(c.y=s,u.y=h):(c.y=h,u.y=s)):n&&(Zt(c,n,t.center),Zt(u,n,t.center));const d=e.createLinearGradient(c.x,c.y,u.x,u.y);return d.addColorStop(0,i),d.addColorStop(1,r),d}function uw(e){const{worldIconRect:t,iconWidth:i,iconHeight:r,imgNaturalWidth:n,imgNaturalHeight:a,worldRect:s}=e.calculative;if(!t)return{x:s.x,y:s.y,width:s.width||n||e.calculative.img.naturalWidth,height:s.width||a||e.calculative.img.naturalHeight};let{x:o,y:l,width:h,height:c}=t;if(i&&(h=i),r&&(c=r),n&&a&&e.imageRatio){const u=t.width/n,d=t.height/a,f=Math.min(u,d),m=n/a;i?c=i/m:r?h=r*m:(h=f*n,c=f*a)}switch(o+=(t.width-h)/2,l+=(t.height-c)/2,e.iconAlign){case"top":l=t.y;break;case"bottom":l=t.ey-c;break;case"left":o=t.x;break;case"right":o=t.ex-h;break;case"left-top":o=t.x,l=t.y;break;case"right-top":o=t.ex-h,l=t.y;break;case"left-bottom":o=t.x,l=t.ey-c;break;case"right-bottom":o=t.ex-h,l=t.ey-c;break}return{x:o,y:l,width:h,height:c}}function ka(e,t){const{x:i,y:r,width:n,height:a}=uw(t),{worldIconRect:s,iconRotate:o,img:l}=t.calculative;if(e.filter=t.filter,o){const{x:h,y:c}=s.center;e.translate(h,c),e.rotate(o*Math.PI/180),e.translate(-h,-c)}if(t.imageRadius){e.save();let h=t.calculative.imageRadius||0,c=h;const{x:u,y:d,width:f,height:m,ex:p,ey:g}=t.calculative.worldRect;h<1&&(h=f*h,c=m*c);let y=h<c?h:c;f<2*y&&(y=f/2),m<2*y&&(y=m/2),e.beginPath(),e.moveTo(u+y,d),e.arcTo(p,d,p,g,y),e.arcTo(p,g,u,g,y),e.arcTo(u,g,u,d,y),e.arcTo(u,d,p,d,y),e.clip(),e.drawImage(l,i,r,n,a),e.restore()}else{let h=r,c=0;if(t.thumbImg){let u=l.naturalWidth,d=l.naturalHeight;c=(a/n*u-d)/2,a-2*c<0&&(c=(a-d/u*n)/2),h=r+c}e.drawImage(l,i,h,n,a-2*c)}}function Ur(e,t){const{textColor:i,color:r}=e.calculative,{styles:n}=t;return i||r||n.textColor||n.color}function Mp(e,t){const{fontStyle:i,fontWeight:r,fontSize:n,fontFamily:a,lineHeight:s,text:o,hiddenText:l,canvas:h,textHasShadow:c,textBackground:u,textType:d}=t.calculative;if(t.input&&!t.text&&t.calculative.canvas.inputDiv.dataset.penId!==t.id){e.save(),e.font=Ne({fontStyle:i,fontWeight:r,fontFamily:a,fontSize:n,lineHeight:s}),e.fillStyle=t.placeholderColor||"#c0c0c0";const O=t.calculative.worldTextRect;e.fillText(t.placeholder||"请输入",O.x,O.y+O.height/2),e.restore()}if(lu(o)||l||t.hiddenText)return;const f=h.store;e.save(),c||(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0);let m;t.calculative.disabled?m=t.disabledTextColor||t.disabledColor||We(.4,Ur(t,f)):t.calculative.hover?m=t.hoverTextColor||t.hoverColor||f.styles.hoverColor:t.calculative.active&&(m=t.activeTextColor||t.activeColor||f.styles.activeColor);let p;d===Oa.Linear?p=nw(e,t):d===Oa.Radial&&(p=rw(e,t)),e.fillStyle=m||p||Ur(t,f),e.font=Ne({fontStyle:i,fontWeight:r,fontFamily:a||f.options.fontFamily,fontSize:n,lineHeight:s}),(!t.calculative.textDrawRect||t.calculative.fontsChecked)&&cu(e,t);const{x:g,y,width:T,height:b}=t.calculative.textDrawRect;u&&(e.save(),e.fillStyle=u,e.fillRect(g,y,T,b),e.restore());const S=.55,I=t.textAlign||f.options.textAlign,D=n*s;t.calculative.textLines&&t.calculative.textLines.forEach((O,P)=>{const q=t.calculative.textLineWidths[P];let J=0;I==="center"?J=(T-q)/2:I==="right"&&(J=T-q),t.letterSpacing?dw(e,O,g+J,y+(P+S)*D,t.calculative.letterSpacing):e.fillText(O,g+J,y+(P+S)*D);const{textDecorationColor:A,textDecorationDash:x,textDecoration:R}=t;R&&fw(e,{x:g+J,y:y+(P+S)*D,width:q},{textDecorationColor:A,textDecorationDash:x,fontSize:n});const{textStrickoutColor:M,textStrickoutDash:Y,textStrickout:X}=t;X&&mw(e,{x:g+J,y:y+(P+S)*D,width:q},{textStrickoutColor:M,textStrickoutDash:Y,fontSize:n})}),e.restore()}function dw(e,t,i,r,n=0){if(n===0){e.fillText(t,i,r);return}let a=0;for(let s=0;s<t.length;s++)e.fillText(t[s],i+a,r),a+=e.measureText(t[s]).width+n}function fw(e,t,i){const{textDecorationColor:r,textDecorationDash:n,fontSize:a}=i;let{x:s,y:o,width:l}=t;switch(e.textBaseline){case"top":o+=a;break;case"middle":o+=a/2;break}e.save(),e.beginPath(),e.strokeStyle=r||e.fillStyle,e.lineWidth=1,e.moveTo(s,o),e.setLineDash(n||[]),e.lineTo(s+l,o),e.stroke(),e.restore()}function mw(e,t,i){const{textStrickoutColor:r,textStrickoutDash:n,fontSize:a}=i;let{x:s,y:o,width:l}=t;switch(e.textBaseline){case"top":o+=a/2;break;case"bottom":o-=a/2;break}e.save(),e.beginPath(),e.strokeStyle=r||e.fillStyle,e.lineWidth=1,e.moveTo(s,o),e.setLineDash(n||[]),e.lineTo(s+l,o),e.stroke(),e.restore()}function Pp(e,t,i){if(i==null)return;const{fontStyle:r,fontWeight:n,fontSize:a,fontFamily:s,lineHeight:o,canvas:l}=t.calculative,h=l.store;e.save();let c;t.calculative.hover?c=t.hoverTextColor||t.hoverColor||h.styles.hoverColor:t.calculative.active&&(c=t.activeTextColor||t.activeColor||h.styles.activeColor),e.fillStyle=c||Ur(t,h),e.font=Ne({fontStyle:r,fontWeight:n,fontFamily:s||h.options.fontFamily,fontSize:a,lineHeight:o});const u=e.measureText(i).width;let d,f;for(const m of t.calculative.worldAnchors){if(!f){f=m;continue}const p=Jl(f,m),g=Math.floor(p/u);d="";for(let T=0;T<g;T++)d+=i;const y=vi(f,m)-270;if(e.save(),y%360!==0){const{x:T,y:b}=f;e.translate(T,b);let S=y*Math.PI/180;e.rotate(S),e.translate(-T,-b)}e.fillText(d,f.x,f.y+o/2),e.restore(),f=m}e.restore()}function Np(e,t){const i=t.calculative.canvas.store;e.save(),e.shadowColor="",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.textAlign="center",e.textBaseline="middle";const r=t.calculative.worldIconRect;let n=r.x+r.width/2,a=r.y+r.height/2;switch(t.iconAlign){case"top":a=r.y,e.textBaseline="top";break;case"bottom":a=r.ey,e.textBaseline="bottom";break;case"left":n=r.x,e.textAlign="left";break;case"right":n=r.ex,e.textAlign="right";break;case"left-top":n=r.x,a=r.y,e.textAlign="left",e.textBaseline="top";break;case"right-top":n=r.ex,a=r.y,e.textAlign="right",e.textBaseline="top";break;case"left-bottom":n=r.x,a=r.ey,e.textAlign="left",e.textBaseline="bottom";break;case"right-bottom":n=r.ex,a=r.ey,e.textAlign="right",e.textBaseline="bottom";break}const s=t.calculative.iconWeight;let o;const l=t.calculative.iconFamily;t.calculative.iconSize>0?o=t.calculative.iconSize:r.width>r.height?o=r.height:o=r.width,e.font=Ne({fontSize:o,fontWeight:s,fontFamily:l}),e.fillStyle=t.calculative.iconColor||Ur(t,i),t.calculative.iconRotate&&(e.translate(r.center.x,r.center.y),e.rotate(t.calculative.iconRotate*Math.PI/180),e.translate(-r.center.x,-r.center.y)),e.beginPath(),e.fillText(t.calculative.icon,n,a),e.restore()}function Lp(e,t){if(!t.input)return;const i=t.calculative.canvas.store.data.scale,r=t.calculative.canvas.inputDiv.dataset.penId,{x:n,y:a,width:s,height:o}=t.calculative.worldRect;e.save(),e.beginPath(),t.id===r?(e.moveTo(n+s-20*i,a+o/2+2*i),e.lineTo(n+s-14*i,a+o/2-4*i),e.lineTo(n+s-8*i,a+o/2+2*i)):(e.moveTo(n+s-20*i,a+o/2-4*i),e.lineTo(n+s-14*i,a+o/2+2*i),e.lineTo(n+s-8*i,a+o/2-4*i)),e.stroke(),e.restore()}function Ne({fontStyle:e="normal",textDecoration:t="normal",fontWeight:i="normal",fontSize:r=12,fontFamily:n="Arial",lineHeight:a=1}={}){return`${e} ${t} ${i} ${r}px/${a} ${n}`}function Wn(e,t){const{x:i,ex:r,y:n,ey:a}=t.calculative.worldRect||{};t.calculative.flipX&&(e.translate(i+r,0),e.scale(-1,1)),t.calculative.flipY&&(e.translate(0,n+a),e.scale(1,-1))}function Mr(e,t,i=!1){if(t.parentId&&t.rotateByRoot){let r=Ge(t,!0);if(r){const{x:n,y:a}=r.calculative.worldRect.pivot||r.calculative.worldRect.center;e.translate(n,a);let s=r.calculative.rotate*Math.PI/180;i||(r.calculative.flipX&&(s*=-1),r.calculative.flipY&&(s*=-1)),e.rotate(s),e.translate(-n,-a)}}else{const{x:r,y:n}=t.calculative.worldRect.pivot||t.calculative.worldRect.center;e.translate(r,n);let a=t.calculative.rotate*Math.PI/180;i||(t.calculative.flipX&&(a*=-1),t.calculative.flipY&&(a*=-1)),e.rotate(a),e.translate(-r,-n)}}function _n(e,t,i){var u;e.save(),e.translate(.5,.5),e.beginPath(),Lw(e,t);const r=t.calculative.canvas.store,n=t.textFlip||r.options.textFlip,a=t.textRotate||r.options.textRotate;(!n||!a)&&e.save(),Wn(e,t),(t.rotateByRoot||t.calculative.rotate&&t.name!==Kd)&&Mr(e,t),(t.calculative.lineWidth>1||i)&&(e.lineWidth=t.calculative.lineWidth),Cw(e,r,t);let s,o=!1,l;t.calculative.disabled?(l=t.disabledColor||r.styles.disabledColor||We(.4,t.calculative.color||r.styles.color),s=t.disabledBackground||r.styles.disabledBackground||We(.4,t.calculative.background||r.styles.penBackground)):t.mouseDownValid&&t.calculative.mouseDown?(l=t.mouseDownColor||We(-.4,t.calculative.color||r.styles.color),s=t.mouseDownBackground||We(-.4,t.calculative.background||r.styles.penBackground)):t.switch&&t.calculative.checked?t.calculative.bkType||(s=t.onBackground):t.calculative.hover?(l=t.hoverColor||r.styles.hoverColor,s=t.hoverBackground||r.styles.hoverBackground):t.calculative.active?(l=t.activeColor||r.styles.activeColor,s=t.activeBackground||r.styles.activeBackground):t.calculative.isDock&&(t.type===$t.Line?l=r.styles.dockPenColor:s=ul(r.styles.dockPenColor,.2));const h=t.calculative.strokeImg;if(t.calculative.strokeImage&&h)e.strokeStyle=l||e.createPattern(h,gl);else{let d;t.calculative.strokeType?t.calculative.lineGradientColors?t.name===Kd?o=!0:t.calculative.lineGradient?d=t.calculative.lineGradient:(d=sw(e,t),t.calculative.lineGradient=d):d=hw(e,t):d=t.calculative.color||(t.type?r.data.lineColor:"")||r.styles.color,e.strokeStyle=l||d}const c=t.calculative.backgroundImg;if(t.calculative.backgroundImage&&c)e.fillStyle=s||e.createPattern(c,gl),s=!0;else{let d;t.calculative.bkType===Oa.Linear?t.calculative.gradientColors?t.calculative.gradient?d=t.calculative.gradient:(d=iw(e,t),t.calculative.gradient=d):d=Jb(e,t):t.calculative.bkType===Oa.Radial?t.calculative.gradientColors?t.calculative.radialGradient?d=t.calculative.radialGradient:(d=ew(e,t),t.calculative.radialGradient=d):d=Zb(e,t):d=t.calculative.background||r.styles.penBackground,e.fillStyle=s||d,s=!!d}if(Up(e,t),Fp(e,t),zn(e,t),t.calculative.lineDash&&e.setLineDash(t.calculative.lineDash.map(d=>d*t.calculative.canvas.store.data.scale)),t.calculative.lineDashOffset&&(e.lineDashOffset=t.calculative.lineDashOffset),t.calculative.shadowColor&&(e.shadowColor=t.calculative.shadowColor,e.shadowOffsetX=t.calculative.shadowOffsetX,e.shadowOffsetY=t.calculative.shadowOffsetY,e.shadowBlur=t.calculative.shadowBlur),o?(Dp(e,t),jp(!0,e,t,r)):(Bp(!0,e,t,r,s),Gp(e,t)),!(t.image&&t.calculative.img)&&t.calculative.icon&&Np(e,t),t.dropdownList&&Lp(e,t),(!n||!a)&&e.restore(),n&&!a&&Wn(e,t),!n&&a&&(t.rotateByRoot||t.calculative.rotate&&t.name!=="line")&&Mr(e,t,!0),Mp(e,t),t.type===$t.Line&&((u=t.fillTexts)==null?void 0:u.length)>0)for(const d of t.fillTexts)Pp(e,t,d);e.restore()}function Up(e,t){const i=t.lineCap||(t.type?"round":"square");e.lineCap=i}function Fp(e,t){const i=t.lineJoin;i?e.lineJoin=i:t.type&&(e.lineJoin="round")}function pl(e,t,i,r){var h,c;e.save(),i&&e.translate(-i.x,-i.y),(h=e.setAttrs)==null||h.call(e,t);let n=!1;const a=t.calculative.canvas.store,s=t.textFlip||a.options.textFlip,o=t.textRotate||a.options.textRotate;e.beginPath(),(!s||!o)&&e.save(),t.calculative.flipX&&(e.translate(t.calculative.worldRect.x+t.calculative.worldRect.ex,0),e.scale(-1,1)),t.calculative.flipY&&(e.translate(0,t.calculative.worldRect.y+t.calculative.worldRect.ey),e.scale(1,-1)),(t.rotateByRoot||t.calculative.rotate&&t.name!=="line")&&Mr(e,t),(t.calculative.lineWidth>1||r)&&(e.lineWidth=t.calculative.lineWidth);let l;if(t.calculative.hover)e.strokeStyle=t.hoverColor||a.styles.hoverColor,e.fillStyle=t.hoverBackground||a.styles.hoverBackground,l=t.hoverBackground||a.styles.hoverBackground;else if(t.calculative.active)e.strokeStyle=t.activeColor||a.styles.activeColor,e.fillStyle=t.activeBackground||a.styles.activeBackground,l=t.activeBackground||a.styles.activeBackground;else{if(t.strokeImage)t.calculative.strokeImg&&(e.strokeStyle=e.createPattern(t.calculative.strokeImg,gl),l=!0);else{let u;t.calculative.strokeType&&t.calculative.lineGradientColors&&t.name==="line"?n=!0:u=t.calculative.color||a.styles.color,e.strokeStyle=u}t.backgroundImage?t.calculative.backgroundImg&&(e.fillStyle=e.createPattern(t.calculative.backgroundImg,gl),l=!0):(e.fillStyle=t.background,l=!!t.background)}if(Up(e,t),Fp(e,t),zn(e,t),t.calculative.lineDash&&e.setLineDash(t.calculative.lineDash),t.calculative.lineDashOffset&&(e.lineDashOffset=t.calculative.lineDashOffset),t.calculative.shadowColor&&(e.shadowColor=t.calculative.shadowColor,e.shadowOffsetX=t.calculative.shadowOffsetX,e.shadowOffsetY=t.calculative.shadowOffsetY,e.shadowBlur=t.calculative.shadowBlur),n?(Dp(e,t),jp(!0,e,t,a)):(Bp(!1,e,t,a,l),Gp(e,t)),t.calculative.img?(e.save(),e.shadowColor="",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,ka(e,t),e.restore()):t.calculative.icon&&Np(e,t),t.dropdownList&&Lp(e,t),(!s||!o)&&e.restore(),s&&!o&&(t.calculative.flipX&&(e.translate(t.calculative.worldRect.x+t.calculative.worldRect.ex,0),e.scale(-1,1)),t.calculative.flipY&&(e.translate(0,t.calculative.worldRect.y+t.calculative.worldRect.ey),e.scale(1,-1))),!s&&o&&(t.rotateByRoot||t.calculative.rotate&&t.name!=="line")&&Mr(e,t,!0),Mp(e,t),t.type===$t.Line&&((c=t.fillTexts)==null?void 0:c.length)>0)for(const u of t.fillTexts)Pp(e,t,u);e.restore()}function Bp(e=!0,t,i,r,n){if(i.name==="drawCommand")return;const a=e?r.path2dMap.get(i):St.path2dDraws[i.name];let s=null,o=null;if(i.type===$t.Line&&(i.fromLineCap&&i.fromLineCap!=="butt"&&(t.lineCap="butt",s=new Path2D,s.moveTo(i.calculative.worldAnchors[0].x,i.calculative.worldAnchors[0].y),s.lineTo(i.calculative.worldAnchors[0].x,i.calculative.worldAnchors[0].y)),i.toLineCap&&i.toLineCap!=="butt"&&(t.lineCap="butt",o=new Path2D,o.moveTo(i.calculative.worldAnchors[i.calculative.worldAnchors.length-1].x,i.calculative.worldAnchors[i.calculative.worldAnchors.length-1].y),o.lineTo(i.calculative.worldAnchors[i.calculative.worldAnchors.length-1].x,i.calculative.worldAnchors[i.calculative.worldAnchors.length-1].y))),a){if(i.type===$t.Line&&i.borderWidth){t.save(),t.beginPath();const h=i.calculative.lineWidth+i.calculative.borderWidth;t.lineWidth=h,t.strokeStyle=i.borderColor,s&&(t.save(),t.lineCap=i.fromLineCap,t.stroke(s),t.restore()),a instanceof Path2D?(n&&t.fill(a),h&&t.stroke(a)):(a(i,t),n&&t.fill(),h&&t.stroke()),o&&(t.save(),t.lineCap=i.toLineCap,t.stroke(o),t.restore()),t.restore()}a instanceof Path2D?i.type?i.close&&n&&t.fill(a):n&&t.fill(a):(t.save(),a(i,t),n&&t.fill(),t.restore());const l=(i.calculative.progress-(i.calculative.min||0))/((i.calculative.max||1)-(i.calculative.min||0));if(l!=null&&!isNaN(l)){t.save();const{ex:h,x:c,y:u,width:d,height:f,ey:m}=i.calculative.worldRect;let p=null;if(i.calculative.verticalProgress?p=i.reverseProgress?t.createLinearGradient(c,u,c,u+f*l):t.createLinearGradient(c,m,c,u+f*(1-l)):p=i.reverseProgress?t.createLinearGradient(h,u,c+d*(1-l),u):t.createLinearGradient(c,u,c+d*l,u),i.calculative.progressGradientColors){const{colors:g}=Kn(i.calculative.progressGradientColors);g.forEach(y=>{p.addColorStop(y.i,y.color)})}else{const g=i.calculative.progressColor||i.calculative.color||r.options.activeColor||r.data.color;p.addColorStop(0,g),p.addColorStop(1,g)}p.addColorStop(1,"transparent"),t.fillStyle=p,a instanceof Path2D?t.fill(a):(a(i,t),t.fill()),t.restore()}if(i.calculative.lineWidth&&(a instanceof Path2D?(r.options.svgPathStroke||i.name!=="svgPath")&&(s&&(t.save(),t.lineCap=i.fromLineCap,t.stroke(s),t.restore()),t.stroke(a),o&&(t.save(),t.lineCap=i.toLineCap,t.stroke(o),t.restore())):(a(i,t),t.stroke())),i.type){if(i.calculative.animatePos){if(t.save(),Wp(t,i,r),i.lineAnimateType===ii.Arrow||i.lineAnimateType===ii.WaterDrop){let h=ev(i,t);h instanceof Path2D?(t.stroke(h),t.fill(h)):(t.stroke(),t.fill())}else a instanceof Path2D?(s&&!i.lineAnimateType&&(t.save(),t.lineCap=i.fromLineCap,t.stroke(s),t.restore()),t.lineCap=i.lineCap,t.stroke(a)):(a(i,t),t.stroke());t.restore()}i.fromArrow&&Rp(t,i,r),i.toArrow&&kp(t,i,r),i.calculative.active&&!i.calculative.pencil&&!r.options.disableAnchor&&!r.data.locked&&zp(t,i)}}}function jp(e=!0,t,i,r){const n=e?r.path2dMap.get(i):St.path2dDraws[i.name];if(n&&i.type){if(i.calculative.animatePos){if(t.save(),Wp(t,i,r),t.beginPath(),n instanceof Path2D)if(i.lineName==="polyline"||i.lineName==="line")if(i.lineAnimateType===ii.Arrow||i.lineAnimateType===ii.WaterDrop){const a=ev(i);t.stroke(a),t.fill(a)}else i.calculative.gradientSmooth||i.calculative.lineSmooth?(i.calculative.gradientAnimatePath||(i.calculative.gradientAnimatePath=du(i)),i.calculative.gradientAnimatePath instanceof Path2D&&t.stroke(i.calculative.gradientAnimatePath)):t.stroke(n);else t.stroke(n);else n(i,t),t.stroke();t.restore()}i.fromArrow&&Rp(t,i,r),i.toArrow&&kp(t,i,r),i.calculative.active&&!i.calculative.pencil&&!r.options.disableAnchor&&!r.data.locked&&zp(t,i)}}function Wp(e,t,i){e.strokeStyle=t.animateColor||i.styles.animateColor,t.animateShadow&&(e.shadowBlur=t.animateShadowBlur||t.animateLineWidth||6,e.shadowColor=t.animateShadowColor||t.animateColor||i.styles.animateColor),t.calculative.animateLineWidth&&(e.lineWidth=t.calculative.animateLineWidth*i.data.scale),Array.isArray(t.lineAnimateType)?t.lineAnimateType.forEach(r=>{$d(t,i,r,e)}):$d(t,i,t.lineAnimateType,e)}function $d(e,t,i,r){let n=0;switch(i){case ii.Beads:e.animateReverse?r.lineDashOffset=e.calculative.animatePos:r.lineDashOffset=e.length-e.calculative.animatePos,n=e.calculative.lineWidth||5,n<5&&(n=5);const a=e.animateLineDash&&e.animateLineDash.map(s=>s*n/5);r.setLineDash(a||[n,n*2]);break;case ii.Dot:e.animateReverse?r.lineDashOffset=e.calculative.animatePos:r.lineDashOffset=e.length-e.calculative.animatePos,n=e.calculative.animateDotSize||e.calculative.lineWidth*2||6,n<6&&(n=6),n>40&&(n=40),r.lineWidth=(e.calculative.animateLineWidth||n)*t.data.scale,r.setLineDash([.1,e.length]);break;case ii.Arrow:r.fillStyle=e.animateColor||t.styles.animateColor,r.lineWidth=1;break;case ii.WaterDrop:r.fillStyle=e.animateColor||t.styles.animateColor,r.lineWidth=1;break;case ii.Custom:switch(e.lineAnimateTargetType){case da.Image:if(e.lineAnimateImages??(e.lineAnimateImages=[]),e.lineAnimateImages.length>0){const l=e.lineAnimateImages.map((h,c)=>{const u=St.htmlElements[h];if(!u)e.calculative.canvas.__loadImage(h);else return u});Io(r,e,"image",l)}break;case da.Icon:const s=e.lineAnimateIcon;Io(r,e,"icon",s);break;case da.Pen:e.lineAnimatePens&&Io(r,e,"pen",e.lineAnimatePens);break;case da.Element:const o=e.lineAnimateElement;Io(r,e,"element",o)}break;default:e.animateReverse?(r.lineDashOffset=Number.EPSILON,r.setLineDash([0,e.length-e.calculative.animatePos+1,e.calculative.animatePos])):r.setLineDash([e.calculative.animatePos,e.length+.01-e.calculative.animatePos]);break}}function Io(e,t,i,r){let n=null;switch(i){case"image":n=gw(r);break;case"icon":n=vw(r);break;case"pen":let a=t.calculative.canvas.find(r);t.lineAnimateElementCount=a.length,n=pw(a);break;case"element":if(n=St.lineAnimateDraws[r],!n)return;break}yw(e,t,n)}function gw(e){return function(t,i,r,n){const a=i.calculative.canvas.store.data.scale,s=i.lineAnimateElementWidth||10,o=i.lineAnimateElementHeight||10,l=e[n%e.length];l&&(t.save(),t.translate(r.x,r.y),t.rotate(r.rotate*Math.PI/180),t.scale(a,a),t.drawImage(l,-s/2,-o/2,s,o),t.restore())}}function pw(e){return function(t,i,r,n){const a=e[n%e.length];if(!a)return;const s=i.calculative.canvas.store.data.scale,o=i.calculative.canvas.store.data.origin,l=i.calculative.canvas.parent,h=a.width,c=a.height,u=r.x-h/2,d=r.y-c/2,f=(u-o.x)/s,m=(d-o.y)/s,p=h/s,g=c/s,y={x:f,y:m,width:p,height:g,rotate:r.rotate};l.setValue({id:a.id,...y})}}function vw(e){return function(t,i,r,n){const a=i.calculative.canvas.store.data.scale;t.beginPath(),t.translate(r.x,r.y),t.rotate(r.rotate*Math.PI/180),t.scale(a,a);const s=i.calculative.iconWeight;let o;const l=i.calculative.iconFamily;o=i.calculative.iconSize||Math.max(i.lineAnimateElementWidth||0,i.lineAnimateElementHeight||0)||10,t.font=Ne({fontSize:o,fontWeight:s,fontFamily:l}),t.fillStyle=i.calculative.iconColor||Ur(i,i.calculative.canvas.parent.store),i.calculative.iconRotate&&t.rotate(i.calculative.iconRotate*Math.PI/180),t.beginPath(),t.fillText(e,0,0)}}function yw(e,t,i){var a;const r=t.calculative.canvas.store.data.scale,n=bl(t)/r;if(t.lineAnimateLoopMode)bw(e,t,i,n,r);else{const s=Array.isArray(t.lineAnimateDash)?t.lineAnimateDash:((a=t.lineAnimateDash)==null?void 0:a.split(",").map(l=>Number(l)))||[10,20];ww(n,s,t.lineAnimateDashOffset,t.lineAnimateElementCount).forEach((l,h)=>{const c=Th(t,l.start);if(c)try{e.save(),i(e,t,c,h),e.restore()}catch(u){e.restore(),console.warn(u)}})}}function bw(e,t,i,r,n){var h;const s=((Array.isArray(t.lineAnimateDash)?t.lineAnimateDash:((h=t.lineAnimateDash)==null?void 0:h.split(",").map(c=>Number(c)))||[10,20])[0]||30)*n,o=t.calculative.animatePos,l=t.calculative.worldAnchors;if(l.length>1){let c,u=0;for(let d=0;d<l.length;d++){let f=l[d];if(c){const m=t.length;let g=(o-u)%s-s,y=0;for(;g<m;){if(g>=0){const T=u+g,b=(o-T)/n;try{e.save();const S=Th(t,b);S&&i(e,t,S,y),e.restore()}catch(S){e.restore(),console.warn(S)}}g+=s,y++}u+=m}c=f}if(t.close){let d=l[0];if(c){const f=Math.sqrt((d.x-c.x)**2+(d.y-c.y)**2);let p=(o-u)%s-s,g=0;for(;p<f;){if(p>=0){const y=u+p,T=(o-y)/n;try{e.save();const b=Th(t,T);b&&i(e,t,b,g),e.restore()}catch(b){e.restore(),console.warn(b)}}p+=s,g++}}}}}function ww(e,t,i=0,r,n=0){const a=[];if(!t||t.length===0)return a.push({start:0,end:e,isDash:!0}),a;const s=t.reduce((c,u)=>c+u,0);let o=(-i+n)%s;o<0&&(o+=s);let l=0,h=0;for(r||(r=1/0);h<e&&l<r;)for(let c=0;c<t.length;c++){const u=t[c],d=c%2===0;let f=h,m=h+u-o;if(m>e&&(m=e),d&&m>f){const p=(f+n)%e,g=(m+n)%e;a.push({start:p,end:g,isDash:!0}),l+=1}if(h=m,o=0,h>=e||l>=r)break}return a}function Th(e,t=0){let i,r=null;if(e.calculative.worldAnchors.forEach(s=>{r&&(i=mf(i,r,r.next,s.prev,s)),r=s}),e.close){let s=e.calculative.worldAnchors[0];i=mf(i,r,r.next,s.prev,s)}let n=0;return e.animateReverse?n=e.length-e.calculative.animatePos-t*e.calculative.canvas.store.data.scale:n=e.calculative.animatePos-t*e.calculative.canvas.store.data.scale,CT(i,n)}function zp(e,t){const i=t.calculative.canvas.store;e.save(),e.lineWidth=1,e.fillStyle=t.activeColor||i.styles.activeColor,t.calculative.worldAnchors.forEach(r=>{!r.hidden&&!r.isTemp&&Tw(e,r,t)}),e.restore()}function Tw(e,t,i){if(!t)return;const r=i.calculative.canvas.store.activeAnchor===i.calculative.activeAnchor&&i.calculative.activeAnchor===t;let n=3;i.calculative.lineWidth>3&&(n=i.calculative.lineWidth),i.anchorRadius&&(n=i.anchorRadius),t.radius&&(n=t.radius),r?(t.prev&&(e.save(),e.strokeStyle="#4dffff",e.beginPath(),e.moveTo(t.prev.x,t.prev.y),e.lineTo(t.x,t.y),e.stroke(),e.restore(),e.save(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.prev.x,t.prev.y,n,0,Math.PI*2),e.fill(),e.stroke(),e.restore()),t.next&&(e.save(),e.strokeStyle="#4dffff",e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.next.x,t.next.y),e.stroke(),e.restore(),e.save(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.next.x,t.next.y,n,0,Math.PI*2),e.fill(),e.stroke(),e.restore(),e.beginPath(),e.arc(t.x,t.y,n,0,Math.PI*2),e.fill(),e.stroke()),e.beginPath(),e.arc(t.x,t.y,n,0,Math.PI*2),e.fill(),e.stroke()):(e.save(),e.fillStyle="#ffffff",e.beginPath(),e.arc(t.x,t.y,n,0,Math.PI*2),e.fill(),e.stroke(),e.restore())}function Vp(e){const t=e.calculative.canvas.store;let i={x:e.x,y:e.y};if(!e.parentId||e.parentId&&!t.pens[e.parentId])e.parentId=void 0,i.width=e.width,i.height=e.height,i.rotate=e.rotate,le(i),ne(i),e.pivot&&_h(i,e.pivot);else{const r=t.pens[e.parentId];let n=r.calculative.worldRect;n||(n=Vp(r)),i.x=n.x+n.width*e.x,i.y=n.y+n.height*e.y,i.width=n.width*e.width,i.height=n.height*e.height,r.flipX&&(i.x=n.width-(i.x-n.x+i.width)+n.x),r.flipY&&(i.y=n.height-(i.y-n.y+i.height)+n.y),le(i),i.rotate=n.rotate+e.rotate,ne(i),e.pivot&&_h(i,e.pivot)}return e.calculative.worldRect=i,fu(e,i),i}function fu(e,t){!e.paddingTop&&(e.calculative.paddingTop=0),!e.paddingBottom&&(e.calculative.paddingBottom=0),!e.paddingLeft&&(e.calculative.paddingLeft=0),!e.paddingRight&&(e.calculative.paddingRight=0),Math.abs(e.calculative.paddingTop)<1&&(e.calculative.paddingTop*=t.height),Math.abs(e.calculative.paddingBottom)<1&&(e.calculative.paddingBottom*=t.height),Math.abs(e.calculative.paddingLeft)<1&&(e.calculative.paddingLeft*=t.width),Math.abs(e.calculative.paddingRight)<1&&(e.calculative.paddingRight*=t.width)}function Jo(e){const t=lt(e.calculative.worldRect);if(delete t.pivot,!e.parentId){Object.assign(e,t);return}const r=e.calculative.canvas.store.pens[e.parentId].calculative.worldRect;Object.assign(e,Jr(t,r))}function Ia(e){const t=e.calculative.canvas.store;let i=[];if(e.anchors){let r=lt(e.anchors);e.flipX&&e.name!=="line"&&r.forEach(n=>{n.x=.5-(n.x-.5)}),e.flipY&&e.name!=="line"&&r.forEach(n=>{n.y=.5-(n.y-.5)}),r.forEach(n=>{i.push(Ew(e,n))})}if(!i.length&&!e.type&&!e.calculative.canvas.parent.isCombine(e)){const{x:r,y:n,width:a,height:s}=e.calculative.worldRect;for(let o=0;o<t.options.defaultAnchors.length;o++){const l=t.options.defaultAnchors[o];i.push({id:`${o}`,penId:e.id,x:r+a*l.x,y:n+s*l.y})}}e.calculative.rotate&&e.name!=="line"&&i.forEach(r=>{Zt(r,e.calculative.rotate,e.calculative.worldRect.pivot||e.calculative.worldRect.center)}),(!e.type||e.anchors)&&(e.calculative.worldAnchors=i),e.calculative.activeAnchor&&i.length&&(e.calculative.activeAnchor=i.find(r=>{r.id,e.calculative.activeAnchor.id})),e.calculative.gradientAnimatePath=void 0}function Hp(e){var t;if((t=e.children)!=null&&t.length){let i=e.calculative.worldRect;e.children.forEach(r=>{const n=e.calculative.canvas.store.pens[r];n.calculative.initRect&&n.calculative.initRelativeRect&&(n.calculative.initRect.x=i.x+i.width*n.calculative.initRelativeRect.x,n.calculative.initRect.y=i.y+i.height*n.calculative.initRelativeRect.y,n.calculative.initRect.ex=n.calculative.initRect.x+i.width*n.calculative.initRelativeRect.width,n.calculative.initRect.ey=n.calculative.initRect.y+i.height+n.calculative.initRelativeRect.height,ne(n.calculative.initRect)),Hp(n)})}}function Ew(e,t){const i={...t},{x:r,y:n,width:a,height:s}=e.calculative.worldRect;return i.x=r+a*t.x,i.y=n+s*t.y,t.prev&&(i.prev={penId:e.id,connectTo:t.prev.connectTo,x:r+a*t.prev.x,y:n+s*t.prev.y}),t.next&&(i.next={penId:e.id,connectTo:t.next.connectTo,x:r+a*t.next.x,y:n+s*t.next.y}),i}function Xd(e,t){if(!t.image&&!t.icon&&!t.thumbImg)return;const{paddingTop:i,paddingBottom:r,paddingLeft:n,paddingRight:a}=t.calculative;let s=n,o=i,l=t.calculative.worldRect.width-n-a,h=t.calculative.worldRect.height-i-r,c=t.calculative.iconLeft||0,u=t.calculative.iconTop||0;c&&Math.abs(c)<1&&(c=t.calculative.worldRect.width*c),u&&Math.abs(u)<1&&(u=t.calculative.worldRect.height*u),s+=c||0,o+=u||0,l-=c||0,h-=u||0;let d=t.calculative.iconRotate||0;if(t.parentId){const f=e[t.parentId].calculative;f&&(d+=f.rotate,d%=360)}s=t.calculative.worldRect.x+s,o=t.calculative.worldRect.y+o,t.calculative.worldIconRect={x:s,y:o,width:l,height:h,rotate:d},le(t.calculative.worldIconRect),ne(t.calculative.worldIconRect)}function ra(e,t,i){zs(e.calculative.worldRect,t,i,e.pivot),e.calculative.initRect&&zs(e.calculative.initRect,t,i,e.pivot),Yp(e,t,i),e.calculative.x&&hl(e.calculative,t,i),e.type&&Ia(e)}function Yp(e,t,i){var r;e&&(r=e.children)!=null&&r.length&&e.children.forEach(n=>{const a=e.calculative.canvas.store.pens[n];a&&(a.calculative.initRect&&zs(a.calculative.initRect,t,i),Yp(a,t,i))})}function _w(e,t){e.anchors||(e.anchors=[]),e.calculative.worldAnchors||(e.calculative.worldAnchors=[]);const i={id:t.id,penId:e.id,x:t.x,y:t.y};if(e.calculative.worldAnchors.push(i),e.calculative.worldRect){e.rotate%360&&Zt(t,-e.rotate,e.calculative.worldRect.center);const r={id:t.id,penId:e.id,x:(t.x-e.calculative.worldRect.x)/e.calculative.worldRect.width,y:(t.y-e.calculative.worldRect.y)/e.calculative.worldRect.height};e.anchors.push(r)}return i}function Sw(e,t,i){e.anchors||(e.anchors=[]),e.calculative.worldAnchors||(e.calculative.worldAnchors=[]);const r=_T(e,t,i);return e.calculative.worldAnchors.splice(i+1,0,r),e.anchors.splice(i+1,0,ws(r,e.calculative.worldRect)),e.calculative.activeAnchor=r,r}function Aw(e,t){if(!e||!e.calculative.worldAnchors)return;let i=e.calculative.worldAnchors.findIndex(r=>r.id===t.id);i>-1&&e.calculative.worldAnchors.splice(i,1),i=e.anchors.findIndex(r=>r.id===t.id),i>-1&&e.anchors.splice(i,1)}function Ma(e,t){if(!t||!t.calculative||!t.calculative.worldRect.center)return Bt.None;if(e.anchorId){let i=t.anchors.filter(r=>r.id===e.anchorId);if(i.length&&i[0].direction>-1)return i[0].direction}return Pb(e,t.calculative.worldRect.center)}function ma(e,t){let i=1/0,r;return e.calculative.worldAnchors.forEach(n=>{const a=Jl(t,n);i>a&&(i=a,r=n)}),r}function Qd(e,t,i){e.x+=t,e.y+=i,e.anchors&&e.anchors.forEach(r=>{bs(r,t,i)}),e.calculative.worldAnchors&&e.calculative.worldAnchors.forEach(r=>{bs(r,t,i)})}function mu(e){if(e&&e.calculative&&e.calculative.worldAnchors.length){let t=Gt(e);if(!e.anchors||!e.anchors.length)for(;e.calculative.worldAnchors.length&&t!==e.calculative.activeAnchor;)e.calculative.worldAnchors.pop(),t=Gt(e);else t===e.calculative.activeAnchor?e.calculative.worldAnchors=[e.calculative.worldAnchors[0]]:e.calculative.worldAnchors[0]===e.calculative.activeAnchor&&(e.calculative.worldAnchors=[e.calculative.worldAnchors[e.calculative.worldAnchors.length-1]])}}function Oe(e,t,i,r){var o,l,h,c,u,d;if(!e||!t||!i||!r||t.twoWay===je.DisableConnected||t.twoWay===je.Disable||r.twoWay===je.DisableConnectTo||r.twoWay===je.Disable)return;if(t.twoWay===je.In){if(i.calculative.worldAnchors.length===1)return;const f=Gt(i);if(r.id!==f.id)return}if(t.twoWay===je.Out){const f=ge(i);if(r.id!==f.id)return}if(r.connectTo===e.id&&r.anchorId===t.id)return;if(r.connectTo){const f=e.calculative.canvas.store.pens[r.connectTo];ga(f,Sn(f,r.anchorId),i,r)}e.connectedLines||(e.connectedLines=[]),e.connectedLines.findIndex(f=>f.lineId===i.id&&f.lineAnchor===r.id&&f.anchor===t.id)<0&&e.connectedLines.push({lineId:i.id,lineAnchor:r.id,anchor:t.id}),r.connectTo=e.id,r.anchorId=t.id,e.type&&Oe(i,r,e,t),e.calculative.canvas.store.emitter.emit("connectLine",{line:i,lineAnchor:r,pen:e,anchor:t});let a=((o=i.calculative.worldAnchors)==null?void 0:o.length)>=2?(l=i.calculative.worldAnchors)==null?void 0:l[0].connectTo:void 0,s=((h=i.calculative.worldAnchors)==null?void 0:h.length)>=2?(u=i.calculative.canvas.store.pens[(c=i.calculative.worldAnchors)==null?void 0:c[0].connectTo])==null?void 0:u.anchors.find(f=>{var m;return f.id===((m=i.calculative.worldAnchors)==null?void 0:m[0].anchorId)}):void 0;return(d=e.onConnectLine)==null||d.call(e,e,{line:i,lineAnchor:r,pen:e,anchor:t,fromPen:a,fromAnchor:s}),!0}function ga(e,t,i,r){if(!(!e||!t||!i||!r)&&!(!e.connectedLines||!e.connectedLines.length))return i.lastConnected||(i.lastConnected={}),i.lastConnected[e.id]||(i.lastConnected[e.id]=lt(e.connectedLines)),e.connectedLines.forEach((n,a,s)=>{(n.lineId===i.id||n.lineId===i.id)&&n.lineAnchor===r.id&&n.anchor===t.id&&s.splice(a,1)}),r.connectTo=void 0,r.anchorId=void 0,e.type&&t.connectTo===i.id&&t.anchorId===r.id&&ga(i,r,e,t),e.calculative.canvas.store.emitter.emit("disconnectLine",{line:i,lineAnchor:r,pen:e,anchor:t}),!0}function Sn(e,t){var i;if(!(!e||!t))return(i=e.calculative.worldAnchors)==null?void 0:i.find(r=>r.id===t)}function ge(e){if(!(!e||!e.calculative.worldAnchors))return e.calculative.worldAnchors[0]}function Gt(e){if(!(!e||!e.calculative.worldAnchors))return e.calculative.worldAnchors[e.calculative.worldAnchors.length-1]}function xw(e,t){var r,n;if(e.calculative.start===0||!e.frames||!e.frames.length)return e.calculative.start=void 0,0;if(!e.calculative.duration){e.calculative.duration=0;for(const a of e.frames){e.calculative.duration+=a.duration;for(const s in a)s!=="duration"&&!e[s]&&s==="scale"&&(e[s]=1)}}if(e.animateCycle||(e.animateCycle=1/0),e.calculative.start){let a=0;const s=Math.ceil((t-e.calculative.start)/e.calculative.duration);if(s>e.animateCycle)return e.currentAnimation=void 0,e.calculative.start=void 0,Zd(e,1),0;const o=(t-e.calculative.start)%e.calculative.duration||e.calculative.duration;let l=0;for(const u of e.frames)if(l+=u.duration,o>l)++a;else break;if(!e.frames[a])return!0;let h=!1;a!==e.calculative.frameIndex&&(h=!0,e.calculative.frameIndex=a,e.calculative.frameDuration=e.frames[a].duration,a>0&&(e.calculative.frameStart+=e.frames[a-1].duration),e.calculative.frameEnd=e.calculative.frameStart+e.calculative.frameDuration);let c=!1;if(s>e.calculative.cycleIndex&&(e.calculative.cycleIndex=s,e.calculative.frameStart=e.calculative.start+e.calculative.duration*(s-1),c=!0),h||c)if(e.calculative.x=e.calculative.initRect.x,e.calculative.y=e.calculative.initRect.y,(n=e.children)!=null&&n.length&&!e.parentId?e.calculative.canvas.rotatePen(e,(e.calculative.initRect.rotate||0)-(e.calculative.rotate||0),e.calculative.initRect):e.calculative.rotate=e.calculative.initRect.rotate||0,a>0){e.prevFrame={};const u=e.frames[a-1];for(const d in u)e.prevFrame[d]=u[d];Object.assign(e.prevFrame,{rotate:u.rotate||0,x:u.x||0,y:u.y||0,scale:u.scale||1})}else Jd(e)}else{if(e.calculative.start=t,e.calculative.frameIndex=0,e.calculative.frameStart=e.calculative.start,e.calculative.frameDuration=e.frames[0].duration,e.calculative.frameEnd=e.calculative.frameStart+e.calculative.frameDuration,e.calculative.cycleIndex=1,e.calculative.x=e.calculative.worldRect.x,e.calculative.y=e.calculative.worldRect.y,e.calculative.initRect=lt(e.calculative.worldRect),e.parentId&&(e.calculative.initRelativeRect={x:e.x,y:e.y,width:e.width,height:e.height}),(r=e.children)!=null&&r.length){const a=e.calculative.canvas.store;e.calculative.childrenVisible={},e.children.forEach(s=>{e.calculative.childrenVisible[s]=a.pens[s].visible})}e.calculative.initRect.rotate=e.calculative.rotate||0,Jd(e)}const i=(t-e.calculative.frameStart)/e.calculative.frameDuration%1;return i>0&&Zd(e,i),!0}function Jd(e){e.prevFrame={};for(const t in e)(typeof e[t]!="object"||t==="lineDash")&&(e.prevFrame[t]=e[t]);e.prevFrame.rotate=0,e.prevFrame.x=0,e.prevFrame.y=0,e.prevFrame.scale=1}function Zd(e,t){var n,a,s,o,l,h;if(t<0)return;t>1&&(t=1);const i=e.frames[e.calculative.frameIndex],r=e.calculative.canvas.store.data.scale;for(const c in i)if(c!=="duration"){if(c==="scale"){e.calculative.worldRect=lt(e.calculative.initRect),zs(e.calculative.worldRect,e.prevFrame.scale,e.calculative.worldRect.center);const u=e.prevFrame.scale+(i[c]-e.prevFrame.scale)*t;zs(e.calculative.worldRect,u/e.prevFrame.scale,e.calculative.worldRect.center),e.calculative.patchFlags=!0}else if(c==="x"){const u=ns(e,c,e.calculative.frameIndex)*r;e.calculative.worldRect.x=e.calculative.initRect.x+u,e.calculative.worldRect.ex=e.calculative.initRect.ex+u,e.calculative.worldRect.center.x=e.calculative.initRect.center.x+u,(n=e.calculative.worldRect.pivot)!=null&&n.x&&(e.calculative.worldRect.pivot.x=((a=e.calculative.initRect.pivot)==null?void 0:a.x)+u),Pn(e.calculative.worldRect,i[c]*t*r,0),e.calculative.patchFlags=!0}else if(c==="y"){const u=ns(e,c,e.calculative.frameIndex)*r;e.calculative.worldRect.y=e.calculative.initRect.y+u,e.calculative.worldRect.ey=e.calculative.initRect.ey+u,e.calculative.worldRect.center.y=e.calculative.initRect.center.y+u,(s=e.calculative.worldRect.pivot)!=null&&s.x&&(e.calculative.worldRect.pivot.y=((o=e.calculative.initRect.pivot)==null?void 0:o.y)+u),Pn(e.calculative.worldRect,0,i[c]*t*r),e.calculative.patchFlags=!0}else if(c==="width"){const u=ns(e,c,e.calculative.frameIndex)*r;e.calculative.worldRect.width=e.calculative.initRect.width+u,e.calculative.worldRect.ex=e.calculative.initRect.ex+u,e.calculative.worldRect.center.x=e.calculative.initRect.center.x+u;let d=i[c]*t*r;e.calculative.worldRect.width+=d,e.calculative.worldRect.ex+=d,e.calculative.worldRect.center.x+=d,e.calculative.patchFlags=!0}else if(c==="height"){const u=ns(e,c,e.calculative.frameIndex)*r;e.calculative.worldRect.height=e.calculative.initRect.height+u,e.calculative.worldRect.ey=e.calculative.initRect.ey+u,e.calculative.worldRect.center.y=e.calculative.initRect.center.y+u;let d=i[c]*t*r;e.calculative.worldRect.height+=d,e.calculative.worldRect.ey+=d,e.calculative.worldRect.center.y+=d,e.calculative.patchFlags=!0}else if(c==="rotate"){e.prevFrame[c]>=360&&(e.prevFrame[c]%=360);const u=ns(e,c,e.calculative.frameIndex),d=(e.calculative.initRect.rotate+u+i[c]*t)%360-(e.calculative.rotate||0);(l=e.children)!=null&&l.length?e.calculative.canvas.rotatePen(e,d,e.calculative.initRect):e.calculative.rotate=(e.calculative.initRect.rotate+u+i[c]*t)%360,e.calculative.patchFlags=!0}else if(c==="image")e.image=i.image,e.calculative.image=void 0,e.calculative.canvas.loadImage(e),e.canvasLayer===Ht.CanvasImageBottom?e.calculative.canvas.canvasImageBottom.init():e.canvasLayer===Ht.CanvasImage&&e.calculative.canvas.canvasImage.init();else if(Rw(i[c],c,e)){e.prevFrame[c]==null&&(c==="globalAlpha"?e.prevFrame[c]=1:e.prevFrame[c]=0);const u=e.prevFrame[c]+(i[c]-e.prevFrame[c])*t;e.calculative[c]=Math.round(u*100)/100}else{if(c==="visible"&&!e.calculative.image){if((h=e.children)!=null&&h.length){const d=di(e,e.calculative.canvas.store);e.calculative.canvas.initImageCanvas(d)}}e.calculative[c]=i[c];const u={};u[c]=i[c],gu(e,u)}c==="text"&&to(e)}}function Rw(e,t,i){const r=["strokeType","bkType","showChild"];return typeof e=="number"&&i.linear!==!1&&!r.includes(t)}function kw(e,t){if(e.calculative.start===0)return e.calculative.start=void 0,e.calculative.cycleStart=void 0,0;e.animateCycle||(e.animateCycle=1/0),e.animateSpan||(e.animateSpan=1);const i=(t-e.calculative.cycleStart)/1e3;if(e.curveAnimate){let r=[];e.animateTimingFunction?r=Array.isArray(e.animateTimingFunction)?e.animateTimingFunction:e.animateTimingFunction.split(","):r=[.25,.25,.75,.75];const n=e.duration||5,a=i/n,s=qb(a,r[1],r[3]);e.calculative.animatePos=s*e.length}else e.calculative.animatePos+=e.animateSpan*(e.calculative.canvas.store.data.scale||1);if(e.calculative.cycleStart||(e.calculative.cycleStart=t),!e.calculative.start)e.calculative.start=Date.now(),e.calculative.animatePos=e.animateSpan*(e.calculative.canvas.store.data.scale||1),e.calculative.cycleIndex=1;else if(e.calculative.animatePos>e.length||e.curveAnimate&&i>e.duration){if(++e.calculative.cycleIndex,e.calculative.cycleIndex>e.animateCycle)return e.currentAnimation=void 0,e.calculative.start=void 0,e.calculative.cycleStart=void 0,0;e.calculative.cycleStart=void 0,e.calculative.animatePos=e.animateSpan}return!0}function sa(e,t=!0){if(!e.children||e.childActive===!1)return;const i=e.calculative.canvas.store;e.children.forEach(r=>{const n=i.pens[r];n&&(n.calculative.active=t,sa(n,t))})}function fs(e,t=!0){if(!e)return;const i=e.calculative.canvas.store;e.calculative.hover=t,e.childHover!==!1&&e.children&&e.children.forEach(r=>{var n,a;((n=i.pens[r])==null?void 0:n.hoverColor)==null&&((a=i.pens[r])==null?void 0:a.hoverBackground)==null&&fs(i.pens[r],t)})}function Se(e,t){if(!t)return;const i=e.calculative.canvas.store,r=e.calculative.worldRect;if(t.style.opacity=e.globalAlpha+"",t.style.position="absolute",t.style.outline="none",t.style.left=r.x+i.data.x+"px",t.style.top=r.y+i.data.y+"px",t.style.width=r.width+"px",t.style.height=r.height+"px",e.name==="iframe"?t.style.opacity=e.calculative.inView?"1":"0":t.style.display=e.calculative.inView!=!1?e.calculative.cssDisplay||"inline":"none",!e.calculative.rotate&&(e.calculative.rotate=0),t.style.transform=`rotate(${e.calculative.rotate}deg)`,e.calculative.rotate||(e.calculative.flipX&&(t.style.transform="rotateY(180deg)"),e.calculative.flipY&&(t.style.transform="rotateX(180deg)"),e.calculative.flipX&&e.calculative.flipY&&(t.style.transform="rotateZ(180deg)")),t.style.zIndex=e.calculative.zIndex!==void 0?e.calculative.zIndex+"":"5",e.calculative.zIndex>e.calculative.canvas.maxZindex&&(e.calculative.canvas.maxZindex=e.calculative.zIndex),e.locked===jt.DisableEdit||e.locked===jt.DisableMove||i.data.locked?(t.style.userSelect="initial",t.style.pointerEvents="initial",e.name==="gif"&&(t.style.userSelect="none",t.style.pointerEvents="none")):(t.style.userSelect="none",t.style.pointerEvents="none"),e.className&&(t.className=e.className),e.styles)for(let n in e.styles)t.style[n]=e.styles[n]}function Bc(e){return e.every(t=>t.locked)}function tf(e){return e.every(t=>t.disableRotate)}function qp(e,t,i){var r;e.rotateByRoot||(e.name==="line"?(e.calculative.worldAnchors.forEach(n=>{Zt(n,t,i.center)}),Iw(e),Jo(e)):(e.calculative.rotate?e.calculative.rotate+=t:e.calculative.rotate=t,Zt(e.calculative.worldRect.center,t,i.center),e.parentId&&(e.calculative.worldRect.x=e.calculative.worldRect.center.x-e.calculative.worldRect.width/2,e.calculative.worldRect.y=e.calculative.worldRect.center.y-e.calculative.worldRect.height/2,e.x=(e.calculative.worldRect.x-i.x)/i.width,e.y=(e.calculative.worldRect.y-i.y)/i.height)),(r=e.children)==null||r.forEach(n=>{const a=e.calculative.canvas.store.pens[n];qp(a,t,i)}))}function Iw(e){var n;if(!((n=e.calculative.worldAnchors)!=null&&n.length)||!isFinite(e.x)||!isFinite(e.x)||e.x==null||e.y==null)return;const t=xh(e);e.parentId||Object.assign(e,t);const{fontSize:i,lineHeight:r}=e.calculative.canvas.store.options;e.fontSize?e.fontSize<0&&(e.fontSize=0,e.calculative.fontSize=0):(e.fontSize=i>=0?i:12,e.calculative.fontSize=e.fontSize*e.calculative.canvas.store.data.scale),e.lineHeight||(e.lineHeight=r,e.calculative.lineHeight=e.lineHeight),ne(t),e.calculative.worldRect=t,fu(e,t),Ji(e),e.calculative.worldAnchors&&(e.anchors=e.calculative.worldAnchors.map(a=>ws(a,e.calculative.worldRect)))}function ef(e){return e.every(t=>t.disableSize||t.pivot)}function ns(e,t,i){if(!e.frames||!t)return 0;let r=0;for(let n=0;n<i;n++)e.frames[n]&&(r+=e.frames[n][t]||0);return r}function vl(e,t){var r;let i=e;for(;i&&i.parentId;){const n=i;i=t.pens[i.parentId];const a=(r=i==null?void 0:i.calculative)==null?void 0:r.showChild;if(a!=null&&i.children[a]!==n.id)return!1}return!0}function kr(e,t=!1){var n,a,s,o;const{store:i,canvasRect:r}=e.calculative.canvas;if(t&&((n=e.children)==null||n.forEach(l=>{const h=i.pens[l];h&&kr(h,!0)})),e.calculative.inView=!0,vl(e,i)?(e.visible==!1||e.calculative.visible==!1)&&(e.calculative.inView=!1,(e.canvasLayer===Ht.CanvasImageBottom||e.canvasLayer===Ht.CanvasImage)&&((a=e.frames)!=null&&a.length)&&(e.calculative.inView=e.frames.some(l=>l.hasOwnProperty("visible")))):e.calculative.inView=!1,e.calculative.inView){const{x:l,y:h,width:c,height:u,rotate:d}=e.calculative.worldRect,f={x:l+i.data.x,y:h+i.data.y,width:c,height:u,rotate:d};le(f),Dr(f,r)||(e.calculative.inView=!1)}i.data.locked&&e.calculative.inView&&((s=i.data.roles)!=null&&s.length)&&(e.calculative.inView=Kp(e,i.data.roles)),(o=e.calculative.singleton)!=null&&o.div&&Se(e,e.calculative.singleton.div)}function Kp(e,t){var i;return(i=e.roles)!=null&&i.length?t==null?void 0:t.some(r=>e.roles.includes(r)):e.parentId?Kp(Ge(e,!1),t):!0}function Cw(e,t,i){if(t.fillWorldTextRect){e.save(),e.fillStyle="#c3deb7";const{x:r,y:n,width:a,height:s}=i.calculative.worldTextRect;e.fillRect(r,n,a,s),e.restore()}}function zn(e,t){const i=t.calculative.globalAlpha;typeof i=="number"&&i<1&&!isNaN(i)&&(e.globalAlpha=i)}function Gp(e,t){const i=Dw(e,t)||St.canvasDraws[t.name];i&&(e.save(),i(e,t),e.restore())}function Dw(e,t){const i=t.drawCommand;if(!(!i||t.name==="line"))return(r,n)=>{i.forEach(a=>{try{a.steps=a.steps.flat(1/0),a.steps.reduce((s,o)=>{const l=Ow(o,n,s.x,s.y);try{if(l.c){if(l.c.startsWith("_")){const c=l.c.split("_")[1];return typeof l.v.value=="number"&&(l.v.value*=n.calculative.canvas.store.data.scale),(l.p||r)[c]=l.v.value,{x:s.x,y:s.y}}let h=[];for(const c in l.v)h.push(l.v[c]);return(l.p||r)[l.c](...h),{x:l.startX||l.v.x,y:l.startY||l.v.y}}return{x:s.x,y:s.y}}catch{}},{})}catch{}}),r.stroke()}}function Ow(e,t,i,r){var a;const n={visio:Nw,dxf:Mw,canvas:Pw};return((a=n[t.parseType])==null?void 0:a.call(n,e,t,i,r))||e}function Mw(e,t,i,r){const{x:n,y:a,width:s,height:o}=t.calculative.worldRect,{originWidth:l,originHeight:h}=t.dxfOrigin;switch(e.c){case"beginPath":return{c:"beginPath",v:{}};case"closePath":return{c:"closePath",v:{}};case"moveTo":return{c:"moveTo",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a}};case"lineTo":return{c:"lineTo",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a}};case"arc":return{c:"ellipse",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a,rx:e.v.xr*(s/l),ry:e.v.yr*(o/h),rotation:e.v.rotation||0,startAngle:e.v.startAngle,endAngle:e.v.endAngle,a:e.v.aclockwise??!0}};case"ellipse":return{c:"ellipse",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a,rx:e.v.xr*(s/l),ry:e.v.yr*(o/h),rotation:e.v.rotation||0,startAngle:e.v.startAngle,endAngle:e.v.endAngle,a:e.v.aclockwise??!0}};case"_font":return{c:"_font",v:{value:e.v.fontSize*t.calculative.canvas.store.data.scale+"px "+(e.v.fontFamily||t.calculative.canvas.store.options.fontFamily)}};case"_fillStyle":return{c:"_fillStyle",v:{value:t.color||e.v.value}};default:const c={c:e.c,v:{...e.v}};return c.v.x!==void 0&&(c.v.x=e.v.x*(s/l)+n),c.v.y!==void 0&&(c.v.y=e.v.y*(o/h)+a),c}}function Pw(e,t,i,r){const{x:n,y:a,width:s,height:o}=t.calculative.worldRect,{originWidth:l,originHeight:h}=t.origin;switch(e.c){case"beginPath":return{c:"beginPath",v:{}};case"closePath":return{c:"closePath",v:{}};case"moveTo":return{c:"moveTo",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a}};case"lineTo":return{c:"lineTo",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a}};case"arc":return{c:"ellipse",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a,rx:e.v.xr*(s/l),ry:e.v.yr*(o/h),rotation:e.v.rotation||0,startAngle:e.v.startAngle,endAngle:e.v.endAngle,a:e.v.aclockwise??!0}};case"ellipse":return{c:"ellipse",v:{x:e.v.x*(s/l)+n,y:e.v.y*(o/h)+a,rx:e.v.xr*(s/l),ry:e.v.yr*(o/h),rotation:e.v.rotation||0,startAngle:e.v.startAngle,endAngle:e.v.endAngle,a:e.v.aclockwise??!0}};case"_font":return{c:"_font",v:{value:e.v.fontSize*t.calculative.canvas.store.data.scale+"px "+(e.v.fontFamily||t.calculative.canvas.store.options.fontFamily)}};default:const c={c:e.c,v:{...e.v}};return c.v.x!==void 0&&(c.v.x=e.v.x*(s/l)+n),c.v.y!==void 0&&(c.v.y=e.v.y*(o/h)+a),c}}function Nw(e,t,i,r){const{x:n,y:a,width:s,height:o}=t.calculative.worldRect,{width:l,height:h}=t.origin;switch(e.c){case"MoveTo":return{c:"moveTo",v:{x:+e.v.X*100*(s/l)+n,y:+e.v.Y*100*(o/h)+a}};case"RelMoveTo":return{c:"moveTo",v:{x:+e.v.X*l*(s/l)+n,y:+e.v.Y*h*(o/h)+a}};case"LineTo":return{c:"lineTo",v:{x:+e.v.X*100*(s/l)+n,y:+e.v.Y*100*(o/h)+a}};case"RelLineTo":return{c:"lineTo",v:{x:+e.v.X*l*(s/l)+n,y:+e.v.Y*h*(o/h)+a}};case"Ellipse":let c=e.v.X,u=e.v.Y,d=Math.abs(e.v.A-e.v.C),f=Math.abs(e.v.B-e.v.D);return{c:"ellipse",v:{x:c*100*(s/l)+n,y:u*100*(o/h)+a,radiuX:d*100*(s/l),radiuY:f*100*(o/h),rotation:0,startAngle:0,endAngle:Math.PI*2,anticlockwise:!0}};case"EllipticalArcTo":const m=e.v.X*100*(s/l)+n,p=e.v.Y*100*(o/h)+a,g=e.v.A*100*(s/l)+n,y=e.v.B*100*(o/h)+a;e.v.C;const T=e.v.D*(s/o)*(h/l),b=(m-i)*(y-r)-(p-r)*(g-i)>0,S=rf(i,r,m,p,g,y,T);return!e.orign&&(e.orign={}),!e.orign.startA&&(e.orign.startA=Co(S.x0,S.y0,i,r)),!e.orign.endA&&(e.orign.endA=Co(S.x0,S.y0,m,p)),{c:"ellipse",v:{centerX:S.x0,centerY:S.y0,radiuX:S.a,radiuY:S.b,rotation:0,startAngle:e.orign.startA,endAngle:e.orign.endA,anticlockwise:b},startX:m,startY:p};case"RelEllipticalArcTo":const I=e.v.X*l*(s/l)+n,D=e.v.Y*h*(o/h)+a,O=e.v.A*l*(s/l)+n,P=e.v.B*h*(o/h)+a;e.v.C;const q=e.v.D*(s/o)*(h/l),J=(I-i)*(P-r)-(D-r)*(O-i)>0,A=rf(i,r,I,D,O,P,q);return!e.orign&&(e.orign={}),!e.orign.startA&&(e.orign.startA=Co(A.x0,A.y0,i,r)),!e.orign.endA&&(e.orign.endA=Co(A.x0,A.y0,I,D)),{c:"ellipse",v:{centerX:A.x0,centerY:A.y0,radiuX:A.a,radiuY:A.b,rotation:0,startAngle:e.orign.startA,endAngle:e.orign.endA,anticlockwise:J},startX:I,startY:D};case"ArcTo":let x=e.v.X*100*s/l+n,R=e.v.Y*100*o/h+a,M=e.v.A*100*t.calculative.canvas.store.data.scale,Y=(i+x)/2,X=(r+R)/2,et=Math.sqrt((x-i)**2+(R-r)**2);if(Math.abs(M)<.001||et<.001)return{c:"lineTo",v:{x,y:R}};let z=et*et/(8*Math.abs(M))+Math.abs(M)/2,W=-(R-r)/et,$=(x-i)/et,L=z-Math.abs(M),N=Y-Math.sign(M)*W*L,V=X-Math.sign(M)*$*L,H=Math.atan2(r-V,i-N),Q=Math.atan2(R-V,x-N),rt=Q-H;for(;rt>Math.PI;)rt-=2*Math.PI;for(;rt<-Math.PI;)rt+=2*Math.PI;let tt=M>0;return(tt&&rt>0||!tt&&rt<0)&&([H,Q]=[Q,H],tt=!tt),{c:"arc",v:{x:N,y:V,radius:z,startAngle:H,endAngle:Q,anticlockwise:tt},startX:x,startY:R};default:const it=lt(e);return Object.entries(it.v).forEach(([w,_])=>{var C,F;(C=w.endsWith)!=null&&C.call(w,"_x")?typeof _=="number"&&(it.v[w]=_*(s/l)+n):(F=w.endsWith)!=null&&F.call(w,"_y")?typeof _=="number"&&(it.v[w]=_*(o/h)+a):typeof _=="number"&&(it.v[w]=_)}),it}}function Lw(e,t){e.filter=t.filter}function gu(e,t){for(const i in t)Sp.includes(i)&&(i=="fontSize"&&t[i]<0&&(t[i]=0),e[i]=t[i],["fontSize","lineWidth"].includes(i)?(e.calculative[i]=t[i]*e.calculative.canvas.store.data.scale,Ji(e)):e.calculative[i]=t[i]),e.image&&e.name!=="gif"&&Ep.includes(i)&&(e.calculative.canvas.store.patchFlagsTop=!0,e.calculative.canvas.store.patchFlagsBackground=!0,e.calculative.imageDrawed=!1);if(e.calculative.canvas.parent.isCombine(e)){const i=e.children;i==null||i.forEach(r=>{let n=lt(t);e.calculative.childrenVisible&&e.calculative.childrenVisible[r]===!1&&delete n.visible;const a=e.calculative.canvas.store.pens[r];a&&gu(a,n)})}}function rf(e,t,i,r,n,a,s){let o=(e-i)*(e+i)*(r-a)-(i-n)*(i+n)*(t-r)+s*s*(t-r)*(r-a)*(t-a),l=2*((e-i)*(r-a)-(i-n)*(t-r)),h=o/l,c=(e-i)*(i-n)*(e-n)+s*s*((i-n)*(t-r)*(t+r)-(e-i)*(r-a)*(r+a)),u=2*s*s*((i-n)*(t-r)-(e-i)*(r-a)),d=c/u,f=Math.sqrt(Math.pow(e-h,2)+Math.pow(s*(t-d),2)),m=f/s;return{x0:h,y0:d,a:f,b:m}}function Co(e,t,i,r){let n=i-e,a=r-t,s=Math.atan2(a,n);return s<0&&(s+=2*Math.PI),s}function nf(e,t,i){let r,n,a=1/0,s=1/0;const o=8;for(const l of e.data.pens){if(l.calculative.inView===!1)continue;pu(l).forEach(c=>{if(c===t||c===i)return;let u=(l.calculative.worldRect.center.x-t.x)*(l.calculative.worldRect.center.x-t.x)+(l.calculative.worldRect.center.y-t.y)*(l.calculative.worldRect.center.y-t.y);const d=Math.abs(c.x-t.x);d>0&&d<o&&u<a&&(r={x:Math.round(c.x)+.5,y:Math.round(c.y)+.5,prev:{x:Math.round(t.x)+.5,y:Math.round(t.y)+.5},step:c.x-t.x},a=u);const f=Math.abs(c.y-t.y);f>0&&f<o&&u<s&&(n={x:Math.round(c.x)+.5,y:Math.round(c.y)+.5,prev:{x:Math.round(t.x)+.5,y:Math.round(t.y)+.5},step:c.y-t.y},s=u)})}return{xDock:r,yDock:n}}function Uw(e,t,i,r){let n=[];return i.length===1?(n=lt(pu(i[0])),n.forEach(a=>{a.x+=r.x,a.y+=r.y})):(ne(t),n=[t.center,...Pr(t)]),$p(e,n,t,!0)}function pu(e){if(e.type){if(e.type===$t.Line)return e.calculative.worldAnchors}else{const t=Pr(e.calculative.worldRect);return ne(e.calculative.worldRect),[...e.calculative.worldAnchors,...t,e.calculative.worldRect.center]}}function Fw(e,t,i,r){const n=Pr(t);return $p(e,n,t)}function $p(e,t,i,r=!1){let n,a,s=1/0,o=1/0;const l=10,h=Yw(i,l);return e.data.pens.forEach(c=>{const{inView:u,worldRect:d,active:f}=c.calculative;if(u===!1||!r&&f||Hw(h,d)||c.type&&e.active.some(p=>Xp(e,p,c)))return;const m=pu(c);if(m)for(const p of m)for(const g of t){const y=p.x-g.x,T=p.y-g.y,b=Math.abs(y),S=Math.abs(T);i.center||(i.center={x:i.x+i.width/2,y:i.y+i.height/2}),b<l&&b<s&&(n={x:Math.round(p.x)+.5,y:Math.round(p.y)+.5,step:y,prev:{x:Math.round(g.x)+.5,y:Math.round(g.y)+.5},penId:c.id,anchorId:g.id,dockAnchorId:p.id},s=b),S<l&&S<o&&(a={x:Math.round(p.x)+.5,y:Math.round(p.y)+.5,step:T,prev:{x:Math.round(g.x)+.5,y:Math.round(g.y)+.5},penId:c.id,anchorId:g.id,dockAnchorId:p.id},o=S)}}),{xDock:n,yDock:a}}function Xp(e,t,i){if(!i.type)return!1;if(Array.isArray(t==null?void 0:t.connectedLines)){for(const r of t==null?void 0:t.connectedLines)if(r.lineId===i.id)return!0}if(Array.isArray(t==null?void 0:t.children))for(const r of t.children){const n=e.pens[r];if(Xp(e,n,i))return!0}return!1}function Eh(e,t){return e.toFixed(12)==t}function Bw(e,t=4){let i=e.map(h=>h.calculative.worldRect);const r=i.map(h=>h.x),n=i.map(h=>h.y),a=r.reduce((h,c)=>h+c,0)/r.length,s=n.reduce((h,c)=>h+c,0)/n.length,o=Math.sqrt(r.map(h=>Math.pow(h-a,2)).reduce((h,c)=>h+c,0)/r.length),l=Math.sqrt(n.map(h=>Math.pow(h-s,2)).reduce((h,c)=>h+c,0)/n.length);return e.filter(h=>{let c=h.calculative.worldRect;const u=(c.x-a)/o,d=(c.y-s)/l;return Math.sqrt(u*u+d*d)>t})}function af(e){if(e.id=Mt(),Array.isArray(e.anchors))for(const t of e.anchors)e.type&&(t.id=Mt()),t.penId=e.id,t.prev&&(e.type&&(t.prev.id=Mt()),t.prev.penId=e.id),t.next&&(e.type&&(t.next.id=Mt()),t.next.penId=e.id)}function jw(){let e=null,t=new Map;return(i,r,n,a=!1)=>{if(t.has(i)&&t.get(i)?e=t.get(i):t.set(i,e=new Map),typeof n!="function")return()=>{console.warn("[rewritePenLifeCycle] warn: not a function ")};let s=new Set,o=new Map;e.has(r)&&e.get(r)?s=e.get(r):(o.set(r,i[r]),e.set(r,s)),a?s.delete(n):s.add(n);let l=o.get(r),h=(...c)=>{l==null||l(...c),s.forEach(u=>{u(...c)})};i[r]=h}}let Ww=jw();function zw(e){return!e.name&&!e.install?(console.error("installPenPlugin Error: Validation Failed"),!1):!0}function yr(e,t){if(!t)return;if(t.ex==null&&le(t),!t.rotate||t.rotate%360===0)return e.x>t.x&&e.x<t.ex&&e.y>t.y&&e.y<t.ey;t.center||ne(t);const i=[{x:t.x,y:t.y},{x:t.ex,y:t.y},{x:t.ex,y:t.ey},{x:t.x,y:t.ey}];return i.forEach(r=>{Zt(r,t.rotate,t.pivot||t.center)}),Vw(e,i)}function Vn(e,t,i=0){const{x:r,y:n,ex:a,ey:s}=t;return e.x>=r-i&&e.x<=a+i&&e.y>=n-i&&e.y<=s+i}function ne(e){e.center||(e.center={}),e.center.x=e.x+e.width/2,e.center.y=e.y+e.height/2}function le(e){e.ex=e.x+e.width,e.ey=e.y+e.height}function _h(e,t){e.pivot||(e.pivot={}),e.pivot.x=e.x+e.width*t.x,e.pivot.y=e.y+e.height*t.y}function Vw(e,t){if(t.length<3)return!1;let i=!1,r=t[t.length-1];for(const n of t)r.y>e.y!=n.y>e.y&&n.x+(e.y-n.y)*(r.x-n.x)/(r.y-n.y)>e.x&&(i=!i),r=n;return i}function Di(e){const t=[];e.forEach(r=>{if(r.isRuleLine)return;const n=r.calculative.worldRect;if(n){const a=Pr(n);t.push(...a)}});const i=eo(t);return ne(i),i}function Pr(e){const t=[{x:e.x,y:e.y},{x:e.ex,y:e.y},{x:e.ex,y:e.ey},{x:e.x,y:e.ey}];return e.rotate&&(e.center||ne(e),t.forEach(i=>{Zt(i,e.rotate,e.pivot||e.center)})),t}function eo(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;return e==null||e.forEach(a=>{!isFinite(a.x)||!isFinite(a.y)||(t=Math.min(t,a.x),i=Math.min(i,a.y),r=Math.max(r,a.x),n=Math.max(n,a.y))}),{x:t,y:i,ex:r,ey:n,width:r-t,height:n-i}}function Dr(e,t,i){return e.rotate&&(e=eo(Pr(e))),i?e.x>t.x&&e.ex<t.ex&&e.y>t.y&&e.ey<t.ey:!(e.x>t.ex||e.ex<t.x||e.ey<t.y||e.y>t.ey)}function Hw(e,t){return(t.x>e.ex||t.ex<e.x)&&(t.y>e.ey||t.ey<e.y)}function Yw(e,t){const i=Rr(t),r={x:e.x-i[3],y:e.y-i[0],width:e.width+i[1]+i[3],height:e.height+i[0]+i[2]};return le(r),r}function Pn(e,t,i){e.x+=t,e.y+=i,e.ex+=t,e.ey+=i,e.center&&(e.center.x+=t,e.center.y+=i),e.pivot&&(e.pivot.x+=t,e.pivot.y+=i)}function qw(e,t){const i=(e.to.y-e.from.y)/(e.to.x-e.from.x),r=(t.to.y-t.from.y)/(t.to.x-t.from.x);return Sh({k:i,point:e.from},{k:r,point:t.from})}function Sh(e,t){if(Eh(e.k,0))return{x:t.point.x,y:e.point.y};if(Eh(t.k,0))return{x:e.point.x,y:t.point.y};const i=e.point.y-e.k*e.point.x,n=(t.point.y-t.k*t.point.x-i)/(e.k-t.k),a=e.k*n+i;return{x:n,y:a}}function Kw(e,t){const i=qw({from:e[0],to:e[2]},{from:e[1],to:e[3]});for(const r of e)Zt(r,-t,i);return eo(e)}function sf(e,t,i,r){let n=e.rotate?e.rotate%360:0;if(n){const a=Pr(e),s=(a[0].y-a[1].y)/(a[0].x-a[1].x),o=(a[1].y-a[2].y)/(a[1].x-a[2].x);if(r<4){if(a[r].x+=t,e.ratio)if(r===0||r===2){let c=t*Math.tan((90-(360-n)-Math.atan(e.width/e.height)/Math.PI*180)/180*Math.PI);a[r].y+=c}else{let c=t*Math.tan((90-(360-n)+Math.atan(e.width/e.height)/Math.PI*180)/180*Math.PI);a[r].y+=c}else a[r].y+=i;const h=a[(r+2)%4];a[(r+1)%4]=Sh({k:r%2?o:s,point:a[r]},{k:r%2?s:o,point:h}),a[(r+4-1)%4]=Sh({k:r%2?s:o,point:a[r]},{k:r%2?o:s,point:h})}else{const h=[4,6].includes(r)?o:s;Eh(h,0)?(a[r%4].x+=t,a[(r+1)%4].x+=t):(a[r%4].y+=i,a[r%4].x+=i/h,a[(r+1)%4].y+=i,a[(r+1)%4].x+=i/h)}if((a[0].x-a[1].x)**2+(a[0].y-a[1].y)**2<25||(a[1].x-a[2].x)**2+(a[1].y-a[2].y)**2<25)return;const l=Kw(a,e.rotate);ne(l),Object.assign(e,l);return}switch(r){case 0:if(e.width-t<5||e.height-i<5)break;e.x+=t,e.y+=i,e.width-=t,e.height-=i;break;case 1:if(e.width+t<5||e.height-i<5)break;e.ex+=t,e.y+=i,e.width+=t,e.height-=i;break;case 2:if(e.width+t<5||e.height+i<5)break;e.ex+=t,e.ey+=i,e.width+=t,e.height+=i;break;case 3:if(e.width-t<5||e.height+i<5)break;e.x+=t,e.ey+=i,e.width-=t,e.height+=i;break;case 4:if(e.height-i<5)break;e.y+=i,e.height-=i;break;case 5:if(e.width+t<5)break;e.ex+=t,e.width+=t;break;case 6:if(e.height+i<5)break;e.ey+=i,e.height+=i;break;case 7:if(e.width-t<5)break;e.x+=t,e.width-=t;break}}function zs(e,t,i,r){e&&(e.width*=t,e.height*=t,hl(e,t,i),le(e),ne(e),r&&_h(e,r))}function Jr(e,t){const i={x:(e.x-t.x)/t.width,y:(e.y-t.y)/t.height,width:e.width/t.width,height:e.height/t.height};return le(i),i}function ws(e,t){const{x:i,y:r,width:n,height:a}=t,{penId:s,connectTo:o}=e,l=Object.assign({},e,{x:n?(e.x-i)/n:0,y:a?(e.y-r)/a:0});return e.prev&&(l.prev={penId:s,connectTo:o,x:n?(e.prev.x-i)/n:0,y:a?(e.prev.y-r)/a:0}),e.next&&(l.next={penId:s,connectTo:o,x:n?(e.next.x-i)/n:0,y:a?(e.next.y-r)/a:0}),l}function Gw(e,t){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){let a=t[r].x,s=t[r].y,o=t[n].x,l=t[n].y;s>e.y!=l>e.y&&e.x<(o-a)*(e.y-s)/(l-s)+a&&(i=!i)}return i}const $w=/^[\t\n\f\r ]*([MLHVZCSQTAmlhvzcsqta])[\t\n\f\r ]*/,of=/^[01]/,ee=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,Xw=/^(([\t\n\f\r ]+,?[\t\n\f\r ]*)|(,[\t\n\f\r ]*))/,Qw={M:[ee,ee],L:[ee,ee],H:[ee],V:[ee],Z:[],C:[ee,ee,ee,ee,ee,ee],S:[ee,ee,ee,ee],Q:[ee,ee,ee,ee],T:[ee,ee],A:[ee,ee,ee,of,of,ee,ee]};function Jw(e){let t=0;const i=[];for(;t<e.length;){const r=e.slice(t).match($w);if(r!==null){const n=r[1];t+=r[0].length;const a=iT(n,e,t);t=a.cursor,i.push(...a.commands)}else throw new Error("malformed path (first error at "+t+")")}return{commands:i}}function lf(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;return nT(e),e.commands.forEach(a=>{a.worldPoints.forEach((s,o)=>{o%2===0?(s<t&&(t=s),s>r&&(r=s)):(s<i&&(i=s),s>n&&(n=s))})}),{x:t,y:i,ex:r,ey:n,width:r-t+1,height:n-i+1}}function Zw(e,t,i){i==null&&(i=t),e.commands.forEach((r,n)=>{if(!(r.relative&&n))switch(r.key){case"A":case"a":r.values[5]+=t,r.values[6]+=i;break;case"V":case"v":r.values[0]+=i;break;default:r.values.forEach((a,s)=>{r.values[s]=a+(s%2===0?t:i)});break}})}function tT(e,t,i){i==null&&(i=t),e.commands.forEach(r=>{switch(r.key){case"A":case"a":const n=r.values[0],a=r.values[1],s=Math.PI*r.values[2]/180,o=Math.cos(s),l=Math.sin(s),h=a*a*i*i*o*o+n*n*i*i*l*l,c=2*t*i*o*l*(a*a-n*n),u=n*n*t*t*o*o+a*a*t*t*l*l,d=-(n*n*a*a*t*t*i*i),f=c*c-4*h*u,m=Math.sqrt((h-u)*(h-u)+c*c);r.values[2]=c!==0?Math.atan((u-h-m)/c)*180/Math.PI:h<u?0:90,r.values[0]=-Math.sqrt(2*f*d*(h+u+m))/f,r.values[1]=-Math.sqrt(2*f*d*(h+u-m))/f,r.values[5]*=t,r.values[6]*=i,r.values[4]=t*i>=0?r.values[4]:1-r.values[4];break;case"V":case"v":r.values[0]*=i;break;default:r.values.forEach((p,g)=>{r.values[g]=p*(g%2===0?t:i)});break}})}function eT(e){let t="";return e.commands.forEach(i=>{t+=i.key+" ",i.values.forEach(r=>{t+=r+" "})}),t}function iT(e,t,i){const r=Qw[e.toUpperCase()],n=[];for(;i<=t.length;){const a={key:e,values:[]};for(const s of r){const o=t.slice(i).match(s);if(o!==null){a.values.push(+o[0]),i+=o[0].length;const l=t.slice(i).match(Xw);l!==null&&(i+=l[0].length)}else{if(a.values.length===0)return{cursor:i,commands:n};throw new Error("malformed path (first error at "+i+")")}}if(a.relative=a.key.toUpperCase()!==a.key,n.push(a),r.length===0)return{cursor:i,commands:n};e==="m"&&(e="l"),e==="M"&&(e="L")}throw new Error("malformed path (first error at "+i+")")}function rT(e,t){const i=[];let r=e.relative&&t?{x:t.worldPoints[t.worldPoints.length-2],y:t.worldPoints[t.worldPoints.length-1]}:{x:0,y:0};for(let n=0;n<e.values.length-1;n+=2)i.push(r.x+e.values[n]),i.push(r.y+e.values[n+1]);e.worldPoints=i}function nT(e){let t,i=0,r=0;e.commands.forEach(n=>{switch(n.key){case"Z":case"z":n.worldPoints=[i,r];break;case"H":n.worldPoints=[n.values[0],t.worldPoints[t.worldPoints.length-1]];break;case"h":n.worldPoints=[n.values[0]+t.worldPoints[t.worldPoints.length-2],t.worldPoints[t.worldPoints.length-1]];break;case"V":n.worldPoints=[t.worldPoints[t.worldPoints.length-2],n.values[0]];break;case"v":n.worldPoints=[t.worldPoints[t.worldPoints.length-2],n.values[0]+t.worldPoints[t.worldPoints.length-1]];break;case"A":n.worldPoints=[t.worldPoints[t.worldPoints.length-2],n.values[0]+t.worldPoints[t.worldPoints.length-1]];break;default:rT(n,t);break}(n.key==="M"||n.key==="m"||n.key==="Z"||n.key==="z")&&(i=n.worldPoints[n.worldPoints.length-2],r=n.worldPoints[n.worldPoints.length-1]),t=n})}function aT(e,t){var l;const r=e.calculative.canvas.store.data.paths[e.pathId];if(!r)return new Path2D;const n=Jw(r);e.calculative.svgRect=lf(n),ne(e.calculative.svgRect),(e.calculative.svgRect.width!==e.calculative.worldRect.width||e.calculative.svgRect.height!==e.calculative.worldRect.height)&&tT(n,e.calculative.worldRect.width/e.calculative.svgRect.width,e.calculative.worldRect.height/e.calculative.svgRect.height);const a=lf(n);ne(a),Zw(n,e.calculative.worldRect.x-a.x,e.calculative.worldRect.y-a.y);const s=eT(n);if(t){(l=t.svgPath)==null||l.call(t,s);return}return new Path2D(s)}function sT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r+a/2,n),i.lineTo(r+a,n+s/2),i.lineTo(r+a/2,n+s),i.lineTo(r,n+s/2),i.lineTo(r+a/2,n),i.closePath(),i instanceof Path2D)return i}function oT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r+a/2,n),i.lineTo(r+a,n+s),i.lineTo(r,n+s),i.lineTo(r+a/2,n),i.closePath(),i instanceof Path2D)return i}function lT(e){const t=[{x:.5,y:0},{x:.75,y:.5},{x:.5,y:1},{x:.25,y:.5}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function cT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r+a/2,n),i.lineTo(r+a,n+s*2/5),i.lineTo(r+a*4/5,n+s),i.lineTo(r+a/5,n+s),i.lineTo(r,n+s*2/5),i.closePath(),i instanceof Path2D)return i}function hT(e){const t=[{x:.5,y:0},{x:1,y:.4},{x:.8,y:1},{x:.2,y:1},{x:0,y:.4}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function uT(e,t){e.onResize||(e.onResize=dT);const i=t||new Path2D,{width:r,height:n,center:a}=e.calculative.worldRect,s=r>n?n:r,o=a.x,l=a.y,h=l-s/2,c=l-s/4,u=-(c-l)*Math.sin(Math.PI/180*324)+o,d=(c-l)*Math.cos(Math.PI/180*324)+l;i.moveTo(u,d);for(let f=0;f<5;++f)i.lineTo(-(h-l)*Math.sin(Math.PI/180*72*f)+o,(h-l)*Math.cos(Math.PI/180*72*f)+l),i.lineTo((u-o)*Math.cos(Math.PI/180*72*(f+1))-(d-l)*Math.sin(Math.PI/180*72*(f+1))+o,(u-o)*Math.sin(Math.PI/180*72*(f+1))+(d-l)*Math.cos(Math.PI/180*72*(f+1))+l);if(i.closePath(),i instanceof Path2D)return i}function Qp(e){const{width:t,height:i}=e,r=t>i?i:t,n=[];for(let a=0;a<5;++a)n.push({flag:1,id:String(a),penId:e.id,x:.5+r/2*Math.sin(Math.PI/180*72*a)/t,y:-r/2*Math.cos(Math.PI/180*72*a)/i+.5});e.anchors=n}function dT(e){const t=e.anchors.filter(i=>i.flag!==1);Qp(e),e.anchors=e.anchors.concat(...t)}function fT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r+a/4,n),i.lineTo(r+a*3/4,n),i.lineTo(r+a,n+s/2),i.lineTo(r+a*3/4,n+s),i.lineTo(r+a*1/4,n+s),i.lineTo(r,n+s/2),i.lineTo(r+a/4,n),i.closePath(),i instanceof Path2D)return i}function mT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r,n+s/2),i.lineTo(r+s/2,n),i.lineTo(r+s/2,n+s/3),i.lineTo(r+a,n+s/3),i.lineTo(r+a,n+s*2/3),i.lineTo(r+s/2,n+s*2/3),i.lineTo(r+s/2,n+s*2/3),i.lineTo(r+s/2,n+s),i.closePath(),i instanceof Path2D)return i}function gT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r,n+s/3),i.lineTo(r+(a-s/2),n+s/3),i.lineTo(r+(a-s/2),n),i.lineTo(r+a,n+s/2),i.lineTo(r+(a-s/2),n+s),i.lineTo(r+(a-s/2),n+s*2/3),i.lineTo(r,n+s*2/3),i.closePath(),i instanceof Path2D)return i}function pT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r,n+s/2),i.lineTo(r+s/2,n),i.lineTo(r+s/2,n+s/3),i.lineTo(r+(a-s/2),n+s/3),i.lineTo(r+(a-s/2),n),i.lineTo(r+a,n+s/2),i.lineTo(r+(a-s/2),n+s),i.lineTo(r+(a-s/2),n+s*2/3),i.lineTo(r+s/2,n+s*2/3),i.lineTo(r+s/2,n+s),i.closePath(),i instanceof Path2D)return i}function vT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s,ey:o}=e.calculative.worldRect;if(i.moveTo(r,n),i.lineTo(r+a,n),i.lineTo(r+a,n+s*3/4),i.lineTo(r+a*8/16,n+s*3/4),i.lineTo(r+a/4,o),i.lineTo(r+a*5/16,n+s*3/4),i.lineTo(r,n+s*3/4),i.closePath(),i instanceof Path2D)return i}function yT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r+a/5,n+s*13/16),i.bezierCurveTo(r-a/15,n+s*13/16,r-a/15,n+s*7/16,r+a/5,n+s*7/16),i.bezierCurveTo(r+a/5,n,r+a*4/5,n,r+a*4/5,n+s*7/16),i.bezierCurveTo(r+a*16/15,n+s*7/16,r+a*16/15,n+s*13/16,r+a*4/5,n+s*13/16),i.closePath(),i instanceof Path2D)return i}function bT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,ex:s,ey:o}=e.calculative.worldRect,l=a/6;if(i.moveTo(r,n),i.lineTo(s-l,n),i.lineTo(s,n+l),i.lineTo(s,o),i.lineTo(r,o),i.closePath(),i.moveTo(s-l,n),i.lineTo(s-l,n+l),i.lineTo(s,n+l),i.closePath(),i instanceof Path2D)return i}function wT(e,t){const{x:i,y:r,width:n,ex:a,ey:s}=t.calculative.worldRect;let o=n*.25;const l=t.z;l>1?o=l*t.calculative.canvas.store.data.scale:l>0&&(o=n*l);const h={x:i,y:r+o},c={x:a-o,y:r+o},u={x:a-o,y:s};jc(e,[h,c,u,{x:i,y:s}],t.backgroundFront||t.background,t.color),jc(e,[h,{x:i+o,y:r},{x:a,y:r},c],t.backgroundUp||t.background,t.color),jc(e,[c,{x:a,y:r},{x:a,y:s-o},u],t.backgroundRight||t.background,t.color)}function jc(e,t,i="",r=""){e.save(),i&&(e.fillStyle=i),r&&(e.strokeStyle=r),e.beginPath();for(let n=0;n<t.length;++n)n?e.lineTo(t[n].x,t[n].y):e.moveTo(t[n].x,t[n].y);e.closePath(),i&&e.fill(),e.stroke(),e.restore()}function TT(e,t){const i=t||new Path2D,{x:r,y:n,width:a,ex:s,ey:o}=e.calculative.worldRect,l=a/4,h=r+a/2;if(i.arc(h,n+l,l,0,Math.PI*2),i.moveTo(r,n+l*3),i.lineTo(s,n+l*3),i.moveTo(h,n+l*2),i.lineTo(h,n+l*4),i.moveTo(h,n+l*4),i.lineTo(r,o),i.moveTo(h,n+l*4),i.lineTo(s,o),i.closePath(),i instanceof Path2D)return i}function ET(e,t,i){if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),i)t.calculative.activeAnchor&&(t.calculative.activeAnchor.next={penId:t.id,x:i.x,y:i.y},Jl(t.calculative.activeAnchor.next,t.calculative.activeAnchor)<5?t.calculative.activeAnchor.next=void 0:(t.calculative.activeAnchor.prev={...t.calculative.activeAnchor.next},Zt(t.calculative.activeAnchor.prev,180,t.calculative.activeAnchor)));else{const r=t.calculative.worldAnchors[0];if(!r.next){const a=Ma(r,e.pens[r.connectTo]);cf(r,a,50),r.prev=void 0}const n=t.calculative.worldAnchors[t.calculative.worldAnchors.length-1];if(n&&n!==r&&!n.prev){const a=Ma(n,e.pens[n.connectTo]);cf(n,a,-50),n.next=void 0}}}function cf(e,t,i){switch(t){case Bt.Up:e.prev={penId:e.penId,x:e.x,y:e.y+i},e.next={penId:e.penId,x:e.x,y:e.y-i};break;case Bt.Right:e.prev={penId:e.penId,x:e.x-i,y:e.y},e.next={penId:e.penId,x:e.x+i,y:e.y};break;case Bt.Bottom:e.prev={penId:e.penId,x:e.x,y:e.y-i},e.next={penId:e.penId,x:e.x,y:e.y+i};break;case Bt.Left:e.prev={penId:e.penId,x:e.x+i,y:e.y},e.next={penId:e.penId,x:e.x-i,y:e.y};break}}function Ah(e,t,i,r){const n=1-e,a=n*n*t.x+2*n*e*i.x+e*e*r.x,s=n*n*t.y+2*n*e*i.y+e*e*r.y;return{x:a,y:s,step:e}}function Jp(e,t,i,r,n){const{x:a,y:s}=t,{x:o,y:l}=n,{x:h,y:c}=i,{x:u,y:d}=r,f=1-e,m=a*f*f*f+3*h*e*f*f+3*u*e*e*f+o*e*e*e,p=s*f*f*f+3*c*e*f*f+3*d*e*e*f+l*e*e*e;return{x:m,y:p,step:e}}function Gr(e,t,i){return{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)}}function _T(e,t,i){let r=e.calculative.worldAnchors[i],n=e.calculative.worldAnchors[i+1];!n&&e.close&&(n=e.calculative.worldAnchors[0]);const a=t.step;let s;if(r.next&&n.prev){const o=r,l=r.next,h=n.prev,c=n,u=Gr(o,l,a),d=Gr(l,h,a),f=Gr(h,c,a),m=Gr(u,d,a),p=Gr(d,f,a);s=Gr(m,p,a),m.penId=e.id,s.prev=m,p.penId=e.id,s.next=p,r.next.x=u.x,r.next.y=u.y,n.prev.x=f.x,n.prev.y=f.y}else if(r.next||n.prev){const o=r,l=r.next||n.prev,h=n,c=Gr(o,l,a),u=Gr(l,h,a);s=t,c.penId=e.id,u.penId=e.id,s.prev=c,s.next=u,r.next=void 0,n.prev=void 0}else s=t;return s.penId=e.id,s.id=Mt(),s.prevNextType=jn.Bilateral,s}function ST(e,t,i){if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),t.calculative.worldAnchors.length<2)return;let r=t.calculative.activeAnchor,n=i||Gt(t);if(!r||!n)return;const a=20,s=e.pens[r.connectTo];let o=Ma(r,s);switch(o===Bt.None&&(n.x>r.x?o=Bt.Right:o=Bt.Left),r.next={id:Mt(),penId:t.id,x:r.x,y:r.y,prevNextType:2},n.prev={id:Mt(),penId:t.id,x:n.x,y:n.y,prevNextType:2},o){case Bt.Up:r.next.y-=a,n.prev.y=r.y;break;case Bt.Bottom:r.next.y+=a,n.prev.y=r.y;break;case Bt.Left:r.next.x-=a,n.prev.x=r.x;break;default:r.next.x+=a,n.prev.x=r.x;break}}function AT(e,t){const i=t||new Path2D;if((e.lineName==="line"||e.lineName==="polyline")&&e.calculative.lineSmooth){let n=du(e);if(i instanceof Path2D&&i.addPath(n),i instanceof Path2D)return i}const r=e.calculative.worldAnchors;if(r.length>1){let n;r.forEach(a=>{n?hf(i,n,a):a.start=!0,n=a}),e.close&&(e.lineName==="curve"?hf(i,n,r[0]):i.closePath())}if(i instanceof Path2D)return i}function xT(e,t,i){var a;if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),t.calculative.worldAnchors.length<2||((a=t.anchors)==null?void 0:a.length)>1)return;const r=ge(t),n=Gt(t);!r||!n||!n.id||r===n||(r.next=void 0,mu(t),n.prev=void 0,t.calculative.worldAnchors.push(n))}function hf(e,t,i){!i||i.isTemp||(t.start&&e.moveTo(t.x,t.y),t.next?i.prev?e.bezierCurveTo(t.next.x,t.next.y,i.prev.x,i.prev.y,i.x,i.y):e.quadraticCurveTo(t.next.x,t.next.y,i.x,i.y):i.prev?e.quadraticCurveTo(i.prev.x,i.prev.y,i.x,i.y):e.lineTo(i.x,i.y))}function xh(e){return bl(e),eo(Zp(e))}function Zp(e){const t=[];let i;return e.calculative.worldAnchors.forEach(r=>{t.push(r),i&&t.push(...uf(i,r,e)),i=r}),e.close&&e.calculative.worldAnchors.length>1&&t.push(...uf(i,e.calculative.worldAnchors[0],e)),t}function yl(e){return e!=null&&e.lineWidth?e.lineWidth/2+4:4}function uf(e,t,i){const r=[];if(!t)return r;let n=.02;if(e.lineLength&&!i.parentId&&(n=yl(i)/e.lineLength),e.next)if(t.prev)for(let a=n;a<1;a+=n)r.push(Jp(a,e,e.next,t.prev,t));else for(let a=n;a<1;a+=n)r.push(Ah(a,e,e.next,t));else if(t.prev)for(let a=n;a<1;a+=n)r.push(Ah(a,e,t.prev,t));else r.push({x:t.x,y:t.y});return r.length>1&&(e.curvePoints=r),r}function RT(e,t){const i=yl(t);let r=0,n,a;for(const s of t.calculative.worldAnchors){if(n){if(a=df(e,n,s,i),a)return{i:r,point:a};++r}n=s}if(t.close&&t.calculative.worldAnchors.length>1&&(a=df(e,n,t.calculative.worldAnchors[0],i)))return{i:r,point:a}}function df(e,t,i,r=4){if(!t.next&&!i.prev){const{x:n,y:a}=t,{x:s,y:o}=i,l=Math.min(n,s),h=Math.max(n,s),c=Math.min(a,o),u=Math.max(a,o);return e.x>=l-r&&e.x<=h+r&&e.y>=c-r&&e.y<=u+r?kT(e,t,i,r):void 0}else if(t.curvePoints){for(const n of t.curvePoints)if(aa(e,n,r))return n}}function kT(e,t,i,r=4){if(t.x===i.x){if(Math.abs(e.x-t.x)<=r)return{x:t.x,y:e.y}}else{const n=(t.y-i.y)/(t.x-i.x),a=t.y-n*t.x;if(Math.abs((n*e.x+a-e.y)/Math.sqrt(n*n+1))<=r){const l=(e.x+n*e.y-n*a)/(n*n+1);return{x:l,y:n*l+a}}}}function ff(e,t,i,r){if(!t&&!i)return Math.sqrt(Math.pow(Math.abs(e.x-r.x),2)+Math.pow(Math.abs(e.y-r.y),2))||0;const n=document.createElementNS("http://www.w3.org/2000/svg","path");return t&&i?n.setAttribute("d",`M${e.x} ${e.y} C${t.x} ${t.y} ${i.x} ${i.y} ${r.x} ${r.y}`):t?n.setAttribute("d",`M${e.x} ${e.y} Q${t.x} ${t.y} ${r.x} ${r.y}`):n.setAttribute("d",`M${e.x} ${e.y} Q${i.x} ${i.y} ${r.x} ${r.y}`),n.getTotalLength()||0}function bl(e){if(e.calculative.worldAnchors.length<2)return 0;let t=0,i;if(e.calculative.worldAnchors.forEach(r=>{i&&(i.lineLength=ff(i,i.next,r.prev,r),t+=i.lineLength),i=r}),e.close){const r=ge(e);i.lineLength=ff(i,i.next,r.prev,r),t+=i.lineLength}return e.calculative.animatePos&&(e.calculative.animatePos=t/e.length*e.calculative.animatePos),e.length=t,t}function Wc(e,t){const i=e.calculative.worldAnchors;for(let r=0;r<i.length-1;r++){const n=i[r],a=i[r+1];if(!n.next&&!a.prev){if(tv(n,a,t))return!0}else if(IT(n,a,t))return!0}return!1}function tv(e,t,i){if(Vn(e,i)||Vn(t,i))return!0;const r=e.x,n=e.y,a=t.x,s=t.y;let o=i.x,l=i.y,h=i.ex,c=i.ey;const u=n-s,d=a-r,f=r*s-a*n;if(u*o+d*l+f>=0&&u*h+d*c+f<=0||u*o+d*l+f<=0&&u*h+d*c+f>=0||u*o+d*c+f>=0&&u*h+d*l+f<=0||u*o+d*c+f<=0&&u*h+d*l+f>=0){if(o>h){const m=o;o=h,h=m}if(l<c){const m=l;l=c,c=m}return!(r<o&&a<o||r>h&&a>h||n>l&&s>l||n<c&&s<c)}else return!1}function IT(e,t,i){if(!e.next&&!t.prev)return tv(e,t,i);if(e.next&&t.prev)for(let n=.02;n<1;n+=.02){const a=Jp(n,e,e.next,t.prev,t);if(Vn(a,i))return!0}else if(e.next||t.prev)for(let n=.02;n<1;n+=.02){const a=Ah(n,e,e.next||t.prev,t);if(Vn(a,i))return!0}return!1}function mf(e,t,i,r,n){let a="";return e||(a+=`M${t.x} ${t.y} `,e=document.createElementNS("http://www.w3.org/2000/svg","path"),e.setAttribute("d",a)),a=e.getAttribute("d")||"",i&&r?a+=`C${i.x} ${i.y} ${r.x} ${r.y} ${n.x} ${n.y}`:i?a+=`Q${i.x} ${i.y} ${n.x} ${n.y}`:a+=`Q${(r==null?void 0:r.x)||t.x} ${(r==null?void 0:r.y)||t.y} ${n.x} ${n.y}`,e.setAttribute("d",a),e}function CT(e,t){const i=e.getTotalLength();if(t<0||t>i)return null;const r=.01,n=e.getPointAtLength(t),a=e.getPointAtLength(t-r),s=Math.atan2(n.y-a.y,n.x-a.x);return{x:n.x,y:n.y,rotate:s/Math.PI*180,progress:t/i}}let ri=10;function DT(e,t,i){var p;if(t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),ri=e.options.polylineSpace||10,t.calculative.worldAnchors.length<2)return;let r=ge(t),n=Gt(t);if(!r||!n)return;let a;if((p=t.anchors)!=null&&p.length&&r===t.calculative.activeAnchor?(a=!0,r=n,n=ge(t)):(!t.anchors||!t.anchors.length)&&r!==t.calculative.activeAnchor&&(r=t.calculative.activeAnchor),!r||!n)return;r.next=void 0,n.prev=void 0;const s=n.connectTo;mu(t);const o=[],l=e.pens[r.connectTo],h=e.pens[n.connectTo],c=Ma(r,l),u=Ma(n,h);let d=gf(r,c,ri);d&&(r=d,o.push(d)),d=gf(n,u,ri);const f=n;let m;if(d&&(n=d,f.connectTo&&(d.y>f.y&&r.y<f.y||d.y<f.y&&r.y>f.y))){m=d;let g=ri;r.x<d.x&&(g=-g),Math.abs(r.x-d.x)<g&&(g=-g),n={x:d.x+g,y:d.y,id:Mt()}}switch(c){case Bt.Up:o.push(...OT(r,n,u));break;case Bt.Right:o.push(...MT(r,n,u));break;case Bt.Bottom:o.push(...PT(r,n,u));break;case Bt.Left:o.push(...NT(r,n,u));break;default:o.push(...LT(t,r,n));break}if(o.forEach(g=>{g.id=Mt(),g.penId=t.id,t.calculative.worldAnchors.push(g)}),t.calculative.worldAnchors.push(n),m&&t.calculative.worldAnchors.push(m),d&&t.calculative.worldAnchors.push(f),a&&t.calculative.worldAnchors.reverse(),s){const g=t.calculative.worldAnchors.length-2;t.calculative.worldAnchors[g].isTemp=!1,t.calculative.worldAnchors[1].isTemp=!1}}function gf(e,t,i){const r={x:e.x,y:e.y,id:Mt()};switch(t){case Bt.Up:r.y-=i;break;case Bt.Right:r.x+=i;break;case Bt.Bottom:r.y+=i;break;case Bt.Left:r.x-=i;break;default:return}return r}function OT(e,t,i){if(e.x===t.x||e.y===t.y)return[];const r=[];let n,a;switch(i){case Bt.Up:e.y<t.y?(n=t.x,a=e.y):(n=e.x,a=t.y),r.push({x:n,y:a});break;case Bt.Bottom:if(n=t.x,a=e.y,t.y>e.y)n=e.x+(t.x-e.x)/2,r.push({x:n,y:e.y},{x:n,y:t.y});else{const s=(e.y+t.y)/2;r.push({x:e.x,y:s},{x:t.x,y:s})}break;case Bt.Right:n=t.x,a=e.y,t.x<e.x&&t.y<e.y&&(n=e.x,a=t.y),r.push({x:n,y:a});break;case Bt.Left:n=t.x,a=e.y,t.x>e.x&&t.y<e.y&&(n=e.x,a=t.y),r.push({x:n,y:a});break;default:if(t.y>e.y-ri)n=e.x+(t.x-e.x)/2,r.push({x:n,y:e.y},{x:n,y:t.y});else{const s=(e.y+t.y+ri)/2;r.push({x:e.x,y:s},{x:t.x,y:s})}break}return r}function MT(e,t,i){if(e.x===t.x||e.y===t.y)return[];const r=[];let n,a;switch(i){case Bt.Up:n=e.x,a=t.y,t.x>e.x&&t.y>e.y&&(n=t.x,a=e.y),r.push({x:n,y:a});break;case Bt.Bottom:n=e.x,a=t.y,t.x>e.x&&t.y<e.y&&(n=t.x,a=e.y),r.push({x:n,y:a});break;case Bt.Left:if(n=t.x,a=e.y,t.x<e.x)a=e.y+(t.y-e.y)/2,r.push({x:e.x,y:a},{x:t.x,y:a});else{const s=(e.x+t.x)/2;r.push({x:s,y:a},{x:s,y:t.y})}break;case Bt.Right:t.x<e.x?r.push({x:e.x,y:t.y}):r.push({x:t.x,y:e.y});break;default:if(n=t.x,a=t.y,t.x<e.x+ri)r.push({x:e.x,y:a});else{const s=(e.x+t.x-ri)/2;r.push({x:s,y:e.y},{x:s,y:a})}break}return r}function PT(e,t,i){if(e.x===t.x||e.y===t.y)return[];const r=[];let n,a;switch(i){case Bt.Up:if(n=e.x,a=t.y,t.y<e.y)n=e.x+(t.x-e.x)/2,r.push({x:n,y:e.y},{x:n,y:t.y});else{const s=(e.y+t.y)/2;r.push({x:n,y:s},{x:t.x,y:s})}break;case Bt.Right:n=t.x,a=e.y,t.x<e.x&&t.y>e.y&&(n=e.x,a=t.y),r.push({x:n,y:a});break;case Bt.Bottom:e.y>t.y?(n=t.x,a=e.y):(n=e.x,a=t.y),r.push({x:n,y:a});break;case Bt.Left:n=t.x,a=e.y,t.x>e.x&&t.y>e.y&&(n=e.x,a=t.y),r.push({x:n,y:a});break;default:if(n=e.x,t.y<e.y+ri)n=e.x+(t.x-e.x)/2,r.push({x:n,y:e.y},{x:n,y:t.y});else{const s=(e.y+t.y-ri)/2;r.push({x:n,y:s},{x:t.x,y:s})}break}return r}function NT(e,t,i){if(e.x===t.x||e.y===t.y)return[];const r=[];let n,a;switch(i){case Bt.Up:n=e.x,a=t.y,t.x<e.x&&t.y>e.y&&(n=t.x,a=e.y),r.push({x:n,y:a});break;case Bt.Bottom:n=e.x,a=t.y,t.x<e.x&&t.y<e.y&&(n=t.x,a=e.y),r.push({x:n,y:a});break;case Bt.Right:if(n=e.x,a=t.y,t.x>e.x)n=t.x,a=e.y+(t.y-e.y)/2,r.push({x:e.x,y:a},{x:t.x,y:a});else{const s=(e.x+t.x)/2;r.push({x:s,y:e.y},{x:s,y:t.y})}break;case Bt.Left:t.x>e.x?r.push({x:e.x,y:t.y}):r.push({x:t.x,y:e.y});break;default:if(n=e.x,a=t.y,t.x<e.x-ri){const s=(e.x+t.x+ri)/2;r.push({x:s,y:e.y},{x:s,y:a})}else r.push({x:e.x,y:a});break}return r}function LT(e,t,i){const r=[];e.calculative.drawlineH==null&&(e.calculative.drawlineH=Math.abs(i.x-t.x)>Math.abs(i.y-t.y));let n=e.calculative.worldAnchors.findIndex(a=>a.id==t.id);if(n>1){let a=e.calculative.worldAnchors[n-1];if(a.x===t.x&&a.y!==t.y)return r.push({x:i.x,y:t.y}),r;if(a.y===t.y&&a.x!==t.x)return r.push({x:t.x,y:i.y}),r}return e.calculative.worldAnchors.length&&(i.isTemp=void 0,e.calculative.drawlineH?(r.push({x:i.x,y:t.y}),Math.abs(i.y-t.y)<ri&&(i.isTemp=!0)):(r.push({x:t.x,y:i.y}),Math.abs(i.x-t.x)<ri&&(i.isTemp=!0))),r}function Do(e,t,i=!0){var n,a;let r=e.calculative.worldAnchors;i||(r=[],e.calculative.worldAnchors.forEach(s=>{r.unshift(s)}));for(let s=0;s<r.length&&r[s].id!==t.id;s++)if(r[s].y!==t.y||r[s].x===((n=r[s+1])==null?void 0:n.x)&&r[s].y!==((a=r[s+1])==null?void 0:a.y))return!1;return!0}function Oo(e,t,i=!0){var n,a;let r=e.calculative.worldAnchors;i||(r=[],e.calculative.worldAnchors.forEach(s=>{r.unshift(s)}));for(let s=0;s<r.length&&r[s].id!==t.id;s++)if(r[s].x!==t.x||r[s].y===((n=r[s+1])==null?void 0:n.y)&&r[s].x!==((a=r[s+1])==null?void 0:a.x))return!1;return!0}function UT(e,t,i){if(!e.calculative.worldAnchors)return;const r=e.calculative.worldAnchors.findIndex(l=>l.id===t.id),n=ge(e),a=Gt(e);let s=e.calculative.worldAnchors[r-1],o=e.calculative.worldAnchors[r+1];if(e.calculative.h==null&&(n.connectTo&&(Do(e,t,!0)?e.calculative.h=!0:Oo(e,t,!0)&&(e.calculative.h=!1)),e.calculative.h==null&&a.connectTo&&(Do(e,t,!1)?e.calculative.h=!0:Oo(e,t,!1)&&(e.calculative.h=!1)),e.calculative.h==null&&(s?e.calculative.h=s.y===t.y:o&&(e.calculative.h=o.y===t.y))),e.calculative.h){if(t.x=i.x,n.connectTo&&Do(e,t,!0)){o&&o.y!==t.y&&(o.x=t.x);return}if(a.connectTo&&Do(e,t,!1)){s&&s.y!==t.y&&(s.x=t.x);return}const l=e.anchors[r];let h;for(let c=r-1;c>-1;c--)if(s=e.anchors[c],h==null&&(h=s.y===l.y),h===!0)if(s.y===l.y)e.calculative.worldAnchors[c].y=i.y;else break;else if(s.x===l.x)e.calculative.worldAnchors[c].x=i.x;else break;h=void 0;for(let c=r+1;c<e.calculative.worldAnchors.length&&(o=e.anchors[c],o);c++)if(h==null&&(h=o.y===l.y),h===!0)if(o.y===l.y)e.calculative.worldAnchors[c].y=i.y;else break;else if(o.x===l.x)e.calculative.worldAnchors[c].x=i.x;else break;t.y=i.y}else{if(t.y=i.y,n.connectTo&&Oo(e,t,!0)){o&&o.x!==t.x&&(o.y=t.y);return}if(a.connectTo&&Oo(e,t,!1)){s&&s.x!==t.x&&(s.y=t.y);return}const l=e.anchors[r];let h;for(let c=r-1;c>-1;c--)if(s=e.anchors[c],h==null&&(h=s.x===l.x),h===!0)if(s.x===l.x)e.calculative.worldAnchors[c].x=i.x;else break;else if(s.y===l.y)e.calculative.worldAnchors[c].y=i.y;else break;h=void 0;for(let c=r+1;c<e.calculative.worldAnchors.length&&(o=e.anchors[c],o);c++)if(h==null&&(h=o.x===l.x),h===!0)if(o.x===l.x)e.calculative.worldAnchors[c].x=i.x;else break;else if(o.y===l.y)e.calculative.worldAnchors[c].y=i.y;else break;t.x=i.x}}function Rh(e,t,i,r){const n=[];let a,s,o,l,h,c,u,d,f,m,p,g,y,T;f=e[i],m=e[r],o=f.x,l=f.y,u=m.x-o,d=m.y-l,T=u*u+d*d,a=t;for(let b=i+1;b<r;b++)p=e[b],u!==0||d!==0?(g=((p.x-o)*u+(p.y-l)*d)/T,g>1?(h=p.x-m.x,c=p.y-m.y):g>0?(h=p.x-(o+u*g),c=p.y-(l+d*g)):(h=p.x-o,c=p.y-l)):(h=p.x-o,c=p.y-l),y=h*h+c*c,y>a&&(s=b,a=y);return a>t&&(s-i>1&&n.push(...Rh(e,t,i,s)),n.push({id:e[s].id,penId:e[s].penId,x:e[s].x,y:e[s].y}),r-s>1&&n.push(...Rh(e,t,s,r))),n}function FT(e,t=.8,i=!1){if(e.length<3)return e;let r,n,a,s,o,l,h,c,u,d,f,m,p,g,y;const T=(b,S,I,D)=>(s=Math.sqrt(b*b+S*S),s>0?(m=b/s,g=S/s):(m=1,g=0),o=Math.sqrt(I*I+D*D),o>0?(p=I/o,y=D/o):(p=1,y=0),Math.acos(m*p+g*y));d=[],f=e.length,r=e[0],e[f-1],d.push({...e[0]});for(let b=0;b<f-1;b++){if(n=e[b],a=e[b+1],u=Math.abs(T(n.x-r.x,n.y-r.y,a.x-n.x,a.y-n.y)),s)if(u<t*3.14)if(i&&(s=Math.min(s,o),o=s),l=(m+p)/2,h=(g+y)/2,c=Math.sqrt(l*l+h*h),c===0)d.push({...n});else{l/=c,h/=c;const S={...n};S.prevNextType=jn.Bilateral,S.prev={penId:S.penId,x:n.x-l*s*.25,y:n.y-h*s*.25},S.next={penId:S.penId,x:n.x+l*o*.25,y:n.y+h*o*.25},d.push(S)}else d.push({...n});r=n}return d.push({...e[e.length-1]}),d}function ev(e,t){const i=t||new Path2D,r=e.calculative.worldAnchors;let n=e.calculative.canvas.store.data.scale,a=(e.calculative.animateLineWidth||6)*n,s=(e.animateLineWidth*2||12)*n;e.lineAnimateType===ii.WaterDrop&&(s=(e.animateLineWidth*4||24)*n);let o=(e.animateInterval||100)*n,l=e.calculative.lineWidth*(e.calculative.lineSmooth||0),h=(e.calculative.animateLineWidth/2||3)*n;if(e.animateReverse&&(s=-s,a=-a),r.length>1){let c,u=0;for(let d=0;d<r.length;d++){let f=r[d];if(c){let m=BT(c,f),p={x:c.x+(e.calculative.animatePos-u)%o*Math.cos(m*Math.PI/180),y:c.y-(e.calculative.animatePos-u)%o*Math.sin(m*Math.PI/180)};e.animateReverse&&(p={x:c.x+(e.length-(e.calculative.animatePos+u))%o*Math.cos(m*Math.PI/180),y:c.y-(e.length-(e.calculative.animatePos+u))%o*Math.sin(m*Math.PI/180)});let g=Math.sqrt((p.x-c.x)**2+(p.y-c.y)**2),y=Math.sqrt((f.x-c.x)**2+(f.y-c.y)**2);for(;g<y;)(e.animateReverse&&g-s<y||!e.animateReverse&&g>s)&&g>l+s&&y-g>l&&(e.lineAnimateType===ii.Arrow?jT(i,p,a,m,h,s):e.lineAnimateType===ii.WaterDrop&&WT(i,p,e.animateReverse,m,h,s)),p.x+=o*Math.cos(m*Math.PI/180),p.y-=o*Math.sin(m*Math.PI/180),g=Math.sqrt((p.x-c.x)**2+(p.y-c.y)**2)}c=f}}if(i instanceof Path2D)return i}function BT(e,t){let i=t.x-e.x,r=t.y-e.y,n=Math.atan(r/i)*180/Math.PI;return t.x>=e.x?n=-n:n=180-n,n}function Zr(e,t,i){let r=(180-i)*Math.PI/180;return{x:(e.x-t.x)*Math.cos(r)-(e.y-t.y)*Math.sin(r)+t.x,y:(e.x-t.x)*Math.sin(r)+(e.y-t.y)*Math.cos(r)+t.y}}function jT(e,t,i,r,n,a){let s=Zr({x:t.x+i,y:t.y+.57*i},{x:t.x,y:t.y},r),o=Zr({x:t.x+i,y:t.y-.57*i},{x:t.x,y:t.y},r),l=Zr({x:t.x+i,y:t.y+n/2},{x:t.x,y:t.y},r),h=Zr({x:t.x+a,y:t.y+n/2},{x:t.x,y:t.y},r),c=Zr({x:t.x+i,y:t.y-n/2},{x:t.x,y:t.y},r),u=Zr({x:t.x+a,y:t.y-n/2},{x:t.x,y:t.y},r);e.moveTo(s.x,s.y),e.lineTo(t.x,t.y),e.lineTo(o.x,o.y),e.lineTo(c.x,c.y),e.lineTo(u.x,u.y),e.lineTo(h.x,h.y),e.lineTo(l.x,l.y),e.lineTo(s.x,s.y)}function WT(e,t,i,r,n,a){let s=n/2;i&&(s=-n/2);let o=Zr({x:t.x,y:t.y+s},{x:t.x,y:t.y},r),l=Zr({x:t.x+a,y:t.y},{x:t.x,y:t.y},r),h=Math.PI/2;i&&(h=-Math.PI/2),e.moveTo(t.x,t.y),e.arc(t.x,t.y,n/2,-h-r/180*Math.PI,h-r/180*Math.PI,!1),e.lineTo(l.x,l.y),e.lineTo(o.x,o.y)}const Nr={};function zT(){var e;for(const t in Nr)(e=Nr[t])==null||e.remove(),Nr[t]=null}function VT(e){var t;for(const i in Nr)e.some(r=>r.name=="iframe"&&r.iframe==i)||((t=Nr[i])==null||t.remove(),Nr[i]=null)}function HT(e){const t=Nr[e.iframe];return t?(e.calculative.singleton.div=t,vu(e),!0):!1}function YT(e){var i;e.onDestroy||(e.onDestroy=qT,e.onMove=Mo,e.onResize=Mo,e.onRotate=Mo,e.onValue=Mo,e.onMouseMove=GT,e.onBeforeValue=KT,e.onRenderPenRaw=XT),e.calculative.singleton||(e.calculative.singleton={});const t=e.calculative.worldRect;if(!e.calculative.singleton.div){if(HT(e))return;const r=document.createElement("div");r.style.position="absolute",r.style.outline="none",r.style.left="-9999px",r.style.top="-9999px",r.style.width=t.width+"px",r.style.height=t.height+"px",document.body.appendChild(r),(i=e.calculative.canvas.externalElements)==null||i.parentElement.appendChild(r),Se(e,r),e.calculative.singleton.div=r;const n=document.createElement("iframe");n.style.width="100%",n.style.height="100%",n.scrolling=e.scrolling||"no",n.frameBorder="0",n.style.border="none",n.src=e.iframe,e.calculative.iframe=e.iframe,r.appendChild(n),vu(e),n.onload=()=>{n.setAttribute("document.domain","")}}return e.calculative.patchFlags&&Se(e,e.calculative.singleton.div),e.onRenderPenRaw(e),new Path2D}function qT(e){rv(e),e.calculative.singleton&&e.calculative.singleton.div&&(e.calculative.canvas.store.data.locked?(Nr[e.calculative.iframe]=e.calculative.singleton.div,delete e.calculative.singleton.div):(e.calculative.singleton.div.remove(),Nr[e.calculative.iframe]=null))}function Mo(e){e.calculative.singleton.div&&Se(e,e.calculative.singleton.div)}function KT(e,t){if(t.iframe&&e.calculative.singleton.div&&(e.calculative.singleton.div.children[0].src=t.iframe,e.calculative.iframe=t.iframe),t.operationalRect||t["operationalRect.x"]!==void 0||t["operationalRect.y"]!==void 0||t["operationalRect.width"]!==void 0||t["operationalRect.height"]!==void 0){e.operationalRect||(e.operationalRect={});let i=lt(t);i.operationalRect||(i.operationalRect={}),i["operationalRect.x"]!==void 0&&(i.operationalRect.x=i["operationalRect.x"]),i["operationalRect.y"]!==void 0&&(i.operationalRect.y=i["operationalRect.y"]),i["operationalRect.width"]!==void 0&&(i.operationalRect.width=i["operationalRect.width"]),i["operationalRect.height"]!==void 0&&(i.operationalRect.height=i["operationalRect.height"]),Object.assign(e.operationalRect,i.operationalRect),e.calculative.singleton.div&&(e.calculative.singleton.div.children.length===1?vu(e):(e.calculative.singleton.div.children[1].style.height=e.operationalRect.y*100+"%",e.calculative.singleton.div.children[1].style.left=e.operationalRect.x*100+"%",e.calculative.singleton.div.children[1].style.width=e.operationalRect.width*100+"%",e.calculative.singleton.div.children[2].style.width=(1-e.operationalRect.x-e.operationalRect.width)*100+"%",e.calculative.singleton.div.children[3].style.height=(1-e.operationalRect.y-e.operationalRect.height)*100+"%",e.calculative.singleton.div.children[3].style.left=e.operationalRect.x*100+"%",e.calculative.singleton.div.children[3].style.width=e.operationalRect.width*100+"%",e.calculative.singleton.div.children[4].style.width=e.operationalRect.x*100+"%"))}if(t.blur!==void 0)for(let i=1;i<5;i++)e.calculative.singleton.div.children[i]&&(e.calculative.singleton.div.children[i].style["backdrop-filter"]=`blur(${t.blur}px)`);if(t.blurBackground!==void 0)for(let i=1;i<5;i++)e.calculative.singleton.div.children[i]&&(e.calculative.singleton.div.children[i].style.backgroundColor=t.blurBackground);return t}function GT(e,t){if(!(!e.calculative.canvas.store.data.locked&&!e.locked)&&iv(e.operationalRect)&&e.calculative.zIndex<5&&t.x>e.x+e.width*e.operationalRect.x&&t.x<e.x+e.width*(e.operationalRect.x+e.operationalRect.width)&&t.y>e.y+e.height*e.operationalRect.y&&t.y<e.y+e.height*(e.operationalRect.y+e.operationalRect.height)&&e.calculative.singleton.div){let i=e.calculative.singleton.div.parentNode.children;for(let r=0;r<6;r++)i[r].style.pointerEvents="none"}}function iv(e){return e?!e.width||!e.height?!1:(e.x===void 0&&(e.x=(1-e.width)/2),e.y===void 0&&(e.y=(1-e.height)/2),!0):!1}function $T(e){for(;e.childNodes.length>1;)e.removeChild(e.lastChild)}function vu(e){if(!iv(e.operationalRect))return;const t=e.calculative.singleton.div;if(!t)return;t.childNodes.length>1&&$T(t);const i=navigator.userAgent.indexOf("Linux")>-1,r=document.createElement("div");r.style.position="absolute",r.style.left=e.operationalRect.x*100+"%",r.style.top="0px",r.style.width=e.operationalRect.width*100+"%",r.style.height=e.operationalRect.y*100+"%",!i&&e.blur&&(r.style["backdrop-filter"]=`blur(${e.blur}px)`),r.style.backgroundColor=e.blurBackground,t.appendChild(r);const n=document.createElement("div");n.style.position="absolute",n.style.right="0px",n.style.top="0px",n.style.width=(1-e.operationalRect.x-e.operationalRect.width)*100+"%",n.style.height="100%",!i&&e.blur&&(n.style["backdrop-filter"]=`blur(${e.blur}px)`),n.style.backgroundColor=e.blurBackground,t.appendChild(n);const a=document.createElement("div");a.style.position="absolute",a.style.left=e.operationalRect.x*100+"%",a.style.bottom="0px",a.style.width=e.operationalRect.width*100+"%",a.style.height=(1-e.operationalRect.y-e.operationalRect.height)*100+"%",!i&&e.blur&&(a.style["backdrop-filter"]=`blur(${e.blur}px)`),a.style.backgroundColor=e.blurBackground,t.appendChild(a);const s=document.createElement("div");s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.width=e.operationalRect.x*100+"%",s.style.height="100%",!i&&e.blur&&(s.style["backdrop-filter"]=`blur(${e.blur}px)`),s.style.backgroundColor=e.blurBackground,t.appendChild(s);let o=()=>{rv(e)};r.onmouseenter=o,a.onmouseenter=o,n.onmouseenter=o,s.onmouseenter=o,t.onmouseleave=o}function rv(e){if(!(!e.calculative.canvas.store.data.locked&&!e.locked)&&e.calculative.zIndex<5){let t=e.calculative.singleton.div.parentNode.children;for(let i=1;i<6;i++)t[i].style.pointerEvents="initial"}}function XT(e){if(e.thumbImg&&!e.calculative.img){const t=new Image;t.crossOrigin=e.crossOrigin==="undefined"?void 0:e.crossOrigin||"anonymous",e.calculative.canvas.store.options.cdn&&!(e.thumbImg.startsWith("http")||e.thumbImg.startsWith("//")||e.thumbImg.startsWith("data:image"))?t.src=e.calculative.canvas.store.options.cdn+e.thumbImg:t.src=e.thumbImg,t.onerror=i=>{t.remove(),e.calculative.img=void 0},e.calculative.img=t}}const ni={},Zo=['<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M473.088 125.44L256 256H52.224C23.552 256 0 279.552 0 308.224V716.8c0 28.16 23.04 51.2 51.2 51.2h204.8l217.088 130.56c16.896 10.24 38.912-2.048 38.912-22.016V147.456c0-19.968-21.504-32.256-38.912-22.016zM699.904 320.512c-20.992-18.944-53.248-17.408-72.192 3.584-18.944 20.992-17.408 53.248 3.584 72.192 0.512 0.512 58.368 54.784 58.368 121.344 0 37.888-19.456 74.752-58.368 110.08-20.992 18.944-22.528 51.2-3.584 72.192 10.24 11.264 24.064 16.896 37.888 16.896 12.288 0 24.576-4.608 34.304-13.312 61.44-55.296 92.16-117.76 92.16-185.856 0-112.64-88.576-193.536-92.16-197.12z" fill="" p-id="2434"></path><path d="M853.504 166.4c-20.992-18.944-53.248-16.896-72.192 4.096-18.944 20.992-16.896 53.248 4.096 72.192 1.536 1.024 135.68 122.88 135.68 280.576 0 90.624-45.568 177.152-135.68 257.536-20.992 18.944-23.04 51.2-4.096 72.192 10.24 11.264 24.064 16.896 38.4 16.896 12.288 0 24.576-4.096 34.304-12.8 112.64-100.864 169.984-212.992 169.984-333.824-1.024-202.752-163.84-350.208-170.496-356.864z"></path></svg>','<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" ><path d="M256 768H51.2c-28.16 0-51.2-23.04-51.2-51.2V308.224C0 279.552 23.552 256 52.224 256H256v512zM512 147.456v728.576c0 19.968-21.504 32.256-38.912 22.016L256 768V256l217.088-130.56c17.408-10.24 38.912 2.048 38.912 22.016zM623.104 656.896c-19.968-19.968-19.968-52.224 0-72.192l217.088-217.088c19.968-19.968 52.224-19.968 72.192 0 19.968 19.968 19.968 52.224 0 72.192l-217.088 217.088c-19.456 19.968-52.224 19.968-72.192 0z" fill="" p-id="2582"></path><path d="M623.104 367.104c19.968-19.968 52.224-19.968 72.192 0l217.088 217.088c19.968 19.968 19.968 52.224 0 72.192-19.968 19.968-52.224 19.968-72.192 0l-217.088-217.088c-19.968-19.456-19.968-52.224 0-72.192z"></path></svg>'];function QT(e){var t;if(e.onDestroy||(e.onDestroy=JT,e.onMove=zc,e.onResize=zc,e.onRotate=zc,e.onClick=pf,e.onValue=tE,e.onChangeId=ZT),ni[e.id])e.video&&e.calculative.media&&e.video!==e.calculative.video?(console.warn("video 更改, 此处是否执行？"),e.calculative.media.src=e.video,e.autoPlay&&(e.calculative.media.muted=!0,e.calculative.media.autoplay=!0),e.calculative.media.loop=e.playLoop,e.calculative.video=e.video):e.audio&&e.calculative.media&&e.audio!==e.calculative.audio&&(e.calculative.media.src=e.audio,e.autoPlay&&(e.calculative.media.muted=!0,e.calculative.media.autoplay=!0),e.calculative.media.loop=e.playLoop,e.calculative.audio=e.audio);else{const i=document.createElement("div"),r=document.createElement("div");r.style.position="absolute",r.style.outline="none",r.style.left="0",r.style.bottom="0",r.style.width="0",r.style.height="2px",r.style.background="#52c41a",r.style.zIndex="1",e.hideProgress&&(r.style.display="none");const n=document.createElement("div");n.innerHTML=Zo[1],n.style.position="absolute",n.style.right="0",n.style.bottom="0",n.style.width="20px",n.style.height="20px",n.style.fill="hsla(0, 0%, 100%, .8)",n.style.zIndex="1",n.style.display="none",i.appendChild(r),i.appendChild(n),n.onclick=s=>{s.stopPropagation(),e.calculative.media.muted?(n.innerHTML=Zo[0],e.calculative.media.muted=!1):(n.innerHTML=Zo[1],e.calculative.media.muted=!0)},e.calculative.singleton||(e.calculative.singleton={}),e.calculative.singleton.muted=n,i.onmouseenter=s=>{e.hideMuted||(n.style.display="block")},i.onmouseleave=s=>{n.style.display="none"},i.onclick=s=>{s.stopPropagation(),pf(e)};let a;e.audio?(a=document.createElement("audio"),a.controls=e.controls,a.src=e.audio):(a=document.createElement("video"),a.src=e.video),a.loop=e.playLoop,a.ontimeupdate=()=>{nv(r,a,e.calculative.worldRect.width)},a.onended=()=>{e.calculative.onended&&e.calculative.onended(e)},e.calculative.media=a,a.style.position="absolute",a.style.outline="none",a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.objectFit=e.objectFit||"contain",i.appendChild(a),ni[e.id]=i,(t=e.calculative.canvas.externalElements)==null||t.parentElement.appendChild(i),Se(e,i),e.autoPlay&&(a.autoplay=!0,a.muted=!0)}return e.calculative.patchFlags&&Se(e,ni[e.id]),new Path2D}function JT(e){ni[e.id].onclick=null,ni[e.id].remove(),ni[e.id]=void 0}function zc(e){Se(e,ni[e.id]);const t=ni[e.id].children[0],i=ni[e.id].children[1];nv(t,i,e.calculative.worldRect.width)}function pf(e){e.calculative.media&&(e.calculative.media.muted=!1,e.calculative.singleton.muted.innerHTML=Zo[0],e.calculative.media.paused?e.calculative.media.play():e.calculative.media.pause())}function nv(e,t,i){e.style.width=t.currentTime/t.duration*i+"px"}function ZT(e,t,i){ni[t]&&(ni[i]=ni[t],delete ni[t])}function tE(e){const t=ni[e.id];if(!t)return;Se(e,t),e.calculative.media||(e.calculative.media=t.querySelector("video"));const i=e.calculative.media.getAttribute("src");e.video?i!==e.video&&(e.calculative.media.src=e.video):e.audio&&i!==e.audio&&(e.calculative.media.src=e.audio),e.autoPlay&&(e.calculative.media.muted=!0,e.calculative.media.autoplay=!0),e.calculative.media.loop=e.playLoop}function ir(){try{const e=new OffscreenCanvas(0,0),t=e.getContext("2d");return t&&t.arc?e:document.createElement("canvas")}catch{return document.createElement("canvas")}}class Ts{constructor(t,i){B(this,"parentElement");B(this,"store");B(this,"box");B(this,"text");B(this,"arrowUp");B(this,"arrowDown");B(this,"x");B(this,"y");B(this,"currentPen");this.parentElement=t,this.store=i,this.box=document.createElement("div"),this.text=document.createElement("div"),this.arrowUp=document.createElement("div"),this.arrowDown=document.createElement("div"),this.box.className="meta2d-tooltip",this.text.className="text",this.arrowUp.className="arrow",this.arrowDown.className="arrow down",this.box.appendChild(this.text),this.box.appendChild(this.arrowUp),this.box.appendChild(this.arrowDown),t.appendChild(this.box),this.box.onmouseleave=()=>{this.hide(),this.store.lastHover=void 0};let r;for(let n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le.com/tooltip"&&(r=document.styleSheets[n]);if(!r){let n=document.createElement("style");n.type="text/css",n.title="le5le.com/tooltip",document.head.appendChild(n),n=document.createElement("style"),n.type="text/css",document.head.appendChild(n),r=n.sheet,r.insertRule(".meta2d-tooltip{position:absolute;padding:8px 0;z-index:10;left: -9999px;top: -9999px;}"),r.insertRule(".meta2d-tooltip .text{max-width:320px;min-height:30px;max-height:400px;outline:none;padding:8px 16px;border-radius:4px;background:#777777;color:#ffffff;line-height:1.8;overflow-y:auto;}"),r.insertRule(".meta2d-tooltip .arrow{position:absolute;border:10px solid transparent;background:transparent;top:-5px;left:50%;transform:translateX(-50%)}"),r.insertRule(".meta2d-tooltip .arrow.down{top:initial;bottom: -1px;}")}}static getTitle(t){if(t.titleFnJs&&!t.titleFn)try{t.titleFn=new Function("pen",t.titleFnJs)}catch(i){console.log("titleFnJs",i)}return t.titleFn?t.titleFn(t):String(t.title)}setText(t){const i=this.box.getBoundingClientRect();let r=globalThis.marked;const n=Ts.getTitle(t);if(r){this.text.innerHTML=r(n);const a=this.text.getElementsByTagName("A");for(let s=0;s<a.length;++s)a[s].setAttribute("target","_blank")}else this.text.innerHTML=n;return i}updateText(t){var n;if(((n=this.currentPen)==null?void 0:n.id)!==t.id||Ts.titleEmpty(t))return;const i=this.setText(t),r=this.box.getBoundingClientRect();this.changePositionByText(i,r)}changePositionByText(t,i){this.x-=(i.width-t.width)/2,this.y-=i.height-t.height,this.box.style.left=this.x+"px",this.box.style.top=this.y+"px"}static titleEmpty(t){return!t.title&&!t.titleFn&&!t.titleFnJs}show(t,i){if(this.currentPen=t,Ts.titleEmpty(t)){let o=Ge(t,!0);o&&this.show(o,i);return}this.setText(t);const r=this.box.getBoundingClientRect(),n=t.calculative.worldRect;let a=t.calculative.canvas.store.data.x+i.x-r.width/2,s=t.calculative.canvas.store.data.y+i.y-r.height;t.type||(a=t.calculative.canvas.store.data.x+n.x-(r.width-n.width)/2,s=t.calculative.canvas.store.data.y+n.ey-r.height-n.height),s>0?(this.arrowUp.style.borderBottomColor="transparent",this.arrowDown.style.borderTopColor="#777777"):(s+=r.height+n.height+5,this.arrowUp.style.borderBottomColor="#777777",this.arrowDown.style.borderTopColor="transparent"),this.x=a,this.y=s,this.box.style.left=this.x+"px",this.box.style.top=this.y+"px"}hide(){this.currentPen=null,this.x=-9999,this.box.style.left="-9999px"}translate(t,i){this.x<-1e3||(this.x+=t,this.y+=i,this.box.style.left=this.x+"px",this.box.style.top=this.y+"px")}destroy(){this.box.onmouseleave=null}}class av{constructor(t){B(this,"parent");B(this,"h");B(this,"v");B(this,"isDownH");B(this,"isDownV");B(this,"x");B(this,"y");B(this,"hSize");B(this,"vSize");B(this,"scrollX");B(this,"scrollY");B(this,"lastScrollX");B(this,"lastScrollY");B(this,"rect");B(this,"isShow");B(this,"isV");B(this,"padding");B(this,"pageMode");B(this,"onMouseDownH",t=>{t.preventDefault(),t.stopPropagation(),this.isDownH=t.x,this.x=this.parent.store.data.x||0,this.lastScrollX=this.scrollX});B(this,"onMouseDownV",t=>{t.preventDefault(),t.stopPropagation(),this.isDownV=t.y,this.y=this.parent.store.data.y||0,this.lastScrollY=this.scrollY});B(this,"onMouseMove",t=>{if(this.isDownH){const i=t.x-this.isDownH;this.scrollX=this.lastScrollX+i,this.h.style.left=`${this.scrollX}px`,this.parent.store.data.x=this.x-i*this.rect.width/this.parent.parentElement.clientWidth}if(this.isDownV){const i=t.y-this.isDownV;if(this.pageMode&&this.canMouseMove(i))return;this.scrollY=this.lastScrollY+i,this.v.style.top=`${this.scrollY}px`,this.isV?this.parent.store.data.y=this.y-i*this.isV.h/this.parent.parentElement.clientHeight:this.parent.store.data.y=this.y-i*this.rect.height/this.parent.parentElement.clientHeight}(this.isDownH||this.isDownV)&&(this.parent.onMovePens(),this.parent.canvasTemplate.init(),this.parent.canvasImage.init(),this.parent.canvasImageBottom.init(),this.parent.render())});B(this,"onMouseUp",t=>{!this.isDownH&&!this.isDownV||(this.isDownH=void 0,this.isDownV=void 0,!this.isV&&(this.scrollX<20?(this.scrollX=20,this.h.style.left=`${this.scrollX}px`):this.scrollX>this.parent.parentElement.clientWidth-this.hSize-20&&(this.scrollX=this.parent.parentElement.clientWidth-this.hSize-20,this.h.style.left=`${this.scrollX}px`),this.scrollY<20?(this.scrollY=20,this.v.style.top=`${this.scrollY}px`):this.scrollY>this.parent.parentElement.clientHeight-this.vSize-20&&(this.scrollY=this.parent.parentElement.clientHeight-this.vSize-20,this.v.style.top=`${this.scrollY}px`),this.resize()))});this.parent=t,this.h=document.createElement("div"),this.v=document.createElement("div"),this.parent.externalElements.appendChild(this.h),this.parent.externalElements.appendChild(this.v),this.h.className="meta2d-scroll h",this.h.onmousedown=this.onMouseDownH,this.v.className="meta2d-scroll v",this.v.onmousedown=this.onMouseDownV,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp);let i;for(let r=0;r<document.styleSheets.length;r++)document.styleSheets[r].title==="le5le/scroll"&&(i=document.styleSheets[r]);if(!i){let r=document.createElement("style");r.type="text/css",r.title="le5le.com/scroll",document.head.appendChild(r),r=document.createElement("style"),r.type="text/css",document.head.appendChild(r),i=r.sheet,i.insertRule(".meta2d-scroll{position:absolute;width:8px;height:200px;background:#dddddd;border-radius:10px;z-index:20;cursor:default;}"),i.insertRule(".meta2d-scroll:hover{background:#cccccc;cursor:pointer}"),i.insertRule(".meta2d-scroll.v{right:0;top:calc(50% - 100px);}"),i.insertRule(".meta2d-scroll.h{bottom:2px;left:calc(50% - 100px);width:200px;height:8px;}")}this.init()}init(){this.isShow=!0,this.resize(),this.initPos(),this.getV()}getV(){const t=this.parent.store.data.width||this.parent.store.options.width,i=this.parent.store.data.height||this.parent.store.options.height;if(t&&i){const r=this.parent.store.data.scale;this.isV={w:t*r,h:i*r}}}canMouseMove(t){if(this.isV){let r=this.parent.store.data.origin;return t<0&&(Math.abs(r.y+this.parent.store.data.y-this.padding)<1||r.y+this.parent.store.data.y-this.padding>0)?(this.scrollY=0,this.v.style.top="0px",!0):t>0&&(Math.abs(r.y+this.isV.h-this.parent.height+this.parent.store.data.y-this.padding)<1||r.y+this.isV.h-this.parent.height+this.parent.store.data.y-this.padding<=0)?(this.parent.store.data.y=-(r.y+this.isV.h-this.parent.height+this.padding)-1,this.parent.onMovePens(),this.parent.canvasTemplate.init(),this.parent.canvasImage.init(),this.parent.canvasImageBottom.init(),this.parent.render(),!0):!1}const i=this.parent.parent.getRect();return t<0&&i.y+this.parent.store.data.y>=0||t>0&&i.ey-this.parent.height+this.parent.store.data.y<=0}changeMode(t){this.pageMode=!0,this.h.style.display="none";const i=this.parent.parent.getRect();if(i.height<this.parent.height&&(this.v.style.display="none"),this.isV){let r=i.height;this.padding=t||0,this.getV(),r=this.isV.h,this.v.style.top="0px",this.v.style.height=this.parent.parentElement.clientHeight/(r+this.padding||0)*this.parent.parentElement.clientHeight+"px",this.scrollY=0}}initPos(){this.scrollX=(this.parent.parentElement.clientWidth-this.hSize)/2,this.scrollY=(this.parent.parentElement.clientHeight-this.vSize)/2,this.h.style.left=`${this.scrollX}px`,this.v.style.top=`${this.scrollY}px`}resize(){this.rect=this.parent.parent.getRect(),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.parent.store.data.x>0?this.rect.width+=this.parent.store.data.x+(this.rect.x>0?0:this.rect.x):this.rect.width-=this.parent.store.data.x+(this.rect.x>0?0:this.rect.x),this.parent.store.data.y>0?this.rect.height+=this.parent.store.data.y+(this.rect.y>0?0:this.rect.y):this.rect.height-=this.parent.store.data.y+(this.rect.y>0?0:this.rect.y),this.rect.width<1400&&(this.rect.width=1400),this.rect.height<900&&(this.rect.height=900),this.hSize=1e3*this.parent.parentElement.clientWidth/this.rect.width/3,this.vSize=1e3*this.parent.parentElement.clientHeight/this.rect.height/3,this.h.style.width=this.hSize+"px",this.v.style.height=this.vSize+"px"}show(){this.isShow=!0,this.h.style.display="block",this.v.style.display="block",document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}hide(){this.isShow=!1,this.h.style.display="none",this.v.style.display="none",this.destroy()}translate(t,i){t&&(this.scrollX-=t*this.parent.parentElement.clientWidth/this.rect.width,this.h.style.left=`${this.scrollX}px`),i&&(this.scrollY-=i*this.parent.parentElement.clientHeight/this.rect.height,this.v.style.top=`${this.scrollY}px`)}wheel(t){let i=10;typeof t=="boolean"?t&&(i=-10):i=t,!(this.pageMode&&this.canMouseMove(i))&&(this.scrollY+=i,this.v.style.top=`${this.scrollY}px`,this.isV?this.parent.store.data.y-=i*this.isV.h/this.parent.parentElement.clientHeight:this.parent.store.data.y-=i*this.rect.height/this.parent.parentElement.clientHeight,this.parent.onMovePens(),this.parent.canvasTemplate.init(),this.parent.canvasImage.init(),this.parent.canvasImageBottom.init(),this.parent.render())}destroy(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}}class vf{constructor(t,i,r){B(this,"parentElement");B(this,"store");B(this,"isBottom");B(this,"canvas",document.createElement("canvas"));B(this,"otherOffsreen",ir());B(this,"offscreen",ir());B(this,"animateOffsScreen",ir());B(this,"fitOffscreen",ir());B(this,"fitFlag",!1);B(this,"currentFit");B(this,"activeFit");this.parentElement=t,this.store=i,this.isBottom=r,t.appendChild(this.canvas),this.canvas.style.backgroundRepeat="no-repeat",this.canvas.style.backgroundSize="100% 100%",this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0"}resize(t,i){this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",t=t*this.store.dpiRatio|0,i=i*this.store.dpiRatio|0,this.canvas.width=t,this.canvas.height=i,this.otherOffsreen.width=t,this.otherOffsreen.height=i,this.offscreen.width=t,this.offscreen.height=i,this.animateOffsScreen.width=t,this.animateOffsScreen.height=i,this.fitOffscreen.width=t,this.fitOffscreen.height=i,this.otherOffsreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.otherOffsreen.getContext("2d").textBaseline="middle",this.offscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").textBaseline="middle",this.animateOffsScreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.animateOffsScreen.getContext("2d").textBaseline="middle",this.fitOffscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.fitOffscreen.getContext("2d").textBaseline="middle",this.init()}init(){this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.animateOffsScreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.fitOffscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.store.data.pens)this.hasImage(t)&&(t.calculative.imageDrawed=!1);this.isBottom?this.store.patchFlagsBackground=!0:this.store.patchFlagsTop=!0}clear(){this.otherOffsreen.getContext("2d").clearRect(0,0,this.otherOffsreen.width,this.otherOffsreen.height),this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.animateOffsScreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.fitOffscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)}hasImage(t){return t.calculative.hasImage=t.calculative&&t.calculative.inView&&(this.isBottom&&t.canvasLayer===Ht.CanvasImageBottom||!this.isBottom&&t.canvasLayer===Ht.CanvasImage)&&t.image&&t.calculative.img&&t.name!=="gif",t.calculative.hasImage}render(){var s;let t=!1,i=!1;for(const o of this.store.data.pens)this.hasImage(o)&&(this.store.animates.has(o)?i=!0:o.calculative.imageDrawed||(t=!0),o.parentId&&this.store.animates.has(Ge(o,!0))&&(i=!0));const r=this.store.patchFlagsBackground,n=this.store.patchFlagsTop;if(n&&!this.isBottom){const o=this.otherOffsreen.getContext("2d");o.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderRule(o)}if(this.store.patchFlagsLast&&this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),t){const o=this.offscreen.getContext("2d");o.save(),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.translate(this.store.data.x,this.store.data.y);for(const l of this.store.data.pens)!l.calculative.hasImage||this.store.animates.has(l)||this.store.animates.has(Ge(l,!0))||l.canvasLayer!==Ht.CanvasTemplate&&(l.calculative.imageDrawed=!0,o.save(),Wn(o,l),(l.rotateByRoot||l.calculative.rotate)&&Mr(o,l),zn(o,l),ka(o,l),o.restore());o.restore()}if(i){const o=this.animateOffsScreen.getContext("2d");o.save(),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.translate(this.store.data.x,this.store.data.y);for(const l of this.store.animates)l.calculative.hasImage&&l.canvasLayer!==Ht.CanvasTemplate&&(l.visible===!1||l.calculative.visible===!1||(l.calculative.imageDrawed=!0,o.save(),Wn(o,l),(l.rotateByRoot||l.calculative.rotate)&&Mr(o,l),zn(o,l),ka(o,l),o.restore()));for(const l of this.store.data.pens)!l.calculative.hasImage||!l.parentId||l.canvasLayer!==Ht.CanvasTemplate&&(l.visible===!1||l.calculative.visible===!1||this.store.animates.has(Ge(l,!0))&&(l.calculative.imageDrawed=!0,o.save(),Wn(o,l),(l.rotateByRoot||l.calculative.rotate)&&Mr(o,l),zn(o,l),ka(o,l),o.restore()));o.restore()}if(!this.isBottom&&!this.store.data.locked&&this.fitFlag){const o=(this.store.data.width||this.store.options.width)*this.store.data.scale,l=(this.store.data.height||this.store.options.height)*this.store.data.scale,h=this.store.data.origin.x+this.store.data.x||this.store.options.x||0,c=this.store.data.origin.y+this.store.data.y||this.store.options.y||0,u=this.fitOffscreen.getContext("2d");u.save(),u.clearRect(0,0,this.canvas.width,this.canvas.height),u.fillStyle="#ffffff66",u.strokeStyle=this.store.styles.activeColor,(s=this.store.data.fits)==null||s.forEach((d,f)=>{u.fillRect(h+o*d.x,c+l*d.y,o*d.width,l*d.height),d.active&&u.strokeRect(h+o*d.x,c+l*d.y,o*d.width,l*d.height)}),u.restore()}if(t||i||r&&this.isBottom||n&&!this.isBottom){const o=this.canvas.getContext("2d");o.clearRect(0,0,this.canvas.width,this.canvas.height),this.isBottom&&(this.store.patchFlagsBackground=!1),o.drawImage(this.offscreen,0,0,this.canvas.width,this.canvas.height),o.drawImage(this.animateOffsScreen,0,0,this.canvas.width,this.canvas.height),this.isBottom||(o.drawImage(this.otherOffsreen,0,0,this.canvas.width,this.canvas.height),this.store.patchFlagsTop=!1,!this.store.data.locked&&this.fitFlag&&o.drawImage(this.fitOffscreen,0,0,this.canvas.width,this.canvas.height))}}renderRule(t){var b,S,I,D,O,P,q,J;const{data:i,options:r}=this.store,{rule:n,ruleColor:a,scale:s,origin:o}=i;if(!(n??r.rule))return;const l=s*10;t.save();const h=a||r.ruleColor||"#ccc";t.strokeStyle=ul(h,.7);const c=o.x+i.x,u=o.y+i.y,{width:d,height:f}=this.canvas;let m=((b=r.ruleOptions)==null?void 0:b.height)||20;(S=r.ruleOptions)!=null&&S.background&&(t.beginPath(),t.fillStyle=(I=r.ruleOptions)==null?void 0:I.background,t.rect(0,0,d,m),t.fill(),t.rect(0,0,m,f),t.fill()),(D=r.ruleOptions)!=null&&D.underline&&(t.beginPath(),t.fillStyle=ul(h,.7),t.moveTo(0,m),t.lineTo(d,m),t.stroke(),t.moveTo(m,0),t.lineTo(m,f),t.stroke());let p=m/4;((O=r.ruleOptions)==null?void 0:O.baseline)==="bottom"&&(p=m*3/4),t.beginPath(),t.lineWidth=m/2,t.lineDashOffset=-c%l,t.setLineDash([1,l-1]),t.moveTo(0,p),t.lineTo(d,p),t.stroke(),t.beginPath(),t.lineDashOffset=-u%l,t.moveTo(p,0),t.lineTo(p,f),t.stroke(),t.strokeStyle=h,t.beginPath(),t.lineWidth=m,t.lineDashOffset=-c%(l*10),t.setLineDash([1,l*10-1]),t.moveTo(0,m/2),t.lineTo(d,m/2),t.stroke(),t.beginPath(),t.lineDashOffset=-u%(l*10),t.moveTo(m/2,0),t.lineTo(m/2,f),t.stroke(),t.beginPath(),t.fillStyle=((P=r.ruleOptions)==null?void 0:P.textColor)||t.strokeStyle;let g=0-Math.floor(c/l/10)*100,y=((q=r.ruleOptions)==null?void 0:q.textTop)||16,T=((J=r.ruleOptions)==null?void 0:J.textLeft)||4;c<0&&(g-=100);for(let A=c%(l*10);A<d;A+=10*l,g+=100)l<3&&g%500||t.fillText(g.toString(),A+T,y);g=0-Math.floor(u/l/10)*100,u<0&&(g-=100);for(let A=u%(l*10);A<f;A+=10*l,g+=100)l<3&&g%500||(t.save(),t.beginPath(),t.translate(y,A-T),t.rotate(270*Math.PI/180),t.fillText(g.toString(),0,0),t.restore());t.restore()}}class eE{constructor(t,i,r){B(this,"parentCanvas");B(this,"parentElement");B(this,"store");B(this,"canvas",document.createElement("canvas"));B(this,"magnifierScreen",ir());B(this,"offscreen",ir());B(this,"domOffscreen",ir());B(this,"magnifierSize",300);B(this,"magnifier");this.parentCanvas=t,this.parentElement=i,this.store=r,i.appendChild(this.canvas),this.canvas.style.backgroundRepeat="no-repeat",this.canvas.style.backgroundSize="100% 100%",this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.pointerEvents="none"}resize(t,i){this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",t=t*this.store.dpiRatio|0,i=i*this.store.dpiRatio|0,this.canvas.width=t,this.canvas.height=i,this.offscreen.width=t,this.offscreen.height=i,this.offscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").textBaseline="middle",this.domOffscreen.width=t,this.domOffscreen.height=i,this.domOffscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.domOffscreen.getContext("2d").textBaseline="middle",this.magnifierScreen.width=this.magnifierSize+5,this.magnifierScreen.height=this.magnifierSize+5}renderMagnifier(){if(!this.magnifier)return;const t=this.magnifierSize/2,i=this.magnifierSize+5,r=this.magnifierScreen.getContext("2d");r.clearRect(0,0,i,i),r.lineWidth=5,r.save(),r.translate(2.5,2.5),r.save(),r.arc(t,t,t,0,Math.PI*2,!1),r.clip(),r.translate(-t,-t),r.scale(2,2);const n={x:(this.parentCanvas.mousePos.x+this.store.data.x)*this.store.dpiRatio,y:(this.parentCanvas.mousePos.y+this.store.data.y)*this.store.dpiRatio};[this.parentCanvas.canvasTemplate.bgOffscreen,this.parentCanvas.canvasTemplate.offscreen,this.parentCanvas.canvasImageBottom.offscreen,this.parentCanvas.canvasImageBottom.animateOffsScreen,this.parentCanvas.offscreen,this.parentCanvas.canvasImage.offscreen,this.parentCanvas.canvasImage.animateOffsScreen,this.domOffscreen].forEach(l=>{r.drawImage(l,n.x-t,n.y-t,this.magnifierSize,this.magnifierSize,0,0,this.magnifierSize,this.magnifierSize)}),r.restore(),r.beginPath();const s=r.createRadialGradient(t,t,t-5,t,t,t);s.addColorStop(0,"rgba(0,0,0,0.2)"),s.addColorStop(.8,"rgb(200,200,200)"),s.addColorStop(.9,"rgb(200,200,200)"),s.addColorStop(1,"rgba(200,200,200,0.9)"),r.strokeStyle=s,r.arc(t,t,t,0,Math.PI*2,!1),r.stroke(),r.restore(),this.offscreen.getContext("2d").drawImage(this.magnifierScreen,0,0,this.magnifierSize+5,this.magnifierSize+5,(n.x-t-2.5)/this.store.dpiRatio,(n.y-t-2.5)/this.store.dpiRatio,(this.magnifierSize+5)/this.store.dpiRatio,(this.magnifierSize+5)/this.store.dpiRatio)}updateDomOffscreen(){const t=this.domOffscreen.getContext("2d");t.clearRect(0,0,this.domOffscreen.width,this.domOffscreen.height);for(const i of this.store.data.pens)if((i.externElement||i.name==="gif")&&i.calculative.img){t.save(),t.translate(this.store.data.x,this.store.data.y);const{x:r,y:n,width:a,height:s}=i.calculative.worldRect;t.drawImage(i.calculative.img,r,n,a,s),t.restore()}}render(){this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.renderMagnifier();const t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.drawImage(this.offscreen,0,0,this.canvas.width,this.canvas.height)}}function sv(e){if(e.data.locked)throw new Error("canvas is locked")}class iE{constructor(t,i){B(this,"parentElement");B(this,"box");B(this,"iframe");B(this,"dialog");B(this,"close");B(this,"title");B(this,"body");B(this,"x");B(this,"y");B(this,"url");B(this,"meta2dDiv");B(this,"dialogMeta2d");B(this,"store");B(this,"data");this.parentElement=t,this.store=i,this.box=document.createElement("div"),this.dialog=document.createElement("div");let r=document.createElement("div");this.title=document.createElement("div"),this.close=document.createElement("span"),this.close.innerHTML=`
      <svg fill="none" viewBox="0 0 16 16" width="1em" height="1em">
      <path
        fill="currentColor"
        d="M8 8.92L11.08 12l.92-.92L8.92 8 12 4.92 11.08 4 8 7.08 4.92 4 4 4.92 7.08 8 4 11.08l.92.92L8 8.92z"
        fill-opacity="0.9"
      ></path>
    </svg>`,this.body=document.createElement("div"),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("frameborder","0"),this.meta2dDiv=document.createElement("div"),this.box.className="meta2d-dialog_mask",this.dialog.className="meta2d-dialog",this.body.className="meta2d-dialog_body",r.className="meta2d-dialog_header",this.title.className="meta2d-dialog-content",this.close.className="meta2d-dialog-close",this.meta2dDiv.className="meta2d-dialog-meta2d",r.appendChild(this.title),r.appendChild(this.close),this.body.appendChild(this.iframe),this.body.appendChild(this.meta2dDiv),this.dialog.appendChild(r),this.dialog.appendChild(this.body),this.box.appendChild(this.dialog),t.appendChild(this.box),this.dialog.onclick=a=>{a.stopPropagation()},this.box.onclick=()=>{this.hide()},this.close.onclick=()=>{this.hide()};let n;for(let a=0;a<document.styleSheets.length;a++)document.styleSheets[a].title==="le5le.com/dialog"&&(n=document.styleSheets[a]);if(!n){let a=document.createElement("style");a.type="text/css",a.title="le5le.com/dialog",document.head.appendChild(a),a=document.createElement("style"),a.type="text/css",document.head.appendChild(a),n=a.sheet,n.insertRule(`.meta2d-dialog_mask {
        display: none;
        position: absolute;
        top: 0%;
        left: 0%;
        width: 100%;
        height: 100%;
        background-color: #0000006f;
        z-index: 9999;`),n.insertRule(`.meta2d-dialog_mask .meta2d-dialog {
            position: absolute;
            top: 15vh;
            left: 10%;
            width: 80%;
            height:420px;
            padding: 16px 20px;
            border-radius: 9px;
            z-index: 19999;
            overflow: auto;
        }`),n.insertRule(`.meta2d-dialog_header {
            display: flex;
            position: relative;
            z-index: 999;
        }`),n.insertRule(`.meta2d-dialog-content {
            width: calc(100% - 20px);
            font-weight: 600;
            font-size: 14px;
            color: #bdc7db;
            padding-bottom:8px;
        }`),n.insertRule(`.meta2d-dialog-close {
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            color: #617b91;
            position: absolute;
            right:20px;
            top:2px;
            display:none;
        }`),n.insertRule(`.meta2d-dialog-close svg{
            width: 18px;
            height: 18px;
        }`),n.insertRule(`.meta2d-dialog-close :hover{
            cursor: pointer;
        }`),n.insertRule(`.meta2d-dialog_body{
          width: 100%;
          height: 100%;
        } `),n.insertRule(`.meta2d-dialog_body iframe{
            width: 100%;
            height: 100%;
        }`),n.insertRule(`.meta2d-dialog_body .meta2d-dialog-meta2d{
          width: 100%;
          height: 100%;
          display: none;
      }`)}}async show(t,i,r,n){if(!i)return;if(this.data=n,t&&(this.title.innerText=t),t?(this.dialog.style.padding="16px 20px",this.title.style.display="block",this.body.style.height="calc(100% - 30px)",this.close.style.top=((r==null?void 0:r.closeTop)||2)+"px",this.close.style.right=((r==null?void 0:r.closeRight)||2)+"px",this.dialog.style.background=(r==null?void 0:r.background)||this.store.data.background||"#1e2430"):(this.dialog.style.padding="0px",this.title.style.display="none",this.body.style.height="100%",this.body.style.overflow="hidden",this.close.style.top=((r==null?void 0:r.closeTop)||18)+"px",this.close.style.right=((r==null?void 0:r.closeRight)||20)+"px",this.body.style.background="transparent"),this.box.style.display="block",r){const{x:o,y:l,width:h,height:c}=this.detailRect(r);this.dialog.style.width=h,this.dialog.style.height=c,this.dialog.style.top=l,this.dialog.style.left=o,this.dialog.style.translate=`${o==="50%"?"-50%":0} ${l==="50%"?"-50%":0}`,this.box.style.background=r.maskBackground||"#0000006f"}const a=this.isUrl(i);let s=!1;if(a?(this.meta2dDiv.style.display="none",this.iframe.style.display="block"):(this.iframe.style.display="none",this.meta2dDiv.style.display="block"),a&&i!==this.url&&(this.iframe.setAttribute("src",i),this.url=i,s=!0),this.iframe.onload=()=>{(!this.dialogMeta2d||a)&&(this.close.style.display=r.hideClose?"none":"block",this.box.style.opacity="1")},!s&&(!this.dialogMeta2d||a)&&(this.box.style.opacity="1"),!a){this.meta2dDiv.style.display="block",this.dialogMeta2d||(globalThis.mainMeta2d=globalThis.meta2d,this.dialogMeta2d=new LE(this.meta2dDiv),globalThis.meta2d=globalThis.mainMeta2d);const o=await Cp(this.store,i);o&&(this.box.style.display="block",this.dialogMeta2d.clear(!0),this.dialogMeta2d.open(o,!1),this.dialogMeta2d.lock(1),this.dialogMeta2d.resize(),this.dialogMeta2d.fitView(!0,0),this.dialogMeta2d.render(!0))}}detailRect(t){const i=["x","y","width","height"];if(t)for(let r of i){let n=t[r];n&&(Number(n)?t[r]=n+"px":n.match(/\d+(px|vh|vw|%)$/)||(n=parseFloat(n),t[r]=isNaN(n)?void 0:n+"px"))}return{x:t.x||"50%",y:t.y||"50%",width:t.width||"80%",height:t.height||"420px"}}hide(){this.box.style.display="none",this.box.style.opacity="0"}isUrl(t){return!!(t.startsWith("http")||t.includes("?")||t.includes("/"))}destroy(){var t;this.dialog.onclick=void 0,this.box.onclick=void 0,this.close.onclick=void 0,(t=this.dialogMeta2d)==null||t.destroy(!0)}}class wl{constructor(t){B(this,"parentElement");B(this,"box");B(this,"currentAnchor");this.parentElement=t,this.box=document.createElement("div"),this.box.className="meta2d-title",t.appendChild(this.box);let i;for(let r=0;r<document.styleSheets.length;r++)document.styleSheets[r].title==="le5le.com/title"&&(i=document.styleSheets[r]);if(!i){let r=document.createElement("style");r.type="text/css",r.title="le5le.com/title",document.head.appendChild(r),r=document.createElement("style"),r.type="text/css",document.head.appendChild(r),i=r.sheet,i.insertRule(".meta2d-title{position:absolute;padding:0;z-index:10;left: -9999px;top: -9999px;background:#fff;color:#000; cursor: crosshair;border: 1px solid black;}")}}static getTitle(t){}setText(t){this.box.innerText=t.title}updateText(t){var i;((i=this.currentAnchor)==null?void 0:i.id)===t.id&&(wl.titleEmpty(t)||(this.setText(t),this.changePositionByAnchor(t)))}changePositionByAnchor(t){this.box.style.left=t.x+10+"px",this.box.style.top=t.y+10+"px"}static titleEmpty(t){return!t.title}show(t,i){if(wl.titleEmpty(t))return;this.currentAnchor=t,this.setText(t);let r={x:i.calculative.canvas.store.data.x+t.x,y:i.calculative.canvas.store.data.y+t.y};this.changePositionByAnchor(r)}hide(){this.box.style.left="-9999px",this.box.innerText="",this.currentAnchor=null}destroy(){this.box.onmouseleave=null}}class rE{constructor(t,i){B(this,"parentElement");B(this,"store");B(this,"canvas",document.createElement("canvas"));B(this,"offscreen",ir());B(this,"bgOffscreen",ir());B(this,"patchFlags");B(this,"bgPatchFlags");B(this,"fit");this.parentElement=t,this.store=i,t.appendChild(this.canvas),this.canvas.style.backgroundRepeat="no-repeat",this.canvas.style.backgroundSize="100% 100%",this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0"}resize(t,i){this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",t=t*this.store.dpiRatio|0,i=i*this.store.dpiRatio|0,this.canvas.width=t,this.canvas.height=i,this.bgOffscreen.width=t,this.bgOffscreen.height=i,this.offscreen.width=t,this.offscreen.height=i,this.bgOffscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.bgOffscreen.getContext("2d").textBaseline="middle",this.offscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").textBaseline="middle",this.init()}init(){this.bgOffscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.patchFlags=!0,this.bgPatchFlags=!0}hidden(){this.canvas.style.display="none"}show(){this.canvas.style.display="block"}clear(){this.bgOffscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.offscreen.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.bgPatchFlags=!0,this.patchFlags=!0}render(){if(this.bgPatchFlags){const t=this.bgOffscreen.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height);const i=this.store.data.width||this.store.options.width,r=this.store.data.height||this.store.options.height,n=this.store.data.x||this.store.options.x||0,a=this.store.data.y||this.store.options.y||0,s=this.store.data.background||this.store.styles.background;s&&(t.save(),t.fillStyle=s,t.globalAlpha=this.store.data.globalAlpha??this.store.options.globalAlpha,i&&r&&!this.fit?(t.shadowOffsetX=this.store.options.shadowOffsetX,t.shadowOffsetY=this.store.options.shadowOffsetY,t.shadowBlur=this.store.options.shadowBlur,t.shadowColor=this.store.options.shadowColor,t.fillRect(this.store.data.origin.x+n,this.store.data.origin.y+a,i*this.store.data.scale,r*this.store.data.scale)):t.fillRect(0,0,this.canvas.width,this.canvas.height),t.restore()),i&&r&&this.store.bkImg&&(t.save(),this.fit?t.drawImage(this.store.bkImg,0,0,this.canvas.offsetWidth,this.canvas.offsetHeight):t.drawImage(this.store.bkImg,this.store.data.origin.x+n,this.store.data.origin.y+a,i*this.store.data.scale,r*this.store.data.scale),t.restore()),this.renderGrid(t)}if(this.patchFlags){const t=this.offscreen.getContext("2d");t.save(),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.translate(this.store.data.x,this.store.data.y);for(const i of this.store.data.pens)isFinite(i.x)&&i.canvasLayer===Ht.CanvasTemplate&&i.calculative.inView&&(_n(t,i),i.image&&i.name!=="gif"&&i.calculative.img&&(t.save(),Wn(t,i),(i.rotateByRoot||i.calculative.rotate)&&Mr(t,i),zn(t,i),ka(t,i),t.restore()));t.restore()}if(this.patchFlags||this.bgPatchFlags){const t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.drawImage(this.bgOffscreen,0,0,this.canvas.width,this.canvas.height),t.drawImage(this.offscreen,0,0,this.canvas.width,this.canvas.height),this.patchFlags=!1,this.bgPatchFlags=!1}}renderGrid(t){const{data:i,options:r}=this.store,{grid:n,gridRotate:a,gridColor:s,gridSize:o,scale:l,origin:h}=i;if(!(n??r.grid))return;t.save();const c=(i.width||r.width)*l,u=(i.height||r.height)*l,d=(i.x||r.x||0)+h.x,f=(i.y||r.y||0)+h.y;t.lineWidth=1,t.strokeStyle=s||r.gridColor,t.beginPath();let m=(o||r.gridSize)*l;if(m=m<0?0:m,!c||!u){const p=this.store.dpiRatio,g=this.canvas.width/p,y=this.canvas.height/p,T=d/m,b=f/m,S=m*10,I=d-Math.ceil(T)*m,D=f-Math.ceil(b)*m,O=g+I+S,P=y+D+S;if(a){const q=a*Math.PI/180,J=q+Math.PI/2,A={x:Math.sin(q),y:-Math.cos(q)},x={x:Math.sin(J),y:-Math.cos(J)};yf(t,g,y,m,A),yf(t,g,y,m,x)}else{for(let q=I;q<=O;q+=m)t.moveTo(q,D),t.lineTo(q,y+D+S);for(let q=D;q<=P;q+=m)t.moveTo(I,q),t.lineTo(g+I+S,q)}}else if(a){const p=a*Math.PI/180,g=p+Math.PI/2,y={x:Math.sin(p),y:-Math.cos(p)},T={x:Math.sin(g),y:-Math.cos(g)};bf(t,d,f,c,u,m,y),bf(t,d,f,c,u,m,T)}else{const p=c+d,g=u+f;for(let y=d;y<=p;y+=m)t.moveTo(y,f),t.lineTo(y,u+f);for(let y=f;y<=g;y+=m)t.moveTo(d,y),t.lineTo(c+d,y)}t.stroke(),t.restore()}}function yf(e,t,i,r,n,a){const s=[{x:0,y:0},{x:t,y:0},{x:t,y:i},{x:0,y:i}];let o=1/0,l=-1/0;s.forEach(c=>{const u=c.x*n.x+c.y*n.y;o=Math.min(o,u),l=Math.max(l,u)});const h=Math.ceil((l-o)/r);e.beginPath();for(let c=0;c<=h;c++){const u=o+c*r;let d=[];for(let f=0;f<s.length;f++){const m=s[f],p=s[(f+1)%s.length],g=n.x*(p.y-m.y)-n.y*(p.x-m.x);if(Math.abs(g)>1e-6){const y=(u-m.x*n.x-m.y*n.y)/(n.x*(p.x-m.x)+n.y*(p.y-m.y));if(y>=0&&y<=1){const T=m.x+y*(p.x-m.x),b=m.y+y*(p.y-m.y);d.push({x:T,y:b})}}}d.length>=2&&(e.moveTo(d[0].x,d[0].y),e.lineTo(d[1].x,d[1].y))}e.stroke()}function bf(e,t,i,r,n,a,s,o){const l=[{x:t,y:i},{x:t+r,y:i},{x:t+r,y:i+n},{x:t,y:i+n}];let h=1/0,c=-1/0;l.forEach(m=>{const p=m.x*s.x+m.y*s.y;h=Math.min(h,p),c=Math.max(c,p)});const u=c-h,d=Math.ceil(u/a),f=h;e.beginPath();for(let m=0;m<=d;m++){const p=f+m*a,g=[];for(let y=0;y<l.length;y++){const T=l[y],b=l[(y+1)%4],S=b.x-T.x,I=b.y-T.y,D=s.x*I-s.y*S;if(Math.abs(D)>1e-6){const O=(p-T.x*s.x-T.y*s.y)/(s.x*S+s.y*I);O>=0&&O<=1&&g.push({x:T.x+O*S,y:T.y+O*I})}}g.length>=2&&(e.moveTo(g[0].x,g[0].y),e.lineTo(g[1].x,g[1].y))}e.stroke()}const nE={info:{icon:'<svg fill="none" viewBox="0 0 24 24"><path fill="#0052d9" d="M12 23a11 11 0 100-22 11 11 0 000 22zM11 8.5v-2h2v2h-2zm2 1.5v7.5h-2V10h2z"></path></svg>'}};class aE{constructor(t,i){B(this,"parentElement");B(this,"store");B(this,"box");B(this,"text");B(this,"arrowUp");B(this,"arrowDown");B(this,"icon");B(this,"confirm");B(this,"cancel");B(this,"x");B(this,"y");this.parentElement=t,this.store=i,this.box=document.createElement("div"),this.text=document.createElement("div"),this.arrowUp=document.createElement("div"),this.arrowDown=document.createElement("div"),this.icon=document.createElement("div"),this.confirm=document.createElement("button"),this.cancel=document.createElement("button"),this.box.className="meta2d-popconfirm",this.text.className="text",this.arrowUp.className="arrow",this.arrowDown.className="arrow down",this.icon.className="icon",this.confirm.className="confirm",this.cancel.className="cancel",this.confirm.innerHTML="确定",this.cancel.innerHTML="取消",this.icon.innerHTML=nE.info.icon,this.box.appendChild(this.text),this.box.appendChild(this.arrowUp),this.box.appendChild(this.arrowDown),this.box.appendChild(this.confirm),this.box.appendChild(this.cancel),this.box.appendChild(this.icon),t.appendChild(this.box);let r;for(let n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le.com/popconfirm"&&(r=document.styleSheets[n]);if(!r){let n=document.createElement("style");n.type="text/css",n.title="le5le.com/popconfirm",document.head.appendChild(n),n=document.createElement("style"),n.type="text/css",document.head.appendChild(n),r=n.sheet,r.insertRule(".meta2d-popconfirm{position:absolute;z-index:999;left: -9999px;top: -9999px;padding:16px;max-width:400px;background:#fff;border-radius:6px;box-shadow:0 3px 14px 2px rgba(0, 0, 0, .05),0 8px 10px 1px rgba(0, 0, 0, 6%),0 5px 5px -3px rgba(0, 0, 0, 10%);}"),r.insertRule(".meta2d-popconfirm .text{outline:none;padding:0px 0px 40px 28px;border-radius:4px;color:rgba(0, 0, 0, 0.9);overflow-y:auto;line-height:22px;font-size:13px;}"),r.insertRule(".meta2d-popconfirm .arrow{position:absolute;border:10px solid transparent;background:transparent;top:-18px;left:50%;transform:translateX(-50%)}"),r.insertRule(".meta2d-popconfirm .arrow.down{top:initial;bottom: -18px;}"),r.insertRule(".meta2d-popconfirm .icon{position:absolute;width:22px;height:22px;left:16px;top:16px;}"),r.insertRule(".meta2d-popconfirm .confirm{position:absolute;right:16px;bottom:16px;width:40px;height:24px;text-align:center;background:#4582e6;color:#fff;border-radius:3px;border-color:transparent}"),r.insertRule(".meta2d-popconfirm .confirm:hover{background:#003cab;}"),r.insertRule(".meta2d-popconfirm .cancel{position:absolute;right:64px;bottom:16px;width:40px;height:24px;text-align:center;background:#dcdcdc;color:rgba(0, 0, 0, 0.9);border-radius:3px;border-color:transparent}"),r.insertRule(".meta2d-popconfirm .cancel:hover{background:#a6a6a6;}")}}show(t,i){if(!t)return;const r=this.box.getBoundingClientRect(),n=t.calculative.worldRect;let a=t.calculative.canvas.store.data.x+i.x-r.width/2,s=t.calculative.canvas.store.data.y+i.y-r.height-20;t.type||(a=t.calculative.canvas.store.data.x+n.x-(r.width-n.width)/2,s=t.calculative.canvas.store.data.y+n.ey-r.height-n.height),s>0?(this.arrowUp.style.borderBottomColor="transparent",this.arrowDown.style.borderTopColor="#fff",s-=10):(s+=r.height+n.height+5,s+=10,this.arrowUp.style.borderBottomColor="#fff",this.arrowDown.style.borderTopColor="transparent"),this.x=a,this.y=s,this.box.style.left=this.x+"px",this.box.style.top=this.y+"px"}hide(){this.x=-9999,this.box.style.left="-9999px"}showModal(t,i,r){return new Promise(n=>{this.text.innerHTML=r||"确认执行操作吗？",this.show(t,i),this.confirm.onclick=()=>{n(!0),this.hide()},this.cancel.onclick=()=>{n(!1),this.hide()}})}destroy(){this.box=null}}const Qe="-moving";class wf{constructor(t,i,r){B(this,"parent");B(this,"parentElement");B(this,"store");B(this,"canvas",document.createElement("canvas"));B(this,"offscreen",ir());B(this,"width");B(this,"height");B(this,"externalElements",document.createElement("div"));B(this,"clientRect");B(this,"canvasRect");B(this,"activeRect");B(this,"initActiveRect");B(this,"dragRect");B(this,"lastRotate",0);B(this,"sizeCPs");B(this,"activeInitPos");B(this,"hoverType",Et.None);B(this,"resizeIndex",0);B(this,"mouseDown");B(this,"hotkeyType");B(this,"mouseRight");B(this,"addCaches");B(this,"touchCenter");B(this,"initTouchDis");B(this,"initScale");B(this,"touchScaling");B(this,"touchMoving");B(this,"startTouches");B(this,"lastTouchY");B(this,"lastOffsetX",0);B(this,"lastOffsetY",0);B(this,"drawingLineName");B(this,"drawLineFns",[...Mb]);B(this,"drawingLine");B(this,"pencil");B(this,"pencilLine");B(this,"movingPens");B(this,"patchFlagsLines",new Set);B(this,"dock");B(this,"prevAnchor");B(this,"nextAnchor");B(this,"lastMouseTime",0);B(this,"hoverTimer",0);B(this,"fitTimer",0);B(this,"willInactivePen");B(this,"patchFlags",!1);B(this,"lastRender",0);B(this,"touchStart",0);B(this,"touchStartTimer");B(this,"timer");B(this,"lastTapTime",0);B(this,"lastAnimateRender",0);B(this,"animateRendering",!1);B(this,"renderTimer");B(this,"initPens");B(this,"pointSize",8);B(this,"pasteOffset",!0);B(this,"opening",!1);B(this,"maxZindex",5);B(this,"canMoveLine",!1);B(this,"randomIdObj");B(this,"keyOptions");B(this,"isMobile",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));B(this,"beforeAddPen");B(this,"beforeAddPens");B(this,"beforeAddAnchor");B(this,"beforeRemovePens");B(this,"beforeRemoveAnchor");B(this,"customResizeDock");B(this,"customMoveDock");B(this,"inputParent",document.createElement("div"));B(this,"inputDiv",document.createElement("div"));B(this,"dropdown",document.createElement("ul"));B(this,"tooltip");B(this,"popconfirm");B(this,"title");B(this,"mousePos",{x:0,y:0});B(this,"scroll");B(this,"movingAnchor");B(this,"canvasTemplate");B(this,"canvasImage");B(this,"canvasImageBottom");B(this,"magnifierCanvas");B(this,"dialog");B(this,"autoPolylineFlag",!1);B(this,"stopPropagation",t=>{t.stopPropagation()});B(this,"curve",ET);B(this,"polyline",DT);B(this,"mind",ST);B(this,"line",xT);B(this,"onCopy",t=>{this.store.options.disableClipboard||t.target!==this.externalElements&&t.target!==document.body&&t.target.offsetParent!==this.externalElements||this.copy()});B(this,"onCut",t=>{this.store.options.disableClipboard||t.target!==this.externalElements&&t.target!==document.body&&t.target.offsetParent!==this.externalElements||this.cut()});B(this,"onPaste",async t=>{if(this.store.data.locked||this.store.options.disableClipboard||t.target!==this.externalElements&&t.target!==document.body&&t.target.offsetParent!==this.externalElements)return;let i;if(navigator.clipboard&&t.clipboardData){const r=t.clipboardData.items;if(r){for(let n=0;n<r.length;n++)if(r[n].type.indexOf("image")!==-1&&r[n].getAsFile()){i=!0;break}}}if(i){const r=t.clipboardData.items;if(r){for(let n=0;n<r.length;n++)if(r[n].type.indexOf("image")!==-1&&r[n].getAsFile()){const{x:a,y:s}=this.mousePos,o=r[n].getAsFile();let l=r[n].type.slice(6)==="gif"?"gif":"image";if(o!==null){const h=l==="gif",c=await this.fileToPen(o,h);c.height=c.height/c.width*100,c.width=100,c.x=a-50/2,c.y=s-c.height/c.width*50,c.externElement=h,this.addPens([c]),this.active([c]),this.copy([c])}}}}else this.paste()});B(this,"onMessage",t=>{if(typeof t.data!="string"||!t.data||t.data.startsWith("setImmediate")||t.data.startsWith("webpackHotUpdate"))return;let i=JSON.parse(t.data);typeof i=="object"?(i.name==="onload"&&this.dialog.iframe.contentWindow.postMessage(JSON.stringify({name:"dialog",data:this.dialog.data}),"*"),i.name==="closeDialog"&&this.dialog.hide(),this.parent.doMessageEvent(i.name,JSON.stringify(i.data))):this.parent.doMessageEvent(i)});B(this,"onwheel",t=>{if(this.inputDiv.contentEditable==="true"||this.drawingLine||this.pencil)return;if(this.store.hover&&this.store.hover.onWheel){this.store.hover.onWheel(this.store.hover,t);return}if(this.store.data.disableScale||this.store.options.disableScale||(t.preventDefault(),t.stopPropagation(),this.mouseDown&&(this.hoverType===Et.Node||this.hoverType===Et.Line))||this.store.data.locked===jt.Disable||this.store.data.locked===jt.DisableScale||this.store.data.locked===jt.DisableMoveScale)return;if(!t.ctrlKey&&Math.abs(t.wheelDelta)<100&&t.deltaY.toString().indexOf(".")===-1){if(this.store.options.scroll&&!t.metaKey&&this.scroll){this.scroll.wheel(t.deltaY<0);return}const a=this.store.data.scale||1;this.translate(-t.deltaX/a,-t.deltaY/a);return}if(Math.abs(t.wheelDelta)>100&&this.store.options.scroll&&this.scroll&&!this.store.options.scrollButScale&&!(t.ctrlKey||t.metaKey)){this.scroll.wheel(t.deltaY<0);return}if(this.store.options.disableTouchPadScale)return;let i=.015;if(this.store.options.scaleOff)i=this.store.options.scaleOff,t.deltaY>0&&(i=-this.store.options.scaleOff);else if(/mac os /i.test(navigator.userAgent))t.ctrlKey?t.deltaY>0&&(i*=-1):i*=t.wheelDeltaY/240;else{let s=.2;t.deltaY.toString().indexOf(".")!==-1&&(s=.01),t.deltaY>0?i=-s:i=s}let{offsetX:r,offsetY:n}=t;this.scale(this.store.data.scale+i,{x:r,y:n}),this.externalElements.focus()});B(this,"onkeydown",t=>{var a,s,o;if(this.store.data.locked>=jt.DisableEdit&&t.target.tagName!=="INPUT"&&t.target.tagName!=="TEXTAREA"&&!t.target.dataset.meta2dIgnore&&this.store.active.forEach(l=>{var h;(h=l.onKeyDown)==null||h.call(l,l,t.key)}),this.store.data.locked>=jt.DisableEdit||t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.target.dataset.meta2dIgnore||this.store.options.unavailableKeys.includes(t.key))return;this.keyOptions||(this.keyOptions={}),this.keyOptions.altKey=t.altKey,this.keyOptions.shiftKey=t.shiftKey,this.keyOptions.ctrlKey=t.ctrlKey,this.keyOptions.metaKey=t.metaKey,this.keyOptions.F=!1,(t.key==="F"||t.key==="f")&&(this.keyOptions.F=!0);let i=10,r=10,n=null;if(this.store.options.strictScope){const l=this.store.data.width||this.store.options.width,h=this.store.data.height||this.store.options.height;l&&h&&(n={x:this.store.data.origin.x,y:this.store.data.origin.y,width:l*this.store.data.scale,height:h*this.store.data.scale})}switch(t.key){case" ":this.hotkeyType=Xt.Translate;break;case"Control":this.drawingLine?this.drawingLine.calculative.drawlineH=!this.drawingLine.calculative.drawlineH:this.hotkeyType||(this.patchFlags=!0,this.hotkeyType=Xt.Select);break;case"Meta":break;case"Shift":this.store.active.length===1&&this.store.active[0].type&&this.store.activeAnchor?this.toggleAnchorHand():this.hotkeyType||(this.patchFlags=!0,this.store.options.resizeMode||(this.hotkeyType=Xt.Resize));break;case"Alt":if(!t.ctrlKey&&!t.shiftKey&&this.drawingLine){const l=Gt(this.drawingLine);l!==this.drawingLine.calculative.activeAnchor?(mu(this.drawingLine),this.drawingLine.calculative.worldAnchors.push(l)):this.drawingLine.calculative.worldAnchors.push({x:l.x,y:l.y});const h=this.drawLineFns.indexOf(this.drawingLineName);this.drawingLineName=this.drawLineFns[(h+1)%this.drawLineFns.length],this.drawingLine.lineName=this.drawingLineName,this.drawline(),this.patchFlags=!0}t.preventDefault();break;case"a":case"A":t.ctrlKey||t.metaKey?(this.active(this.store.data.pens.filter(l=>!l.parentId&&l.locked!==jt.Disable)),t.preventDefault()):this.toggleAnchorMode();break;case"Delete":case"Backspace":if(this.canvasImage.fitFlag&&this.canvasImage.activeFit){this.deleteFit();break}!this.store.data.locked&&this.delete();break;case"ArrowLeft":if(this.movingAnchor){this.translateAnchor(-1,0);break}if(i=-1,t.shiftKey&&(i=-5),(t.ctrlKey||t.metaKey)&&(i=-10),i=i*this.store.data.scale,this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){this.moveLineAnchor({x:this.store.activeAnchor.x+i,y:this.store.activeAnchor.y},{});break}n&&this.activeRect.x+i<n.x&&(i=n.x-this.activeRect.x),this.translatePens(this.store.active,i,0);break;case"ArrowUp":if(this.movingAnchor){this.translateAnchor(0,-1);break}if(r=-1,t.shiftKey&&(r=-5),(t.ctrlKey||t.metaKey)&&(r=-10),r=r*this.store.data.scale,n&&this.activeRect.y+r<n.y&&(r=n.y-this.activeRect.y),this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){this.moveLineAnchor({x:this.store.activeAnchor.x,y:this.store.activeAnchor.y+r},{});break}this.translatePens(this.store.active,0,r);break;case"ArrowRight":if(this.movingAnchor){this.translateAnchor(1,0);break}if(i=1,t.shiftKey&&(i=5),(t.ctrlKey||t.metaKey)&&(i=10),i=i*this.store.data.scale,this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){this.moveLineAnchor({x:this.store.activeAnchor.x+i,y:this.store.activeAnchor.y},{});break}n&&this.activeRect.x+this.activeRect.width+i>n.x+n.width&&(i=n.x+n.width-(this.activeRect.x+this.activeRect.width)),this.translatePens(this.store.active,i,0);break;case"ArrowDown":if(this.movingAnchor){this.translateAnchor(0,1);break}if(r=1,t.shiftKey&&(r=5),(t.ctrlKey||t.metaKey)&&(r=10),r=r*this.store.data.scale,n&&this.activeRect.y+this.activeRect.height+r>n.y+n.height&&(r=n.y+n.height-(this.activeRect.y+this.activeRect.height)),this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){this.moveLineAnchor({x:this.store.activeAnchor.x,y:this.store.activeAnchor.y+r},{});break}this.translatePens(this.store.active,0,r);break;case"d":case"D":(a=this.store.active[0])!=null&&a.locked||this.removeAnchorHand();break;case"h":case"H":(s=this.store.active[0])!=null&&s.locked||this.addAnchorHand();break;case"m":case"M":this.toggleMagnifier();break;case"g":case"G":if(t.ctrlKey||t.metaKey){t.shiftKey?this.parent.uncombine():this.store.active.length>1&&this.parent.combine(this.store.active),t.preventDefault();break}this.hoverType===Et.NodeAnchor&&(this.movingAnchor=this.store.hoverAnchor,this.externalElements.style.cursor="move");break;case"s":case"S":!this.store.data.locked&&this.hoverType===Et.LineAnchor&&this.store.hover===this.store.active[0]&&this.splitLine(this.store.active[0],this.store.hoverAnchor),(t.ctrlKey||t.metaKey)&&this.store.emitter.emit("save",{event:t});break;case"c":case"C":(t.ctrlKey||t.metaKey)&&this.store.options.disableClipboard&&this.copy();break;case"x":case"X":(t.ctrlKey||t.metaKey)&&this.store.options.disableClipboard&&this.cut();break;case"√":case"v":case"V":!t.ctrlKey&&!t.metaKey&&(this.pencil&&this.stopPencil(),this.drawingLineName?(this.finishDrawline(),this.drawingLineName=""):this.drawingLineName=this.store.options.drawingLineName),!this.store.data.locked&&(t.ctrlKey||t.metaKey)&&(this.store.options.disableClipboard||!this.store.options.disableClipboard&&t.altKey)&&this.paste();break;case"b":case"B":this.drawingLineName&&(this.finishDrawline(),this.drawingLineName=""),this.pencil?this.stopPencil():this.drawingPencil();break;case"y":case"Y":(t.ctrlKey||t.metaKey)&&this.redo();break;case"z":case"Z":t.ctrlKey||t.metaKey?this.undo():t.shiftKey&&this.redo();break;case"Enter":this.drawingLineName&&(this.finishDrawline(!0),this.store.active[0].anchors[0].connectTo?this.drawingLineName="":this.drawingLineName=this.store.options.drawingLineName),this.store.active&&(this.store.active.forEach(l=>{l.type?(l.close=!l.close,l.close&&Zp(l),this.store.path2dMap.set(l,St.path2dDraws.line(l)),bl(l)):l.calculative.focus=!0}),this.render());break;case"Escape":this.drawingLineName&&this.finishDrawline(),this.drawingLineName=void 0,this.stopPencil(),this.store.active&&this.store.active.forEach(l=>{l.type||(l.calculative.focus=!1)}),this.movingPens&&(this.getAllByPens(this.movingPens).forEach(l=>{this.store.pens[l.id]=void 0}),this.movingPens=void 0,this.mouseDown=void 0,this.clearDock(),(o=this.store.active)==null||o.forEach(l=>{this.updateLines(l)}),this.calcActiveRect(),this.patchFlags=!0),this.hotkeyType=Xt.None,this.movingAnchor=void 0,this.magnifierCanvas.magnifier&&(this.magnifierCanvas.magnifier=!1,this.patchFlags=!0);break;case"E":case"e":this.store.options.disableAnchor=!this.store.options.disableAnchor,this.store.emitter.emit("disableAnchor",this.store.options.disableAnchor);break;case"=":(t.ctrlKey||t.metaKey)&&(this.scale(this.store.data.scale+.1),t.preventDefault(),t.stopPropagation());break;case"-":(t.ctrlKey||t.metaKey)&&(this.scale(this.store.data.scale-.1),t.preventDefault(),t.stopPropagation());break;case"l":case"L":this.canMoveLine=!0;break;case"[":this.parent.down();break;case"]":this.parent.up();break;case"{":this.parent.bottom();break;case"}":this.parent.top();break;case"F":case"f":!this.store.data.locked&&(t.ctrlKey||t.metaKey)&&!this.store.options.disableClipboard&&this.paste(),this.setFollowers();break}this.render(!1)});B(this,"onkeyup",t=>{switch(t.key){case"l":case"L":this.canMoveLine=!1;break}this.hotkeyType&&this.render(),this.hotkeyType<Xt.AddAnchor&&(this.hotkeyType=Xt.None)});B(this,"ondrop",async t=>{if(this.store.data.locked){console.warn("canvas is locked, can not drop");return}t.preventDefault(),t.stopPropagation();const i=t.dataTransfer.getData("Meta2d")||t.dataTransfer.getData("Text");let r=null;try{i&&(r=JSON.parse(i))}catch{}if(!r){const{files:n}=t.dataTransfer;if(n.length&&n[0].type.match("image.*")&&!(this.addCaches&&this.addCaches.length)){const a=n[0].type==="image/gif";r=await this.fileToPen(n[0],a)}else if(this.addCaches&&this.addCaches.length)r=this.addCaches,this.addCaches=[];else{this.store.emitter.emit("drop",void 0);return}}if(r=Array.isArray(r)?r:[r],r[0]&&r[0].draggable!==!1){const n={x:t.offsetX,y:t.offsetY};this.calibrateMouse(n),this.dropPens(r,n),this.addCaches=[],this.getContainerHover(n),this.mousePos.x=n.x,this.mousePos.y=n.y,this.store.emitter.emit("mouseup",{x:n.x,y:n.y,pen:this.store.hoverContainer})}this.store.emitter.emit("drop",r||i)});B(this,"ontouchstart",t=>{if(this.lastTouchY=t.touches[0].clientY,this.store.data.locked===jt.Disable)return;const i=new Date().getTime(),r=i-this.lastTapTime;r<300&&r>0&&this.ondblclick(t),this.lastTapTime=i,this.touchStartTimer&&clearTimeout(this.touchStartTimer),this.touchStartTimer=setTimeout(()=>{this.touchStart=performance.now();const n=t.touches[0].pageX-this.clientRect.x,a=t.touches[0].pageY-this.clientRect.y,s={x:n,y:a};if(this.calibrateMouse(s),this.getHover(s),this.onMouseDown({x:n,y:a,clientX:t.touches[0].clientX,clientY:t.touches[0].clientY,pageX:t.touches[0].pageX,pageY:t.touches[0].pageY,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:1}),t.touches.length===2){this.initTouchDis=Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY),this.initScale=this.store.data.scale,this.startTouches=t.touches,this.touchCenter={x:t.touches[0].pageX+(t.touches[1].pageX-t.touches[0].pageX)/2-this.clientRect.x,y:t.touches[0].pageY+(t.touches[1].pageY-t.touches[0].pageY)/2-this.clientRect.y};return}else t.touches.length===3&&(this.store.emitter.emit("contextmenu",{e:{x:n,y:a,clientX:t.touches[0].clientX,clientY:t.touches[0].clientY,pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},clientRect:this.clientRect}),t.preventDefault(),t.stopPropagation());this.touchStartTimer=void 0},50)});B(this,"ontouchmove",t=>{var o;if(this.store.data.locked===jt.Disable)return;t.stopPropagation(),t.preventDefault();const i=performance.now();if(i-this.touchStart<50)return;this.touchStart=i;const r=t.touches,n=r.length,a=t.touches[0].pageX-this.clientRect.x,s=t.touches[0].pageY-this.clientRect.y;if(n===1){if(this.store.options.scroll&&this.scroll&&!this.store.options.scrollButScale){let l=this.lastTouchY-t.touches[0].clientY;this.scroll.wheel(l),this.lastTouchY=t.touches[0].clientY;return}this.onMouseMove({x:a,y:s,clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:1})}else if(n===2&&((o=this.startTouches)==null?void 0:o.length)===2){if(!this.touchMoving&&!this.touchScaling){const l=this.startTouches[0].pageX-r[0].pageX,h=this.startTouches[1].pageX-r[1].pageX,c=this.startTouches[0].pageY-r[0].pageY,u=this.startTouches[1].pageY-r[1].pageY;(l>=0&&h<0||l<=0&&h>0)&&(c>=0&&u<0||c<=0&&u>0)?this.touchScaling=!0:this.touchMoving=!0}if(this.touchScaling){if(this.store.data.disableScale||this.store.options.disableScale)return;const l=Math.hypot(r[0].pageX-r[1].pageX,r[0].pageY-r[1].pageY)/this.initTouchDis;this.scale(this.initScale*l,lt(this.touchCenter))}if(this.touchMoving){if(this.store.data.locked>=jt.DisableMove&&this.store.data.locked!==jt.DisableScale||this.store.data.disableScale||this.store.options.disableScale)return;if(this.lastOffsetX){const{scale:l}=this.store.data;this.translate((a-this.lastOffsetX)/l,(s-this.lastOffsetY)/l)}this.lastOffsetX=a,this.lastOffsetY=s}}});B(this,"ontouchend",t=>{if(this.store.data.locked===jt.Disable)return;this.touchCenter=void 0,this.touchScaling=void 0,this.touchMoving=void 0,this.startTouches=void 0,this.lastOffsetX=0,this.lastOffsetY=0;const i=t.changedTouches[0].pageX-this.clientRect.x,r=t.changedTouches[0].pageY-this.clientRect.y;setTimeout(()=>{this.onMouseUp({x:i,y:r,clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:1}),this.render()},60)});B(this,"onGesturestart",t=>{t.preventDefault()});B(this,"onMouseDown",t=>{var i,r,n,a,s;if(t.buttons===2&&!this.drawingLine&&(this.mouseRight=wr.Down),this.hideInput(),this.popconfirm.hide(),this.store.data.locked===jt.Disable||t.buttons!==1&&t.buttons!==2){this.hoverType=Et.None;return}if(!this.magnifierCanvas.magnifier){if(this.calibrateMouse(t),this.mousePos.x=t.x,this.mousePos.y=t.y,this.mouseDown=t,this.lastMouseTime=performance.now(),this.canvasImage.fitFlag){this.canvasImage.currentFit||this.calcuActiveFit();return}if(this.hotkeyType===Xt.AddAnchor){this.setAnchor(this.store.pointAt);return}if(!this.store.options.autoAnchor&&!this.drawingLine&&t.shiftKey&&t.ctrlKey&&t.altKey){this.setAnchor(this.store.pointAt),this.drawingLineName=this.store.options.drawingLineName;const o=this.store.activeAnchor;if(!o)return;const l={id:Mt(),x:o.x,y:o.y};this.drawingLine=this.createDrawingLine(l);let h=ge(this.drawingLine);this.drawingLine.calculative.activeAnchor=h,Oe(this.store.hover,o,this.drawingLine,l),this.drawline();return}if(!(this.hotkeyType===Xt.Translate||this.mouseRight===wr.Down&&!this.store.options.mouseRightActive)){if(this.drawingLine){if(this.store.hoverAnchor){const l=Gt(this.drawingLine);this.store.hoverAnchor.type===Xi.Line?Ro(l,this.store.hoverAnchor,this.store):(l.x=this.store.hoverAnchor.x,l.y=this.store.hoverAnchor.y),Oe(this.store.hover,this.store.hoverAnchor,this.drawingLine,l),this.drawline(),this.finishDrawline(!0);return}if(!this.store.options.autoAnchor&&t.shiftKey&&t.altKey&&t.ctrlKey){this.setAnchor(this.store.pointAt);const l=Gt(this.drawingLine),h=this.store.activeAnchor;if(!h)return;l.x=h.x,l.y=h.y,Oe(this.store.hover,h,this.drawingLine,l),this.drawline(),this.finishDrawline(!0);return}if(t.buttons===2||this.drawingLineName==="mind"&&((i=this.drawingLine)==null?void 0:i.calculative.worldAnchors.length)>1||this.store.options.drawingLineLength&&((r=this.drawingLine)==null?void 0:r.calculative.worldAnchors.length)>this.store.options.drawingLineLength){this.finishDrawline(!0),(n=this.store.active[0])!=null&&n.anchors[0].connectTo||this.store.active.length==0?this.drawingLineName="":this.drawingLineName=this.store.options.drawingLineName;return}if(this.store.options.autoAnchor&&this.hoverType===Et.Node){const l=Gt(this.drawingLine),h=ma(this.store.hover,t);l.x=h.x,l.y=h.y,this.drawingLine.autoTo=!0,Oe(this.store.hover,h,this.drawingLine,l),this.drawline(),this.finishDrawline(!0);return}const o=Gt(this.drawingLine);o.isTemp?(this.drawingLine.calculative.activeAnchor=this.drawingLine.calculative.worldAnchors[this.drawingLine.calculative.worldAnchors.length-2],o.isTemp=void 0):(this.drawingLine.calculative.activeAnchor=o,this.drawingLine.calculative.worldAnchors.push({x:o.x,y:o.y,penId:o.penId})),this.drawingLine.calculative.drawlineH=void 0,this.drawingLineName!=="polyline"&&this.drawline()}if(this.drawingLineName){if(this.hoverType===Et.Node)if(this.store.options.autoAnchor){this.inactive(!0);const o=ma(this.store.hover,t);this.store.hoverAnchor=o;const l={id:Mt(),x:o.x,y:o.y};this.drawingLine=this.createDrawingLine(l),this.drawingLine.autoFrom=!0,Oe(this.store.hover,o,this.drawingLine,l)}else this.inactive(),this.hoverType=Et.None;else if(this.hoverType===Et.NodeAnchor){this.drawingLineName=this.store.options.drawingLineName;const o={id:Mt(),x:this.store.hoverAnchor.x,y:this.store.hoverAnchor.y};this.drawingLine=this.createDrawingLine(o),this.drawingLine.calculative.activeAnchor=o,Oe(this.store.hover,this.store.hoverAnchor,this.drawingLine,o)}else if(!this.drawingLine&&this.drawingLineName!=="curve"){this.inactive(!0);const o={id:Mt(),x:t.x,y:t.y};this.drawingLine=this.createDrawingLine(o),this.drawingLine.calculative.activeAnchor=o}}else if(this.pencil){this.inactive(!0);const o=Mt(),l={x:t.x,y:t.y,id:Mt(),penId:o};this.pencilLine=this.getInitPencilLine(l)}else{switch(this.hoverType){case Et.None:(this.store.data.rule||this.store.options.rule)&&!this.store.options.disableRuleLine&&this.addRuleLine(t),this.store.options.resizeMode&&(this.hotkeyType=Xt.None),this.inactive();break;case Et.Node:case Et.Line:if(this.store.hover){if((a=this.store.active)!=null&&a.length&&this.store.active.length===1&&this.store.hover.id===this.store.active[0].id){this.calcActiveRect();break}const o=Ge(this.store.hover,!0);let l=o||this.store.hover;o&&(o.container||(s=this.store.options.containerShapes)!=null&&s.includes(o.name))&&(l=this.store.hover),t.ctrlKey&&!t.shiftKey?(l.calculative.active?this.willInactivePen=l:this.store.active.length>0&&(l.calculative.active=!0,sa(l),this.store.active.push(l),this.store.emitter.emit("active",this.store.active)),this.patchFlags=!0):t.ctrlKey&&t.shiftKey&&this.store.hover.parentId?this.active([this.store.hover]):(!(this.activeRect&&yr({x:t.x,y:t.y},this.activeRect))||this.store.active.length==1)&&(l.calculative.active||(this.active([l]),this.store.options.resizeMode&&(this.hotkeyType=Xt.Resize))),this.calcActiveRect()}break;case Et.LineAnchor:this.store.activeAnchor=this.store.hoverAnchor,this.store.hover.calculative.activeAnchor=this.store.hoverAnchor,this.active([this.store.hover]);break;case Et.LineAnchorPrev:case Et.LineAnchorNext:this.store.activeAnchor&&(this.prevAnchor={...this.store.activeAnchor.prev},this.nextAnchor={...this.store.activeAnchor.next});break;case Et.Resize:this.activeInitPos=[],this.store.active.forEach(o=>{this.activeInitPos.push({x:(o.calculative.worldRect.x-this.activeRect.x)/this.activeRect.width,y:(o.calculative.worldRect.y-this.activeRect.y)/this.activeRect.height})});break}this.store.hover&&(this.store.hover.calculative.mouseDown=!0),this.store.emitter.emit("mousedown",{x:t.x,y:t.y,pen:this.store.hover})}this.render()}}});B(this,"onMouseMove",t=>{var r,n,a,s,o,l,h,c;if(this.store.data.locked===jt.Disable){this.hoverType=Et.None;return}if(this.mouseDown&&!this.mouseDown.restore&&t.buttons!==1&&t.buttons!==2){this.onMouseUp(t);return}if(this.lastMouseTime){if(performance.now()-this.lastMouseTime<50){this.lastMouseTime=0;return}this.lastMouseTime=0}if(this.calibrateMouse(t),this.mousePos.x=t.x,this.mousePos.y=t.y,this.magnifierCanvas.magnifier){this.render();return}if(this.canvasImage.fitFlag&&this.canvasImage.activeFit){const u=performance.now();u-this.fitTimer>100&&(this.mouseDown?this.updateFit(t):this.inFitBorder(this.mousePos),this.fitTimer=u);return}if(this.mouseDown&&!this.store.options.disableTranslate&&!this.store.data.disableTranslate){if(this.mouseRight===wr.Down&&(this.mouseRight=wr.Translate),this.store.data.locked===jt.DisableEdit||this.store.data.locked===jt.DisableScale||this.hotkeyType===Xt.Translate||this.mouseRight===wr.Translate){const{scale:u}=this.store.data;let d=(t.x-this.mouseDown.x)/u,f=(t.y-this.mouseDown.y)/u;t.shiftKey&&!t.ctrlKey&&(f=0),t.ctrlKey&&(d=0),this.translate(d,f);return}if(this.store.data.locked)return;if(!this.drawingLine&&!this.pencil){if(!this.drawingLineName&&!this.movingAnchor){if(this.hoverType===Et.NodeAnchor){if(!this.store.hoverAnchor)return;this.drawingLineName=this.store.options.drawingLineName;const u={id:Mt(),x:this.store.hoverAnchor.x,y:this.store.hoverAnchor.y};this.drawingLine=this.createDrawingLine(u),this.drawingLine.calculative.activeAnchor=u,Oe(this.store.hover,this.store.hoverAnchor,this.drawingLine,u),this.drawline();return}}else if(this.drawingLineName&&this.hoverType===Et.None){const u={id:Mt(),x:t.x,y:t.y};this.drawingLine=this.createDrawingLine(u),this.drawingLine.calculative.activeAnchor=u,this.drawline();return}if(t.buttons===1&&(t.ctrlKey||!this.hoverType&&!this.hotkeyType)&&!(t.ctrlKey&&(this.store.activeAnchor||(r=this.store.active)!=null&&r.length))){this.dragRect={x:Math.min(this.mouseDown.x,t.x),y:Math.min(this.mouseDown.y,t.y),ex:Math.max(this.mouseDown.x,t.x),ey:Math.max(this.mouseDown.y,t.y),width:Math.abs(t.x-this.mouseDown.x),height:Math.abs(t.y-this.mouseDown.y)},this.render();return}if(this.movingAnchor){const u=t.x-this.movingAnchor.x,d=t.y-this.movingAnchor.y;this.translateAnchor(u,d),this.render();return}else if(!((n=this.store.active[0])!=null&&n.locked)){const u={x:t.x,y:t.y};if(this.hoverType===Et.LineAnchor){(this.dockInAnchor(t)||((a=this.store.active[0])==null?void 0:a.lineName)==="line")&&!this.store.options.disableDock&&!this.store.options.disableLineDock&&(this.clearDock(),this.dock=nf(this.store,u,this.store.activeAnchor),(s=this.dock)!=null&&s.xDock&&(u.x+=this.dock.xDock.step),(o=this.dock)!=null&&o.yDock&&(u.y+=this.dock.yDock.step)),this.moveLineAnchor(u,t);return}if(this.hoverType===Et.LineAnchorPrev){this.moveLineAnchorPrev(t);return}if(this.hoverType===Et.LineAnchorNext){this.moveLineAnchorNext(t);return}}if(this.hoverType===Et.Rotate){this.rotatePens({x:t.x,y:t.y});return}if(this.hoverType===Et.Resize){this.resizePens(t);return}if(this.hoverType===Et.Node||this.hoverType===Et.Line){const u=t.x-this.mouseDown.x,d=t.y-this.mouseDown.y,f=20;if(t.ctrlKey&&!t.shiftKey&&(Math.abs(u)>=f||Math.abs(d)>=f)&&(this.willInactivePen=void 0),this.store.active.length===1){const m=this.store.active[0];if((m.locked===void 0||m.locked<jt.DisableMove)&&((l=m==null?void 0:m.onMouseMove)==null||l.call(m,m,this.mousePos)),m.calculative.focus)return}this.movePens(t),this.getContainerHover(t);return}}else if(this.pencil){const{x:u,y:d}=t,f={x:u,y:d};f.id=Mt(),f.penId=this.pencilLine.id,this.pencilLine.calculative.worldAnchors.push(f),this.store.path2dMap.set(this.pencilLine,St.path2dDraws[this.pencilLine.name](this.pencilLine)),this.patchFlags=!0}}if(this.drawingLine){const{x:u,y:d}=t,f={x:u,y:d};if(f.id=Mt(),f.penId=this.drawingLine.id,!this.store.options.disableDock&&!this.store.options.disableLineDock&&(this.clearDock(),this.dock=nf(this.store,f),(h=this.dock)!=null&&h.xDock&&(f.x+=this.dock.xDock.step),(c=this.dock)!=null&&c.yDock&&(f.y+=this.dock.yDock.step)),this.mouseDown&&this.drawingLineName==="curve"&&!this.drawingLine.calculative.worldAnchors[0].connectTo)this.drawline(f);else{let m;if(this.drawingLine.calculative.worldAnchors.length>1&&(m=Gt(this.drawingLine)),m?(m.prev=void 0,m.next=void 0,m.id||(m.id=Mt()),m.x=f.x,m.y=f.y,m.connectTo=void 0):(m={...f},this.drawingLine.calculative.worldAnchors.push(m)),(this.hoverType===Et.NodeAnchor||this.hoverType===Et.LineAnchor)&&(this.store.hoverAnchor.type!==Xi.Line&&(m.x=this.store.hoverAnchor.x,m.y=this.store.hoverAnchor.y),m.connectTo=this.store.hoverAnchor.penId,this.drawingLineName==="polyline"&&(m.isTemp=!1)),this.drawingLineName==="line"){if(t.ctrlKey&&!t.shiftKey)m.x=this.drawingLine.calculative.worldAnchors[this.drawingLine.calculative.worldAnchors.length-2].x;else if(t.shiftKey&&!t.ctrlKey)m.y=this.drawingLine.calculative.worldAnchors[this.drawingLine.calculative.worldAnchors.length-2].y;else if(t.shiftKey&&t.ctrlKey){let p=this.drawingLine.calculative.worldAnchors[this.drawingLine.calculative.worldAnchors.length-2];this.getSpecialAngle(m,p)}}this.drawline()}}globalThis.debug&&console.time("hover");const i=performance.now();i-this.hoverTimer>50&&(this.hoverTimer=i,this.getHover(t)),globalThis.debug&&console.timeEnd("hover"),this.hotkeyType===Xt.AddAnchor&&(this.patchFlags=!0),this.render(!1)});B(this,"onMouseUp",t=>{if(this.store.data.locked===jt.Disable){this.hoverType=Et.None;return}if(this.mouseDown){if(this.mouseRight===wr.Down&&(this.store.hover&&this.store.hover.onContextmenu?this.store.hover.onContextmenu(this.store.hover,t):this.store.emitter.emit("contextmenu",{e:t,clientRect:this.clientRect,pen:this.store.hover})),this.mouseRight=wr.None,this.calibrateMouse(t),this.mousePos.x=t.x,this.mousePos.y=t.y,this.pencil&&this.finishPencil(),this.drawingLine){if(this.store.hoverAnchor){const i=Gt(this.drawingLine);this.store.hoverAnchor.type===Xi.Line?Ro(i,this.store.hoverAnchor,this.store):(i.x=this.store.hoverAnchor.x,i.y=this.store.hoverAnchor.y),Oe(this.store.hover,this.store.hoverAnchor,this.drawingLine,i),this.drawline(),this.finishDrawline(!0);return}if(this.store.options.autoAnchor&&this.hoverType===Et.Node){const i=Gt(this.drawingLine),r=ma(this.store.hover,t);i.x=r.x,i.y=r.y,this.drawingLine.autoTo=!0,Oe(this.store.hover,r,this.drawingLine,i),this.drawline(),this.finishDrawline(!0);return}}if(this.hoverType===Et.LineAnchor&&this.store.hover&&this.store.active[0]&&this.store.active[0].name==="line"&&this.store.active[0]!==this.store.hover){const i=this.store.active[0],r=ge(i),n=Gt(i);if(this.store.hoverAnchor){const a=this.store.hover,s=ge(a)===this.store.hoverAnchor,o=Gt(a)===this.store.hoverAnchor,l=r===this.store.activeAnchor,h=n===this.store.activeAnchor;if((t.ctrlKey||t.altKey)&&a.type===$t.Line&&(s||o)&&(l||h)){const c=a.calculative.worldAnchors.map(u=>({...u,penId:i.id}));s?c.shift():o&&c.pop(),(s&&l||o&&h)&&c.reverse(),l?(i.calculative.worldAnchors[0].connectTo=void 0,i.calculative.worldAnchors.unshift(...c)):h&&(i.calculative.worldAnchors[i.calculative.worldAnchors.length-1].connectTo=void 0,i.calculative.worldAnchors.push(...c)),this.delete([a]),this.render()}else this.store.activeAnchor&&(this.store.hoverAnchor.type===Xi.Line?Ro(this.store.activeAnchor,this.store.hoverAnchor,this.store):(this.store.activeAnchor.x=this.store.hoverAnchor.x,this.store.activeAnchor.y=this.store.hoverAnchor.y),Oe(this.store.hover,this.store.hoverAnchor,i,this.store.activeAnchor));this[i.lineName]&&i.lineName!=="polyline"&&this[i.lineName](this.store,i),this.store.path2dMap.set(i,St.path2dDraws.line(i)),this.initLineRect(i)}else r===this.store.activeAnchor&&i.autoFrom?this.calcAutoAnchor(i,r,this.store.hover):n===this.store.activeAnchor&&i.autoTo&&this.calcAutoAnchor(i,n,this.store.hover)}if(this.addCaches&&this.addCaches.length){if(!this.store.data.locked){if(this.dragRect&&this.addCaches.length===1){const i=this.addCaches[0];i.width=this.dragRect.width/this.store.data.scale,i.height=this.dragRect.height/this.store.data.scale,t.x=(this.dragRect.x+this.dragRect.ex)/2,t.y=(this.dragRect.y+this.dragRect.ey)/2}this.dropPens(this.addCaches,t)}this.addCaches=void 0}if(this.hoverType===Et.Rotate&&(this.getSizeCPs(),this.store.active.forEach(i=>{i.rotate=i.calculative.rotate})),this.patchFlagsLines.forEach(i=>{i.type&&this.initLineRect(i)}),this.patchFlagsLines.clear(),this.dragRect)if(this.canvasImage.fitFlag)this.makeFit();else{const i=this.store.data.pens.filter(r=>{if(r.visible===!1||r.locked>=jt.DisableMove||r.parentId||r.isRuleLine)return!1;if(Dr(r.calculative.worldRect,this.dragRect,t.ctrlKey||this.store.options.dragAllIn))return r.type===$t.Line&&!this.store.options.dragAllIn?Wc(r,this.dragRect):!0});this.active(i)}if(t.button!==2&&(Jl(this.mouseDown,t)<2&&(this.store.hover&&this.store.hover.input&&(this.store.hover.onShowInput?this.store.hover.onShowInput(this.store.hover,t):(this.store.hover.parentId&&this.active([this.store.hover]),this.showInput(this.store.hover))),this.store.emitter.emit("click",{x:t.x,y:t.y,pen:this.store.hover})),this.store.hover&&(this.store.hover.calculative.mouseDown=!1),this.store.hover!=this.store.hoverContainer&&this.store.emitter.emit("mouseup",{x:t.x,y:t.y,pen:this.store.hover}),this.store.emitter.emit("mouseup",{x:t.x,y:t.y,pen:this.store.hoverContainer})),this.willInactivePen){this.willInactivePen.calculative.active=void 0,sa(this.willInactivePen,!1);const i=this.store.active.findIndex(r=>r===this.willInactivePen);i>=0&&this.store.active.splice(i,1),this.calcActiveRect(),this.willInactivePen=void 0,this.store.emitter.emit("inactive",[this.willInactivePen]),this.render()}this.movingPens&&(t.altKey&&!t.shiftKey?this.copyMovedPens():this.movedActivePens(t.ctrlKey&&t.shiftKey),this.getAllByPens(this.movingPens).forEach(i=>{this.store.pens[i.id]=void 0}),this.movingPens=void 0),this.store.active&&this.store.active[0]&&(this.store.active[0].calculative.h=void 0),this.mouseDown=void 0,this.lastOffsetX=0,this.lastOffsetY=0,this.clearDock(),this.dragRect=void 0,this.initActiveRect=void 0,this.render()}});B(this,"clearDock",()=>{var a,s,o,l;const t=(s=(a=this.dock)==null?void 0:a.xDock)==null?void 0:s.penId,i=(l=(o=this.dock)==null?void 0:o.yDock)==null?void 0:l.penId,r=this.store.pens[t];r&&(r.calculative.isDock=!1);const n=this.store.pens[i];n&&(n.calculative.isDock=!1),this.dock=void 0});B(this,"onResize",()=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.resize(),this.timer=void 0},100)});B(this,"onScroll",()=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.clientRect=this.canvas.getBoundingClientRect(),this.timer=void 0},100)});B(this,"calibrateMouse",t=>(t.x-=this.store.data.x,t.y-=this.store.data.y,t));B(this,"getContainerHover",t=>{var r;if(this.dragRect)return;this.store.hoverContainer=void 0;const i=this.store.data.pens.filter(n=>{var a;return n.container||((a=this.store.options.containerShapes)==null?void 0:a.includes(n.name))});if(i.length)for(let n=i.length-1;n>=0;--n){const a=i[n];if(!(a.visible==!1||a.calculative.inView==!1||a.locked===jt.Disable)){if(yr(t,a.calculative.worldRect))this.store.hoverContainer=a,(r=a==null?void 0:a.onMouseMove)==null||r.call(a,a,t),this.store.lastHoverContainer!==this.store.hoverContainer&&(this.patchFlags=!0,this.store.lastHoverContainer&&(this.store.lastHoverContainer.calculative.containerHover=!1,this.store.emitter.emit("leave",this.store.lastHoverContainer)),this.store.hoverContainer&&(this.store.hoverContainer.calculative.containerHover=!0,this.store.emitter.emit("enter",this.store.hoverContainer)),this.store.lastHoverContainer=this.store.hoverContainer);else if(a===this.store.hoverContainer&&(this.store.hoverContainer=void 0,this.store.lastHoverContainer!==this.store.hoverContainer)){this.patchFlags=!0;const s=this.store.lastHoverContainer.calculative.canvas.store.pens[this.store.lastHoverContainer.id+Qe];this.store.lastHoverContainer&&!s&&(this.store.lastHoverContainer.calculative.containerHover=!1,this.store.emitter.emit("leave",this.store.lastHoverContainer)),this.store.lastHoverContainer=this.store.hoverContainer}}}});B(this,"lastHoverType",Et.None);B(this,"getHover",t=>{var n,a;if(this.dragRect||this.canvasImage.fitFlag)return;let i=Et.None;this.store.hover=void 0,this.store.hoverAnchor=void 0,this.title.hide(),this.store.pointAt=void 0,this.store.pointAtIndex=void 0;const r=this.store.active.length===1&&this.store.active[0].type;if(!this.drawingLineName&&this.hotkeyType!==Xt.AddAnchor&&this.activeRect&&!r&&!this.store.data.locked){const s=Bc(this.store.active),o=tf(this.store.active)||this.store.options.disableRotate,l=ef(this.store.active)||this.store.options.disableSize;if(!s&&!o){const h={x:this.activeRect.center.x,y:this.activeRect.y-30};this.activeRect.rotate&&Zt(h,this.activeRect.rotate,this.activeRect.pivot||this.activeRect.center),!this.hotkeyType&&aa(t,h,this.pointSize)&&(i=Et.Rotate,this.externalElements.style.cursor=`url("${this.store.options.rotateCursor}"), auto`)}if(!s&&!l)for(let h=0;h<8;h++){const c=h<4;if((this.hotkeyType===Xt.Resize||c&&!this.hotkeyType)&&aa(t,this.sizeCPs[h],this.pointSize)){let d=c?Vd:Hd,f=0;Math.abs(this.activeRect.rotate%90-45)<25?(d=c?Hd:Vd,f=Math.round((this.activeRect.rotate-45)/90)+(c?0:1)):f=Math.round(this.activeRect.rotate/90),i=Et.Resize,this.resizeIndex=h,this.externalElements.style.cursor=d[(h+f)%4];break}}}i===Et.None&&(i=this.inPens(t,this.store.data.pens)),!i&&!r&&yr(t,this.activeRect)&&(i=Et.Node,this.externalElements.style.cursor="move"),this.hoverType=i,i===Et.None&&(this.drawingLineName||this.pencil?this.externalElements.style.cursor="crosshair":this.mouseDown||(this.externalElements.style.cursor="default"),this.store.hover=void 0),this.store.lastHover!==this.store.hover&&(this.patchFlags=!0,this.store.lastHover&&(this.store.lastHover.calculative.hover=!1,fs(Ge(this.store.lastHover,!0)||this.store.lastHover,!1),this.store.pens[this.store.lastHover.id]&&this.store.emitter.emit("leave",this.store.lastHover),this.tooltip.hide()),this.store.hover&&(this.store.hover.calculative.hover=!0,fs(Ge(this.store.hover,!0)||this.store.hover),this.store.emitter.emit("enter",this.store.hover),this.tooltip.show(this.store.hover,t)),this.store.lastHover=this.store.hover),[Et.LineAnchor,Et.NodeAnchor].includes(i)&&![Et.LineAnchor,Et.NodeAnchor].includes(this.lastHoverType)&&this.store.emitter.emit("enterAnchor",{pen:this.store.hover,anchor:this.store.hoverAnchor}),this.lastHoverType=i,(a=(n=this.store.hover)==null?void 0:n.onMouseMove)==null||a.call(n,this.store.hover,this.mousePos)});B(this,"inPens",(t,i)=>{var n;let r=Et.None;t:for(let a=i.length-1;a>=0;--a){const s=i[a];if(s.visible==!1||s.calculative.inView==!1||s.locked===jt.Disable)continue;const o=yl(s);if(!(!s.calculative.active&&!Vn(t,s.calculative.worldRect,o)&&!yr(t,s.calculative.worldRect))){if(!this.store.data.locked&&this.hotkeyType!==Xt.Resize&&s.calculative.worldAnchors){for(const l of s.calculative.worldAnchors)if(r=this.inAnchor(t,s,l),r){let h=lt(l);Object.assign(h,t),this.title.show(h,s);break t}}if(s.type){if(s.isRuleLine){let h=((n=this.store.options.ruleOptions)==null?void 0:n.height)||20;if(t.x+this.store.data.x>h&&t.y+this.store.data.y>h)break}const l=RT(t,s);if(l){!this.store.data.locked&&!s.locked?this.hotkeyType===Xt.AddAnchor?this.externalElements.style.cursor="pointer":this.externalElements.style.cursor="move":this.externalElements.style.cursor=s.hoverCursor||this.store.options.hoverCursor,s.calculative.disabled&&(this.externalElements.style.cursor="not-allowed"),this.store.hover=s,this.store.pointAt=l.point,this.store.pointAtIndex=l.i,this.initTemplateCanvas([this.store.hover]),r=Et.Line;break}}else{if(s.children){const h=[];if(s.children.forEach(c=>{this.store.pens[c]&&h.push(this.store.pens[c])}),r=this.inPens(t,h),r)break}let l=!1;if(s.name==="line"?l=Vn(t,s.calculative.worldRect,s.lineWidth):l=yr(t,s.calculative.worldRect),l){if(s.type===$t.Node&&s.name==="line"&&!Gw(t,s.calculative.worldAnchors))continue;if(!this.store.data.locked&&!s.locked?this.hotkeyType===Xt.AddAnchor?this.externalElements.style.cursor="pointer":this.externalElements.style.cursor="move":this.externalElements.style.cursor=s.hoverCursor||this.store.options.hoverCursor,s.calculative.disabled&&(this.externalElements.style.cursor="not-allowed"),this.store.hover=s,this.initTemplateCanvas([this.store.hover]),r=Et.Node,this.store.pointAt=t,!t.ctrlKey){let{x:h,y:c,ex:u,ey:d,rotate:f,center:m}=this.store.hover.calculative.worldRect;if(f){const p=[{x:h,y:c},{x:u,y:c},{x:u,y:d},{x:h,y:d}];p.forEach(y=>{Zt(y,f,m)});let g=p[p.length-1];for(const y of p){if(g.y>t.y!=y.y>t.y){const T=y.x+(t.y-y.y)*(g.x-y.x)/(g.y-y.y);Math.abs(T-this.store.pointAt.x)<10&&(this.store.pointAt.x=T)}g=y}}else this.store.pointAt.x-10<h?this.store.pointAt.x=h:this.store.pointAt.x+10>u&&(this.store.pointAt.x=u),this.store.pointAt.y-10<c?this.store.pointAt.y=c:this.store.pointAt.y+10>d&&(this.store.pointAt.y=d)}break}}}}return r});B(this,"dockInAnchor",t=>{var i,r;this.store.hover=void 0;for(let n=this.store.data.pens.length-1;n>=0;--n){const a=this.store.data.pens[n];if(a.visible==!1||a.locked===jt.Disable||a===this.store.active[0])continue;let s=yl(a);if(s+=2*this.store.options.anchorRadius,!!Vn(t,a.calculative.worldRect,s)&&(this.store.hover=a,this.hotkeyType!==Xt.Resize&&a.calculative.worldAnchors))for(const o of a.calculative.worldAnchors){if(o.twoWay===je.In){const l=Gt(this.store.active[0]);if(this.store.activeAnchor.id!==l.id)continue}if(o.twoWay===je.Out){const l=ge(this.store.active[0]);if(this.store.activeAnchor.id!==l.id)continue}if(!(o.twoWay===je.DisableConnected||o.twoWay===je.Disable||((i=this.store.activeAnchor)==null?void 0:i.twoWay)===je.DisableConnectTo||((r=this.store.activeAnchor)==null?void 0:r.twoWay)===je.Disable)&&(this.title.hide(),this.inAnchor(t,a,o))){let l=lt(o);return Object.assign(l,t),this.title.show(l,a),!0}}}});B(this,"__loadMap",new Map);B(this,"imageTimer");B(this,"templateImageTimer");B(this,"render",t=>{if(t&&(this.opening=!1),this.opening)return;let i;if(t==null||t===!0||t===1/0?(i=performance.now(),this.patchFlags=!0):t>1?i=t:i=performance.now(),!this.patchFlags)return;if(i-this.lastRender<this.store.options.interval){this.renderTimer&&cancelAnimationFrame(this.renderTimer),this.renderTimer=requestAnimationFrame(this.render);return}this.renderTimer=void 0,this.lastRender=i;const r=this.offscreen.getContext("2d");r.clearRect(0,0,this.offscreen.width,this.offscreen.height),r.save(),r.translate(this.store.data.x,this.store.data.y),globalThis.debugRender&&console.time("renderPens"),this.renderPens(),globalThis.debugRender&&console.timeEnd("renderPens"),this.renderBorder(),this.renderHoverPoint(),this.renderPensAnchors(),r.restore(),this.magnifierCanvas.magnifier&&this.magnifierCanvas.render();const n=this.canvas.getContext("2d");n.clearRect(0,0,this.canvas.width,this.canvas.height),n.drawImage(this.offscreen,0,0,this.width,this.height),this.canvasTemplate.render(),this.canvasImageBottom.render(),this.canvasImage.render(),this.patchFlags=!1});B(this,"renderPens",()=>{const t=this.offscreen.getContext("2d");t.strokeStyle=this.store.styles.color;for(const i of this.store.data.pens)isFinite(i.x)&&i.canvasLayer!==Ht.CanvasTemplate&&i.calculative.inView&&(i.canvasLayer===Ht.CanvasMain&&i.name!=="gif"&&i.image&&i.calculative.img&&(t.save(),Wn(t,i),(i.rotateByRoot||i.calculative.rotate)&&Mr(t,i),zn(t,i),ka(t,i),t.restore()),_n(t,i));this.drawingLine&&_n(t,this.drawingLine),this.pencilLine&&_n(t,this.pencilLine),this.movingPens&&this.movingPens.forEach(i=>{this.renderPenContainChild(t,i)})});B(this,"renderPenContainChild",(t,i)=>{var r;i.calculative.inView&&_n(t,i),(r=i.children)==null||r.forEach(n=>{const a=this.store.pens[n];a&&this.renderPenContainChild(t,a)})});B(this,"renderBorder",()=>{if(!this.store.data.locked&&this.activeRect&&!(this.store.active.length===1&&this.store.active[0].type)&&!this.movingPens){const t=this.offscreen.getContext("2d");t.save(),t.translate(.5,.5);const i=this.activeRect.pivot||this.activeRect.center;if(this.activeRect.rotate&&(t.translate(i.x,i.y),t.rotate(this.activeRect.rotate*Math.PI/180),t.translate(-i.x,-i.y)),t.strokeStyle=this.store.styles.activeColor,t.globalAlpha=this.store.options.activeGlobalAlpha===void 0?.3:this.store.options.activeGlobalAlpha,t.beginPath(),t.lineWidth=this.store.options.activeLineWidth||1,t.setLineDash(this.store.options.activeLineDash||[]),t.strokeRect(this.activeRect.x,this.activeRect.y,this.activeRect.width,this.activeRect.height),t.setLineDash([]),t.lineWidth=1,t.globalAlpha=1,Bc(this.store.active)||tf(this.store.active)||this.store.options.disableRotate){t.restore();return}t.beginPath(),t.moveTo(this.activeRect.center.x,this.activeRect.y),t.lineTo(this.activeRect.center.x,this.activeRect.y-30),t.stroke(),t.beginPath(),t.strokeStyle=this.store.styles.activeColor,t.fillStyle="#ffffff",t.arc(this.activeRect.center.x,this.activeRect.y-30,5,0,Math.PI*2),t.fill(),t.stroke(),t.restore()}});B(this,"renderHoverPoint",()=>{if(this.store.data.locked)return;const t=this.offscreen.getContext("2d");if(t.save(),t.translate(.5,.5),!this.store.options.disableAnchor&&this.store.hover&&!this.store.hover.disableAnchor&&(this.hotkeyType!==Xt.Resize||this.store.active.length!==1||this.store.active[0]!==this.store.hover)){const i=[...this.store.hover.calculative.worldAnchors];this.store.pointAt&&this.hotkeyType===Xt.AddAnchor&&i.push(this.store.pointAt),i&&(t.strokeStyle=this.store.hover.anchorColor||this.store.styles.anchorColor,t.fillStyle=this.store.hover.anchorBackground||this.store.options.anchorBackground,i.forEach(r=>{if(r.hidden&&r.locked>jt.DisableEdit)return;if(r===this.store.hoverAnchor){t.save();const a=this.store.hover.hoverAnchorColor||this.store.options.hoverAnchorColor;t.strokeStyle=a,t.fillStyle=a}t.beginPath();let n=r.radius||this.store.hover.anchorRadius||this.store.options.anchorRadius;if(this.store.hover.type&&!r.radius&&!this.store.hover.anchorRadius&&(n=3,this.store.hover.calculative.lineWidth>3&&(n=this.store.hover.calculative.lineWidth)),r.type===Xi.Line){let a=this.store.pens[r.penId].rotate||0;this.store.pens[r.penId].calculative.flipX&&(a*=-1),this.store.pens[r.penId].calculative.flipY&&(a*=-1);let s=r.rotate+a;this.store.pens[r.penId].calculative.flipX&&(s*=-1),this.store.pens[r.penId].calculative.flipY&&(s*=-1),t.save(),t.translate(r.x,r.y),t.rotate(s*Math.PI/180),t.translate(-r.x,-r.y),t.rect(r.x-r.length*this.store.data.scale/2,r.y-n,r.length*this.store.data.scale,n*2),t.restore()}else t.arc(r.x,r.y,n,0,Math.PI*2);if(this.store.hover.type&&this.store.hoverAnchor===r?(t.save(),t.strokeStyle=this.store.hover.activeColor||this.store.styles.activeColor,t.fillStyle=t.strokeStyle):(r.color||r.background)&&(t.save(),t.strokeStyle=r.color,t.fillStyle=r.background),t.fill(),t.stroke(),r===this.store.hoverAnchor&&t.restore(),(this.store.hover.type&&this.store.hoverAnchor===r||r.color||r.background)&&t.restore(),!this.store.hover.parentId&&this.store.hover.children&&this.store.hover.children.length>0&&r===this.store.hoverAnchor){t.save(),t.beginPath(),t.lineWidth=3;const a=this.store.hover.hoverAnchorColor||this.store.options.hoverAnchorColor;globalThis.pSBC&&(t.strokeStyle=globalThis.pSBC(.5,a)),t.arc(r.x,r.y,n+1.5,0,Math.PI*2),t.stroke(),t.restore()}}))}this.hotkeyType!==Xt.AddAnchor&&!this.movingPens&&this.activeRect&&!(this.store.active.length===1&&this.store.active[0].type)&&!Bc(this.store.active)&&!ef(this.store.active)&&!this.store.options.disableSize&&(t.strokeStyle=this.store.styles.activeColor,t.fillStyle="#ffffff",this.sizeCPs.forEach((i,r)=>{this.activeRect.rotate&&(t.save(),t.translate(i.x,i.y),t.rotate(this.activeRect.rotate*Math.PI/180),t.translate(-i.x,-i.y)),(r<4||this.hotkeyType===Xt.Resize)&&(t.beginPath(),t.fillRect(i.x-4.5,i.y-4.5,8,8),t.strokeRect(i.x-5.5,i.y-5.5,10,10)),this.activeRect.rotate&&t.restore()})),!this.store.data.locked&&this.dragRect&&(t.save(),t.fillStyle=ul(this.store.options.dragColor,.2),t.strokeStyle=this.store.options.dragColor,t.beginPath(),t.strokeRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height),t.fillRect(this.dragRect.x,this.dragRect.y,this.dragRect.width,this.dragRect.height),t.restore()),this.dock&&(t.strokeStyle=this.store.options.dockColor,this.dock.xDock&&(t.beginPath(),t.moveTo(this.dock.xDock.x,this.dock.xDock.y),t.lineTo(this.dock.xDock.x,this.dock.xDock.prev.y),t.stroke()),this.dock.yDock&&(t.beginPath(),t.moveTo(this.dock.yDock.x,this.dock.yDock.y),t.lineTo(this.dock.yDock.prev.x,this.dock.yDock.y),t.stroke())),t.restore()});B(this,"renderPensAnchors",()=>{for(const t of this.store.data.pens)isFinite(t.x)&&t.anchorVisible===!0&&this.renderAnchors(t)});B(this,"renderAnchors",t=>{const i=this.offscreen.getContext("2d");i.save(),i.translate(.5,.5),i.strokeStyle=t.anchorColor||this.store.styles.anchorColor,i.fillStyle=t.anchorBackground||this.store.options.anchorBackground,t.calculative.worldAnchors.forEach(r=>{if(r.hidden||r.locked>jt.DisableEdit)return;if(r===this.store.hoverAnchor){i.save();const a=t.hoverAnchorColor||this.store.options.hoverAnchorColor;i.strokeStyle=a,i.fillStyle=a}i.beginPath();let n=r.radius||t.anchorRadius||this.store.options.anchorRadius;if(t.type&&!r.radius&&!t.anchorRadius&&(n=3,t.calculative.lineWidth>3&&(n=t.calculative.lineWidth)),r.type===Xi.Line){let a=this.store.pens[r.penId].rotate||0;this.store.pens[r.penId].calculative.flipX&&(a*=-1),this.store.pens[r.penId].calculative.flipY&&(a*=-1);let s=r.rotate+a;this.store.pens[r.penId].calculative.flipX&&(s*=-1),this.store.pens[r.penId].calculative.flipY&&(s*=-1),i.save(),i.translate(r.x,r.y),i.rotate(s*Math.PI/180),i.translate(-r.x,-r.y),i.rect(r.x-r.length*this.store.data.scale/2,r.y-n,r.length*this.store.data.scale,n*2),i.restore()}else i.arc(r.x,r.y,n,0,Math.PI*2);if(t.type&&this.store.hoverAnchor===r?(i.save(),i.strokeStyle=t.activeColor||this.store.styles.activeColor,i.fillStyle=i.strokeStyle):(r.color||r.background)&&(i.save(),i.strokeStyle=r.color,i.fillStyle=r.background),i.fill(),i.stroke(),r===this.store.hoverAnchor&&i.restore(),(t.type&&this.store.hoverAnchor===r||r.color||r.background)&&i.restore(),!t.parentId&&t.children&&t.children.length>0&&r===this.store.hoverAnchor){i.save(),i.beginPath(),i.lineWidth=3;const a=t.hoverAnchorColor||this.store.options.hoverAnchorColor;globalThis.pSBC&&(i.strokeStyle=globalThis.pSBC(.5,a)),i.arc(r.x,r.y,n+1.5,0,Math.PI*2),i.stroke(),i.restore()}}),i.restore()});B(this,"transTimeout");B(this,"pastePen",(t,i)=>{const r=t.id;if(af(t),t.parentId=i,t.type===$t.Line?this.changeNodeConnectedLine(r,t,this.store.clipboard.pens):this.changeLineAnchors(r,t,this.store.clipboard.pens),!t.parentId){const a=this.getPenRect(t,this.store.clipboard.origin,this.store.clipboard.scale),s=this.getPenRect(this.store.clipboard.initRect,this.store.clipboard.origin,this.store.clipboard.scale),{origin:o,scale:l}=this.store.data;t.x=o.x+a.x*l,t.y=o.y+a.y*l,t.width=a.width*l,t.height=a.height*l,s.x=o.x+s.x*l,s.y=o.y+s.y*l,ne(s),this.store.clipboard.pos&&(t.x-=s.center.x-this.store.clipboard.pos.x,t.y-=s.center.y-this.store.clipboard.pos.y),this.keyOptions&&this.keyOptions.altKey&&(this.keyOptions.ctrlKey||this.keyOptions.metaKey)?(t.x=-this.store.data.x+this.width/2-t.width/2,t.y=-this.store.data.y+this.height/2-t.height/2):this.keyOptions&&this.keyOptions.shiftKey&&(this.keyOptions.ctrlKey||this.keyOptions.metaKey||this.keyOptions.F)||(t.x+=this.store.clipboard.offset*this.store.data.scale,t.y+=this.store.clipboard.offset*this.store.data.scale)}this.makePen(t);const n=[];if(Array.isArray(t.children))for(const a of t.children){const s=this.store.clipboard.pens.find(o=>o.id===a);s&&n.push(this.pastePen(s,t.id).id)}return t.children=n,kr(t,!0),t});B(this,"ondblclick",t=>{var i,r,n;if(this.store.hover&&(!this.store.data.locked||this.store.hover.dbInput)&&!this.store.options.disableInput)if(this.store.hover.onShowInput)this.store.hover.onShowInput(this.store.hover,t);else if(this.store.hover&&this.store.hover.parentId)if(((i=this.store.active)==null?void 0:i.length)===1&&this.store.active[0].id===this.store.hover.id)this.showInput(this.store.hover);else{if(this.store.pens[this.store.hover.parentId].children.forEach(a=>{this.store.pens[a].calculative.active=!1,this.store.pens[a].calculative.hover=!1}),this.store.hover.parentId){let a=this.store.hover.id;const s=this.calibrateMouse({x:t.offsetX,y:t.offsetY});let o=1/0;(n=(r=this.store.pens[this.store.hover.parentId])==null?void 0:r.children)==null||n.forEach(l=>{const h=this.store.pens[l];if(yr(s,h.calculative.worldRect)){const c=Math.sqrt((s.x-h.calculative.worldRect.center.x)**2+(s.y-h.calculative.worldRect.center.y)**2);c<o&&(o=c,a=l)}}),this.store.hover=this.store.pens[a],this.store.pens[a].calculative.hover=!0}this.active([this.store.hover])}else this.showInput(this.store.hover);this.store.emitter.emit("dblclick",{x:t.x,y:t.y,pen:this.store.hover})});B(this,"showInput",(t,i,r="transparent")=>{if(!window||!this.store.hover||this.store.hover.locked||this.store.hover.externElement||this.store.hover.disableInput||this.store.hover.disabled)return;if(this.inputDiv.dataset.penId===t.id){this.inputDiv.dataset.isInput="true",this.inputDiv.contentEditable="true",this.inputDiv.focus();const c=window.getSelection();c.selectAllChildren(this.inputDiv),c.collapseToEnd(),this.inputDiv.scrollTop=this.inputDiv.scrollHeight,this.inputDiv.scrollLeft=this.inputDiv.scrollWidth;return}!i&&!t.dbInput?this.setInputStyle(t):(this.inputDiv.style.width="100%",this.inputDiv.style.height="100%");const n=i||t.calculative.worldTextRect,o=`${(t.calculative.tempText===void 0?t.text+""||"":t.calculative.tempText).replace(/\x20/g,"&nbsp;").split(/[\s\n]/).join("</div><div>")}</div>`.replace("</div>","").replace(/\<div\>\<\/div\>/g,"<div><br></div>");this.inputDiv.innerHTML=o,this.inputParent.style.left=n.x+this.store.data.x-(t.calculative.textLeft||0)+"px",this.inputParent.style.top=n.y+this.store.data.y-(t.calculative.textTop||0)+"px";let l=n.width;if(this.inputParent.style.width=(l<0?12:l)+"px",this.inputParent.style.height=n.height+(t.textTop||0)+"px",this.inputParent.style.zIndex="9999",this.inputParent.style.background=r,t.rotate%360?this.inputParent.style.transform=`rotate(${t.rotate}deg)`:this.inputParent.style.transform=null,this.inputParent.style.display="flex",this.inputDiv.dataset.penId=t.id,this.inputDiv.contentEditable=t.disableInput==null?"true":t.disableInput.toString(),t.dropdownList&&this.dropdown.style.display!=="block"){this.dropdown.style.background=t.dropdownBackground||this.store.styles.popContentBg||"#fff",this.dropdown.style.color=t.dropdownColor||"#bdc7db",this.dropdown.style.width=this.inputParent.style.width,this.dropdown.style.fontSize=(t.fontSize||12)+"px";const c=this.inputDiv.getBoundingClientRect();let u=window.innerHeight-c.top-c.height;u=u>200?200:u,this.dropdown.style.maxHeight=u+"px",this.setDropdownList(),this.externalElements.style.zIndex="9999"}this.inputDiv.contentEditable=t.readonly?"false":"true",this.inputDiv.focus();const h=window.getSelection();h.selectAllChildren(this.inputDiv),h.collapseToEnd(),this.inputDiv.scrollTop=this.inputDiv.scrollHeight,this.inputDiv.scrollLeft=this.inputDiv.scrollWidth,t.calculative.text=void 0,this.initTemplateCanvas([t]),this.render()});B(this,"setInputStyle",t=>{t.text||(t.text="");let i;for(let l=0;l<document.styleSheets.length;l++)document.styleSheets[l].title==="le5le.com"&&(i=document.styleSheets[l]);let r="overflow: scroll;",n="",a=1;const{scale:s}=this.store.data;if(t.fontSize<12&&(a=12/t.fontSize),t.textAlign?r+=`text-align: ${t.textAlign};`:r+="text-align: center;",t.textAlign&&t.whiteSpace==="pre-line"&&(r+=`align-items: ${{left:"start",center:"center",right:"end"}[t.textAlign]};`),t.textBaseline?r+=`justify-content: ${{top:"start",middle:"center",bottom:"end"}[t.textBaseline]};`:r+="justify-content: center;",t.fontFamily&&(r+=`font-family: ${t.fontFamily};`),t.fontSize&&(t.fontSize*s<12?r+=`font-size:${t.calculative.fontSize}px;`:r+=`font-size:${t.fontSize*s}px;`),r+=`color:${Ur(t,this.store)};`,t.fontStyle&&(r+=`font-style: ${t.fontStyle};`),t.fontWeight&&(r+=`font-weight: ${t.fontWeight};`),t.textLeft&&(r+=`margin-left:${s>1,t.textLeft*s}px;`),t.textTop&&(r+=`margin-top:${s>1,t.textTop*a}px;`),t.lineHeight&&(r+=`line-height:${s>1?t.fontSize*t.lineHeight*s:t.calculative.fontSize*t.lineHeight}px;`),t.textHeight)r+=`height:${s>1?t.textHeight*a*s:t.textHeight*a}px;`;else{let l=t.calculative.worldRect.height/s;l<0&&(l=0);let h=(t.fontSize*s<12,l*s*a);h<t.fontSize*t.lineHeight*s&&(h=t.fontSize*t.lineHeight*s,r+=`top:-${h/2}px;`),r+=`height:${h}px;`}t.letterSpacing&&(r+=`letter-spacing:${t.calculative.letterSpacing}px;`);let o=null;if(t.textWidth)o=t.calculative.textWidth,t.whiteSpace!=="pre-line"&&(o<t.fontSize?r+=`width:${t.fontSize*1.2*a}px;`:r+=`width:${s>1,o*a}px;`);else if(t.whiteSpace===void 0||t.whiteSpace==="break-all"){let l=(t.calculative.worldTextRect.width||12)/s;l<0&&(l=0),r+=`width:${t.fontSize*s<12,l*s}px;`}if(t.whiteSpace&&(t.whiteSpace==="pre-line"?r+="white-space:pre;":(r+=`white-space:${t.whiteSpace};`,t.whiteSpace==="nowrap"&&(n+="display:contents;"))),t.whiteSpace!=="nowrap"){let l=t.fontSize*1.2*t.text.length,h=(o||t.calculative.worldRect.width/s)*Math.floor(t.calculative.worldRect.height/s/(t.lineHeight*t.fontSize));l>h&&(r+="justify-content: start;")}i.deleteRule(0),i.deleteRule(0),i.insertRule(`.meta2d-input
      .input-div{
        resize:none;border:none;outline:none;background:transparent;position:absolute;flex-grow:1;height:100%;width: 100%;position:absolute;left:0;top:0;display:flex;flex-direction: column;cursor: text;${r}}`),i.insertRule(`.input-div div{${n}}`)});B(this,"hideInput",()=>{if(this.externalElements.style.zIndex="5",this.inputParent.style.display==="flex"){this.inputParent.style.display="none";const t=this.store.pens[this.inputDiv.dataset.penId];if(!t)return;if(t.calculative.text=t.text,this.inputDiv.dataset.value=this.inputDiv.innerHTML.replace(/\<div\>/g,`
`).replace(/\<\/div\>/g,"").replace(/\<br\>/g,"").replace(/&nbsp;/g," ").replace(/(<([^>]+)>)/gi,""),this.inputDiv.dataset.value=this.convertSpecialCharacter(this.inputDiv.dataset.value),t.onInput)t.onInput(t,this.inputDiv.dataset.value);else if(t.text!==this.inputDiv.dataset.value){const i=[lt(t,!0)];t.text=this.inputDiv.dataset.value,t.calculative.text=t.text,this.inputDiv.dataset.penId=void 0,t.text&&t.textAutoAdjust&&!t.parentId&&Yb(t),Ji(t),this.patchFlags=!0,this.pushHistory({type:_t.Update,pens:[lt(t,!0)],initPens:i}),this.store.emitter.emit("change",t),this.store.emitter.emit("valueUpdate",t)}else t.text===this.inputDiv.dataset.value&&t.calculative.textLines&&t.calculative.textLines.length==0&&Ji(t);this.initTemplateCanvas([t])}this.inputDiv.dataset.penId=void 0,this.dropdown.style.display="none",this.inputDiv.dataset.isInput="false",this.inputDiv.contentEditable="false",this.render()});B(this,"setDropdownList",t=>{this.clearDropdownList();const i=this.store.pens[this.inputDiv.dataset.penId];if(!this.store.data.locked&&!["tablePlus"].includes(i.name))return;if(this.dropdown.style.display="block",!i||!i.dropdownList){this.dropdown.style.display="none";return}if(!i.dropdownList.length){const a=document.createElement("div");a.innerText="None",a.style.padding="5px 12px",a.style.color="#ddd",this.dropdown.appendChild(a);return}const r=this.inputDiv.innerHTML.replace(/\<div\>/g,`
`).replace(/\<\/div\>/g,"").replace(/\<br\>/g,"");let n=0;for(const a of i.dropdownList){const s=typeof a=="string"?a:a.text;t&&r?s.includes(r)&&this.dropdownAppendOption(s,n):this.dropdownAppendOption(s,n),++n}if(!this.dropdown.hasChildNodes()){const a=document.createElement("div");a.innerText="None",a.style.padding="5px 12px",a.style.color="#ddd",this.dropdown.appendChild(a)}});B(this,"selectDropdown",t=>{const i=t.target,r=this.store.pens[this.inputDiv.dataset.penId];if(!i||!r||!r.dropdownList)return;const n=+i.dataset.i,a=r.dropdownList[n];if(!a)return;const s=[lt(r,!0)];typeof a=="object"?(this.updateValue(r,{...a}),r.calculative.text=void 0,this.calcActiveRect()):r.text=a+"",this.inputDiv.innerText=r.text,this.hideInput(),this.pushHistory({type:_t.Update,pens:[lt(r,!0)],initPens:s}),this.render(),this.store.emitter.emit("change",r),this.store.emitter.emit("valueUpdate",r)});B(this,"inFitBorder",t=>{let i;const r=this.store.data.width||this.store.options.width,n=this.store.data.height||this.store.options.height;let a={x:(t.x-this.store.data.origin.x)/this.store.data.scale,y:(t.y-this.store.data.origin.y)/this.store.data.scale};const s=this.canvasImage.activeFit;this.externalElements.style.cursor="default",a.y>n*s.y-10&&a.y<n*s.y+10&&(i="top",this.externalElements.style.cursor="row-resize"),a.y>n*(s.y+s.height)-10&&a.y<n*(s.y+s.height)+10&&(i="bottom",this.externalElements.style.cursor="row-resize"),a.x>r*s.x-10&&a.x<r*s.x&&(i="left",this.externalElements.style.cursor="col-resize"),a.x>r*(s.x+s.width)-10&&a.x<r*(s.x+s.width)+10&&(i="right",this.externalElements.style.cursor="col-resize"),this.canvasImage.currentFit=i});this.parent=t,this.parentElement=i,this.store=r,this.canvasTemplate=new rE(i,r),this.canvasTemplate.canvas.style.zIndex="1",this.canvasImageBottom=new vf(i,r,!0),this.canvasImageBottom.canvas.style.zIndex="2",i.appendChild(this.canvas),this.canvas.style.position="absolute",this.canvas.style.backgroundRepeat="no-repeat",this.canvas.style.backgroundSize="100% 100%",this.canvas.style.zIndex="3",this.canvasImage=new vf(i,r),this.canvasImage.canvas.style.zIndex="4",this.magnifierCanvas=new eE(this,i,r),this.magnifierCanvas.canvas.style.zIndex="5",this.externalElements.style.position="absolute",this.externalElements.style.left="0",this.externalElements.style.top="0",this.externalElements.style.outline="none",this.externalElements.style.background="transparent",this.externalElements.style.zIndex="5",i.style.position="relative",i.style["-webkit-tap-highlight-color"]="transparent",i.appendChild(this.externalElements),this.createInput(),this.tooltip=new Ts(i,r),this.tooltip.box.onmouseleave=n=>{this.patchFlags=!0,this.store.lastHover&&(this.store.lastHover.calculative.hover=!1);let a=this.store.data.pens.find(s=>s.calculative.hover===!0);fs(a,!1)},this.popconfirm=new aE(i,r),this.dialog=new iE(i,r),this.title=new wl(i),this.store.options.scroll&&(this.scroll=new av(this)),this.store.dpiRatio=globalThis.devicePixelRatio||1,this.store.dpiRatio<1?this.store.dpiRatio=1:this.store.dpiRatio>1&&this.store.dpiRatio<1.5&&(this.store.dpiRatio=1.5),this.clientRect=this.externalElements.getBoundingClientRect(),this.listen(),window==null||window.addEventListener("resize",this.onResize),window==null||window.addEventListener("scroll",this.onScroll),window==null||window.addEventListener("message",this.onMessage)}listen(){switch(this.externalElements.addEventListener("gesturestart",this.onGesturestart),this.externalElements.ondragover=t=>t.preventDefault(),this.externalElements.ondrop=this.ondrop,this.externalElements.oncontextmenu=t=>t.preventDefault(),this.store.options.interval=50,this.externalElements.ontouchstart=this.ontouchstart,this.externalElements.ontouchmove=this.ontouchmove,this.externalElements.ontouchend=this.ontouchend,this.externalElements.onmousedown=t=>{this.isMobile||this.onMouseDown({x:t.offsetX,y:t.offsetY,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:t.buttons})},this.externalElements.onmousemove=t=>{this.isMobile||t.target===this.externalElements&&this.onMouseMove({x:t.offsetX,y:t.offsetY,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:t.buttons})},this.externalElements.onmouseup=t=>{this.isMobile||this.onMouseUp({x:t.offsetX,y:t.offsetY,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,ctrlKey:t.ctrlKey||t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,buttons:t.buttons,button:t.button})},this.externalElements.onmouseleave=t=>{this.store.data.pens.forEach(i=>{i.calculative.hover&&(i.calculative.hover=!1)}),this.store.hover&&(this.store.hover.calculative.hover=!1,this.store.hover=void 0),this.render(),t.toElement!==this.tooltip.box&&t.toElement!==this.tooltip.arrowUp&&t.toElement!==this.tooltip.arrowDown&&(this.tooltip.hide(),this.store.lastHover=void 0)},this.externalElements.ondblclick=t=>{this.isMobile||this.ondblclick(t)},this.externalElements.tabIndex=0,this.externalElements.onblur=()=>{this.mouseDown=void 0},this.externalElements.onwheel=this.onwheel,document.addEventListener("copy",this.onCopy),document.addEventListener("cut",this.onCut),document.addEventListener("paste",this.onPaste),this.store.options.keydown){case Mn.Document:document.addEventListener("keydown",this.onkeydown),document.addEventListener("keyup",this.onkeyup);break;case Mn.Canvas:this.externalElements.addEventListener("keydown",this.onkeydown),this.externalElements.addEventListener("keyup",this.onkeyup);break}}splitLine(t,i){const r=t.calculative.worldAnchors,n=r.findIndex(c=>c===i);if([-1,0,r.length-1].includes(n))return;const a=lt(t,!0),s=lt(t,!0),o=Mt();s.id=o,s.calculative.canvas=this,s.calculative.active=!1,s.calculative.hover=!1;const l=lt(r.slice(0,n+1)),h=lt(r.slice(n)).map(c=>(c.penId=o,c));t.calculative.worldAnchors=l,s.calculative.worldAnchors=h,this.initLineRect(t),this.initLineRect(s),this.store.data.pens.push(s),this.store.pens[o]=s,this.pushHistory({type:_t.Add,pens:[lt(s,!0)],step:2}),this.pushHistory({type:_t.Update,initPens:[a],pens:[lt(t,!0)],step:2})}translateAnchor(t,i){this.movingAnchor.x+=t,this.movingAnchor.y+=i;const r=this.movingAnchor.penId;if(r){const n=this.store.pens[r],a=n.calculative.worldRect;this.movingAnchor.x<a.x?this.movingAnchor.x=a.x:this.movingAnchor.x>a.ex&&(this.movingAnchor.x=a.ex),this.movingAnchor.y<a.y?this.movingAnchor.y=a.y:this.movingAnchor.y>a.ey&&(this.movingAnchor.y=a.ey);const s=ws(this.movingAnchor,a),o=n.anchors.findIndex(l=>l.id===this.movingAnchor.id);n.anchors[o]=s,this.patchFlags=!0}}async fileToPen(t,i){let r="";return this.store.options.uploadFn?r=await this.store.options.uploadFn(t):this.store.options.uploadUrl?r=await Gb(t,this.store.options.uploadUrl,this.store.options.uploadParams,this.store.options.uploadHeaders):r=await Kb(t),new Promise((n,a)=>{const s=new Image;s.onload=()=>{St.htmlElements[r]=s,n({width:s.width,height:s.height,name:i?"gif":"image",image:r})},s.onerror=o=>{a(o)},s.crossOrigin="anonymous",s.src=r})}async dropPens(t,i){var l,h,c,u;this.randomIdObj={};for(const d of t)!d.parentId&&this.randomCombineId(d,t);if(Object.keys(this.randomIdObj).length!==0){const d=Object.keys(this.randomIdObj).join("|"),f=new RegExp(`(${d})`,"g");for(const m of t){if(m.type?(m.anchors[0].connectTo=this.randomIdObj[m.anchors[0].connectTo],m.anchors[m.anchors.length-1].connectTo=this.randomIdObj[m.anchors[m.anchors.length-1].connectTo]):(l=m.connectedLines)==null||l.forEach(p=>{p.lineAnchor=this.randomIdObj[p.lineAnchor],p.lineId=this.randomIdObj[p.lineId]}),(h=m.animations)!=null&&h.length){const p=JSON.stringify(m.animations).replace(f,g=>this.randomIdObj[g]);m.animations=JSON.parse(p)}if((c=m.triggers)!=null&&c.length){const p=JSON.stringify(m.triggers).replace(f,g=>this.randomIdObj[g]);m.triggers=JSON.parse(p)}if((u=m.events)!=null&&u.length){const p=JSON.stringify(m.events).replace(f,g=>this.randomIdObj[g]);m.events=JSON.parse(p)}}}for(const d of t)d.id||(d.id=Mt()),!d.calculative&&(d.calculative={canvas:this}),this.store.pens[d.id]=d;let r=0,n=0,a=0;for(const d of t)d.parentId||(d.width*=this.store.data.scale,d.height*=this.store.data.scale,d.x=i.x-d.width/2+a,d.y=i.y-d.height/2+n,d.tags&&d.tags.includes("meta3d")&&(d.x=this.store.data.origin.x,d.y=this.store.data.origin.y),d.dataset&&(r%2===0?a=d.width-40*this.store.data.scale:a=0,r++,r%2===0&&(n+=d.height+10*this.store.data.scale),delete d.dataset),d.temOffsetX&&(d.x+=d.temOffsetX*this.store.data.scale,delete d.temOffsetX),d.temOffsetY&&(d.y+=d.temOffsetY*this.store.data.scale,delete d.temOffsetY));const s=this.store.data.width||this.store.options.width,o=this.store.data.height||this.store.options.height;if(s&&o){let d={x:this.store.data.origin.x,y:this.store.data.origin.y,width:s*this.store.data.scale,height:o*this.store.data.scale},f=!0;for(const m of t)if(!m.parentId){let p=[{x:m.x,y:m.y},{x:m.x+m.width,y:m.y},{x:m.x,y:m.y+m.height},{x:m.x+m.width,y:m.y+m.height},{x:m.x+m.width/2,y:m.y+m.height/2}];if(m.x===d.x&&m.y===d.y&&m.width===d.width&&m.height===d.height||p.some(g=>yr(g,d))){f=!1,this.store.options.strictScope&&(m.x<d.x&&(m.x=d.x),m.y<d.y&&(m.y=d.y),m.x+m.width>d.x+d.width&&(m.x=d.x+d.width-m.width),m.y+m.height>d.y+d.height&&(m.y=d.y+d.height-m.height));break}}if(f){console.info("画笔在大屏范围外");return}}await this.addPens(t,!0),this.active(t.filter(d=>!d.parentId)),this.render(),this.externalElements.focus()}randomCombineId(t,i,r){let n=null;t.type?t.anchors[0].connectTo||t.anchors[t.anchors.length-1].connectTo?n=[t.id,t.anchors[0].id,t.anchors[t.anchors.length-1].id]:n=[t.id]:i.length>1&&(n=[t.id]),af(t),i.length>1&&(n.length===1?this.randomIdObj[n[0]]=t.id:(this.randomIdObj[n[0]]=t.id,this.randomIdObj[n[1]]=t.anchors[0].id,this.randomIdObj[n[2]]=t.anchors[t.anchors.length-1].id)),t.parentId=r;const a=[];if(Array.isArray(t.children))for(const s of t.children){const o=i.find(l=>l.id===s);o&&a.push(this.randomCombineId(o,i,t.id).id)}return t.children=a,t}async addPens(t,i,r){if(this.beforeAddPens&&await this.beforeAddPens(t)!=!0)return[];const n=[];for(const a of t)this.beforeAddPen&&this.beforeAddPen(a)!=!0||(r&&!a.parentId&&(a.x=a.x*this.store.data.scale+this.store.data.origin.x,a.y=a.y*this.store.data.scale+this.store.data.origin.y,a.width=a.width*this.store.data.scale,a.height=a.height*this.store.data.scale),this.makePen(a),n.push(a));return this.render(),this.store.emitter.emit("add",n),i&&this.pushHistory({type:_t.Add,pens:lt(n,!0)}),n}getInitPencilLine(t){const{data:i,options:r}=this.store,n=i.scale,a=i.lineWidth||1;return{id:t.penId,name:"line",x:t.x,y:t.y,type:$t.Line,calculative:{canvas:this,pencil:!0,active:!0,worldAnchors:[t],lineWidth:a*n},fromArrow:i.fromArrow||r.fromArrow,toArrow:i.toArrow||r.toArrow,lineWidth:a}}createDrawingLine(t){this.inactive();const{data:i,options:r}=this.store,n=i.scale,a=i.lineWidth||1;return t.penId=Mt(),{id:t.penId,name:"line",lineName:this.drawingLineName,x:t.x,y:t.y,type:$t.Line,calculative:{canvas:this,active:!0,worldAnchors:[t],lineWidth:a*n,...r.linePresetStyle},fromArrow:i.fromArrow||r.fromArrow,toArrow:i.toArrow||r.toArrow,lineWidth:a,...r.linePresetStyle}}addRuleLine(t){const{x:i,y:r,scale:n,origin:a}=this.store.data,s=t.x+i,o=t.y+r;let l=t.x,h=t.y,c=0,u=0,d=0,f=0;if(s<=o&&s<20)l=-i,c=this.width,d=1,t.ctrlKey||(h=Math.round((h-a.y)/(n*10))*(n*10)+a.y);else if(o<s&&o<20)h=-r,u=this.height,f=1,t.ctrlKey||(l=Math.round((l-a.x)/(n*10))*(n*10)+a.x);else return;this.addPen({isRuleLine:!0,type:$t.Line,name:"line",lineName:"line",x:l,y:h,width:c,height:u,color:this.store.options.ruleLineColor,anchors:[{x:0,y:0},{x:d,y:f}]})}clearRuleLines(){this.delete(this.ruleLines)}get ruleLines(){return this.store.data.pens.filter(t=>t.isRuleLine)}alignPenToGrid(t){var r;if(this.store.options.autoAlignGrid&&this.store.data.grid&&!t.type){const n=this.store.data.gridSize||this.store.options.gridSize,{origin:a,scale:s}=this.store.data,{x:o,y:l}=t,h={x:o,y:l},c=this.getPenRect(t),u=parseInt((c.x/n).toFixed()),d=parseInt((c.y/n).toFixed()),f=u*n,m=d*n;h.x=a.x+f*s,h.y=a.y+m*s,Object.assign(t,h),(r=t.onMove)==null||r.call(t,t),this.updatePenRect(t),this.calcActiveRect(),this.getSizeCPs()}}movedActivePens(t){let i=this.getAllFollowersByPens(this.store.active,!1);const r=lt(i,!0),n=this.store.data.gridSize||this.store.options.gridSize,{origin:a,scale:s}=this.store.data,o=this.store.options.autoAlignGrid&&(this.store.data.grid||this.store.options.grid);if(i.forEach(d=>{var y;const f=this.movingPens.findIndex(T=>T.id===d.id+Qe);if(f<0)return;const{x:m,y:p}=this.movingPens[f],g={x:m,y:p};if(o&&!this.movingPens[f].type){const T=this.getPenRect(this.movingPens[f]),b=parseInt((T.x/n).toFixed()),S=parseInt((T.y/n).toFixed()),I=b*n,D=S*n;g.x=a.x+I*s,g.y=a.y+D*s}Object.assign(d,g),(y=d.onMove)==null||y.call(d,d),this.updatePenRect(d),this.updateLines(d),this.store.emitter.emit("updateLines",d),this.patchFlagsLines.forEach(T=>{T.type&&this.initLineRect(T)}),this.patchFlagsLines.clear(),d.calculative.x=d.x,d.calculative.y=d.y,d.calculative.initRect&&(d.calculative.initRect.x=d.calculative.x,d.calculative.initRect.y=d.calculative.y,d.calculative.initRect.ex=d.calculative.x+d.calculative.width,d.calculative.initRect.ey=d.calculative.y+d.calculative.height),Hp(d),d.parentId&&this.parent.updateRectbyChild(d.calculative.worldRect,d,this.store.pens[d.parentId])}),this.initImageCanvas(this.store.active),this.initTemplateCanvas(this.store.active),!this.dock)return;const{xDock:l,yDock:h}=this.dock;let c;l&&(c=this.store.pens[l.penId]),!c&&h&&(c=this.store.pens[h.penId]);const u=lt(this.store.active,!0);if(t&&this.store.active.length===1&&(c==null?void 0:c.type)===1&&(l!=null&&l.anchorId||h!=null&&h.anchorId)){const d=ge(c),f=Gt(c);if(l!=null&&l.anchorId){const m=this.store.pens[this.store.active[0].id+Qe].calculative.worldAnchors.find(p=>p.id===l.anchorId);m.x===d.x&&m.y===d.y?(r.push(lt(c,!0)),Oe(this.store.active[0],m,c,d),u.push(lt(c,!0))):m.x===f.x&&m.y===f.y&&(r.push(lt(c,!0)),Oe(this.store.active[0],m,c,f),u.push(lt(c,!0)))}else if(h!=null&&h.anchorId){const m=this.store.pens[this.store.active[0].id+Qe].calculative.worldAnchors.find(p=>p.id===h.anchorId);m.x===d.x&&m.y===d.y?(r.push(lt(c,!0)),Oe(this.store.active[0],m,c,d),u.push(lt(c,!0))):m.x===f.x&&m.y===f.y&&(r.push(lt(c,!0)),Oe(this.store.active[0],m,c,f),u.push(lt(c,!0)))}}o&&(this.calcActiveRect(),this.getSizeCPs()),this.pushHistory({type:_t.Update,pens:u,initPens:r}),this.store.emitter.emit("translatePens",u)}copyMovedPens(){this.copy(this.store.active.map((t,i)=>{const{x:r,y:n}=this.movingPens[i];return this.updateLines(t),{...t,x:r,y:n}})),this.pasteOffset=!1,this.paste()}initImageCanvas(t){t.some(i=>this.hasImage(i,!1))&&this.canvasImage.init(),t.some(i=>this.hasImage(i,!0))&&this.canvasImageBottom.init()}initTemplateCanvas(t){t.some(i=>i.canvasLayer===Ht.CanvasTemplate)&&this.canvasTemplate.init()}hasImage(t,i){var r;return t.image&&t.name!=="gif"?i?t.canvasLayer===Ht.CanvasImageBottom:t.canvasLayer===Ht.CanvasImage:(r=t.children)==null?void 0:r.some(n=>{const a=this.store.pens[n];return a&&this.hasImage(a,i)})}inactive(t){if(!this.store.active.length)return;this.initTemplateCanvas(this.store.active),this.store.active.forEach(r=>{r.calculative.active=void 0,r.calculative.activeAnchor=void 0,r.calculative.hover=!1,sa(r,!1)});const i=[...this.store.active];this.store.active=[],this.activeRect=void 0,this.sizeCPs=void 0,this.store.activeAnchor=void 0,this.patchFlags=!0,!t&&this.store.emitter.emit("inactive",i)}active(t,i=!0){if(this.store.active&&this.store.active.length){i&&this.store.emitter.emit("inactive",this.store.active);for(const r of this.store.active)r.calculative.active=void 0,r.calculative.hover=!1,sa(r,!1)}this.store.active=[],t.forEach(r=>{r.calculative.active=!0,sa(r)}),this.store.active.push(...t),this.activeRect=void 0,this.calcActiveRect(),this.initTemplateCanvas(t),this.patchFlags=!0,i&&this.store.emitter.emit("active",this.store.active)}getSizeCPs(){this.sizeCPs=Pr(this.activeRect);const t=[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}],{x:i,y:r,width:n,height:a,rotate:s,center:o}=this.activeRect;t.forEach(l=>{const h={x:l.x*n+i,y:l.y*a+r};Zt(h,s,o),this.sizeCPs.push(h)})}getSpecialAngle(t,i){let r=0;t.x-i.x!==0?(r=Math.atan((i.y-t.y)/(t.x-i.x))*180/Math.PI,t.x<i.x&&(r>0?r-=180:r+=180)):i.y>t.y?r=90:i.y<t.y&&(r=-90),r=Math.round(r/15)*15;let n=Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y));t.x=i.x+Math.cos(r/180*Math.PI)*n,t.y=i.y-Math.sin(r/180*Math.PI)*n}clearHover(){this.hoverType=Et.None,this.store.hover=null,this.store.hoverAnchor=null}inAnchor(t,i,r){var n;if(this.store.hoverAnchor=void 0,this.movingAnchor=void 0,!r||r.locked>jt.DisableEdit||!(i.type&&i.calculative.active)&&this.store.options.disableAnchor||i.disableAnchor)return Et.None;if((this.mouseDown||this.drawingLine)&&i.name==="line"&&r.connectTo){const a=this.findOne(r.connectTo);if(a!=null&&a.calculative&&!(a!=null&&a.calculative.active)){i=a;const s=a.calculative.worldAnchors.find(o=>o.id===r.anchorId);s&&(r=s)}}if(r.twoWay===je.Disable&&i.name!=="line")return Et.None;if(i.name==="line"&&r.connectTo){let a=(n=this.findOne(r.connectTo))==null?void 0:n.anchors.find(s=>s.id===r.anchorId);if(a&&a.twoWay)return Et.None}if(this.drawingLine){if(r.twoWay===je.Out)return Et.None}else if(!(this.mouseDown&&this.hoverType===Et.LineAnchor)){if(r.twoWay===je.In)return Et.None}if(aa(t,r,this.pointSize,r.penId?this.store.pens[r.penId]:void 0))return r!==this.store.hoverAnchor&&(this.patchFlags=!0),this.store.hoverAnchor=r,this.store.hover=i,i.type?r.connectTo&&!i.calculative.active&&(this.store.hover=this.store.pens[r.connectTo],this.store.hover)?(this.store.hoverAnchor=this.store.hover.calculative.worldAnchors.find(a=>a.id===r.anchorId),this.store.hoverAnchor?(this.externalElements.style.cursor="crosshair",Et.NodeAnchor):Et.None):(this.hotkeyType===Xt.AddAnchor?this.externalElements.style.cursor="vertical-text":this.externalElements.style.cursor="pointer",Et.LineAnchor):(this.hotkeyType===Xt.AddAnchor?this.externalElements.style.cursor="vertical-text":this.externalElements.style.cursor="crosshair",Et.NodeAnchor);if(!this.mouseDown&&i.type){if(i.calculative.active&&r.prev&&aa(t,r.prev,this.pointSize))return this.store.hoverAnchor=r,this.store.hover=i,this.externalElements.style.cursor="pointer",Et.LineAnchorPrev;if(i.calculative.active&&r.next&&aa(t,r.next,this.pointSize))return this.store.hoverAnchor=r,this.store.hover=i,this.externalElements.style.cursor="pointer",Et.LineAnchorNext}return Et.None}resize(t,i){t=t||this.parentElement.clientWidth,i=i||this.parentElement.clientHeight,this.width=t,this.height=i,this.canvasRect={x:0,y:0,width:t,height:i},le(this.canvasRect),this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.externalElements.style.width=t+"px",this.externalElements.style.height=i+"px",this.canvasTemplate.resize(t,i),this.canvasImage.resize(t,i),this.canvasImageBottom.resize(t,i),this.magnifierCanvas.resize(t,i),t=t*this.store.dpiRatio|0,i=i*this.store.dpiRatio|0,this.canvas.width=t,this.canvas.height=i,this.offscreen.width=t,this.offscreen.height=i,this.clientRect=this.externalElements.getBoundingClientRect(),this.canvas.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").scale(this.store.dpiRatio,this.store.dpiRatio),this.offscreen.getContext("2d").textBaseline="middle";for(const r of this.store.data.pens)r.isRuleLine&&(r.width?r.height||(r.width=this.width):r.height=this.height,this.updatePenRect(r)),kr(r);this.render()}clearCanvas(){this.activeRect=void 0,this.sizeCPs=void 0,this.__loadMap=new Map,this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.offscreen.getContext("2d").clearRect(0,0,this.offscreen.width,this.offscreen.height),this.store.data.template||this.canvasTemplate.clear(),this.canvasImage.clear(),this.canvasImageBottom.clear()}async addPen(t,i,r,n){if(!(this.beforeAddPens&&await this.beforeAddPens([t])!=!0)&&!(this.beforeAddPen&&this.beforeAddPen(t)!=!0))return n&&(t.x=t.x*this.store.data.scale+this.store.data.origin.x,t.y=t.y*this.store.data.scale+this.store.data.origin.y,t.width=t.width*this.store.data.scale,t.height=t.height*this.store.data.scale),this.makePen(t),this.active([t]),this.render(),r&&this.store.emitter.emit("add",[t]),i&&this.pushHistory({type:_t.Add,pens:[t]}),t}addPenSync(t,i,r,n){if(!(this.beforeAddPen&&this.beforeAddPen(t)!=!0))return n&&(t.x=t.x*this.store.data.scale+this.store.data.origin.x,t.y=t.y*this.store.data.scale+this.store.data.origin.y,t.width=t.width*this.store.data.scale,t.height=t.height*this.store.data.scale),this.makePen(t),this.active([t]),this.render(),r&&this.store.emitter.emit("add",[t]),i&&this.pushHistory({type:_t.Add,pens:[t]}),t}pushHistory(t){var n;if(this.store.data.locked)return;const{origin:i,scale:r}=this.store.data;t.origin=lt(i),t.scale=r,t.type!==_t.Update&&t.pens&&t.pens.forEach(a=>{a.calculative&&(a.calculative.layer=this.store.data.pens.findIndex(s=>s.id===a.id))}),this.store.historyIndex<this.store.histories.length-1&&this.store.histories.splice(this.store.historyIndex+1,this.store.histories.length-this.store.historyIndex-1),(n=t.pens)==null||n.forEach(a=>{let s;if(t.initPens)for(const o of t.initPens)o.id===a.id&&(s=o);if(s)for(const o in a)s[o]==null&&(s[o]=void 0)}),this.store.histories.push(t),this.store.historyIndex=this.store.histories.length-1,this.store.emitter.emit("update",{previous:t.initPens,current:t.pens})}undo(){if(this.store.data.locked||this.store.historyIndex==null||this.store.historyIndex<0)return;const t=this.store.histories[this.store.historyIndex--];this.doEditAction(t,!0);let i=t.step;for(;i>1;){const r=this.store.histories[this.store.historyIndex--];this.doEditAction(r,!0),i--}(t.type==_t.Add||t.type==_t.Delete||t.type==_t.Update)&&this.activeHistory()}redo(){if(this.store.data.locked||this.store.historyIndex==null||this.store.historyIndex>this.store.histories.length-2)return;const t=this.store.histories[++this.store.historyIndex];this.doEditAction(t,!1);let i=t.step;for(;i>1;){const r=this.store.histories[++this.store.historyIndex];this.doEditAction(r,!1),i--}(t.type==_t.Add||t.type==_t.Delete||t.type==_t.Update)&&this.activeHistory()}activeHistory(){let t=this.store.histories[this.store.historyIndex+1];const i=[];if(t&&t.type===_t.Update){t.pens.forEach(n=>{i.push(this.store.pens[n.id])}),this.active(i);return}let r=this.store.histories[this.store.historyIndex];r&&(r.type===_t.Add||r.type===_t.Delete)&&(r.pens.forEach(n=>{i.push(this.store.pens[n.id])}),this.active(i))}doEditAction(t,i){switch(this.inactive(),this.store.hoverAnchor=void 0,this.store.hover=void 0,t.type){case _t.Add:t.pens.forEach(a=>{var l;const s=lt(a,!0),o=this.store.data.pens.findIndex(h=>h.id===s.id);o>-1&&((l=s.onDestroy)==null||l.call(s,this.store.pens[s.id]),this.store.data.pens.splice(o,1),this.store.pens[s.id]=void 0,s.calculative||(s.calculative={}),s.calculative.canvas=this,this.store.animates.delete(s),this.store.animateMap.delete(s))}),t.type=_t.Delete;break;case _t.Update:const r=i?t.initPens:t.pens,n=i?t.pens:t.initPens;r.forEach(a=>{const s=lt(a,!0),o=this.store.data.pens.findIndex(l=>l.id===s.id);if(o>-1){if(s.calculative=this.store.data.pens[o].calculative,this.store.data.pens[o].type&&this.store.data.pens[o].lastConnected){for(let h in this.store.data.pens[o].lastConnected)if(this.store.pens[h]){let c=lt(this.store.data.pens[o].lastConnected[h]);this.store.pens[h].connectedLines=c,s.anchors.forEach(u=>{c.forEach(d=>{u.id===d.lineAnchor&&(u.connectTo=h)})})}}this.store.data.pens[o]=s,this.store.pens[s.id]=s;for(const h in s)(typeof s[h]!="object"||h==="lineDash")&&(s.calculative[h]=s[h]);s.calculative.image=void 0;const l=this.getPenRect(s,t.origin,t.scale);if(this.setPenRect(s,l,!1),this.updateLines(s,!0),s.calculative.canvas.parent.isCombine(s)){let h=n.find(c=>c.id===s.id);Sp.forEach(c=>{s[c]!==h[c]&&this.parent.setValue({id:s.id,[c]:s[c]},{render:!0,doEvent:!1})})}}});break;case _t.Delete:t.pens.reverse().forEach(a=>{var o,l;const s=lt(a,!0);if(s.calculative||(s.calculative={}),this.store.data.pens.splice(((o=s.calculative)==null?void 0:o.layer)!==-1?(l=s.calculative)==null?void 0:l.layer:this.store.data.pens.length,0,s),s.path&&!this.store.data.paths[s.pathId]&&(this.store.data.paths[s.pathId]=s.path),this.store.pens[s.id]=s,s.type&&s.lastConnected)for(let h in s.lastConnected)this.store.pens[h]&&(this.store.pens[h].connectedLines=s.lastConnected[h]);s.calculative.canvas=this}),t.pens.reverse().forEach(a=>{const s=this.store.pens[a.id],o=this.getPenRect(s,t.origin,t.scale);this.setPenRect(s,o,!1),s.calculative.image=void 0,s.calculative.backgroundImage=void 0,s.calculative.strokeImage=void 0,this.loadImage(s)}),t.type=_t.Add;break;case _t.Replace:{const a=i?t.initPens:t.pens;(i?t.pens:t.initPens).forEach(o=>{var c;const l=lt(o,!0);if(this.store.data.pens.findIndex(u=>u.id===l.id)>-1){(c=l.onDestroy)==null||c.call(l,this.store.data.pens.find(d=>d.id===l.id));const u=this.store.data.pens.findIndex(d=>d.id===l.id);this.store.data.pens.splice(u,1),this.store.pens[l.id]=void 0,l.calculative||(l.calculative={}),l.calculative.canvas=this,this.store.animates.delete(l),this.store.animateMap.delete(l)}}),a.reverse().forEach(o=>{var h,c;const l=lt(o,!0);if(l.calculative||(l.calculative={}),this.store.data.pens.splice(((h=l.calculative)==null?void 0:h.layer)!==-1?(c=l.calculative)==null?void 0:c.layer:this.store.data.pens.length,0,l),this.store.pens[l.id]=l,l.type&&l.lastConnected)for(let u in l.lastConnected)this.store.pens[u]&&(this.store.pens[u].connectedLines=l.lastConnected[u]);l.calculative.canvas=this}),a.reverse().forEach(o=>{const l=this.store.data.pens.find(c=>c.id===o.id),h=this.getPenRect(l,t.origin,t.scale);this.setPenRect(l,h,!1),l.calculative.image=void 0,l.calculative.backgroundImage=void 0,l.calculative.strokeImage=void 0,this.loadImage(l)}),t.type=_t.Replace;break}}if(t.type===_t.Update){let r=[...t.pens,...t.initPens];this.initImageCanvas(r),this.initTemplateCanvas(r)}else this.initImageCanvas(t.pens),this.initTemplateCanvas(t.pens);this.parent.onSizeUpdate(),this.render(),this.store.emitter.emit(i?"undo":"redo",t)}makePen(t){var n;if(t.id||(t.id=Mt()),Math.abs(this.store.lastScale-this.store.data.scale)<1e-4&&this.store.sameTemplate&&this.store.templatePens[t.id]&&t.canvasLayer===Ht.CanvasTemplate){t=this.store.templatePens[t.id],this.store.data.pens.push(t),this.updatePenRect(t);return}if(t.copyIndex?(this.store.data.pens.splice(t.copyIndex+1,0,t),delete t.copyIndex):this.store.data.pens.push(t),this.store.pens[t.id]=t,t.path){!t.pathId&&(t.pathId=Mt());const a=this.store.data.paths;!a[t.pathId]&&(a[t.pathId]=t.path),t.path=void 0}t.lineWidth==null&&(t.lineWidth=1);const{fontSize:i,lineHeight:r}=this.store.options;t.fontSize?t.fontSize<0&&(t.fontSize=0):t.fontSize=i>=0?i:12,t.lineHeight||(t.lineHeight=r),t.image&&t.name!=="gif"&&t.canvasLayer===void 0&&(t.isBottom?t.canvasLayer=Ht.CanvasImageBottom:t.canvasLayer=Ht.CanvasImage,delete t.isBottom),t.template&&(t.canvasLayer=Ht.CanvasTemplate),t.calculative={canvas:this,singleton:(n=t.calculative)==null?void 0:n.singleton},(t.video||t.audio)&&(t.calculative.onended=a=>{this.nextAnimate(a)});for(const a in t)(typeof t[a]!="object"||a==="lineDash")&&(t.calculative[a]=t[a]);if(t.calculative.image=void 0,t.calculative.backgroundImage=void 0,t.calculative.strokeImage=void 0,!t.anchors&&St.anchors[t.name]&&(t.anchors||(t.anchors=[]),St.anchors[t.name](t)),!t.anchors){const a=lt(this.store.options.defaultAnchors);a.forEach((s,o)=>{s.id=`${o}`,s.penId=t.id}),t.anchors=a}this.updatePenRect(t),!t.anchors&&t.calculative.worldAnchors&&(t.anchors=t.calculative.worldAnchors.map(a=>ws(a,t.calculative.worldRect))),!t.rotate&&(t.rotate=0),t.lineAnimateImages??(t.lineAnimateImages=[]),t.lineAnimateImages&&t.lineAnimateImages.forEach(a=>{this.__loadImage(a)}),this.loadImage(t),this.parent.penNetwork(t)}drawline(t){var i;this.drawingLine&&((i=this[this.drawingLineName])==null||i.call(this,this.store,this.drawingLine,t),this.store.path2dMap.set(this.drawingLine,St.path2dDraws.line(this.drawingLine)),this.patchFlags=!0)}initLineRect(t){var a;if(!t)return;if(!((a=t.calculative.worldAnchors)!=null&&a.length)){this._del([t]);return}if(!isFinite(t.x)||!isFinite(t.x)||t.x==null||t.y==null)return;const i=xh(t);t.parentId||Object.assign(t,i);const{fontSize:r,lineHeight:n}=this.store.options;t.fontSize||(t.fontSize=r>=0?r:12,t.calculative.fontSize=t.fontSize*this.store.data.scale),t.lineHeight||(t.lineHeight=n,t.calculative.lineHeight=t.lineHeight),ne(i),t.calculative.worldRect=i,fu(t,i),Ji(t),kr(t),t.calculative&&(t.calculative.gradientAnimatePath=void 0),this.store.path2dMap.set(t,St.path2dDraws[t.name](t)),t.calculative.worldAnchors&&(t.anchors=t.calculative.worldAnchors.map(s=>ws(s,t.calculative.worldRect)))}drawingPencil(){sv(this.store),this.pencil=!0,this.externalElements.style.cursor="crosshair"}stopPencil(){this.pencil=!1,this.pencilLine=void 0,this.externalElements.style.cursor="default"}async finishDrawline(t){if(!this.drawingLine)return;const i=ge(this.drawingLine);let r=Gt(this.drawingLine);if(r.isTemp&&(this.drawingLine.calculative.worldAnchors.pop(),r=Gt(this.drawingLine)),!t&&(!r.connectTo&&this.drawingLine.calculative.worldAnchors.pop(),ge(this.drawingLine)===this.drawingLine.calculative.activeAnchor)){this.drawingLine=void 0,this.render();return}if(!i.connectTo||!r.connectTo){if(this.store.options.disableEmptyLine){i.connectTo&&(this.store.pens[i.connectTo].connectedLines=this.store.pens[i.connectTo].connectedLines.filter(s=>s.lineId!==this.drawingLine.id)),this.drawingLine=void 0,this.render();return}}else if(this.store.options.disableRepeatLine&&this.store.data.pens.find(o=>{if(o.type){const l=ge(o),h=Gt(o);return Yd(l,i)&&Yd(h,r)}})){this.drawingLine=void 0,this.render();return}const n=xh(this.drawingLine);Object.assign(this.drawingLine,n),this.drawingLine.calculative.worldRect=n,this.drawingLine.calculative.activeAnchor=Gt(this.drawingLine),this.store.activeAnchor=this.drawingLine.calculative.activeAnchor,(!this.beforeAddPens||await this.beforeAddPens([this.drawingLine]))&&(!this.beforeAddPen||this.beforeAddPen(this.drawingLine))&&(this.initLineRect(this.drawingLine),this.store.data.pens.push(this.drawingLine),this.store.pens[this.drawingLine.id]=this.drawingLine,this.store.emitter.emit("add",[this.drawingLine]),this.active([this.drawingLine]),this.pushHistory({type:_t.Add,pens:lt([this.drawingLine],!0)})),this.store.path2dMap.set(this.drawingLine,St.path2dDraws[this.drawingLine.name](this.drawingLine)),this.drawingLine=void 0,this.drawingLineName=void 0,this.render()}async finishPencil(){if(this.pencilLine){const t=Rh(this.pencilLine.calculative.worldAnchors,10,0,this.pencilLine.calculative.worldAnchors.length-1);let i=ge(this.pencilLine);t.unshift({id:i.id,penId:i.penId,x:i.x,y:i.y}),i=Gt(this.pencilLine),t.push({id:i.id,penId:i.penId,x:i.x,y:i.y}),this.pencilLine.calculative.worldAnchors=FT(t),this.pencilLine.calculative.worldAnchors.length>1&&(this.pencilLine.calculative.pencil=!1,this.store.path2dMap.set(this.pencilLine,St.path2dDraws[this.pencilLine.name](this.pencilLine)),(!this.beforeAddPens||await this.beforeAddPens([this.pencilLine]))&&(!this.beforeAddPen||this.beforeAddPen(this.pencilLine))&&(this.initLineRect(this.pencilLine),this.store.data.pens.push(this.pencilLine),this.store.pens[this.pencilLine.id]=this.pencilLine,this.store.emitter.emit("add",[this.pencilLine]),this.active([this.pencilLine]),this.pushHistory({type:_t.Add,pens:lt([this.pencilLine],!0)}))),this.pencilLine=void 0,this.render()}}firefoxLoadSvg(t){const i=new Image,r=new XMLHttpRequest;r.open("GET",t.image,!0),r.onload=()=>{const s=new DOMParser().parseFromString(r.responseText,"text/xml").getElementsByTagName("svg")[0],{width:o,height:l}=t.calculative.worldRect;s.setAttribute("width",`${o}px`),s.setAttribute("height",`${l}px`);const c="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(new XMLSerializer().serializeToString(s))));i.src=c,i.onload=()=>{t.calculative.img=i,t.calculative.imgNaturalWidth=i.naturalWidth||t.iconWidth,t.calculative.imgNaturalHeight=i.naturalHeight||t.iconHeight,St.htmlElements[t.image]=i,this.imageLoaded(),t.canvasLayer===Ht.CanvasTemplate&&this.templateImageLoaded()}},r.send()}loadImage(t){if(t.image!==t.calculative.image||!t.calculative.img){if(t.calculative.img=void 0,t.image)if(St.htmlElements[t.image]){const i=St.htmlElements[t.image];t.calculative.img=i,t.calculative.imgNaturalWidth=i.naturalWidth||t.iconWidth,t.calculative.imgNaturalHeight=i.naturalHeight||t.iconHeight,this.imageLoaded(),t.canvasLayer===Ht.CanvasTemplate&&this.templateImageLoaded()}else if(navigator.userAgent.includes("Firefox")&&t.image.endsWith(".svg"))this.firefoxLoadSvg(t);else{const i=new Image;i.crossOrigin=t.crossOrigin==="undefined"?void 0:t.crossOrigin||"anonymous",i.src=t.image,this.store.options.cdn&&!(t.image.startsWith("http")||t.image.startsWith("//")||t.image.startsWith("data:image"))&&(i.src=this.store.options.cdn+t.image),i.onload=()=>{t.calculative.img=i,t.calculative.imgNaturalWidth=i.naturalWidth||t.iconWidth,t.calculative.imgNaturalHeight=i.naturalHeight||t.iconHeight,St.htmlElements[t.image]=i,this.imageLoaded(),t.canvasLayer===Ht.CanvasTemplate&&this.templateImageLoaded()}}t.calculative.image=t.image}if(t.backgroundImage!==t.calculative.backgroundImage){if(t.calculative.backgroundImg=void 0,t.backgroundImage)if(St.htmlElements[t.backgroundImage]){const i=St.htmlElements[t.backgroundImage];t.calculative.backgroundImg=i}else{const i=new Image;i.crossOrigin="anonymous",i.src=t.backgroundImage,this.store.options.cdn&&!(t.backgroundImage.startsWith("http")||t.backgroundImage.startsWith("//")||t.backgroundImage.startsWith("data:image"))&&(i.src=this.store.options.cdn+t.backgroundImage),i.onload=()=>{t.calculative.backgroundImg=i,St.htmlElements[t.backgroundImage]=i,this.imageLoaded(),t.canvasLayer===Ht.CanvasTemplate&&this.templateImageLoaded()}}t.calculative.backgroundImage=t.backgroundImage}if(t.strokeImage!==t.calculative.strokeImage){if(t.calculative.strokeImg=void 0,t.strokeImage)if(St.htmlElements[t.strokeImage]){const i=St.htmlElements[t.strokeImage];t.calculative.strokeImg=i}else{const i=new Image;i.crossOrigin="anonymous",i.src=t.strokeImage,this.store.options.cdn&&!(t.strokeImage.startsWith("http")||t.strokeImage.startsWith("//")||t.strokeImage.startsWith("data:image"))&&(i.src=this.store.options.cdn+t.strokeImage),i.onload=()=>{t.calculative.strokeImg=i,St.htmlElements[t.strokeImage]=i,this.imageLoaded(),t.canvasLayer===Ht.CanvasTemplate&&t.name!=="gif"&&this.templateImageLoaded()}}t.calculative.strokeImage=t.strokeImage}}__loadImage(t,i=5){if(this.__loadMap.has(t))return this.__loadMap.get(t);const r=new Promise((n,a)=>{if(St.htmlElements[t])n(St.htmlElements[t]);else{const s=new Image;s.crossOrigin="anonymous",this.store.options.cdn&&!(t.startsWith("http")||t.startsWith("//")||t.startsWith("data:image"))?s.src=this.store.options.cdn+t:s.src=t,s.onload=()=>{St.htmlElements[t]=s,this.__loadMap.delete(t),n(s)},s.onerror=()=>{i>0?(console.warn(`Image ${t} load failed, retrying... (${i})`),setTimeout(()=>{this.__loadMap.delete(t),this.__loadImage(t,i-1).then(n).catch(a)},1e3)):(this.__loadMap.set(t,0),a(new Error(`Failed to load image: ${t}`)))}}});return this.__loadMap.set(t,r),r}imageLoaded(){this.imageTimer&&clearTimeout(this.imageTimer),this.imageTimer=setTimeout(()=>{this.canvasImage.init(),this.canvasImageBottom.init(),this.render()},100)}templateImageLoaded(){this.templateImageTimer&&clearTimeout(this.templateImageTimer),this.templateImageTimer=setTimeout(()=>{this.canvasTemplate.init(),this.render()},100)}setCalculativeByScale(t){const i=this.store.data.scale;t.calculative.lineWidth=t.lineWidth*i,t.calculative.fontSize=t.fontSize*i,t.calculative.letterSpacing=(t.letterSpacing||0)*i,t.fontSize<1&&t.fontSize>0&&(t.calculative.fontSize=t.fontSize*t.calculative.worldRect.height),Hi(t.iconSize)&&(t.calculative.iconSize=t.iconSize*i),Hi(t.iconWidth)&&(t.calculative.iconWidth=t.iconWidth*i),Hi(t.iconHeight)&&(t.calculative.iconHeight=t.iconHeight*i),Hi(t.iconLeft)&&(t.calculative.iconLeft=t.iconLeft<1&&t.iconLeft>-1?t.iconLeft:t.iconLeft*i),Hi(t.iconTop)&&(t.calculative.iconTop=t.iconTop<1&&t.iconTop>-1?t.iconTop:t.iconTop*i),Hi(t.textWidth)&&(t.calculative.textWidth=t.textWidth<1&&t.textWidth>-1?t.textWidth:t.textWidth*i),Hi(t.textHeight)&&(t.calculative.textHeight=t.textHeight<1&&t.textHeight>-1?t.textHeight:t.textHeight*i),Hi(t.textLeft)&&(t.calculative.textLeft=t.textLeft<1&&t.textLeft>-1?t.textLeft*t.calculative.worldRect.width:t.textLeft*i),Hi(t.textTop)&&(t.calculative.textTop=t.textTop<1&&t.textTop>-1?t.textTop*t.calculative.worldRect.height:t.textTop*i),Hi(t.borderWidth)&&t.type===$t.Line&&t.borderWidth&&(t.calculative.borderWidth=t.borderWidth*i)}updatePenRect(t,{worldRectIsReady:i,playingAnimate:r}={}){i?Jo(t):Vp(t),r||this.setCalculativeByScale(t),Ia(t),Xd(this.store.pens,t),Ji(t),kr(t),St.path2dDraws[t.name]&&this.store.path2dMap.set(t,St.path2dDraws[t.name](t)),t.calculative.patchFlags=!0,this.patchFlags=!0,t.children&&t.children.forEach(n=>{const a=this.store.pens[n];a&&this.updatePenRect(a,{worldRectIsReady:!1})}),t.type&&this.initLineRect(t),(t.gradientColors||t.lineGradientColors)&&(t.calculative.gradientTimer&&clearTimeout(t.calculative.gradientTimer),t.calculative.gradientTimer=setTimeout(()=>{t.calculative.lineGradient&&(t.calculative.lineGradient=null),t.calculative.gradient&&(t.calculative.gradient=null),t.calculative.radialGradient&&(t.calculative.radialGradient=null),this.patchFlags=!0,t.calculative.gradientTimer=void 0},50))}initGlobalStyle(){if(this.store.options.themeOnlyCanvas||this.store.data.themeOnlyCanvas)return;const t={},i={},r={};Fb.forEach(a=>{var s;if(this.store.options[a]!=null&&this.store.options[a]!==""&&(t[a]=this.store.options[a]),this.store.data[a]!=null&&this.store.data[a]!==""&&(i[a]=this.store.data[a]),this.store.data.theme){const o=(s=this.store.theme[this.store.data.theme])==null?void 0:s[a];o!=null&&o!==""&&(r[a]=o)}}),this.store.styles={};const n=us.getThemeObj(this.store.data.theme);Object.assign(this.store.styles,t,i,r,n)}translate(t=0,i=0){if(this.store.data.x+=t*this.store.data.scale,this.store.data.y+=i*this.store.data.scale,this.store.data.x=Math.round(this.store.data.x),this.store.data.y=Math.round(this.store.data.y),this.store.options.padding){let r=Rr(this.store.options.padding);const n=this.store.data.width||this.store.options.width,a=this.store.data.height||this.store.options.height;this.width<(n+r[1]+r[3])*this.store.data.scale&&(this.store.data.x+this.store.data.origin.x>r[3]*this.store.data.scale&&(this.store.data.x=r[3]*this.store.data.scale-this.store.data.origin.x),this.store.data.x+this.store.data.origin.x+n*this.store.data.scale<this.width-r[1]*this.store.data.scale&&(this.store.data.x=this.width-r[1]*this.store.data.scale-(this.store.data.origin.x+n*this.store.data.scale))),this.height<(a+r[0]+r[2])*this.store.data.scale&&(this.store.data.y+this.store.data.origin.y>r[0]*this.store.data.scale&&(this.store.data.y=r[0]*this.store.data.scale-this.store.data.origin.y),this.store.data.y+this.store.data.origin.y+a*this.store.data.scale<this.height-r[2]*this.store.data.scale&&(this.store.data.y=this.height-r[2]*this.store.data.scale-(this.store.data.origin.y+a*this.store.data.scale)))}this.store.data.asyncTranslate?(clearTimeout(this.transTimeout),this.transTimeout=setTimeout(()=>{this.canvasTemplate.init(),this.canvasImage.init(),this.canvasImageBottom.init(),this.render()},300)):(this.canvasTemplate.init(),this.canvasImage.init(),this.canvasImageBottom.init(),this.render()),this.store.emitter.emit("translate",{x:this.store.data.x,y:this.store.data.y}),this.tooltip.translate(t,i),this.scroll&&this.scroll.isShow&&this.scroll.translate(t,i),this.onMovePens()}onMovePens(){var i;const t=this.parent.map;t&&t.isShow&&t.setView();for(const r of this.store.data.pens)kr(r),(i=r.onMove)==null||i.call(r,r),r.isRuleLine&&(r.width?r.height||(r.x=-this.store.data.x):r.y=-this.store.data.y,this.updatePenRect(r))}scale(t,i={x:0,y:0}){var o;const r=this.store.data.minScale||this.store.options.minScale,n=this.store.data.maxScale||this.store.options.maxScale;if(!(t>=r&&t<=n))return;this.calibrateMouse(i);const a=t/this.store.data.scale;this.store.data.scale=t,this.store.data.center=i,(o=this.store.clipboard)!=null&&o.pos&&hl(this.store.clipboard.pos,a,i),hl(this.store.data.origin,a,i),this.store.data.pens.forEach(l=>{if(l.onScale&&l.onScale(l),!l.parentId){if(ra(l,a,i),l.isRuleLine){const h=1/a,c=l.calculative.worldRect.center;l.width&&l.height||ra(l,h,c)}this.updatePenRect(l,{worldRectIsReady:!0}),this.execPenResize(l)}}),this.onMovePens(),this.calcActiveRect(),this.canvasTemplate.init(),this.canvasImage.init(),this.canvasImageBottom.init();const s=this.parent.map;s&&s.isShow&&s.setView(),this.render(),this.store.emitter.emit("scale",this.store.data.scale)}templateScale(t,i={x:0,y:0}){const{minScale:r,maxScale:n}=this.store.options;if(!(t>=r&&t<=n))return;const a=t/this.store.data.scale;this.store.data.scale=t,this.store.data.center={x:0,y:0},this.store.data.origin={x:0,y:0},this.store.data.pens.forEach(s=>{if(!s.parentId){if(ra(s,a,i),s.onScale&&s.onScale(s),s.isRuleLine){const o=a>1?1:1/a/a,l=s.calculative.worldRect.center;s.width&&s.height||ra(s,o,l)}this.execPenResize(s)}}),this.calcActiveRect()}rotatePens(t){this.initPens||(this.initPens=lt(this.getAllByPens(this.store.active))),this.activeRect.rotate=vi(t,this.activeRect.center),this.activeRect.rotate%90<10&&(this.activeRect.rotate-=this.activeRect.rotate%90),this.activeRect.rotate%90>80&&(this.activeRect.rotate+=90-this.activeRect.rotate%90),this.store.active.length===1&&(this.lastRotate=this.store.active[0].rotate||0);const i=this.activeRect.rotate-this.lastRotate;for(const r of this.store.active){if(r.parentId)return;this.rotatePen(r,i,this.activeRect),r.onRotate&&r.onRotate(r),this.updateLines(r)}this.lastRotate=this.activeRect.rotate,this.getSizeCPs(),this.initImageCanvas(this.store.active),this.initTemplateCanvas(this.store.active),this.render(),this.store.emitter.emit("rotatePens",this.store.active),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.timer=void 0,this.pushHistory({type:_t.Update,pens:lt(this.getAllByPens(this.store.active)),initPens:this.initPens}),this.initPens=void 0},200)}resizePens(t){if(this.initPens||(this.initPens=lt(this.store.active,!0)),!this.initActiveRect){this.initActiveRect=lt(this.activeRect);return}const i={x:this.mouseDown.x,y:this.mouseDown.y},r={x:t.x,y:t.y};let n=r.x-i.x,a=r.y-i.y;const s=lt(this.initActiveRect);if(sf(s,n,a,this.resizeIndex),ne(s),!this.store.options.disableDock){this.clearDock();const f=this.customResizeDock||Fw;this.dock=f(this.store,s,this.store.active,this.resizeIndex);const{xDock:m,yDock:p}=this.dock;if(m){n+=m.step;const g=this.store.pens[m.penId];g.calculative.isDock=!0}if(p){a+=p.step;const g=this.store.pens[p.penId];g.calculative.isDock=!0}}const o=this.activeRect.width,l=this.activeRect.height;let h=n-this.lastOffsetX,c=a-this.lastOffsetY;if(this.lastOffsetX=n,this.lastOffsetY=a,(t.ctrlKey||this.initPens.length===1&&this.initPens[0].ratio)&&(c=([1,3].includes(this.resizeIndex)?-1:1)*(h*l)/o),this.activeRect.ratio=this.initPens[0].ratio,sf(this.activeRect,h,c,this.resizeIndex),this.store.options.strictScope){const f=this.store.data.width||this.store.options.width,m=this.store.data.height||this.store.options.height;if(f&&m){let p={x:this.store.data.origin.x,y:this.store.data.origin.y,width:f*this.store.data.scale,height:m*this.store.data.scale};this.activeRect.x<p.x&&(this.activeRect.width=this.activeRect.width-(p.x-this.activeRect.x),this.activeRect.x=p.x),this.activeRect.y<p.y&&(this.activeRect.height=this.activeRect.height-(p.y-this.activeRect.y),this.activeRect.y=p.y),this.activeRect.x+this.activeRect.width>p.x+p.width&&(this.activeRect.width=this.activeRect.width-(this.activeRect.x+this.activeRect.width-(p.x+p.width)),this.activeRect.x=p.x+p.width-this.activeRect.width,this.activeRect.ex=this.activeRect.x+this.activeRect.width),this.activeRect.y+this.activeRect.height>p.y+p.height&&(this.activeRect.height=this.activeRect.height-(this.activeRect.y+this.activeRect.height-(p.y+p.height)),this.activeRect.y=p.y+p.height-this.activeRect.height,this.activeRect.ey=this.activeRect.y+this.activeRect.height)}}ne(this.activeRect);const u=this.activeRect.width/o,d=this.activeRect.height/l;this.store.active.forEach((f,m)=>{f.calculative.worldRect.x=this.activeInitPos[m].x*this.activeRect.width+this.activeRect.x,f.calculative.worldRect.y=this.activeInitPos[m].y*this.activeRect.height+this.activeRect.y,f.calculative.worldRect.width*=u,f.calculative.iconWidth&&(f.calculative.iconWidth*=u),f.calculative.worldRect.height*=d,f.calculative.iconHeight&&(f.calculative.iconHeight*=d),le(f.calculative.worldRect),ne(f.calculative.worldRect),this.updatePenRect(f,{worldRectIsReady:!0}),this.execPenResize(f,!0),this.updateLines(f)}),this.getSizeCPs(),this.initImageCanvas(this.store.active),this.initTemplateCanvas(this.store.active),this.render(),this.store.emitter.emit("resizePens",this.store.active),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.timer=void 0,this.pushHistory({type:_t.Update,pens:lt(this.store.active,!0),initPens:this.initPens}),this.initPens=void 0},200)}movePens(t){var o,l;if(!this.activeRect||this.store.data.locked)return;if(!this.initActiveRect){this.initActiveRect=lt(this.activeRect);return}if(!this.store.options.moveConnectedLine&&!this.canMoveLine&&this.store.active.length===1&&((o=this.store.active[0].anchors[0])!=null&&o.connectTo||(l=this.store.active[0].anchors[this.store.active[0].anchors.length-1])!=null&&l.connectTo)||(this.movingPens||(this.initMovingPens(),this.store.active.forEach(h=>{fs(h,!1)}),this.store.hover=void 0),!this.mouseDown))return;let i=t.x-this.mouseDown.x,r=t.y-this.mouseDown.y;t.shiftKey&&!t.ctrlKey&&(r=0),t.ctrlKey&&(i=0);const n=lt(this.initActiveRect);Pn(n,i,r);let a=!1;if(this.store.options.strictScope){const h=this.store.data.width||this.store.options.width,c=this.store.data.height||this.store.options.height;if(h&&c){let u={x:this.store.data.origin.x,y:this.store.data.origin.y,width:h*this.store.data.scale,height:c*this.store.data.scale};n.x<u.x&&(n.x=u.x,a=!0),n.y<u.y&&(n.y=u.y,a=!0),n.x+n.width>u.x+u.width&&(n.x=u.x+u.width-n.width,a=!0),n.y+n.height>u.y+u.height&&(n.y=u.y+u.height-n.height,a=!0)}}const s={x:n.x-this.activeRect.x,y:n.y-this.activeRect.y};if(!this.store.options.disableDock&&!a){this.clearDock();const h=this.customMoveDock||Uw;this.dock=h(this.store,n,this.movingPens,s);const{xDock:c,yDock:u}=this.dock;let d;c&&(s.x+=c.step,d=this.store.pens[c.penId],d.calculative.isDock=!0),u&&(s.y+=u.step,d=this.store.pens[u.penId],d.calculative.isDock=!0)}this.translatePens(this.movingPens,s.x,s.y,!0)}changeIdsByMoving(t,i){t.id+=Qe,t.parentId&&i.find(r=>r.id===t.parentId)&&(t.parentId+=Qe),t.children&&(t.children=t.children.map(r=>r+Qe)),t.connectedLines&&(t.connectedLines=t.connectedLines.map(r=>(i.find(n=>n.id===r.lineId)&&(r.lineId+=Qe),r))),t.type&&t.calculative.worldAnchors&&(t.calculative.worldAnchors=t.calculative.worldAnchors.map(r=>(r.connectTo&&i.find(n=>n.id===r.connectTo)&&(r.connectTo+=Qe),r)))}initMovingPens(){var r,n;if(!this.store.options.moveConnectedLine&&!this.canMoveLine)for(let a=0;a<this.store.active.length;a++){const s=this.store.active[a];((r=s.anchors[0])!=null&&r.connectTo||(n=s.anchors[s.anchors.length-1])!=null&&n.connectTo)&&(this.store.active.splice(a,1),s.calculative.active=void 0,--a)}this.movingPens=lt(this.store.active,!0),this.movingPens=this.getAllFollowersByPens(this.movingPens);const t=this.getAllByPens(this.movingPens),i=lt(t,!0);t.forEach(a=>{this.changeIdsByMoving(a,i),this.store.pens[a.id]=a,a.calculative.canvas=this;const s={globalAlpha:.5};a.lineWidth===0&&(s.lineWidth=1),(a.name.endsWith("Dom")||_p.includes(a.name)||this.store.options.domShapes.includes(a.name)||a.image)&&(s.name="rectangle",s.onDestroy=void 0),this.updateValue(a,s),a.calculative.image=void 0})}moveLineAnchor(t,i){var o,l,h,c,u;if(!this.activeRect||this.store.data.locked)return;if(this.initPens||(this.initPens=lt(this.store.active,!0)),(o=this.store.activeAnchor)!=null&&o.connectTo){const d=this.store.pens[this.store.activeAnchor.connectTo];ga(d,Sn(d,this.store.activeAnchor.anchorId),this.store.pens[this.store.activeAnchor.penId],this.store.activeAnchor)}let r=(l=this.store.activeAnchor)==null?void 0:l.id,n=(c=(h=this.store.pens[this.store.activeAnchor.penId])==null?void 0:h.connectedLines)==null?void 0:c.filter(d=>d.anchor===r);n&&n.length>0&&n.forEach(d=>{const f=this.store.pens[d.lineId];ga(this.store.pens[this.store.activeAnchor.penId],this.store.activeAnchor,f,Sn(f,d.lineAnchor))});const a=this.store.active[0];ge(a);const s=Gt(a);if(a.lineName==="polyline"&&!i.shiftKey)UT(a,this.store.activeAnchor,t);else{let d=0,f=0;if(a.lineName==="line"){let m=a.calculative.worldAnchors.findIndex(g=>g.id===this.store.activeAnchor.id);m===0&&(m=2);let p=a.calculative.worldAnchors[m-1];if(i.ctrlKey&&i.shiftKey){let g=lt(t);this.getSpecialAngle(g,p),d=g.x-this.store.activeAnchor.x,f=g.y-this.store.activeAnchor.y}else if(!i.ctrlKey&&i.shiftKey){let g={x:t.x,y:p.y};d=g.x-this.store.activeAnchor.x,f=g.y-this.store.activeAnchor.y}else if(i.ctrlKey&&!i.shiftKey){let g={x:p.x,y:t.y};d=g.x-this.store.activeAnchor.x,f=g.y-this.store.activeAnchor.y}else d=t.x-this.store.activeAnchor.x,f=t.y-this.store.activeAnchor.y}else!i.ctrlKey&&i.shiftKey?(d=t.x-this.store.activeAnchor.x,f=0):i.ctrlKey&&!i.shiftKey?(d=0,f=t.y-this.store.activeAnchor.y):(d=t.x-this.store.activeAnchor.x,f=t.y-this.store.activeAnchor.y);bs(this.store.activeAnchor,d,f),this.store.hover&&this.store.hoverAnchor&&this.store.hoverAnchor.penId!==this.store.activeAnchor.penId&&(this.store.hoverAnchor.type===Xi.Line?(d=t.x-this.store.activeAnchor.x,f=t.y-this.store.activeAnchor.y,Ro(this.store.activeAnchor,this.store.hoverAnchor,this.store)):(d=this.store.hoverAnchor.x-this.store.activeAnchor.x,f=this.store.hoverAnchor.y-this.store.activeAnchor.y),bs(this.store.activeAnchor,d,f),s.prev=void 0,a.lineName!=="polyline"&&((u=this[a.lineName])==null||u.call(this,this.store,a)))}this.patchFlagsLines.add(a),this.store.path2dMap.set(a,St.path2dDraws[a.name](a)),this.render(),this.store.active[0].calculative&&(this.store.active[0].calculative.gradientAnimatePath=void 0),this.store.emitter.emit("moveLineAnchor",{pen:this.store.active[0],anchor:this.store.activeAnchor}),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.timer=void 0,this.pushHistory({type:_t.Update,pens:lt(this.store.active,!0),initPens:this.initPens}),this.initPens=void 0},500)}moveLineAnchorPrev(t){if(!this.activeRect||this.store.data.locked||!this.store.activeAnchor)return;if(this.initPens||(this.initPens=lt(this.store.active,!0)),this.store.activeAnchor.prev.x=t.x,this.store.activeAnchor.prev.y=t.y,this.store.activeAnchor.next){if(!this.store.activeAnchor.prevNextType)this.store.activeAnchor.next.x=t.x,this.store.activeAnchor.next.y=t.y,Zt(this.store.activeAnchor.next,180,this.store.activeAnchor);else if(this.store.activeAnchor.prevNextType===jn.Bilateral&&this.prevAnchor){const r=vi(t,this.store.activeAnchor),n=vi(this.prevAnchor,this.store.activeAnchor);this.store.activeAnchor.next.x=this.nextAnchor.x,this.store.activeAnchor.next.y=this.nextAnchor.y,Zt(this.store.activeAnchor.next,r-n,this.store.activeAnchor)}}const i=this.store.active[0];this.patchFlagsLines.add(i),this.store.path2dMap.set(i,St.path2dDraws[i.name](i)),this.render(),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.timer=void 0,this.pushHistory({type:_t.Update,pens:lt(this.store.active,!0),initPens:this.initPens}),this.initPens=void 0},200)}moveLineAnchorNext(t){if(!this.activeRect||this.store.data.locked||!this.store.activeAnchor)return;if(this.initPens||(this.initPens=lt(this.store.active,!0)),this.store.activeAnchor.next.x=t.x,this.store.activeAnchor.next.y=t.y,this.store.activeAnchor.prev){if(!this.store.activeAnchor.prevNextType)this.store.activeAnchor.prev.x=t.x,this.store.activeAnchor.prev.y=t.y,Zt(this.store.activeAnchor.prev,180,this.store.activeAnchor);else if(this.store.activeAnchor.prevNextType===jn.Bilateral&&this.nextAnchor){const r=vi(t,this.store.activeAnchor),n=vi(this.nextAnchor,this.store.activeAnchor);this.store.activeAnchor.prev.x=this.prevAnchor.x,this.store.activeAnchor.prev.y=this.prevAnchor.y,Zt(this.store.activeAnchor.prev,r-n,this.store.activeAnchor)}}const i=this.store.active[0];this.patchFlagsLines.add(i),this.store.path2dMap.set(i,St.path2dDraws[i.name](i)),this.render(),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.timer=void 0,this.pushHistory({type:_t.Update,pens:lt(this.store.active,!0),initPens:this.initPens}),this.initPens=void 0},200)}async setAnchor(t){var n;const i=[lt(this.store.hover,!0)],r=this.store.hover;if(this.store.hoverAnchor){if(this.beforeRemoveAnchor&&!await this.beforeRemoveAnchor(r,this.store.hoverAnchor))return;r.type===$t.Line&&((n=r.calculative.worldAnchors)==null?void 0:n.length)<=2?this.delete([r]):(Aw(r,this.store.hoverAnchor),r.type===$t.Line&&this.initLineRect(r)),this.store.hoverAnchor=void 0,this.store.activeAnchor=void 0,this.externalElements.style.cursor="default"}else if(r){if(this.beforeAddAnchor&&!await this.beforeAddAnchor(r,this.store.pointAt))return;if(r.type===$t.Line){this.store.activeAnchor=Sw(r,this.store.pointAt,this.store.pointAtIndex),this.initLineRect(r);const a={x:t.x,y:t.y};this.getHover(a)}else{const a={id:Mt(),x:t.x,y:t.y};this.store.activeAnchor=_w(r,a)}}this.hotkeyType=Xt.None,this.render(),r&&this.pushHistory({type:_t.Update,pens:[lt(r,!0)],initPens:i})}checkDisconnect(t,i){if(t.id.indexOf(Qe)>0){const r=t.id;t=this.store.pens[r.replace(Qe,"")]}t.anchors.forEach(r=>{if(r.connectTo&&!i.find(n=>n.id===r.connectTo||n.id===r.connectTo+Qe)){const n=this.store.pens[r.connectTo];if(!n||n.type)return;ga(n,Sn(n,r.anchorId),t,r)}})}translatePens(t=this.store.active,i,r,n){if(!t||!t.length||t.some(l=>{if(l.locked>=jt.DisableMove)return!0}))return;const s=!n&&lt(t,!0);this.activeRect&&Pn(this.activeRect,i,r);const o=this.getAllByPens(t);t.forEach(l=>{var h,c;if(!(l.locked>=jt.DisableMove)){if(l.type===$t.Line){if(!this.store.options.moveConnectedLine&&!this.canMoveLine||l.isRuleLine)return;Qd(l,i,r),this.checkDisconnect(l,o),this.store.path2dMap.set(l,St.path2dDraws[l.name](l)),n||(this.initLineRect(l),(h=l.connectedLines)==null||h.forEach(u=>{const d=this.store.pens[u.lineId];this.initLineRect(d)}))}else Pn(l.calculative.worldRect,i,r),this.updatePenRect(l,{worldRectIsReady:!0}),l.calculative.x=l.x,l.calculative.y=l.y,l.calculative.initRect&&(l.calculative.initRect.x=l.calculative.x,l.calculative.initRect.y=l.calculative.y,l.calculative.initRect.ex=l.calculative.x+l.calculative.width,l.calculative.initRect.ey=l.calculative.y+l.calculative.height);this.updateLines(l),(c=l.onMove)==null||c.call(l,l)}}),this.activeRect&&this.getSizeCPs(),this.render(),this.tooltip.translate(i,r),n||(this.pushHistory({type:_t.Update,pens:lt(t,!0),initPens:s}),this.initImageCanvas(t),this.initTemplateCanvas(t),this.store.emitter.emit("translatePens",t)),this.store.emitter.emit("translatingPens",t)}templateTranslatePens(t=this.store.active,i,r){if(!t||!t.length)return;const n=this.getAllByPens(t);t.forEach(a=>{var s;if(a.type===$t.Line){if(!this.store.options.moveConnectedLine&&!this.canMoveLine)return;Qd(a,i,r),this.checkDisconnect(a,n),this.store.path2dMap.set(a,St.path2dDraws[a.name](a))}else Pn(a.calculative.worldRect,i,r),this.updatePenRect(a,{worldRectIsReady:!0}),a.calculative.x=a.x,a.calculative.y=a.y,a.calculative.initRect&&(a.calculative.initRect.x=a.calculative.x,a.calculative.initRect.y=a.calculative.y,a.calculative.initRect.ex=a.calculative.x+a.calculative.width,a.calculative.initRect.ey=a.calculative.y+a.calculative.height);(s=a.onMove)==null||s.call(a,a)})}calcAutoAnchor(t,i,r,n){const a=ge(t),s=Gt(t),o=ma(r,i===a?s:a);o&&(i.x=o.x,i.y=o.y,i.prev=void 0,i.next=void 0,n?n.anchor=o.id:Oe(r,o,t,i),this[t.lineName]&&this[t.lineName](this.store,t),this.store.path2dMap.set(t,St.path2dDraws.line(t)),this.initLineRect(t))}restoreNodeAnimate(t){var i,r;if(t.calculative.initRect){if(t.keepAnimateState)for(const n in t)t.calculative[n]!==void 0&&n!=="x"&&n!=="y"&&n!=="width"&&n!=="height"&&n!=="initRect"&&(typeof t[n]!="object"||n==="lineDash")&&(n==="fontSize"||n==="lineWidth"?t[n]=t.calculative[n]/t.calculative.canvas.store.data.scale:t[n]=t.calculative[n]);else{const n=t.calculative.initRect.rotate-t.calculative.rotate;for(const s in t)s!=="x"&&s!=="y"&&s!=="width"&&s!=="height"&&s!=="initRect"&&s!=="rotate"&&(typeof t[s]!="object"||s==="lineDash")&&(t.calculative[s]=t[s]);(i=t.children)!=null&&i.length?n&&qp(t,n,t.calculative.worldRect):t.calculative.rotate=t.rotate;const a=lt(this.store.animateMap.get(t));a&&(a.id=t.id,this.parent.setValue(a,{doEvent:!1,render:!0,history:!1})),t.calculative.worldRect=t.calculative.initRect}this.updatePenRect(t,{worldRectIsReady:!0}),this.updateLines(t),t.image&&t.name!=="gif"&&(this.canvasImage.init(),this.canvasImageBottom.init()),t.calculative.text!==t.text&&(t.calculative.text=t.text,to(t)),(r=this.store.active)!=null&&r.length&&this.calcActiveRect(),t.calculative.initRect=void 0}}updateLines(t,i){var r;(r=t.children)==null||r.forEach(n=>{const a=this.store.pens[n];a&&this.updateLines(a,i)}),t.connectedLines&&t.connectedLines.forEach((n,a)=>{const s=this.store.pens[n.lineId];if(!s||s.calculative.active)return;const o=Sn(s,n.lineAnchor);if(!o)return;if(!o.connectTo){t.connectedLines.splice(a,1);return}if(s.autoFrom){const d=ge(s);d.id===o.id&&this.calcAutoAnchor(s,d,t,n)}if(s.autoTo){const d=Gt(s);d.id===o.id&&this.calcAutoAnchor(s,d,t,n)}const l=Sn(t,n.anchor);if(!l)return;let h=t.rotate;t.flipX&&(h*=-1),t.flipY&&(h*=-1);let c=o.distance*this.store.data.scale*Math.cos((h+l.rotate)/180*Math.PI)||0,u=o.distance*this.store.data.scale*Math.sin((h+l.rotate)/180*Math.PI)||0;if(t.flipX&&(c=-c),t.flipY&&(u=-u),bs(o,l.x-o.x+c,l.y-o.y+u),this.store.options.autoPolyline&&!this.autoPolylineFlag&&s.autoPolyline!==!1&&s.lineName==="polyline"){let d=ge(s),f=Gt(s),m=!1;d.id===o.id?(d=o,m=!0):f.id===o.id&&(f=o,m=!0),m&&(s.calculative.worldAnchors=[d,f],s.calculative.activeAnchor=d,this.polyline(this.store,s,f),this.initLineRect(s))}this.store.path2dMap.set(s,St.path2dDraws[s.name](s)),this.patchFlagsLines.add(s),s.calculative.gradientSmooth&&(s.calculative.gradientAnimatePath=du(s)),i&&bl(s)})}calcActiveRect(){const t=this.store.active.filter(i=>(!i.locked||i.locked<jt.DisableMove)&&i.visible!=!1);if(t.length)t.length===1?(this.activeRect=lt(t[0].calculative.worldRect),this.activeRect.rotate=t[0].calculative.rotate||0,ne(this.activeRect)):(this.activeRect=Di(t),this.activeRect.rotate=0);else return;this.lastRotate=0,this.getSizeCPs()}rotatePen(t,i,r){t.rotateByRoot||(t.name==="line"?(t.calculative.worldAnchors.forEach(n=>{Zt(n,i,r.center)}),this.initLineRect(t),Jo(t)):(t.calculative.rotate?t.calculative.rotate+=i:t.calculative.rotate=i,Zt(t.calculative.worldRect.center,i,r.center),t.parentId?(t.calculative.worldRect.x=t.calculative.worldRect.center.x-t.calculative.worldRect.width/2,t.calculative.worldRect.y=t.calculative.worldRect.center.y-t.calculative.worldRect.height/2,t.x=(t.calculative.worldRect.x-r.x)/r.width,t.y=(t.calculative.worldRect.y-r.y)/r.height):(t.x=t.calculative.worldRect.center.x-t.width/2,t.y=t.calculative.worldRect.center.y-t.height/2),t.rotate=t.calculative.rotate,this.updatePenRect(t),t.children&&t.children.forEach(n=>{const a=this.store.pens[n];this.rotatePen(a,i,t.calculative.worldRect)})))}nextAnimate(t){if(!t)return;this.store.emitter.emit("animateEnd",t);let i;t.nextAnimate&&(i=this.store.data.pens.filter(r=>r.id===t.nextAnimate||r.tags&&r.tags.indexOf(t.nextAnimate)>-1)),i&&(i.forEach(r=>{var n,a,s,o,l;if(r.calculative.pause){const h=Date.now()-r.calculative.pause;r.calculative.pause=void 0,r.calculative.frameStart+=h,r.calculative.frameEnd+=h}else if(r.name==="video")r.calculative.media.currentTime=0,(n=r.calculative.media)==null||n.play(),(a=r.onStartVideo)==null||a.call(r,r);else if(r.type||(s=r.frames)!=null&&s.length||r.animations&&r.animations.length){if(r.type){if((l=r.animations)!=null&&l.length){const h=lt(r.animations[0]);delete h.name,h.currentAnimation=0,this.parent.setValue({id:r.id,...h},{doEvent:!1,history:!1})}}else{if(!r.frames&&r.animations&&r.animations.length){let h=(o=r.animations)==null?void 0:o.findIndex(d=>d.autoPlay),c=h===-1?0:h;const u=lt(r.animations[c]);delete u.name,u.currentAnimation=c,!r.type&&u.frames&&(u.showDuration=this.parent.calcAnimateDuration(u)),this.parent.setValue({id:r.id,...u},{doEvent:!1,history:!1})}this.store.animateMap.set(r,this.getFrameProps(r))}this.store.animates.add(r)}}),this.animate())}getFrameProps(t){let i={};return t.frames&&t.frames.forEach(r=>{for(let n in r)!["duration","x","y","width","height","rotate"].includes(n)&&!i[n]&&(i[n]=t[n])}),i}animate(){this.animateRendering||requestAnimationFrame(()=>{const t=Date.now();if(t-this.lastAnimateRender<this.store.options.animateInterval){this.store.animates.size>0&&this.animate();return}this.lastAnimateRender=t,this.animateRendering=!0;const i=[];let r=!1;for(const n of this.store.animates)if(!n.calculative.pause){if(n.calculative.active&&!n.type&&!this.movingPens&&(r=!0),!n.type)xw(n,t)?n.calculative.patchFlags&&(ne(n.calculative.worldRect),this.updatePenRect(n,{worldRectIsReady:!0,playingAnimate:!0})):(requestAnimationFrame(()=>{this.restoreNodeAnimate(n)}),i.push(n),this.nextAnimate(n)),this.updateLines(n,!0);else if(!kw(n,t)){if(n.keepAnimateState){for(const a in n)n.calculative[a]!==void 0&&a!=="length"&&(typeof n[a]!="object"||a==="lineDash")&&(a==="lineWidth"?n[a]=n.calculative[a]/n.calculative.canvas.store.data.scale:n[a]=n.calculative[a]);Jo(n)}else for(const a in n)(typeof n[a]!="object"||a==="lineDash")&&(a==="lineWidth"?n.calculative[a]=n[a]*n.calculative.canvas.store.data.scale:n.calculative[a]=n[a]);i.push(n),this.nextAnimate(n)}this.patchFlags=!0}r&&this.calcActiveRect(),i.forEach(n=>{this.store.animates.delete(n)}),this.render(!1),this.animateRendering=!1,this.animate()})}get clipboardName(){return"meta2d-clipboard"}async copy(t,i=!0){const r=Mt(),{origin:n,scale:a}=this.store.data;this.store.clipboard=void 0,localStorage.removeItem(this.clipboardName),sessionStorage.setItem("page",r);let s=this.getAllByPens(lt(t||this.store.active,!0));s.forEach(l=>{l.copyIndex=this.store.data.pens.findIndex(h=>h.id===l.id),l.pathId&&(l.path=this.store.data.paths[l.pathId])}),s.sort((l,h)=>l.copyIndex-h.copyIndex);const o={meta2d:!0,pens:s,origin:lt(n),scale:a,page:r,initRect:lt(this.activeRect),offset:10,mousePos:lt(this.mousePos)};if(navigator.clipboard&&!this.store.options.disableClipboard&&!navigator.userAgent.includes("Firefox"))try{await navigator.clipboard.writeText(JSON.stringify(o))}catch{localStorage.setItem(this.clipboardName,JSON.stringify(o))}else localStorage.setItem(this.clipboardName,JSON.stringify(o));i&&this.store.emitter.emit("copy",o.pens)}cut(t){this.copy(t,!1),this.delete(t),this.store.emitter.emit("cut",t)}async paste(){var l,h;let t,i;if(navigator.clipboard&&!this.store.options.disableClipboard&&!navigator.userAgent.includes("Firefox"))try{t=await((l=navigator.clipboard)==null?void 0:l.readText())}catch{t=localStorage.getItem(this.clipboardName)}else t=localStorage.getItem(this.clipboardName);if(t){try{i=JSON.parse(t)}catch(c){console.warn("剪切板数据不是json",c.message);return}if(!i||!i.meta2d)return}else return;if(this.beforeAddPens&&await this.beforeAddPens(i.pens)!=!0)return;let r,n;this.store.clipboard&&(r=this.store.clipboard.offset+10,n=this.store.clipboard.pos),this.store.clipboard=lt(i);const a=sessionStorage.getItem("page"),s=this.store.data.scale;if(this.store.clipboard.mousePos&&(Math.abs(this.store.clipboard.mousePos.x-this.mousePos.x)>100*s||Math.abs(this.store.clipboard.mousePos.y-this.mousePos.y)>100*s)){let c=-this.store.clipboard.initRect.width/this.store.clipboard.scale/10/s,u=-this.store.clipboard.initRect.height/this.store.clipboard.scale/10/s,d=(s-this.store.clipboard.scale)*this.store.clipboard.initRect.width/2+c,f=(s-this.store.clipboard.scale)*this.store.clipboard.initRect.height/2+u;s<this.store.clipboard.scale&&(d=(s-this.store.clipboard.scale)/((this.store.clipboard.scale-s)*100)*this.store.clipboard.initRect.width/2+c,f=(s-this.store.clipboard.scale)/((this.store.clipboard.scale-s)*100)*this.store.clipboard.initRect.height/2+u),this.store.clipboard.pens.length>1&&(d=(s-1)*this.store.clipboard.initRect.width/this.store.clipboard.scale/2,f=(s-1)*this.store.clipboard.initRect.height/this.store.clipboard.scale/2),this.store.clipboard.pos={x:this.mousePos.x-d,y:this.mousePos.y-f},this.store.clipboard.offset=0}else a!==i.page?(this.store.clipboard.pos={x:this.mousePos.x,y:this.mousePos.y},this.store.clipboard.offset=0):this.pasteOffset?(r&&(this.store.clipboard.offset=r),n&&(this.store.clipboard.pos=n)):(this.store.clipboard.offset=0,this.pasteOffset=!0);const o=this.store.clipboard.pens.filter(c=>!c.parentId);for(const c of o)this.pastePen(c,void 0);(h=this.keyOptions)!=null&&h.F||this.store.clipboard.pens.forEach(c=>{delete c.copyIndex}),sessionStorage.setItem("page",i.page),this.active(o),this.pushHistory({type:_t.Add,pens:this.store.clipboard.pens}),this.render(),this.store.emitter.emit("add",this.store.clipboard.pens),this.store.emitter.emit("paste",this.store.clipboard.pens)}getAllByPens(t){const i=[];for(const r of t)i.push(...lt(di(r,this.store),!0));return i.concat(t)}getAllFollowersByPens(t,i=!0){const r=t;for(const n of t){let a=hu(n,this.store);i&&(a=lt(a,!0));for(const s of a)r.find(o=>o.id===s.id)||r.push(s)}return r}setFollowers(t=this.store.active){if(t)if(t.length<2)t[0].followers=[];else{let i=t.map(n=>n.id);i.pop();const r=t[t.length-1];r.followers?i.forEach(n=>{r.followers.includes(n)||r.followers.push(n)}):r.followers=i}}changeLineAnchors(t,i,r){if(Array.isArray(i.connectedLines))for(let n=0;n<i.connectedLines.length;n++){const{lineId:a}=i.connectedLines[n],s=r.find(o=>o.id===a);if(s){const o=s.anchors[0],l=s.anchors[s.anchors.length-1];o.connectTo===t&&(o.connectTo=i.id),l.connectTo===t&&(l.connectTo=i.id)}else i.connectedLines.splice(n,1),n--}}changeNodeConnectedLine(t,i,r){var o;const n=i.anchors[0],a=i.anchors[i.anchors.length-1],s=[n,a];for(const l of s){const h=l.connectTo;if(h){const c=r.find(u=>u.id===h);c?(o=c.connectedLines)==null||o.forEach(u=>{u.lineId===t&&(u.lineId=i.id,u.lineAnchor=l.id)}):(l.connectTo=void 0,l.prev&&(l.prev.connectTo=void 0),l.next&&(l.next.connectTo=void 0))}}}async delete(t=this.store.active,i=!1,r=!0){if(!t||!t.length||this.beforeRemovePens&&await this.beforeRemovePens(t)!=!0||(i||(t=t.filter(a=>!a.locked)),!t||!t.length))return;const n=[];if(this._del(t,n,i),this.initImageCanvas(n),this.initTemplateCanvas(n),this.inactive(),this.clearHover(),this.render(),r){if(n.length===0)return;this.pushHistory({type:_t.Delete,pens:n})}this.store.emitter.emit("delete",t)}deleteSync(t=this.store.active,i=!1,r=!0){if(!t||!t.length||(i||(t=t.filter(a=>!a.locked)),!t||!t.length))return;const n=[];if(this._del(t,n,i),this.initImageCanvas(n),this.initTemplateCanvas(n),this.inactive(),this.clearHover(),this.render(),r){if(n.length===0)return;this.pushHistory({type:_t.Delete,pens:n})}this.store.emitter.emit("delete",t)}_del(t,i,r){t&&t.forEach(n=>{if(n.type&&(n.lastConnected={}),n.parentId)if(this.getLockedParent(n)){console.warn("父节点锁定");return}else{const s=Ge(n),o=s.children.indexOf(n.id);s.children.splice(o,1),i&&this.getDelPens(n,i),this.delForce(n)}else{if(!r&&n.locked)return;i&&this.getDelPens(n,i),this.delForce(n)}})}getDelPens(t,i){if(!t)return;if(this.store.data.pens.findIndex(n=>n.id===t.id)>-1){const n=this.store.pens[t.id];n&&n.calculative&&(n.calculative.active=void 0),n.pathId&&(n.path=this.store.data.paths[t.pathId]),i.push(n)}t.children&&t.children.forEach(n=>{this.getDelPens(this.store.pens[n],i)})}getLockedParent(t){if(!t.parentId)return!1;const i=Ge(t);if(i.locked)return i;this.getLockedParent(i)}delForce(t){var r;if(!t)return;const i=this.store.data.pens.findIndex(n=>n.id===t.id);i>-1&&(this.delConnectedLines(this.store.data.pens[i]),this.store.data.pens.splice(i,1),this.store.pens[t.id]=void 0,delete this.store.pens[t.id],t.pathId&&(this.store.data.pens.some(a=>a.pathId===t.pathId)||delete this.store.data.paths[t.pathId])),this.store.animates.delete(t),this.store.animateMap.delete(t),t.children&&t.children.forEach(n=>{this.delForce(this.store.pens[n])}),(r=t.onDestroy)==null||r.call(t,t)}delConnectedLines(t){var i;if(t.connectedLines)for(let r=0;r<t.connectedLines.length;r++){const{lineId:n,lineAnchor:a}=t.connectedLines[r],s=this.store.pens[n];if(s){let o=s.anchors.find(l=>l.id===a);(o==null?void 0:o.connectTo)===t.id&&(o.connectTo=void 0,o.anchorId=void 0,o.prev&&(o.prev.connectTo=void 0),o.next&&(o.next.connectTo=void 0)),o=Sn(s,a),o&&(o.connectTo=void 0,o.anchorId=void 0,o.prev&&(o.prev.connectTo=void 0),o.next&&(o.next.connectTo=void 0))}}t.type&&((i=t.calculative.worldAnchors)==null||i.forEach((r,n)=>{var s;if(!r.connectTo)return;const a=this.store.pens[r.connectTo];a&&((s=a.calculative.worldAnchors)==null||s.forEach(o=>{ga(a,o,t,r)}))}))}convertSpecialCharacter(t){var i={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return t.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(r,n){return i[n]})}createInput(){this.inputParent.classList.add("meta2d-input"),this.inputDiv.classList.add("input-div"),this.inputParent.appendChild(this.inputDiv),this.dropdown.onmouseleave=()=>{this.store.hover=null},this.inputParent.appendChild(this.dropdown),this.externalElements.appendChild(this.inputParent),this.inputParent.onmousedown=this.stopPropagation,this.inputDiv.onmousedown=this.stopPropagation,this.inputDiv.contentEditable="false",this.dropdown.onmousedown=this.stopPropagation;let t;for(let i=0;i<document.styleSheets.length;i++)document.styleSheets[i].title==="le5le.com"&&(t=document.styleSheets[i]);if(!t){const i=document.createElement("style");i.title="le5le.com",document.head.appendChild(i),t=i.sheet,t.insertRule(".meta2d-input{display:none;position:absolute;outline:none;align-items: center;}"),t.insertRule(".meta2d-input textarea{resize:none;border:none;outline:none;background:transparent;flex-grow:1;height:100%;left:0;top:0}"),t.insertRule(".meta2d-input .right{width:10px;height:10px;flex-shrink:0;border-top: 1px solid;border-right: 1px solid;margin-right: 5px;transition: all .3s cubic-bezier(.645,.045,.355,1);position:absolute;right:1px;}"),t.insertRule(".meta2d-input ul{position:absolute;top:100%;margin-top:4px; width:calc(100% + 10px);min-height:30px;border-radius: 2px;box-shadow: 0 2px 8px #00000026;list-style-type: none;background-color: #fff;padding: 4px 0;max-height: 105px;overflow-y: auto;}"),t.insertRule(".meta2d-input ul li{padding: 5px 12px;line-height: 22px;white-space: nowrap;cursor: pointer;}"),t.insertRule(".meta2d-input ul li:hover{background: #eeeeee;}"),t.insertRule(".input-div::-webkit-scrollbar {display:none}"),t.insertRule(".input-div{scrollbar-width: none;}"),t.insertRule(".meta2d-input .input-div{resize:none;border:none;outline:none;background:transparent;flex-grow:1;height:100%;width: 100%;left:0;top:0;display:flex;text-align: center;justify-content: center;flex-direction: column;}"),t.insertRule(".input-div div{}")}this.inputDiv.onfocus=i=>{if(navigator.userAgent.includes("Firefox")){if(!i.target.innerText){let r=this.inputDiv.offsetWidth/2;window.getComputedStyle(this.inputDiv,null).textAlign!=="center"&&(r=0),this.inputDiv.innerHTML=`<br style="margin-left:${r}px;margin-top:4px;" />`}}else if(i.target.innerText)this.inputDiv.style.paddingTop="";else{let r=window.getComputedStyle(this.inputDiv,null);r.justifyContent==="center"&&(this.inputDiv.style.paddingTop=` ${this.inputDiv.offsetHeight/2-parseFloat(r.lineHeight)/2}px`)}},this.inputDiv.onblur=()=>{setTimeout(()=>{this.hideInput()},300)},this.inputDiv.oninput=i=>{const r=this.store.pens[this.inputDiv.dataset.penId];if(r&&r.inputType==="number"){const n=i.target.innerText,a=n.replace(/[^0-9]/g,"");n!==a&&(i.preventDefault(),i.target.innerText=a)}if(navigator.userAgent.includes("Firefox")){if(!i.target.innerText.trim()){let n=this.inputDiv.offsetWidth/2;window.getComputedStyle(this.inputDiv,null).textAlign!=="center"&&(n=0),this.inputDiv.innerHTML=`<br style="margin-left:${n}px;margin-top:4px;" />`}}else if(i.target.innerText)this.inputDiv.style.paddingTop="";else{let n=window.getComputedStyle(this.inputDiv,null);n.justifyContent==="center"&&(this.inputDiv.style.paddingTop=` ${this.inputDiv.offsetHeight/2-parseFloat(n.lineHeight)/2}px`)}this.store.emitter.emit("input",r)},this.inputDiv.onclick=i=>{i.stopPropagation();const r=this.store.pens[this.inputDiv.dataset.penId];this.dropdown.style.display==="block"?this.dropdown.style.display="none":r!=null&&r.dropdownList&&this.store.data.locked&&(this.dropdown.style.display="block"),this.store.emitter.emit("clickInput",r)},this.inputDiv.onkeyup=i=>{this.setDropdownList(!0);const r=this.store.pens[this.inputDiv.dataset.penId];this.store.emitter.emit("input",{pen:r,text:i.key}),i.stopPropagation()},this.inputDiv.onkeydown=i=>{i.stopPropagation()},this.inputDiv.onmousedown=this.stopPropagation,this.inputDiv.onwheel=i=>{i.stopPropagation()},this.inputDiv.onpaste=i=>{i.preventDefault();let r="";i.clipboardData&&i.clipboardData.getData&&(r=i.clipboardData.getData("text/plain")),document.execCommand("insertHTML",!1,r)}}clearDropdownList(){if(this.dropdown.hasChildNodes())for(let t=0;t<this.dropdown.childNodes.length;t++)this.dropdown.childNodes[t].remove(),--t}dropdownAppendOption(t,i){const r=document.createElement("li");r.onwheel=this.stopPropagation,r.innerText=t,r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.title=t,r.style.zoom=this.store.data.scale,r.onmousedown=this.stopPropagation,r.dataset.i=i+"",r.onclick=this.selectDropdown;const n=this.store.pens[this.inputDiv.dataset.penId];r.onmouseenter=()=>{r.style.background=n.dropdownHoverBackground||this.store.styles.activeBg||"#eee",r.style.color=n.dropdownHoverColor||"#bdc7db"},r.onmouseleave=()=>{r.style.background=n.dropdownBackground||this.store.styles.popContentBg||"#fff",r.style.color=n.dropdownColor||"#bdc7db"},this.dropdown.appendChild(r)}find(t){return this.store.data.pens.filter(i=>i.id==t||i.tags&&i.tags.indexOf(t)>-1)}findOne(t){return this.store.data.pens.find(i=>i.id==t||i.tags&&i.tags.indexOf(t)>-1)}changePenId(t,i){var n,a,s,o,l,h,c;if(t===i)return;const r=this.store.pens[t];if(r&&!this.store.pens[i]){if(r.id=i,this.store.pens[i]=this.store.pens[t],(n=r.onChangeId)==null||n.call(r,r,t,i),delete this.store.pens[t],r.parentId){const u=this.store.pens[r.parentId],d=(a=u.children)==null?void 0:a.findIndex(f=>f===t);d!==-1&&((s=u.children)==null||s.splice(d,1,i))}(o=r.children)==null||o.forEach(u=>{const d=this.store.pens[u];d.parentId=i}),r.formId&&r.followers.forEach(u=>{const d=this.store.pens[u];d.formId=i}),r.type===$t.Line?this.changeNodeConnectedLine(t,r,this.store.data.pens):(this.changeLineAnchors(t,r,this.store.data.pens),(l=r.connectedLines)==null||l.forEach(({lineId:u})=>{const d=this.store.pens[u];Ia(d)})),(h=r.anchors)==null||h.forEach(u=>u.penId=i),(c=r.calculative.worldAnchors)==null||c.forEach(u=>u.penId=i)}}updateValue(t,i){var m,p;const r=this.getPenRect(t),n=t.name;Object.assign(t,i);const a=n!==t.name;i.newId&&this.changePenId(t.id,i.newId);let s=!1,o=!1,l=!1,h=!1,c=!1,u=!1,d,f=!1;for(const g in i)g.indexOf(".")===-1?(g==="rotate"?t.disableRotate?t.rotate=t.calculative.rotate||0:d=t.calculative.rotate||0:g==="canvasLayer"||g==="isBottom"||g==="showChild"?u=!0:g==="image"&&(f=!0),(typeof t[g]!="object"||g==="lineDash")&&(!t.disableRotate||g!=="rotate")&&(t.calculative[g]=i[g]),kb.includes(g)&&(o=!0),["name","borderRadius","lineSmooth","close"].includes(g)&&(s=!0),Ib.includes(g)&&(c=!0),Cb.includes(g)&&(l=!0),Db.includes(g)&&(h=!0),t.image&&t.name!=="gif"&&Ep.includes(g)&&(f=!0)):(delete t[g],ml(t,g,i[g])),g.split(".")[0]==="anchors"&&Ia(t);if(this.setCalculativeByScale(t),a&&((m=t.onDestroy)==null||m.call(t,t),Ob(t)),c){const g={x:i.x??r.x,y:i.y??r.y,width:i.width??r.width,height:i.height??r.height};this.setPenRect(t,g,!1),this.updateLines(t,!0),this.store.active&&this.store.active.length&&t.id===this.store.active[0].id&&this.calcActiveRect()}else l?this.updatePenRect(t):(!t.hiddenText&&o&&Ji(t),h&&Xd(this.store.pens,t),s&&St.path2dDraws[t.name]&&this.store.path2dMap.set(t,St.path2dDraws[t.name](t)));if(d!==void 0){const g=t.calculative.rotate;t.calculative.rotate=d,this.rotatePen(t,g-d,t.calculative.worldRect)}(i.image||i.backgroundImage||i.strokeImage)&&(t.calculative.image=void 0,t.calculative.backgroundImage=void 0,t.calculative.strokeImage=void 0,this.loadImage(t)),i.lineGradientColors&&(t.calculative.lineGradient=void 0,t.calculative.gradientColorStop=void 0),i.gradientColors&&(t.calculative.gradient=void 0,t.calculative.radialGradient=void 0),i.gradientRadius&&(t.calculative.gradient=void 0,t.calculative.radialGradient=void 0),i.animateLineWidth&&(t.calculative.gradientAnimatePath=void 0),i.gradientSmooth&&(t.calculative.gradientAnimatePath=void 0),u?(this.canvasImage.init(),this.canvasImageBottom.init()):f&&(t.canvasLayer===void 0&&(t.canvasLayer=Ht.CanvasImageBottom,t.calculative.canvasLayer=Ht.CanvasImageBottom),t.canvasLayer===Ht.CanvasImageBottom?this.canvasImageBottom.init():t.canvasLayer===Ht.CanvasImage&&this.canvasImage.init()),(i.canvasLayer!==void 0||t.canvasLayer===Ht.CanvasTemplate)&&this.initTemplateCanvas([t]),i.zIndex!==void 0&&(p=t.calculative.singleton)!=null&&p.div&&Se(t,t.calculative.singleton.div)}execPenResize(t,i){var r,n;(r=t.onResize)==null||r.call(t,t,i),(n=t.children)==null||n.forEach(a=>{const s=this.store.pens[a];s&&this.execPenResize(s,i)})}setPenRect(t,i,r=!0){if(t.parentId)Object.assign(t,i);else{const{origin:n,scale:a}=this.store.data;t.x=n.x+i.x*a,t.y=n.y+i.y*a,t.width=i.width*a,t.height=i.height*a}this.updatePenRect(t),this.execPenResize(t,!0),r&&this.render()}getPenRect(t,i=this.store.data.origin,r=this.store.data.scale){if(t)return t.parentId?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:(t.x-i.x)/r,y:(t.y-i.y)/r,width:t.width/r,height:t.height/r}}toPng(t=2,i,r=!1,n){const a=Di(this.store.data.pens),s=this.store.data.scale;if(!isFinite(a.width))throw new Error("can not to png, because width is not finite");const o=lt(a),l=this.store.data,h=r&&this.store.bkImg;let c=!1,u=!1;if(h){if(a.x+=l.x,a.y+=l.y,le(a),Dr(a,this.canvasRect,!0))Object.assign(a,this.canvasRect);else{const I=eo([...Pr(a),...Pr(this.canvasRect)]);Object.assign(a,I)}c=a.x===0,u=a.y===0}const d=this.store.data.width||this.store.options.width,f=this.store.data.height||this.store.options.height;let m=!1;d&&f&&!this.store.data.component&&(m=!0),m&&(a.x=this.store.data.origin.x,a.y=this.store.data.origin.y,a.width=d*this.store.data.scale,a.height=f*this.store.data.scale);const p=lt(a),g=Rr(t);a.x-=g[3]*s,a.y-=g[0]*s,a.width+=(g[3]+g[1])*s,a.height+=(g[0]+g[2])*s;const y=(n||1920)/a.width;a.width*=y,a.height*=y,le(a);const T=document.createElement("canvas");if(T.width=a.width,T.height=a.height,T.width>32767||T.height>32767||!navigator.userAgent.includes("Firefox")&&T.height*T.width>268435456||navigator.userAgent.includes("Firefox")&&T.height*T.width>472907776)throw new Error("can not to png, because the size exceeds the browser limit");const b=T.getContext("2d");b.textBaseline="middle",b.scale(y,y);const S=this.store.options.downloadBgTransparent?void 0:this.store.data.background||this.store.styles.background;if(S&&m&&(b.save(),b.fillStyle=S,b.fillRect(0,0,p.width+(g[1]+g[3])*s,p.height+(g[0]+g[2])*s),b.restore()),h)if(m)b.drawImage(this.store.bkImg,g[3]*s||0,g[0]*s||0,p.width,p.height);else{const I=a.x<0?-a.x:0,D=a.y<0?-a.y:0;b.drawImage(this.store.bkImg,I,D,this.canvasRect.width,this.canvasRect.height)}if(S&&!m)if(h){const I=a.x<0?-a.x:0,D=a.y<0?-a.y:0;b.save(),b.fillStyle=S,b.fillRect(I,D,this.canvasRect.width,this.canvasRect.height),b.restore()}else b.save(),b.fillStyle=S,b.fillRect(0,0,o.width+(g[3]+g[1])*s,o.height+(g[0]+g[2])*s),b.restore();h?m?b.translate(-a.x,-a.y):b.translate((c?l.x:-o.x)+g[3]*s||0,(u?l.y:-o.y)+g[0]*s||0):b.translate(-a.x,-a.y);for(const I of this.store.data.pens){if(!vl(I,this.store)||I.visible==!1)continue;const{active:D}=I.calculative;I.calculative.active=!1,I.calculative.img?pl(b,I):_n(b,I,!0),I.calculative.active=D}if(i){T.toBlob(i);return}return T.toDataURL()}activeToPng(t=2,i){return this.pensToPng(this.store.active,t,i)}pensToPng(t=this.store.active,i=2,r){if(t.length===0)return;const n=this.getAllByPens(t);let a=n.map(f=>f.id);const s=Di(n);if(!isFinite(s.width))throw new Error("can not to png, because width is not finite");const o=lt(s),l=Rr(i);s.x-=l[3],s.y-=l[0],s.width+=l[3]+l[1],s.height+=l[0]+l[2],le(s);const h=(r||s.width)/s.width;s.width*=h,s.height*=h;const c=document.createElement("canvas");if(c.width=s.width,c.height=s.height,c.width>32767||c.height>32767||!navigator.userAgent.includes("Firefox")&&c.height*c.width>268435456||navigator.userAgent.includes("Firefox")&&c.height*c.width>472907776)throw new Error("can not to png, because the size exceeds the browser limit");const u=c.getContext("2d");u.textBaseline="middle",u.scale(h,h);const d=this.store.options.downloadBgTransparent?void 0:this.store.data.background||this.store.styles.background;d&&(u.save(),u.fillStyle=d,u.fillRect(0,0,o.width+(l[3]+l[1]),o.height+(l[0]+l[2])),u.restore()),u.translate(-o.x+l[3],-o.y+l[0]);for(const f of this.store.data.pens)if(a.includes(f.id)){if(!vl(f,this.store)||f.visible==!1)continue;const{active:m}=f.calculative;f.calculative.active=!1,f.calculative.img?pl(u,f):_n(u,f),f.calculative.active=m}return c.toDataURL()}toggleAnchorMode(){var t;if(this.hotkeyType)this.hotkeyType===Xt.AddAnchor&&(this.hotkeyType=Xt.None,this.store.hoverAnchor?this.externalElements.style.cursor="vertical-text":this.store.hover&&(this.externalElements.style.cursor="move"));else{if(this.store.options.disableAnchor||(t=this.store.hover)!=null&&t.disableAnchor)return;this.hotkeyType=Xt.AddAnchor,this.store.hover&&(this.externalElements.style.cursor="pointer")}this.patchFlags=!0}addAnchorHand(){if(this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){const t=[lt(this.store.active[0],!0)];this.store.activeAnchor.prev?this.store.activeAnchor.next||(this.store.activeAnchor.next={...this.store.activeAnchor.prev},Zt(this.store.activeAnchor.next,180,this.store.activeAnchor),this.initLineRect(this.store.active[0]),this.patchFlags=!0):(this.store.activeAnchor.next||(this.store.activeAnchor.next={penId:this.store.activeAnchor.penId,x:this.store.activeAnchor.x+50,y:this.store.activeAnchor.y}),this.store.activeAnchor.prev={...this.store.activeAnchor.next},Zt(this.store.activeAnchor.prev,180,this.store.activeAnchor),this.initLineRect(this.store.active[0]),this.patchFlags=!0),this.pushHistory({type:_t.Update,pens:[lt(this.store.active[0],!0)],initPens:t})}}removeAnchorHand(){if(this.store.activeAnchor&&this.store.active&&this.store.active.length===1&&this.store.active[0].type){const t=[lt(this.store.active[0],!0)];this.hoverType===Et.LineAnchorPrev?(this.store.activeAnchor.prev=void 0,this.initLineRect(this.store.active[0]),this.patchFlags=!0):this.hoverType===Et.LineAnchorNext?(this.store.activeAnchor.next=void 0,this.initLineRect(this.store.active[0]),this.patchFlags=!0):(this.store.activeAnchor.prev=void 0,this.store.activeAnchor.next=void 0,this.initLineRect(this.store.active[0]),this.patchFlags=!0),this.pushHistory({type:_t.Update,pens:[lt(this.store.active[0])],initPens:t})}}toggleAnchorHand(){this.store.active.length===1&&this.store.active[0].type&&this.store.activeAnchor&&(this.store.activeAnchor.prevNextType||(this.store.activeAnchor.prevNextType=jn.Mirror),this.store.activeAnchor.prevNextType=(this.store.activeAnchor.prevNextType+1)%3)}gotoView(t,i){let r=Di(this.store.data.pens);if(!isFinite(r.width))throw new Error("can not move view, because width is not finite");const n=this.store.data.width||this.store.options.width,a=this.store.data.height||this.store.options.height;n&&a&&(r={x:this.store.data.origin.x,y:this.store.data.origin.y,width:n*this.store.data.scale,height:a*this.store.data.scale}),this.store.data.x=this.canvas.clientWidth/2-t*r.width-r.x,this.store.data.y=this.canvas.clientHeight/2-i*r.height-r.y,this.onMovePens(),this.canvasTemplate.init(),this.canvasImage.init(),this.canvasImageBottom.init(),this.render()}showMagnifier(){this.magnifierCanvas.canvas.style.zIndex="100",this.externalElements.style.zIndex="101",this.magnifierCanvas.magnifier=!0,this.magnifierCanvas.updateDomOffscreen(),this.externalElements.style.cursor="default",this.render()}hideMagnifier(){this.magnifierCanvas.canvas.style.zIndex="5",this.externalElements.style.zIndex="5",this.magnifierCanvas.magnifier=!1,this.externalElements.style.cursor="default",this.magnifierCanvas.render(),this.render()}showFit(){this.store.data.locked=0,this.canvasImage.fitFlag=!0,this.canvasImage.activeFit=void 0,this.canvasImage.currentFit=void 0,this.store.data.fits||(this.store.data.fits=[]),this.store.data.fits.forEach(t=>t.active=!1),this.canvasImage.init(),this.canvasImage.render()}hideFit(){this.canvasImage.fitFlag=!1,this.canvasImage.activeFit=void 0,this.canvasImage.currentFit=void 0,this.canvasImage.init(),this.canvasImage.render()}makeFit(){if(this.dragRect.width<100&&this.dragRect.height<100)return;const t=this.store.data.pens.filter(h=>{if(h.parentId||h.isRuleLine)return!1;if(Dr(h.calculative.worldRect,this.dragRect,!0))return h.type===$t.Line&&!this.store.options.dragAllIn?Wc(h,this.dragRect):!0});if(!t.length)return;const i=this.parent.getRect(t),r=this.store.data.scale,n=this.store.data.width||this.store.options.width,a=this.store.data.height||this.store.options.height;let s=(Math.floor(i.x)-this.store.data.origin.x)/r/n,o=(Math.floor(i.y)-this.store.data.origin.y)/r/a,l={x:s,y:o,width:(Math.ceil(i.width)+1)/r/n,height:(Math.ceil(i.height)+1)/r/a,children:t.map(h=>h.id),id:Mt(),active:!0};l.x<-.1&&(l.x=-.1),l.y<-.1&&(l.y=-.1),l.width>.5?(l.left=!0,l.right=!0,l.leftValue=l.x,l.rightValue=1-(l.x+l.width)):l.x<.5?(l.left=!0,l.leftValue=l.x,l.x>.2&&l.x+l.width>.5&&(l.right=!0,l.rightValue=1-(l.x+l.width))):(l.right=!0,l.rightValue=1-(l.x+l.width)),l.leftValue<.05&&(l.leftValue=0),l.rightValue<.05&&(l.rightValue=0),l.height>.5?(l.top=!0,l.bottom=!0,l.topValue=l.y,l.bottomValue=1-(l.y+l.height)):l.y<.5?(l.top=!0,l.topValue=l.y):(l.bottom=!0,l.bottomValue=1-(l.y+l.height)),l.topValue<.05&&(l.topValue=0),l.bottomValue<.05&&(l.bottomValue=0),this.store.data.fits||(this.store.data.fits=[]),this.store.data.fits.forEach(h=>{h.active=!1}),this.store.data.fits.push(l),this.canvasImage.activeFit=l,this.store.emitter.emit("fit",l),this.canvasImage.init(),this.canvasImage.render()}updateFit(t){const i=this.store.data.scale,r=this.store.data.width||this.store.options.width,n=this.store.data.height||this.store.options.height;let a=(t.x-this.store.data.origin.x)/i/r,s=(t.y-this.store.data.origin.y)/i/n;if(this.canvasImage.currentFit){const o=this.canvasImage.activeFit;if(this.canvasImage.currentFit==="top"){s<-.1&&(s=-.1);let c=s-o.y;if(o.height-=c,o.height<.01){o.height=.01;return}o.y=s}if(this.canvasImage.currentFit==="bottom"&&(s>1.1&&(s=1.1),o.height=s-o.y,o.height<=.01&&(o.height=.01)),this.canvasImage.currentFit==="left"){a<-.1&&(a=-.1);let c=a-o.x;if(o.width-=c,o.width<.01){o.width=.01;return}o.x=a}this.canvasImage.currentFit==="right"&&(a>1.1&&(a=1.1),o.width=a-o.x,o.width<=.01&&(o.width=.01));let l={x:o.x*r*i+this.store.data.origin.x,y:o.y*n*i+this.store.data.origin.y,width:o.width*r*i,height:o.height*n*i};le(l);const h=this.store.data.pens.filter(c=>{if(c.parentId||c.isRuleLine)return!1;if(Dr(c.calculative.worldRect,l,!0))return c.type===$t.Line&&!this.store.options.dragAllIn?Wc(c,l):!0});o.left=void 0,o.leftValue=void 0,o.right=void 0,o.rightValue=void 0,o.top=void 0,o.topValue=void 0,o.bottom=void 0,o.bottomValue=void 0,o.width>.5?(o.left=!0,o.right=!0,o.leftValue=o.x,o.rightValue=1-(o.x+o.width)):o.x<.5?(o.left=!0,o.leftValue=o.x,o.x>.2&&o.x+o.width>.5&&(o.right=!0,o.rightValue=1-(o.x+o.width))):(o.right=!0,o.rightValue=1-(o.x+o.width)),Math.abs(o.leftValue)<.05&&(o.leftValue=0),Math.abs(o.rightValue)<.05&&(o.rightValue=0),o.height>.5?(o.top=!0,o.bottom=!0,o.topValue=o.y,o.bottomValue=1-(o.y+o.height)):o.y<.5?(o.top=!0,o.topValue=o.y-0):(o.bottom=!0,o.bottomValue=1-(o.y+o.height)),Math.abs(o.topValue)<.05&&(o.topValue=0),Math.abs(o.bottomValue)<.05&&(o.bottomValue=0),o.children=h.map(c=>c.id),this.store.emitter.emit("fit",o),this.mouseDown.x=t.x,this.mouseDown.y=t.y,this.canvasImage.init(),this.canvasImage.render()}}updateFitRect(t=this.canvasImage.activeFit){const i=this.store.data.width||this.store.options.width,r=this.store.data.height||this.store.options.height;t.left&&(t.leftValue?t.x=Math.abs(t.leftValue)<1?t.leftValue:t.leftValue/i:t.x=0),t.right&&(t.rightValue?t.width=1-(Math.abs(t.rightValue)<1?t.rightValue:t.rightValue/i)-t.x:t.width=1-t.x),t.top&&(t.topValue?t.y=Math.abs(t.topValue)<1?t.topValue:t.topValue/r:t.y=0),t.bottom&&(t.bottomValue?t.height=1-(Math.abs(t.bottomValue)<1?t.bottomValue:t.bottomValue/r)-t.y:t.height=1-t.y),this.canvasImage.init(),this.canvasImage.render()}deleteFit(t=this.canvasImage.activeFit){if(!t)return;const i=this.store.data.fits.findIndex(r=>r.id===t.id);this.store.data.fits.splice(i,1),this.canvasImage.activeFit=void 0,this.canvasImage.init(),this.canvasImage.render(),this.store.emitter.emit("fit",void 0)}calcuActiveFit(){var o;const t=this.store.data.width||this.store.options.width,i=this.store.data.height||this.store.options.height;let r=(this.mouseDown.x-this.store.data.origin.x)/this.store.data.scale/t,n=(this.mouseDown.y-this.store.data.origin.y)/this.store.data.scale/i,a=-1,s=-1;(o=this.store.data.fits)==null||o.forEach((l,h)=>{l.ex=null,l.ey=null,yr({x:r,y:n},l)&&(a=h),l.active&&(s=h)}),a!==-1&&a!==s?(this.canvasImage.activeFit=this.store.data.fits[a],this.store.data.fits[a].active=!0,s!==-1&&(this.store.data.fits[s].active=!1),this.store.emitter.emit("fit",this.store.data.fits[a])):a===-1&&s!==-1&&(this.store.data.fits[s].active=!1,this.store.emitter.emit("fit",void 0),this.canvasImage.activeFit=null),this.inactive(),this.canvasImage.init(),this.canvasImage.render()}toggleMagnifier(){this.magnifierCanvas.magnifier=!this.magnifierCanvas.magnifier,this.magnifierCanvas.magnifier&&(this.externalElements.style.cursor="default"),this.magnifierCanvas.render(),this.render()}destroy(){var t,i,r,n;switch(this.scroll&&this.scroll.destroy(),(t=this.tooltip)==null||t.destroy(),(i=this.dialog)==null||i.destroy(),(r=this.title)==null||r.destroy(),(n=this.popconfirm)==null||n.destroy(),this.externalElements.removeEventListener("gesturestart",this.onGesturestart),this.externalElements.ondragover=a=>a.preventDefault(),this.externalElements.ondrop=void 0,this.externalElements.ontouchstart=void 0,this.externalElements.ontouchmove=void 0,this.externalElements.ontouchend=void 0,this.externalElements.onmousedown=void 0,this.externalElements.onmousemove=void 0,this.externalElements.onmouseup=void 0,this.externalElements.onmouseleave=void 0,this.externalElements.ondblclick=void 0,this.store.options.keydown){case Mn.Document:document.removeEventListener("keydown",this.onkeydown),document.removeEventListener("keyup",this.onkeyup);break;case Mn.Canvas:this.externalElements.removeEventListener("keydown",this.onkeydown),this.externalElements.removeEventListener("keyup",this.onkeyup);break}document.removeEventListener("copy",this.onCopy),document.removeEventListener("cut",this.onCut),document.removeEventListener("paste",this.onPaste),window&&window.removeEventListener("message",this.onMessage),window&&window.removeEventListener("resize",this.onResize),window&&window.removeEventListener("scroll",this.onScroll),this.parentElement.innerHTML=""}}function sE(e,t){const i=t||new Path2D;e.onDestroy||(e.onDestroy=lE,e.onMove=Tf,e.onRotate=Tf,e.onMouseEnter=cE,e.onMouseLeave=hE,e.onMouseMove=dE,e.onMouseUp=uE,e.onInput=oE),e.formId=e.id;let r=e.calculative.borderRadius||0,n=r;const{x:a,y:s,width:o,height:l,ex:h,ey:c}=e.calculative.worldRect,{x:u}=e.calculative.worldTextRect;r<1&&(r=o*r,n=l*n);let d=r<n?r:n;if(o<2*d&&(d=o/2),l<2*d&&(d=l/2),i.moveTo(a+d,s),i.arcTo(h,s,h,c,d),i.arcTo(h,c,a,c,d),i.arcTo(a,c,a,s,d),i.arcTo(a,s,h,s,d),i instanceof Path2D)return i}function oE(e,t){e.text=t,e.calculative.text=e.text,e.calculative.canvas.updatePenRect(e)}function lE(e){}function Tf(e){}function cE(e){}function hE(e){const t=e.calculative.canvas.store.active;t&&t.length&&t.forEach(i=>{if(e.followers){let r=e.followers.findIndex(n=>n===i.id);if(r!==-1){const n=e.calculative.canvas.store.pens[i.id+Qe];n&&n.calculative&&(Dr(n.calculative.worldRect,e.calculative.worldRect,!0)||(e.followers.splice(r,1),delete i.formId))}}})}function uE(e){const t=e.calculative.canvas.store.active;t&&t.length&&t.forEach(i=>{const r=e.calculative.canvas.store.pens[i.id+Qe];if(r&&r.calculative){let n=lt(e.calculative.worldRect);n.x-=1,n.y-=1,n.width+=2,n.height+=2,Dr(r.calculative.worldRect,n,!0)&&(e.followers||(e.followers=[]),e.followers.includes(i.id)||e.followers.push(i.id),i.formId=e.id)}})}function dE(e,t){}function Ef(e,t){if(e.formId&&e.formKey&&e.formValue){const i=e.calculative.canvas.store.pens[e.formId];i&&(i.formData||(i.formData={}),i.formData[e.formKey]=e[e.formValue])}}function fE(e){const t=e.calculative.canvas.store.pens[e.formId];t.followers.forEach(i=>{const r=e.calculative.canvas.store.pens[i];if(r.formId&&r.formKey&&t.formData[r.formKey]){const n=r[r.formValue];let a="";Array.isArray(n)&&(a=[]),e.calculative.canvas.parent.setValue({id:r.id,[r.formValue]:a},{render:!1,doEvent:!1,history:!1})}}),t.formData={},e.calculative.canvas.parent.render()}const Ie={};function mE(e){e.onDestroy||(e.onDestroy=gE,e.onMove=_f,e.onResize=pE,e.onRotate=_f,e.onValue=vE,e.onChangeId=yE);const t=new Path2D;if(!e.image)return;const r=e.calculative.canvas.store.id+"-"+e.id;if(!Ie[r]){const n=new Image;n.crossOrigin="anonymous",n.src=e.image,e.calculative.canvas.parent.store.options.cdn&&!(e.image.startsWith("http")||e.image.startsWith("//")||e.image.startsWith("data:image"))&&(n.src=e.calculative.canvas.parent.store.options.cdn+e.image),Ie[r]=n,n.onload=()=>{var a;Ie[r]===n&&(e.calculative.img=n,e.calculative.imgNaturalWidth=n.naturalWidth||e.iconWidth,e.calculative.imgNaturalHeight=n.naturalHeight||e.iconHeight,(a=e.calculative.canvas.externalElements)==null||a.parentElement.appendChild(n),Vs(e,n))}}return e.calculative.patchFlags&&Ie[r]&&Vs(e,Ie[r]),t}function gE(e){const i=e.calculative.canvas.store.id+"-"+e.id;Ie[i]&&(Ie[i].remove(),Ie[i]=void 0)}function _f(e){const i=e.calculative.canvas.store.id+"-"+e.id;Ie[i]&&Vs(e,Ie[i])}function pE(e){const i=e.calculative.canvas.store.id+"-"+e.id;Ie[i]&&Vs(e,Ie[i])}function vE(e){const i=e.calculative.canvas.store.id+"-"+e.id;Ie[i]&&(Vs(e,Ie[i]),Ie[i].getAttribute("src")!==e.image&&(Ie[i].src=e.image))}function yE(e,t,i){const r=e.calculative.canvas.store.id;Ie[r+"-"+t]&&(Ie[r+"-"+i]=Ie[r+"-"+t],delete Ie[r+"-"+t])}function Vs(e,t){t.style.objectFit=e.imageRatio?"contain":"fill",Se(e,t)}function bE(e,t){return e.onResize||(e.onResize=ov,e.onValue=wE),Bn(e,t)}function ov(e){const t=e.anchors.filter(i=>i.flag!==1);lv(e),e.anchors=e.anchors.concat(...t)}function wE(e){ov(e),Ia(e)}function lv(e){const t=[],{x:i,y:r,width:n,height:a}=e,s=TE(e),o=5;for(let u=0;u<o;u++){if(u===2)continue;let d=i+n*(u+1)/(o+1),f=r;d<i+s?f=No(i+s,f+s,d,s,-1):d>i+n-s&&(f=No(i+n-s,f+s,d,s,-1)),t.push({id:String(t.length),flag:1,penId:e.id,x:(d-i)/n,y:(f-r)/a})}const l=3;for(let u=0;u<l;u++){let d=r+a*(u+1)/(l+1),f=i+n;d<r+s?f=Po(f-s,r+s,d,s):d>r+a-s&&(f=Po(f-s,r+a-s,d,s)),t.push({id:String(t.length),flag:1,penId:e.id,x:(f-i)/n,y:(d-r)/a})}const h=5;for(let u=0;u<h;u++){if(u===2)continue;let d=i+n*(u+1)/(h+1),f=r+a;d<i+s?f=No(i+s,f-s,d,s):d>i+n-s&&(f=No(i+n-s,f-s,d,s)),t.push({id:String(t.length),flag:1,penId:e.id,x:(d-i)/n,y:(f-r)/a})}const c=3;for(let u=0;u<c;u++){let d=r+a*(u+1)/(c+1),f=i;d<r+s?f=Po(f+s,r+s,d,s,-1):d>r+a-s&&(f=Po(f+s,r+a-s,d,s,-1)),t.push({id:String(t.length),flag:1,penId:e.id,x:(f-i)/n,y:(d-r)/a})}e.anchors=t}function TE(e){let t=e.calculative.borderRadius||0,i=e.calculative.borderRadius||0;const{width:r,height:n}=e;e.calculative.borderRadius<1&&(t=r*e.calculative.borderRadius,i=n*e.calculative.borderRadius);let a=t<i?t:i;return r<2*a&&(a=r/2),n<2*a&&(a=n/2),a}function Po(e,t,i,r,n=1){return n*Math.sqrt(r**2-(i-t)**2)+e}function No(e,t,i,r,n=1){return n*Math.sqrt(r**2-(i-e)**2)+t}function EE(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.moveTo(r,n+s),i.lineTo(r+a,n+s),i.closePath(),i instanceof Path2D)return i}function _E(e){const t=[{x:0,y:1},{x:1,y:1}];e.anchors=t.map(({x:i,y:r},n)=>({id:n+"",x:i,y:r,penId:e.id}))}function SE(){return{rectangle:Bn,square:xb,circle:Rb,svgPath:aT,diamond:sT,triangle:oT,pentagon:cT,pentagram:uT,hexagon:fT,leftArrow:mT,rightArrow:gT,twowayArrow:pT,message:vT,cloud:yT,file:bT,people:TT,line:AT,iframe:YT,video:QT,gif:mE,mindNode:bE,mindLine:EE,mindNode2:Bn,form:sE,combine:Bn}}function AE(){return{triangle:lT,pentagon:hT,pentagram:Qp,mindNode:lv,mindLine:_E}}var ve;(function(e){e[e.Link=0]="Link",e[e.SetProps=1]="SetProps",e[e.StartAnimate=2]="StartAnimate",e[e.PauseAnimate=3]="PauseAnimate",e[e.StopAnimate=4]="StopAnimate",e[e.JS=5]="JS",e[e.GlobalFn=6]="GlobalFn",e[e.Emit=7]="Emit",e[e.StartVideo=8]="StartVideo",e[e.PauseVideo=9]="PauseVideo",e[e.StopVideo=10]="StopVideo",e[e.SendPropData=11]="SendPropData",e[e.SendVarData=12]="SendVarData",e[e.Navigator=13]="Navigator",e[e.Dialog=14]="Dialog",e[e.SendData=15]="SendData",e[e.PostMessage=16]="PostMessage",e[e.PostMessageToParent=17]="PostMessageToParent",e[e.Message=18]="Message"})(ve||(ve={}));class xE{constructor(t){B(this,"parent");B(this,"box");B(this,"boxWidth",320);B(this,"boxHeight",180);B(this,"ratio",this.boxWidth/this.boxHeight);B(this,"padding",5);B(this,"img");B(this,"isShow");B(this,"isDown");B(this,"view");B(this,"timer");B(this,"onMouseDown",t=>{t.preventDefault(),t.stopPropagation(),this.isDown=!0});B(this,"onMouseMove",t=>{if(t.preventDefault(),t.stopPropagation(),this.isDown)try{this.parent.gotoView(t.offsetX/this.box.clientWidth,t.offsetY/this.box.clientHeight)}catch(i){console.warn(i.message),this.isDown=!1}});B(this,"onMouseUp",t=>{t.preventDefault(),t.stopPropagation();try{this.parent.gotoView(t.offsetX/this.box.clientWidth,t.offsetY/this.box.clientHeight)}catch(i){console.warn(i.message)}finally{this.isDown=!1}});B(this,"onWheel",t=>{let i=.015;if(this.parent.store.options.scaleOff)i=this.parent.store.options.scaleOff,t.deltaY>0&&(i=-this.parent.store.options.scaleOff);else if(/mac os /i.test(navigator.userAgent))t.ctrlKey?t.deltaY>0&&(i*=-1):i*=t.wheelDeltaY/240;else{let l=.2;t.deltaY.toString().indexOf(".")!==-1&&(l=.01),t.deltaY>0?i=-l:i=l}let{offsetX:r,offsetY:n}=t;const a=this.parent.store.data.width||this.parent.store.options.width,s=this.parent.store.data.height||this.parent.store.options.height;if(a&&s)r=r/this.boxWidth*a*this.parent.store.data.scale+this.parent.store.data.origin.x+this.parent.store.data.x,n=n/this.boxHeight*s*this.parent.store.data.scale+this.parent.store.data.origin.y+this.parent.store.data.y;else{const o=this.parent.parent.getRect();r=r/this.boxWidth*o.width+o.x+this.parent.store.data.x,n=n/this.boxHeight*o.height+o.y+this.parent.store.data.y}this.parent.scale(this.parent.store.data.scale+i,{x:r,y:n})});var r;this.parent=t,this.box=document.createElement("div"),this.img=new Image,this.view=document.createElement("div"),this.box.appendChild(this.img),this.box.appendChild(this.view),(r=this.parent.externalElements)==null||r.parentElement.appendChild(this.box),this.box.className="meta2d-map",this.box.onmousedown=this.onMouseDown,this.box.onmousemove=this.onMouseMove,this.box.onmouseup=this.onMouseUp,this.box.onwheel=this.onWheel;let i;for(let n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le/map"&&(i=document.styleSheets[n]);if(!i){let n=document.createElement("style");n.type="text/css",n.title="le5le.com/map",document.head.appendChild(n),n=document.createElement("style"),n.type="text/css",document.head.appendChild(n),i=n.sheet,i.insertRule(`.meta2d-map{display:flex;width:${this.boxWidth+2*this.padding}px;height:${this.boxHeight+2*this.padding}px;padding:${this.padding}px;background:#f4f4f4;border:1px solid #ffffff;box-shadow: 0px 0px 14px 0px rgba(0,10,38,0.30);border-radius:8px;position:absolute;z-index:9999;right:0;bottom:0;justify-content:center;align-items:center;cursor:default;user-select:none;overflow: hidden;}`),i.insertRule(".meta2d-map img{max-width:100%;max-height:100%;pointer-events: none;}"),i.insertRule(".meta2d-map div{pointer-events: none;border:1px solid #1890ff;position:absolute}")}}show(){this.box.style.display="flex",this.parent.store.data.pens.length?(this.img.style.display="block",this.img.src=this.parent.toPng(0,void 0,!0),this.setView()):this.img.style.display="none",this.isShow=!0}hide(){this.box.style.display="none",this.isShow=!1}setView(){const t=this.parent.store.data;if(t.pens.length){let i=Di(t.pens);const r=this.parent.store.data.width||this.parent.store.options.width,n=this.parent.store.data.height||this.parent.store.options.height;if(r&&n?i={x:this.parent.store.data.origin.x,y:this.parent.store.data.origin.y,width:r*this.parent.store.data.scale,height:n*this.parent.store.data.scale}:(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.parent.store.bkImg&&(this.img.src=this.parent.toPng(0,void 0,!0))},300)),Pn(i,t.x,t.y),i.width/i.height>this.ratio){const u=i.width/this.ratio;i.y-=(u-i.height)/2,i.height=u,le(i)}else{const u=i.height*this.ratio;i.x-=(u-i.width)/2,i.width=u,le(i)}const s=this.parent.canvasRect;let o=0,l=0;if(i.x<0)o=-i.x/i.width;else if(i.x+i.width>s.width){let u=0;s.width>i.width&&(u=s.width-i.width),o=(-i.x+u)/i.width}if(i.y<0)l=-i.y/i.height;else if(i.y+i.height>s.height){let u=0;s.height>i.height&&(u=s.height-i.height),l=(-i.y+u)/i.height}const h=s.width>i.width?1:s.width/i.width,c=s.height>i.height?1:s.height/i.height;this.view.style.left=this.padding+o*this.boxWidth+"px",this.view.style.width=h*this.boxWidth+"px",this.view.style.top=this.padding+l*this.boxHeight+"px",this.view.style.height=c*this.boxHeight+"px"}}}function Lo(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Vc={exports:{}},Sf;function RE(){return Sf||(Sf=1,(function(e,t){(function(i){e.exports=i()})(function(){return(function(){return function i(r,n,a){function s(h,c){if(!n[h]){if(!r[h]){var u=typeof Lo=="function"&&Lo;if(!c&&u)return u(h,!0);if(o)return o(h,!0);var d=new Error("Cannot find module '"+h+"'");throw d.code="MODULE_NOT_FOUND",d}var f=n[h]={exports:{}};r[h][0].call(f.exports,function(m){return s(r[h][1][m]||m)},f,f.exports,i,r,n,a)}return n[h].exports}for(var o=typeof Lo=="function"&&Lo,l=0;l<a.length;l++)s(a[l]);return s}})()({1:[function(i,r,n){(function(a,s){(function(){const o=i("events").EventEmitter,l=i("./store"),h=i("./topic-alias-recv"),c=i("./topic-alias-send"),u=i("mqtt-packet"),d=i("./default-message-id-provider"),f=i("readable-stream").Writable,m=i("inherits"),p=i("reinterval"),g=i("rfdc/default"),y=i("./validations"),T=i("xtend"),b=i("debug")("mqttjs:client"),S=a?a.nextTick:function(R){setTimeout(R,0)},I=s.setImmediate||function(R){S(R)},D={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},O={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function P(R,M){let Y;M.properties&&(Y=M.properties.topicAlias);let X=M.topic.toString();if(X.length===0){if(Y===void 0)return new Error("Unregistered Topic Alias");if((X=R.topicAliasSend.getTopicByAlias(Y))===void 0)return new Error("Unregistered Topic Alias");M.topic=X}Y&&delete M.properties.topicAlias}function q(R,M,Y){b("sendPacket :: packet: %O",M),b("sendPacket :: emitting `packetsend`"),R.emit("packetsend",M),b("sendPacket :: writing to stream");const X=u.writeToStream(M,R.stream,R.options);b("sendPacket :: writeToStream result %s",X),!X&&Y&&Y!==A?(b("sendPacket :: handle events on `drain` once through callback."),R.stream.once("drain",Y)):Y&&(b("sendPacket :: invoking cb"),Y())}function J(R,M,Y,X){b("storeAndSend :: store packet with cmd %s to outgoingStore",M.cmd);let et,z=M;if(z.cmd==="publish"&&(z=g(M),et=P(R,z)))return Y&&Y(et);R.outgoingStore.put(z,function(W){if(W)return Y&&Y(W);X(),q(R,M,Y)})}function A(R){b("nop ::",R)}function x(R,M){let Y;const X=this;if(!(this instanceof x))return new x(R,M);for(Y in this.options=M||{},D)this.options[Y]===void 0?this.options[Y]=D[Y]:this.options[Y]=M[Y];b("MqttClient :: options.protocol",M.protocol),b("MqttClient :: options.protocolVersion",M.protocolVersion),b("MqttClient :: options.username",M.username),b("MqttClient :: options.keepalive",M.keepalive),b("MqttClient :: options.reconnectPeriod",M.reconnectPeriod),b("MqttClient :: options.rejectUnauthorized",M.rejectUnauthorized),b("MqttClient :: options.topicAliasMaximum",M.topicAliasMaximum),this.options.clientId=typeof M.clientId=="string"?M.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),b("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=M.protocolVersion===5&&M.customHandleAcks?M.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=R,this.messageIdProvider=this.options.messageIdProvider===void 0?new d:this.options.messageIdProvider,this.outgoingStore=M.outgoingStore||new l,this.incomingStore=M.incomingStore||new l,this.queueQoSZero=M.queueQoSZero===void 0||M.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,M.topicAliasMaximum>0&&(M.topicAliasMaximum>65535?b("MqttClient :: options.topicAliasMaximum is out of range"):this.topicAliasRecv=new h(M.topicAliasMaximum)),this.on("connect",function(){const et=this.queue;b("connect :: sending queued packets"),(function z(){const W=et.shift();b("deliver :: entry %o",W);let $=null;if(!W)return void X._resubscribe();$=W.packet,b("deliver :: call _sendPacket for %o",$);let L=!0;$.messageId&&$.messageId!==0&&(X.messageIdProvider.register($.messageId)||(L=!1)),L?X._sendPacket($,function(N){W.cb&&W.cb(N),z()}):(b("messageId: %d has already used. The message is skipped and removed.",$.messageId),z())})()}),this.on("close",function(){b("close :: connected set to `false`"),this.connected=!1,b("close :: clearing connackTimer"),clearTimeout(this.connackTimer),b("close :: clearing ping timer"),X.pingTimer!==null&&(X.pingTimer.clear(),X.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),b("close :: calling _setupReconnect"),this._setupReconnect()}),o.call(this),b("MqttClient :: setting up stream"),this._setupStream()}m(x,o),x.prototype._setupStream=function(){const R=this,M=new f,Y=u.parser(this.options);let X=null;const et=[];function z(){if(et.length)S(W);else{const L=X;X=null,L()}}function W(){b("work :: getting next packet in queue");const L=et.shift();if(L)b("work :: packet pulled from queue"),R._handlePacket(L,z);else{b("work :: no packets in queue");const N=X;X=null,b("work :: done flag is %s",!!N),N&&N()}}b("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),b("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),Y.on("packet",function(L){b("parser :: on packet push to packets array."),et.push(L)}),M._write=function(L,N,V){X=V,b("writable stream :: parsing buffer"),Y.parse(L),W()},b("_setupStream :: pipe stream to writable stream"),this.stream.pipe(M),this.stream.on("error",function(L){b("streamErrorHandler :: error",L.message),L.code?(b("streamErrorHandler :: emitting error"),R.emit("error",L)):A(L)}),this.stream.on("close",function(){var L;b("(%s)stream :: on close",R.options.clientId),(L=R.outgoing)&&(b("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(L).forEach(function(N){L[N].volatile&&typeof L[N].cb=="function"&&(L[N].cb(new Error("Connection closed")),delete L[N])})),b("stream: emit close to MqttClient"),R.emit("close")}),b("_setupStream: sending packet `connect`");const $=Object.create(this.options);if($.cmd="connect",this.topicAliasRecv&&($.properties||($.properties={}),this.topicAliasRecv&&($.properties.topicAliasMaximum=this.topicAliasRecv.max)),q(this,$),Y.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return R.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"&&q(this,T({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){b("!!connectTimeout hit!! Calling _cleanUp with force `true`"),R._cleanUp(!0)},this.options.connectTimeout)},x.prototype._handlePacket=function(R,M){const Y=this.options;if(Y.protocolVersion===5&&Y.properties&&Y.properties.maximumPacketSize&&Y.properties.maximumPacketSize<R.length)return this.emit("error",new Error("exceeding packets size "+R.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(b("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",R),R.cmd){case"publish":this._handlePublish(R,M);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(R),M();break;case"pubrel":this._handlePubrel(R,M);break;case"connack":this._handleConnack(R),M();break;case"auth":this._handleAuth(R),M();break;case"pingresp":this._handlePingresp(R),M();break;case"disconnect":this._handleDisconnect(R),M()}},x.prototype._checkDisconnecting=function(R){return this.disconnecting&&(R&&R!==A?R(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},x.prototype.publish=function(R,M,Y,X){b("publish :: message `%s` to topic `%s`",M,R);const et=this.options;if(typeof Y=="function"&&(X=Y,Y=null),Y=T({qos:0,retain:!1,dup:!1},Y),this._checkDisconnecting(X))return this;const z=this,W=function(){let $=0;if((Y.qos===1||Y.qos===2)&&($=z._nextId())===null)return b("No messageId left"),!1;const L={cmd:"publish",topic:R,payload:M,qos:Y.qos,retain:Y.retain,messageId:$,dup:Y.dup};switch(et.protocolVersion===5&&(L.properties=Y.properties),b("publish :: qos",Y.qos),Y.qos){case 1:case 2:z.outgoing[L.messageId]={volatile:!1,cb:X||A},b("MqttClient:publish: packet cmd: %s",L.cmd),z._sendPacket(L,void 0,Y.cbStorePut);break;default:b("MqttClient:publish: packet cmd: %s",L.cmd),z._sendPacket(L,X,Y.cbStorePut)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!W())&&this._storeProcessingQueue.push({invoke:W,cbStorePut:Y.cbStorePut,callback:X}),this},x.prototype.subscribe=function(){const R=this,M=new Array(arguments.length);for(let H=0;H<arguments.length;H++)M[H]=arguments[H];const Y=[];let X=M.shift();const et=X.resubscribe;let z=M.pop()||A,W=M.pop();const $=this.options.protocolVersion;delete X.resubscribe,typeof X=="string"&&(X=[X]),typeof z!="function"&&(W=z,z=A);const L=y.validateTopics(X);if(L!==null)return I(z,new Error("Invalid topic "+L)),this;if(this._checkDisconnecting(z))return b("subscribe: discconecting true"),this;const N={qos:0};if($===5&&(N.nl=!1,N.rap=!1,N.rh=0),W=T(N,W),Array.isArray(X)?X.forEach(function(H){if(b("subscribe: array topic %s",H),!Object.prototype.hasOwnProperty.call(R._resubscribeTopics,H)||R._resubscribeTopics[H].qos<W.qos||et){const Q={topic:H,qos:W.qos};$===5&&(Q.nl=W.nl,Q.rap=W.rap,Q.rh=W.rh,Q.properties=W.properties),b("subscribe: pushing topic `%s` and qos `%s` to subs list",Q.topic,Q.qos),Y.push(Q)}}):Object.keys(X).forEach(function(H){if(b("subscribe: object topic %s",H),!Object.prototype.hasOwnProperty.call(R._resubscribeTopics,H)||R._resubscribeTopics[H].qos<X[H].qos||et){const Q={topic:H,qos:X[H].qos};$===5&&(Q.nl=X[H].nl,Q.rap=X[H].rap,Q.rh=X[H].rh,Q.properties=W.properties),b("subscribe: pushing `%s` to subs list",Q),Y.push(Q)}}),!Y.length)return z(null,[]),this;const V=function(){const H=R._nextId();if(H===null)return b("No messageId left"),!1;const Q={cmd:"subscribe",subscriptions:Y,qos:1,retain:!1,dup:!1,messageId:H};if(W.properties&&(Q.properties=W.properties),R.options.resubscribe){b("subscribe :: resubscribe true");const rt=[];Y.forEach(function(tt){if(R.options.reconnectPeriod>0){const it={qos:tt.qos};$===5&&(it.nl=tt.nl||!1,it.rap=tt.rap||!1,it.rh=tt.rh||0,it.properties=tt.properties),R._resubscribeTopics[tt.topic]=it,rt.push(tt.topic)}}),R.messageIdToTopic[Q.messageId]=rt}return R.outgoing[Q.messageId]={volatile:!0,cb:function(rt,tt){if(!rt){const it=tt.granted;for(let w=0;w<it.length;w+=1)Y[w].qos=it[w]}z(rt,Y)}},b("subscribe :: call _sendPacket"),R._sendPacket(Q),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!V())&&this._storeProcessingQueue.push({invoke:V,callback:z}),this},x.prototype.unsubscribe=function(){const R=this,M=new Array(arguments.length);for(let $=0;$<arguments.length;$++)M[$]=arguments[$];let Y=M.shift(),X=M.pop()||A,et=M.pop();typeof Y=="string"&&(Y=[Y]),typeof X!="function"&&(et=X,X=A);const z=y.validateTopics(Y);if(z!==null)return I(X,new Error("Invalid topic "+z)),this;if(R._checkDisconnecting(X))return this;const W=function(){const $=R._nextId();if($===null)return b("No messageId left"),!1;const L={cmd:"unsubscribe",qos:1,messageId:$};return typeof Y=="string"?L.unsubscriptions=[Y]:Array.isArray(Y)&&(L.unsubscriptions=Y),R.options.resubscribe&&L.unsubscriptions.forEach(function(N){delete R._resubscribeTopics[N]}),typeof et=="object"&&et.properties&&(L.properties=et.properties),R.outgoing[L.messageId]={volatile:!0,cb:X},b("unsubscribe: call _sendPacket"),R._sendPacket(L),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!W())&&this._storeProcessingQueue.push({invoke:W,callback:X}),this},x.prototype.end=function(R,M,Y){const X=this;function et(){b("end :: (%s) :: finish :: calling _cleanUp with force %s",X.options.clientId,R),X._cleanUp(R,()=>{b("end :: finish :: calling process.nextTick on closeStores"),S((function(){b("end :: closeStores: closing incoming and outgoing stores"),X.disconnected=!0,X.incomingStore.close(function(z){X.outgoingStore.close(function(W){if(b("end :: closeStores: emitting end"),X.emit("end"),Y){const $=z||W;b("end :: closeStores: invoking callback with args"),Y($)}})}),X._deferredReconnect&&X._deferredReconnect()}).bind(X))},M)}return b("end :: (%s)",this.options.clientId),R!=null&&typeof R=="boolean"||(Y=M||A,M=R,R=!1,typeof M!="object"&&(Y=M,M=null,typeof Y!="function"&&(Y=A))),typeof M!="object"&&(Y=M,M=null),b("end :: cb? %s",!!Y),Y=Y||A,this.disconnecting?(Y(),this):(this._clearReconnect(),this.disconnecting=!0,!R&&Object.keys(this.outgoing).length>0?(b("end :: (%s) :: calling finish in 10ms once outgoing is empty",X.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,et,10))):(b("end :: (%s) :: immediately calling finish",X.options.clientId),et()),this)},x.prototype.removeOutgoingMessage=function(R){const M=this.outgoing[R]?this.outgoing[R].cb:null;return delete this.outgoing[R],this.outgoingStore.del({messageId:R},function(){M(new Error("Message removed"))}),this},x.prototype.reconnect=function(R){b("client reconnect");const M=this,Y=function(){R?(M.options.incomingStore=R.incomingStore,M.options.outgoingStore=R.outgoingStore):(M.options.incomingStore=null,M.options.outgoingStore=null),M.incomingStore=M.options.incomingStore||new l,M.outgoingStore=M.options.outgoingStore||new l,M.disconnecting=!1,M.disconnected=!1,M._deferredReconnect=null,M._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=Y:Y(),this},x.prototype._reconnect=function(){b("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this._setupStream()}),b("client already connected. disconnecting first.")):(b("_reconnect: calling _setupStream"),this._setupStream())},x.prototype._setupReconnect=function(){const R=this;!R.disconnecting&&!R.reconnectTimer&&R.options.reconnectPeriod>0?(this.reconnecting||(b("_setupReconnect :: emit `offline` state"),this.emit("offline"),b("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),b("_setupReconnect :: setting reconnectTimer for %d ms",R.options.reconnectPeriod),R.reconnectTimer=setInterval(function(){b("reconnectTimer :: reconnect triggered!"),R._reconnect()},R.options.reconnectPeriod)):b("_setupReconnect :: doing nothing...")},x.prototype._clearReconnect=function(){b("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},x.prototype._cleanUp=function(R,M){const Y=arguments[2];if(M&&(b("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",M)),b("_cleanUp :: forced? %s",R),R)this.options.reconnectPeriod===0&&this.options.clean&&(X=this.outgoing)&&(b("flush: queue exists? %b",!!X),Object.keys(X).forEach(function(et){typeof X[et].cb=="function"&&(X[et].cb(new Error("Connection closed")),delete X[et])})),b("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{const et=T({cmd:"disconnect"},Y);b("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(et,I.bind(null,this.stream.end.bind(this.stream)))}var X;this.disconnecting||(b("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(b("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),M&&!this.connected&&(b("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",M),M())},x.prototype._sendPacket=function(R,M,Y){b("_sendPacket :: (%s) ::  start",this.options.clientId),Y=Y||A,M=M||A;const X=(function(et,z){if(et.options.protocolVersion===5&&z.cmd==="publish"){let W;z.properties&&(W=z.properties.topicAlias);const $=z.topic.toString();if(et.topicAliasSend)if(W){if($.length!==0&&(b("applyTopicAlias :: register topic: %s - alias: %d",$,W),!et.topicAliasSend.put($,W)))return b("applyTopicAlias :: error out of range. topic: %s - alias: %d",$,W),new Error("Sending Topic Alias out of range")}else $.length!==0&&(et.options.autoAssignTopicAlias?(W=et.topicAliasSend.getAliasByTopic($))?(z.topic="",z.properties={...z.properties,topicAlias:W},b("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",$,W)):(W=et.topicAliasSend.getLruAlias(),et.topicAliasSend.put($,W),z.properties={...z.properties,topicAlias:W},b("applyTopicAlias :: auto assign topic: %s - alias: %d",$,W)):et.options.autoUseTopicAlias&&(W=et.topicAliasSend.getAliasByTopic($))&&(z.topic="",z.properties={...z.properties,topicAlias:W},b("applyTopicAlias :: auto use topic: %s - alias: %d",$,W)));else if(W)return b("applyTopicAlias :: error out of range. topic: %s - alias: %d",$,W),new Error("Sending Topic Alias out of range")}})(this,R);if(X)M(X);else{if(!this.connected)return R.cmd==="auth"?(this._shiftPingInterval(),void q(this,R,M)):(b("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(R,M,Y));switch(this._shiftPingInterval(),R.cmd){case"publish":break;case"pubrel":return void J(this,R,M,Y);default:return void q(this,R,M)}switch(R.qos){case 2:case 1:J(this,R,M,Y);break;case 0:default:q(this,R,M)}b("_sendPacket :: (%s) ::  end",this.options.clientId)}},x.prototype._storePacket=function(R,M,Y){b("_storePacket :: packet: %o",R),b("_storePacket :: cb? %s",!!M),Y=Y||A;let X=R;if(X.cmd==="publish"){const et=P(this,X=g(R));if(et)return M&&M(et)}(X.qos||0)===0&&this.queueQoSZero||X.cmd!=="publish"?this.queue.push({packet:X,cb:M}):X.qos>0?(M=this.outgoing[X.messageId]?this.outgoing[X.messageId].cb:null,this.outgoingStore.put(X,function(et){if(et)return M&&M(et);Y()})):M&&M(new Error("No connection to broker"))},x.prototype._setupPingTimer=function(){b("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);const R=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=p(function(){R._checkPing()},1e3*this.options.keepalive))},x.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},x.prototype._checkPing=function(){b("_checkPing :: checking ping..."),this.pingResp?(b("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(b("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))},x.prototype._handlePingresp=function(){this.pingResp=!0},x.prototype._handleConnack=function(R){b("_handleConnack");const M=this.options,Y=M.protocolVersion===5?R.reasonCode:R.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,R.properties){if(R.properties.topicAliasMaximum){if(R.properties.topicAliasMaximum>65535)return void this.emit("error",new Error("topicAliasMaximum from broker is out of range"));R.properties.topicAliasMaximum>0&&(this.topicAliasSend=new c(R.properties.topicAliasMaximum))}R.properties.serverKeepAlive&&M.keepalive&&(M.keepalive=R.properties.serverKeepAlive,this._shiftPingInterval()),R.properties.maximumPacketSize&&(M.properties||(M.properties={}),M.properties.maximumPacketSize=R.properties.maximumPacketSize)}if(Y===0)this.reconnecting=!1,this._onConnect(R);else if(Y>0){const X=new Error("Connection refused: "+O[Y]);X.code=Y,this.emit("error",X)}},x.prototype._handleAuth=function(R){const M=this.options.protocolVersion,Y=M===5?R.reasonCode:R.returnCode;if(M!==5){const et=new Error("Protocol error: Auth packets are only supported in MQTT 5. Your version:"+M);return et.code=Y,void this.emit("error",et)}const X=this;this.handleAuth(R,function(et,z){if(et)X.emit("error",et);else if(Y===24)X.reconnecting=!1,X._sendPacket(z);else{const W=new Error("Connection refused: "+O[Y]);et.code=Y,X.emit("error",W)}})},x.prototype.handleAuth=function(R,M){M()},x.prototype._handlePublish=function(R,M){b("_handlePublish: packet %o",R),M=M!==void 0?M:A;let Y=R.topic.toString();const X=R.payload,et=R.qos,z=R.messageId,W=this,$=this.options,L=[0,16,128,131,135,144,145,151,153];if(this.options.protocolVersion===5){let N;if(R.properties&&(N=R.properties.topicAlias),N!==void 0)if(Y.length===0){if(!(N>0&&N<=65535))return b("_handlePublish :: topic alias out of range. alias: %d",N),void this.emit("error",new Error("Received Topic Alias is out of range"));{const V=this.topicAliasRecv.getTopicByAlias(N);if(!V)return b("_handlePublish :: unregistered topic alias. alias: %d",N),void this.emit("error",new Error("Received unregistered Topic Alias"));b("_handlePublish :: topic complemented by alias. topic: %s - alias: %d",Y=V,N)}}else{if(!this.topicAliasRecv.put(Y,N))return b("_handlePublish :: topic alias out of range. alias: %d",N),void this.emit("error",new Error("Received Topic Alias is out of range"));b("_handlePublish :: registered topic: %s - alias: %d",Y,N)}}switch(b("_handlePublish: qos %d",et),et){case 2:$.customHandleAcks(Y,X,R,function(N,V){return N instanceof Error||(V=N,N=null),N?W.emit("error",N):L.indexOf(V)===-1?W.emit("error",new Error("Wrong reason code for pubrec")):void(V?W._sendPacket({cmd:"pubrec",messageId:z,reasonCode:V},M):W.incomingStore.put(R,function(){W._sendPacket({cmd:"pubrec",messageId:z},M)}))});break;case 1:$.customHandleAcks(Y,X,R,function(N,V){return N instanceof Error||(V=N,N=null),N?W.emit("error",N):L.indexOf(V)===-1?W.emit("error",new Error("Wrong reason code for puback")):(V||W.emit("message",Y,X,R),void W.handleMessage(R,function(H){if(H)return M&&M(H);W._sendPacket({cmd:"puback",messageId:z,reasonCode:V},M)}))});break;case 0:this.emit("message",Y,X,R),this.handleMessage(R,M);break;default:b("_handlePublish: unknown QoS. Doing nothing.")}},x.prototype.handleMessage=function(R,M){M()},x.prototype._handleAck=function(R){const M=R.messageId,Y=R.cmd;let X=null;const et=this.outgoing[M]?this.outgoing[M].cb:null,z=this;let W;if(et){switch(b("_handleAck :: packet type",Y),Y){case"pubcomp":case"puback":{const $=R.reasonCode;$&&$>0&&$!==16&&((W=new Error("Publish error: "+O[$])).code=$,et(W,R)),delete this.outgoing[M],this.outgoingStore.del(R,et),this.messageIdProvider.deallocate(M),this._invokeStoreProcessingQueue();break}case"pubrec":{X={cmd:"pubrel",qos:2,messageId:M};const $=R.reasonCode;$&&$>0&&$!==16?((W=new Error("Publish error: "+O[$])).code=$,et(W,R)):this._sendPacket(X);break}case"suback":delete this.outgoing[M],this.messageIdProvider.deallocate(M);for(let $=0;$<R.granted.length;$++)if((128&R.granted[$])!=0){const L=this.messageIdToTopic[M];L&&L.forEach(function(N){delete z._resubscribeTopics[N]})}this._invokeStoreProcessingQueue(),et(null,R);break;case"unsuback":delete this.outgoing[M],this.messageIdProvider.deallocate(M),this._invokeStoreProcessingQueue(),et(null);break;default:z.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")}else b("_handleAck :: Server sent an ack in error. Ignoring.")},x.prototype._handlePubrel=function(R,M){b("handling pubrel packet"),M=M!==void 0?M:A;const Y=this,X={cmd:"pubcomp",messageId:R.messageId};Y.incomingStore.get(R,function(et,z){et?Y._sendPacket(X,M):(Y.emit("message",z.topic,z.payload,z),Y.handleMessage(z,function(W){if(W)return M(W);Y.incomingStore.del(z,A),Y._sendPacket(X,M)}))})},x.prototype._handleDisconnect=function(R){this.emit("disconnect",R)},x.prototype._nextId=function(){return this.messageIdProvider.allocate()},x.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()},x.prototype._resubscribe=function(){b("_resubscribe");const R=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!this.connackPacket.sessionPresent)&&R.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){b("_resubscribe: protocolVersion 5");for(let M=0;M<R.length;M++){const Y={};Y[R[M]]=this._resubscribeTopics[R[M]],Y.resubscribe=!0,this.subscribe(Y,{properties:Y[R[M]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},x.prototype._onConnect=function(R){if(this.disconnected)return void this.emit("connect",R);const M=this;this.connackPacket=R,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0,(function Y(){let X=M.outgoingStore.createStream();function et(){M._storeProcessing=!1,M._packetIdsDuringStoreProcessing={}}function z(){X.destroy(),X=null,M._flushStoreProcessingQueue(),et()}M.once("close",z),X.on("error",function(W){et(),M._flushStoreProcessingQueue(),M.removeListener("close",z),M.emit("error",W)}),X.on("end",function(){let W=!0;for(const $ in M._packetIdsDuringStoreProcessing)if(!M._packetIdsDuringStoreProcessing[$]){W=!1;break}W?(et(),M.removeListener("close",z),M._invokeAllStoreProcessingQueue(),M.emit("connect",R)):Y()}),(function W(){if(!X)return;M._storeProcessing=!0;const $=X.read(1);let L;$?M._packetIdsDuringStoreProcessing[$.messageId]?W():M.disconnecting||M.reconnectTimer?X.destroy&&X.destroy():(L=M.outgoing[$.messageId]?M.outgoing[$.messageId].cb:null,M.outgoing[$.messageId]={volatile:!1,cb:function(N,V){L&&L(N,V),W()}},M._packetIdsDuringStoreProcessing[$.messageId]=!0,M.messageIdProvider.register($.messageId)?M._sendPacket($):b("messageId: %d has already used.",$.messageId)):X.once("readable",W)})()})()},x.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){const R=this._storeProcessingQueue[0];if(R&&R.invoke())return this._storeProcessingQueue.shift(),!0}return!1},x.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););},x.prototype._flushStoreProcessingQueue=function(){for(const R of this._storeProcessingQueue)R.cbStorePut&&R.cbStorePut(new Error("Connection closed")),R.callback&&R.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)},r.exports=x}).call(this)}).call(this,i("_process"),typeof Vi<"u"?Vi:typeof self<"u"?self:typeof window<"u"?window:{})},{"./default-message-id-provider":7,"./store":8,"./topic-alias-recv":9,"./topic-alias-send":10,"./validations":11,_process:50,debug:18,events:22,inherits:24,"mqtt-packet":40,"readable-stream":69,reinterval:70,"rfdc/default":71,xtend:81}],2:[function(i,r,n){const{Buffer:a}=i("buffer"),s=i("readable-stream").Transform,o=i("duplexify");let l,h,c,u=!1;r.exports=function(d,f){if(f.hostname=f.hostname||f.host,!f.hostname)throw new Error("Could not determine host. Specify host manually.");const m=f.protocolId==="MQIsdp"&&f.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(f);const p=(function(g,y){const T=g.protocol==="alis"?"wss":"ws";let b=T+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(b=T+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(b=g.transformWsUrl(b,g,y)),b})(f,d);return(l=f.my).connectSocket({url:p,protocols:m}),h=(function(){const g=new s;return g._write=function(y,T,b){l.sendSocketMessage({data:y.buffer,success:function(){b()},fail:function(){b(new Error)}})},g._flush=function(y){l.closeSocket({success:function(){y()}})},g})(),c=o.obj(),u||(u=!0,l.onSocketOpen(function(){c.setReadable(h),c.setWritable(h),c.emit("connect")}),l.onSocketMessage(function(g){if(typeof g.data=="string"){const y=a.from(g.data,"base64");h.push(y)}else{const y=new FileReader;y.addEventListener("load",function(){let T=y.result;T=T instanceof ArrayBuffer?a.from(T):a.from(T,"utf8"),h.push(T)}),y.readAsArrayBuffer(g.data)}}),l.onSocketClose(function(){c.end(),c.destroy()}),l.onSocketError(function(g){c.destroy(g)})),c}},{buffer:17,duplexify:20,"readable-stream":69}],3:[function(i,r,n){const a=i("net"),s=i("debug")("mqttjs:tcp");r.exports=function(o,l){l.port=l.port||1883,l.hostname=l.hostname||l.host||"localhost";const h=l.port,c=l.hostname;return s("port %d and host %s",h,c),a.createConnection(h,c)}},{debug:18,net:16}],4:[function(i,r,n){const a=i("tls"),s=i("net"),o=i("debug")("mqttjs:tls");r.exports=function(l,h){h.port=h.port||8883,h.host=h.hostname||h.host||"localhost",s.isIP(h.host)===0&&(h.servername=h.host),h.rejectUnauthorized=h.rejectUnauthorized!==!1,delete h.path,o("port %d host %s rejectUnauthorized %b",h.port,h.host,h.rejectUnauthorized);const c=a.connect(h);function u(d){h.rejectUnauthorized&&l.emit("error",d),c.end()}return c.on("secureConnect",function(){h.rejectUnauthorized&&!c.authorized?c.emit("error",new Error("TLS not authorized")):c.removeListener("error",u)}),c.on("error",u),c}},{debug:18,net:16,tls:16}],5:[function(i,r,n){(function(a){(function(){const{Buffer:s}=i("buffer"),o=i("ws"),l=i("debug")("mqttjs:ws"),h=i("duplexify"),c=i("readable-stream").Transform,u=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],d=a!==void 0&&a.title==="browser"||typeof __webpack_require__=="function";function f(p,g){let y=p.protocol+"://"+p.hostname+":"+p.port+p.path;return typeof p.transformWsUrl=="function"&&(y=p.transformWsUrl(y,p,g)),y}function m(p){const g=p;return p.hostname||(g.hostname="localhost"),p.port||(p.protocol==="wss"?g.port=443:g.port=80),p.path||(g.path="/"),p.wsOptions||(g.wsOptions={}),d||p.protocol!=="wss"||u.forEach(function(y){Object.prototype.hasOwnProperty.call(p,y)&&!Object.prototype.hasOwnProperty.call(p.wsOptions,y)&&(g.wsOptions[y]=p[y])}),g}r.exports=d?function(p,g){let y;l("browserStreamBuilder");const T=(function(R){const M=m(R);if(M.hostname||(M.hostname=M.host),!M.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");const Y=new URL(document.URL);M.hostname=Y.hostname,M.port||(M.port=Y.port)}return M.objectMode===void 0&&(M.objectMode=!(M.binary===!0||M.binary===void 0)),M})(g).browserBufferSize||524288,b=g.browserBufferTimeout||1e3,S=!g.objectMode,I=(function(R,M){const Y=M.protocolId==="MQIsdp"&&M.protocolVersion===3?"mqttv3.1":"mqtt",X=f(M,R),et=new WebSocket(X,[Y]);return et.binaryType="arraybuffer",et})(p,g),D=(function(R,M,Y){const X=new c({objectModeMode:R.objectMode});return X._write=M,X._flush=Y,X})(g,function R(M,Y,X){I.bufferedAmount>T&&setTimeout(R,b,M,Y,X),S&&typeof M=="string"&&(M=s.from(M,"utf8"));try{I.send(M)}catch(et){return X(et)}X()},function(R){I.close(),R()});g.objectMode||(D._writev=x),D.on("close",()=>{I.close()});const O=I.addEventListener!==void 0;function P(){y.setReadable(D),y.setWritable(D),y.emit("connect")}function q(){y.end(),y.destroy()}function J(R){y.destroy(R)}function A(R){let M=R.data;M=M instanceof ArrayBuffer?s.from(M):s.from(M,"utf8"),D.push(M)}function x(R,M){const Y=new Array(R.length);for(let X=0;X<R.length;X++)typeof R[X].chunk=="string"?Y[X]=s.from(R[X],"utf8"):Y[X]=R[X].chunk;this._write(s.concat(Y),"binary",M)}return I.readyState===I.OPEN?y=D:(y=y=h(void 0,void 0,g),g.objectMode||(y._writev=x),O?I.addEventListener("open",P):I.onopen=P),y.socket=I,O?(I.addEventListener("close",q),I.addEventListener("error",J),I.addEventListener("message",A)):(I.onclose=q,I.onerror=J,I.onmessage=A),y}:function(p,g){l("streamBuilder");const y=m(g),T=f(y,p),b=(function(I,D,O){l("createWebSocket"),l("protocol: "+O.protocolId+" "+O.protocolVersion);const P=O.protocolId==="MQIsdp"&&O.protocolVersion===3?"mqttv3.1":"mqtt";return l("creating new Websocket for url: "+D+" and protocol: "+P),new o(D,[P],O.wsOptions)})(0,T,y),S=o.createWebSocketStream(b,y.wsOptions);return S.url=T,b.on("close",()=>{S.destroy()}),S}}).call(this)}).call(this,i("_process"))},{_process:50,buffer:17,debug:18,duplexify:20,"readable-stream":69,ws:80}],6:[function(i,r,n){const{Buffer:a}=i("buffer"),s=i("readable-stream").Transform,o=i("duplexify");let l,h,c;r.exports=function(u,d){if(d.hostname=d.hostname||d.host,!d.hostname)throw new Error("Could not determine host. Specify host manually.");const f=d.protocolId==="MQIsdp"&&d.protocolVersion===3?"mqttv3.1":"mqtt";(function(g){g.hostname||(g.hostname="localhost"),g.path||(g.path="/"),g.wsOptions||(g.wsOptions={})})(d);const m=(function(g,y){const T=g.protocol==="wxs"?"wss":"ws";let b=T+"://"+g.hostname+g.path;return g.port&&g.port!==80&&g.port!==443&&(b=T+"://"+g.hostname+":"+g.port+g.path),typeof g.transformWsUrl=="function"&&(b=g.transformWsUrl(b,g,y)),b})(d,u);l=wx.connectSocket({url:m,protocols:[f]}),h=(function(){const g=new s;return g._write=function(y,T,b){l.send({data:y.buffer,success:function(){b()},fail:function(S){b(new Error(S))}})},g._flush=function(y){l.close({success:function(){y()}})},g})(),(c=o.obj())._destroy=function(g,y){l.close({success:function(){y&&y(g)}})};const p=c.destroy;return c.destroy=(function(){c.destroy=p;const g=this;setTimeout(function(){l.close({fail:function(){g._destroy(new Error)}})},0)}).bind(c),l.onOpen(function(){c.setReadable(h),c.setWritable(h),c.emit("connect")}),l.onMessage(function(g){let y=g.data;y=y instanceof ArrayBuffer?a.from(y):a.from(y,"utf8"),h.push(y)}),l.onClose(function(){c.end(),c.destroy()}),l.onError(function(g){c.destroy(new Error(g.errMsg))}),c}},{buffer:17,duplexify:20,"readable-stream":69}],7:[function(i,r,n){function a(){if(!(this instanceof a))return new a;this.nextId=Math.max(1,Math.floor(65535*Math.random()))}a.prototype.allocate=function(){const s=this.nextId++;return this.nextId===65536&&(this.nextId=1),s},a.prototype.getLastAllocated=function(){return this.nextId===1?65535:this.nextId-1},a.prototype.register=function(s){return!0},a.prototype.deallocate=function(s){},a.prototype.clear=function(){},r.exports=a},{}],8:[function(i,r,n){const a=i("xtend"),s=i("readable-stream").Readable,o={objectMode:!0},l={clean:!0};function h(c){if(!(this instanceof h))return new h(c);this.options=c||{},this.options=a(l,c),this._inflights=new Map}h.prototype.put=function(c,u){return this._inflights.set(c.messageId,c),u&&u(),this},h.prototype.createStream=function(){const c=new s(o),u=[];let d=!1,f=0;return this._inflights.forEach(function(m,p){u.push(m)}),c._read=function(){!d&&f<u.length?this.push(u[f++]):this.push(null)},c.destroy=function(){if(d)return;const m=this;d=!0,setTimeout(function(){m.emit("close")},0)},c},h.prototype.del=function(c,u){return(c=this._inflights.get(c.messageId))?(this._inflights.delete(c.messageId),u(null,c)):u&&u(new Error("missing packet")),this},h.prototype.get=function(c,u){return(c=this._inflights.get(c.messageId))?u(null,c):u&&u(new Error("missing packet")),this},h.prototype.close=function(c){this.options.clean&&(this._inflights=null),c&&c()},r.exports=h},{"readable-stream":69,xtend:81}],9:[function(i,r,n){function a(s){if(!(this instanceof a))return new a(s);this.aliasToTopic={},this.max=s}a.prototype.put=function(s,o){return!(o===0||o>this.max)&&(this.aliasToTopic[o]=s,this.length=Object.keys(this.aliasToTopic).length,!0)},a.prototype.getTopicByAlias=function(s){return this.aliasToTopic[s]},a.prototype.clear=function(){this.aliasToTopic={}},r.exports=a},{}],10:[function(i,r,n){const a=i("lru-cache"),s=i("number-allocator").NumberAllocator;function o(l){if(!(this instanceof o))return new o(l);l>0&&(this.aliasToTopic=new a({max:l}),this.topicToAlias={},this.numberAllocator=new s(1,l),this.max=l,this.length=0)}o.prototype.put=function(l,h){if(h===0||h>this.max)return!1;const c=this.aliasToTopic.get(h);return c&&delete this.topicToAlias[c],this.aliasToTopic.set(h,l),this.topicToAlias[l]=h,this.numberAllocator.use(h),this.length=this.aliasToTopic.length,!0},o.prototype.getTopicByAlias=function(l){return this.aliasToTopic.get(l)},o.prototype.getAliasByTopic=function(l){const h=this.topicToAlias[l];return h!==void 0&&this.aliasToTopic.get(h),h},o.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0},o.prototype.getLruAlias=function(){return this.numberAllocator.firstVacant()||this.aliasToTopic.keys()[this.aliasToTopic.length-1]},r.exports=o},{"lru-cache":37,"number-allocator":46}],11:[function(i,r,n){function a(s){const o=s.split("/");for(let l=0;l<o.length;l++)if(o[l]!=="+"){if(o[l]==="#")return l===o.length-1;if(o[l].indexOf("+")!==-1||o[l].indexOf("#")!==-1)return!1}return!0}r.exports={validateTopics:function(s){if(s.length===0)return"empty_topic_list";for(let o=0;o<s.length;o++)if(!a(s[o]))return s[o];return null}}},{}],12:[function(i,r,n){(function(a){(function(){const s=i("../client"),o=i("../store"),l=i("url"),h=i("xtend"),c=i("debug")("mqttjs"),u={};function d(f,m){if(c("connecting to an MQTT broker..."),typeof f!="object"||m||(m=f,f=null),m=m||{},f){const g=l.parse(f,!0);if(g.port!=null&&(g.port=Number(g.port)),(m=h(g,m)).protocol===null)throw new Error("Missing protocol");m.protocol=m.protocol.replace(/:$/,"")}if((function(g){let y;g.auth&&((y=g.auth.match(/^(.+):(.+)$/))?(g.username=y[1],g.password=y[2]):g.username=g.auth)})(m),m.query&&typeof m.query.clientId=="string"&&(m.clientId=m.query.clientId),m.cert&&m.key){if(!m.protocol)throw new Error("Missing secure protocol key");if(["mqtts","wss","wxs","alis"].indexOf(m.protocol)===-1)switch(m.protocol){case"mqtt":m.protocol="mqtts";break;case"ws":m.protocol="wss";break;case"wx":m.protocol="wxs";break;case"ali":m.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+m.protocol+'"!')}}if(!u[m.protocol]){const g=["mqtts","wss"].indexOf(m.protocol)!==-1;m.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(y,T){return(!g||T%2!=0)&&typeof u[y]=="function"})[0]}if(m.clean===!1&&!m.clientId)throw new Error("Missing clientId for unclean clients");m.protocol&&(m.defaultProtocol=m.protocol);const p=new s(function(g){return m.servers&&(g._reconnectCount&&g._reconnectCount!==m.servers.length||(g._reconnectCount=0),m.host=m.servers[g._reconnectCount].host,m.port=m.servers[g._reconnectCount].port,m.protocol=m.servers[g._reconnectCount].protocol?m.servers[g._reconnectCount].protocol:m.defaultProtocol,m.hostname=m.host,g._reconnectCount++),c("calling streambuilder for",m.protocol),u[m.protocol](g,m)},m);return p.on("error",function(){}),p}a!==void 0&&a.title!=="browser"||typeof __webpack_require__!="function"?(u.mqtt=i("./tcp"),u.tcp=i("./tcp"),u.ssl=i("./tls"),u.tls=i("./tls"),u.mqtts=i("./tls")):(u.wx=i("./wx"),u.wxs=i("./wx"),u.ali=i("./ali"),u.alis=i("./ali")),u.ws=i("./ws"),u.wss=i("./ws"),r.exports=d,r.exports.connect=d,r.exports.MqttClient=s,r.exports.Store=o}).call(this)}).call(this,i("_process"))},{"../client":1,"../store":8,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:50,debug:18,url:76,xtend:81}],13:[function(i,r,n){n.byteLength=function(f){var m=u(f),p=m[0],g=m[1];return 3*(p+g)/4-g},n.toByteArray=function(f){var m,p,g=u(f),y=g[0],T=g[1],b=new o((function(D,O,P){return 3*(O+P)/4-P})(0,y,T)),S=0,I=T>0?y-4:y;for(p=0;p<I;p+=4)m=s[f.charCodeAt(p)]<<18|s[f.charCodeAt(p+1)]<<12|s[f.charCodeAt(p+2)]<<6|s[f.charCodeAt(p+3)],b[S++]=m>>16&255,b[S++]=m>>8&255,b[S++]=255&m;return T===2&&(m=s[f.charCodeAt(p)]<<2|s[f.charCodeAt(p+1)]>>4,b[S++]=255&m),T===1&&(m=s[f.charCodeAt(p)]<<10|s[f.charCodeAt(p+1)]<<4|s[f.charCodeAt(p+2)]>>2,b[S++]=m>>8&255,b[S++]=255&m),b},n.fromByteArray=function(f){for(var m,p=f.length,g=p%3,y=[],T=0,b=p-g;T<b;T+=16383)y.push(d(f,T,T+16383>b?b:T+16383));return g===1?(m=f[p-1],y.push(a[m>>2]+a[m<<4&63]+"==")):g===2&&(m=(f[p-2]<<8)+f[p-1],y.push(a[m>>10]+a[m>>4&63]+a[m<<2&63]+"=")),y.join("")};for(var a=[],s=[],o=typeof Uint8Array<"u"?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,c=l.length;h<c;++h)a[h]=l[h],s[l.charCodeAt(h)]=h;function u(f){var m=f.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var p=f.indexOf("=");return p===-1&&(p=m),[p,p===m?0:4-p%4]}function d(f,m,p){for(var g,y,T=[],b=m;b<p;b+=3)g=(f[b]<<16&16711680)+(f[b+1]<<8&65280)+(255&f[b+2]),T.push(a[(y=g)>>18&63]+a[y>>12&63]+a[y>>6&63]+a[63&y]);return T.join("")}s[45]=62,s[95]=63},{}],14:[function(i,r,n){const{Buffer:a}=i("buffer"),s=Symbol.for("BufferList");function o(l){if(!(this instanceof o))return new o(l);o._init.call(this,l)}o._init=function(l){Object.defineProperty(this,s,{value:!0}),this._bufs=[],this.length=0,l&&this.append(l)},o.prototype._new=function(l){return new o(l)},o.prototype._offset=function(l){if(l===0)return[0,0];let h=0;for(let c=0;c<this._bufs.length;c++){const u=h+this._bufs[c].length;if(l<u||c===this._bufs.length-1)return[c,l-h];h=u}},o.prototype._reverseOffset=function(l){const h=l[0];let c=l[1];for(let u=0;u<h;u++)c+=this._bufs[u].length;return c},o.prototype.get=function(l){if(l>this.length||l<0)return;const h=this._offset(l);return this._bufs[h[0]][h[1]]},o.prototype.slice=function(l,h){return typeof l=="number"&&l<0&&(l+=this.length),typeof h=="number"&&h<0&&(h+=this.length),this.copy(null,0,l,h)},o.prototype.copy=function(l,h,c,u){if((typeof c!="number"||c<0)&&(c=0),(typeof u!="number"||u>this.length)&&(u=this.length),c>=this.length||u<=0)return l||a.alloc(0);const d=!!l,f=this._offset(c),m=u-c;let p=m,g=d&&h||0,y=f[1];if(c===0&&u===this.length){if(!d)return this._bufs.length===1?this._bufs[0]:a.concat(this._bufs,this.length);for(let T=0;T<this._bufs.length;T++)this._bufs[T].copy(l,g),g+=this._bufs[T].length;return l}if(p<=this._bufs[f[0]].length-y)return d?this._bufs[f[0]].copy(l,h,y,y+p):this._bufs[f[0]].slice(y,y+p);d||(l=a.allocUnsafe(m));for(let T=f[0];T<this._bufs.length;T++){const b=this._bufs[T].length-y;if(!(p>b)){this._bufs[T].copy(l,g,y,y+p),g+=b;break}this._bufs[T].copy(l,g,y),g+=b,p-=b,y&&(y=0)}return l.length>g?l.slice(0,g):l},o.prototype.shallowSlice=function(l,h){if(l=l||0,h=typeof h!="number"?this.length:h,l<0&&(l+=this.length),h<0&&(h+=this.length),l===h)return this._new();const c=this._offset(l),u=this._offset(h),d=this._bufs.slice(c[0],u[0]+1);return u[1]===0?d.pop():d[d.length-1]=d[d.length-1].slice(0,u[1]),c[1]!==0&&(d[0]=d[0].slice(c[1])),this._new(d)},o.prototype.toString=function(l,h,c){return this.slice(h,c).toString(l)},o.prototype.consume=function(l){if(l=Math.trunc(l),Number.isNaN(l)||l<=0)return this;for(;this._bufs.length;){if(!(l>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(l),this.length-=l;break}l-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},o.prototype.duplicate=function(){const l=this._new();for(let h=0;h<this._bufs.length;h++)l.append(this._bufs[h]);return l},o.prototype.append=function(l){if(l==null)return this;if(l.buffer)this._appendBuffer(a.from(l.buffer,l.byteOffset,l.byteLength));else if(Array.isArray(l))for(let h=0;h<l.length;h++)this.append(l[h]);else if(this._isBufferList(l))for(let h=0;h<l._bufs.length;h++)this.append(l._bufs[h]);else typeof l=="number"&&(l=l.toString()),this._appendBuffer(a.from(l));return this},o.prototype._appendBuffer=function(l){this._bufs.push(l),this.length+=l.length},o.prototype.indexOf=function(l,h,c){if(c===void 0&&typeof h=="string"&&(c=h,h=void 0),typeof l=="function"||Array.isArray(l))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof l=="number"?l=a.from([l]):typeof l=="string"?l=a.from(l,c):this._isBufferList(l)?l=l.slice():Array.isArray(l.buffer)?l=a.from(l.buffer,l.byteOffset,l.byteLength):a.isBuffer(l)||(l=a.from(l)),h=Number(h||0),isNaN(h)&&(h=0),h<0&&(h=this.length+h),h<0&&(h=0),l.length===0)return h>this.length?this.length:h;const u=this._offset(h);let d=u[0],f=u[1];for(;d<this._bufs.length;d++){const m=this._bufs[d];for(;f<m.length;)if(m.length-f>=l.length){const p=m.indexOf(l,f);if(p!==-1)return this._reverseOffset([d,p]);f=m.length-l.length+1}else{const p=this._reverseOffset([d,f]);if(this._match(p,l))return p;f++}f=0}return-1},o.prototype._match=function(l,h){if(this.length-l<h.length)return!1;for(let c=0;c<h.length;c++)if(this.get(l+c)!==h[c])return!1;return!0},(function(){const l={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const h in l)(function(c){o.prototype[c]=l[c]===null?function(u,d){return this.slice(u,u+d)[c](0,d)}:function(u=0){return this.slice(u,u+l[c])[c](0)}})(h)})(),o.prototype._isBufferList=function(l){return l instanceof o||o.isBufferList(l)},o.isBufferList=function(l){return l!=null&&l[s]},r.exports=o},{buffer:17}],15:[function(i,r,n){const a=i("readable-stream").Duplex,s=i("inherits"),o=i("./BufferList");function l(h){if(!(this instanceof l))return new l(h);if(typeof h=="function"){this._callback=h;const c=(function(u){this._callback&&(this._callback(u),this._callback=null)}).bind(this);this.on("pipe",function(u){u.on("error",c)}),this.on("unpipe",function(u){u.removeListener("error",c)}),h=null}o._init.call(this,h),a.call(this)}s(l,a),Object.assign(l.prototype,o.prototype),l.prototype._new=function(h){return new l(h)},l.prototype._write=function(h,c,u){this._appendBuffer(h),typeof u=="function"&&u()},l.prototype._read=function(h){if(!this.length)return this.push(null);h=Math.min(h,this.length),this.push(this.slice(0,h)),this.consume(h)},l.prototype.end=function(h){a.prototype.end.call(this,h),this._callback&&(this._callback(null,this.slice()),this._callback=null)},l.prototype._destroy=function(h,c){this._bufs.length=0,this.length=0,c(h)},l.prototype._isBufferList=function(h){return h instanceof l||h instanceof o||l.isBufferList(h)},l.isBufferList=o.isBufferList,r.exports=l,r.exports.BufferListStream=l,r.exports.BufferList=o},{"./BufferList":14,inherits:24,"readable-stream":69}],16:[function(i,r,n){},{}],17:[function(i,r,n){(function(a){(function(){var s=i("base64-js"),o=i("ieee754");n.Buffer=c,n.SlowBuffer=function(w){return+w!=w&&(w=0),c.alloc(+w)},n.INSPECT_MAX_BYTES=50;var l=2147483647;function h(w){if(w>l)throw new RangeError('The value "'+w+'" is invalid for option "size"');var _=new Uint8Array(w);return _.__proto__=c.prototype,_}function c(w,_,C){if(typeof w=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(w)}return u(w,_,C)}function u(w,_,C){if(typeof w=="string")return(function(K,nt){if(typeof nt=="string"&&nt!==""||(nt="utf8"),!c.isEncoding(nt))throw new TypeError("Unknown encoding: "+nt);var mt=0|g(K,nt),ft=h(mt),gt=ft.write(K,nt);return gt!==mt&&(ft=ft.slice(0,gt)),ft})(w,_);if(ArrayBuffer.isView(w))return m(w);if(w==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof w);if(tt(w,ArrayBuffer)||w&&tt(w.buffer,ArrayBuffer))return(function(K,nt,mt){if(nt<0||K.byteLength<nt)throw new RangeError('"offset" is outside of buffer bounds');if(K.byteLength<nt+(mt||0))throw new RangeError('"length" is outside of buffer bounds');var ft;return ft=nt===void 0&&mt===void 0?new Uint8Array(K):mt===void 0?new Uint8Array(K,nt):new Uint8Array(K,nt,mt),ft.__proto__=c.prototype,ft})(w,_,C);if(typeof w=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var F=w.valueOf&&w.valueOf();if(F!=null&&F!==w)return c.from(F,_,C);var j=(function(K){if(c.isBuffer(K)){var nt=0|p(K.length),mt=h(nt);return mt.length===0||K.copy(mt,0,0,nt),mt}if(K.length!==void 0)return typeof K.length!="number"||it(K.length)?h(0):m(K);if(K.type==="Buffer"&&Array.isArray(K.data))return m(K.data)})(w);if(j)return j;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof w[Symbol.toPrimitive]=="function")return c.from(w[Symbol.toPrimitive]("string"),_,C);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof w)}function d(w){if(typeof w!="number")throw new TypeError('"size" argument must be of type number');if(w<0)throw new RangeError('The value "'+w+'" is invalid for option "size"')}function f(w){return d(w),h(w<0?0:0|p(w))}function m(w){for(var _=w.length<0?0:0|p(w.length),C=h(_),F=0;F<_;F+=1)C[F]=255&w[F];return C}function p(w){if(w>=l)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l.toString(16)+" bytes");return 0|w}function g(w,_){if(c.isBuffer(w))return w.length;if(ArrayBuffer.isView(w)||tt(w,ArrayBuffer))return w.byteLength;if(typeof w!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof w);var C=w.length,F=arguments.length>2&&arguments[2]===!0;if(!F&&C===0)return 0;for(var j=!1;;)switch(_){case"ascii":case"latin1":case"binary":return C;case"utf8":case"utf-8":return H(w).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*C;case"hex":return C>>>1;case"base64":return Q(w).length;default:if(j)return F?-1:H(w).length;_=(""+_).toLowerCase(),j=!0}}function y(w,_,C){var F=w[_];w[_]=w[C],w[C]=F}function T(w,_,C,F,j){if(w.length===0)return-1;if(typeof C=="string"?(F=C,C=0):C>2147483647?C=2147483647:C<-2147483648&&(C=-2147483648),it(C=+C)&&(C=j?0:w.length-1),C<0&&(C=w.length+C),C>=w.length){if(j)return-1;C=w.length-1}else if(C<0){if(!j)return-1;C=0}if(typeof _=="string"&&(_=c.from(_,F)),c.isBuffer(_))return _.length===0?-1:b(w,_,C,F,j);if(typeof _=="number")return _&=255,typeof Uint8Array.prototype.indexOf=="function"?j?Uint8Array.prototype.indexOf.call(w,_,C):Uint8Array.prototype.lastIndexOf.call(w,_,C):b(w,[_],C,F,j);throw new TypeError("val must be string, number or Buffer")}function b(w,_,C,F,j){var K,nt=1,mt=w.length,ft=_.length;if(F!==void 0&&((F=String(F).toLowerCase())==="ucs2"||F==="ucs-2"||F==="utf16le"||F==="utf-16le")){if(w.length<2||_.length<2)return-1;nt=2,mt/=2,ft/=2,C/=2}function gt(he,zt){return nt===1?he[zt]:he.readUInt16BE(zt*nt)}if(j){var xt=-1;for(K=C;K<mt;K++)if(gt(w,K)===gt(_,xt===-1?0:K-xt)){if(xt===-1&&(xt=K),K-xt+1===ft)return xt*nt}else xt!==-1&&(K-=K-xt),xt=-1}else for(C+ft>mt&&(C=mt-ft),K=C;K>=0;K--){for(var xe=!0,we=0;we<ft;we++)if(gt(w,K+we)!==gt(_,we)){xe=!1;break}if(xe)return K}return-1}function S(w,_,C,F){C=Number(C)||0;var j=w.length-C;F?(F=Number(F))>j&&(F=j):F=j;var K=_.length;F>K/2&&(F=K/2);for(var nt=0;nt<F;++nt){var mt=parseInt(_.substr(2*nt,2),16);if(it(mt))return nt;w[C+nt]=mt}return nt}function I(w,_,C,F){return rt(H(_,w.length-C),w,C,F)}function D(w,_,C,F){return rt((function(j){for(var K=[],nt=0;nt<j.length;++nt)K.push(255&j.charCodeAt(nt));return K})(_),w,C,F)}function O(w,_,C,F){return D(w,_,C,F)}function P(w,_,C,F){return rt(Q(_),w,C,F)}function q(w,_,C,F){return rt((function(j,K){for(var nt,mt,ft,gt=[],xt=0;xt<j.length&&!((K-=2)<0);++xt)nt=j.charCodeAt(xt),mt=nt>>8,ft=nt%256,gt.push(ft),gt.push(mt);return gt})(_,w.length-C),w,C,F)}function J(w,_,C){return _===0&&C===w.length?s.fromByteArray(w):s.fromByteArray(w.slice(_,C))}function A(w,_,C){C=Math.min(w.length,C);for(var F=[],j=_;j<C;){var K,nt,mt,ft,gt=w[j],xt=null,xe=gt>239?4:gt>223?3:gt>191?2:1;if(j+xe<=C)switch(xe){case 1:gt<128&&(xt=gt);break;case 2:(192&(K=w[j+1]))==128&&(ft=(31&gt)<<6|63&K)>127&&(xt=ft);break;case 3:K=w[j+1],nt=w[j+2],(192&K)==128&&(192&nt)==128&&(ft=(15&gt)<<12|(63&K)<<6|63&nt)>2047&&(ft<55296||ft>57343)&&(xt=ft);break;case 4:K=w[j+1],nt=w[j+2],mt=w[j+3],(192&K)==128&&(192&nt)==128&&(192&mt)==128&&(ft=(15&gt)<<18|(63&K)<<12|(63&nt)<<6|63&mt)>65535&&ft<1114112&&(xt=ft)}xt===null?(xt=65533,xe=1):xt>65535&&(xt-=65536,F.push(xt>>>10&1023|55296),xt=56320|1023&xt),F.push(xt),j+=xe}return(function(we){var he=we.length;if(he<=x)return String.fromCharCode.apply(String,we);for(var zt="",qt=0;qt<he;)zt+=String.fromCharCode.apply(String,we.slice(qt,qt+=x));return zt})(F)}n.kMaxLength=l,c.TYPED_ARRAY_SUPPORT=(function(){try{var w=new Uint8Array(1);return w.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},w.foo()===42}catch{return!1}})(),c.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),typeof Symbol<"u"&&Symbol.species!=null&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=function(w,_,C){return u(w,_,C)},c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=function(w,_,C){return(function(F,j,K){return d(F),F<=0?h(F):j!==void 0?typeof K=="string"?h(F).fill(j,K):h(F).fill(j):h(F)})(w,_,C)},c.allocUnsafe=function(w){return f(w)},c.allocUnsafeSlow=function(w){return f(w)},c.isBuffer=function(w){return w!=null&&w._isBuffer===!0&&w!==c.prototype},c.compare=function(w,_){if(tt(w,Uint8Array)&&(w=c.from(w,w.offset,w.byteLength)),tt(_,Uint8Array)&&(_=c.from(_,_.offset,_.byteLength)),!c.isBuffer(w)||!c.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(w===_)return 0;for(var C=w.length,F=_.length,j=0,K=Math.min(C,F);j<K;++j)if(w[j]!==_[j]){C=w[j],F=_[j];break}return C<F?-1:F<C?1:0},c.isEncoding=function(w){switch(String(w).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(w,_){if(!Array.isArray(w))throw new TypeError('"list" argument must be an Array of Buffers');if(w.length===0)return c.alloc(0);var C;if(_===void 0)for(_=0,C=0;C<w.length;++C)_+=w[C].length;var F=c.allocUnsafe(_),j=0;for(C=0;C<w.length;++C){var K=w[C];if(tt(K,Uint8Array)&&(K=c.from(K)),!c.isBuffer(K))throw new TypeError('"list" argument must be an Array of Buffers');K.copy(F,j),j+=K.length}return F},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var w=this.length;if(w%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var _=0;_<w;_+=2)y(this,_,_+1);return this},c.prototype.swap32=function(){var w=this.length;if(w%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var _=0;_<w;_+=4)y(this,_,_+3),y(this,_+1,_+2);return this},c.prototype.swap64=function(){var w=this.length;if(w%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var _=0;_<w;_+=8)y(this,_,_+7),y(this,_+1,_+6),y(this,_+2,_+5),y(this,_+3,_+4);return this},c.prototype.toString=function(){var w=this.length;return w===0?"":arguments.length===0?A(this,0,w):(function(_,C,F){var j=!1;if((C===void 0||C<0)&&(C=0),C>this.length||((F===void 0||F>this.length)&&(F=this.length),F<=0)||(F>>>=0)<=(C>>>=0))return"";for(_||(_="utf8");;)switch(_){case"hex":return Y(this,C,F);case"utf8":case"utf-8":return A(this,C,F);case"ascii":return R(this,C,F);case"latin1":case"binary":return M(this,C,F);case"base64":return J(this,C,F);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return X(this,C,F);default:if(j)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),j=!0}}).apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(w){if(!c.isBuffer(w))throw new TypeError("Argument must be a Buffer");return this===w||c.compare(this,w)===0},c.prototype.inspect=function(){var w="",_=n.INSPECT_MAX_BYTES;return w=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(w+=" ... "),"<Buffer "+w+">"},c.prototype.compare=function(w,_,C,F,j){if(tt(w,Uint8Array)&&(w=c.from(w,w.offset,w.byteLength)),!c.isBuffer(w))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof w);if(_===void 0&&(_=0),C===void 0&&(C=w?w.length:0),F===void 0&&(F=0),j===void 0&&(j=this.length),_<0||C>w.length||F<0||j>this.length)throw new RangeError("out of range index");if(F>=j&&_>=C)return 0;if(F>=j)return-1;if(_>=C)return 1;if(_>>>=0,C>>>=0,F>>>=0,j>>>=0,this===w)return 0;for(var K=j-F,nt=C-_,mt=Math.min(K,nt),ft=this.slice(F,j),gt=w.slice(_,C),xt=0;xt<mt;++xt)if(ft[xt]!==gt[xt]){K=ft[xt],nt=gt[xt];break}return K<nt?-1:nt<K?1:0},c.prototype.includes=function(w,_,C){return this.indexOf(w,_,C)!==-1},c.prototype.indexOf=function(w,_,C){return T(this,w,_,C,!0)},c.prototype.lastIndexOf=function(w,_,C){return T(this,w,_,C,!1)},c.prototype.write=function(w,_,C,F){if(_===void 0)F="utf8",C=this.length,_=0;else if(C===void 0&&typeof _=="string")F=_,C=this.length,_=0;else{if(!isFinite(_))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");_>>>=0,isFinite(C)?(C>>>=0,F===void 0&&(F="utf8")):(F=C,C=void 0)}var j=this.length-_;if((C===void 0||C>j)&&(C=j),w.length>0&&(C<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");for(var K=!1;;)switch(F){case"hex":return S(this,w,_,C);case"utf8":case"utf-8":return I(this,w,_,C);case"ascii":return D(this,w,_,C);case"latin1":case"binary":return O(this,w,_,C);case"base64":return P(this,w,_,C);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,w,_,C);default:if(K)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),K=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function R(w,_,C){var F="";C=Math.min(w.length,C);for(var j=_;j<C;++j)F+=String.fromCharCode(127&w[j]);return F}function M(w,_,C){var F="";C=Math.min(w.length,C);for(var j=_;j<C;++j)F+=String.fromCharCode(w[j]);return F}function Y(w,_,C){var F=w.length;(!_||_<0)&&(_=0),(!C||C<0||C>F)&&(C=F);for(var j="",K=_;K<C;++K)j+=V(w[K]);return j}function X(w,_,C){for(var F=w.slice(_,C),j="",K=0;K<F.length;K+=2)j+=String.fromCharCode(F[K]+256*F[K+1]);return j}function et(w,_,C){if(w%1!=0||w<0)throw new RangeError("offset is not uint");if(w+_>C)throw new RangeError("Trying to access beyond buffer length")}function z(w,_,C,F,j,K){if(!c.isBuffer(w))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>j||_<K)throw new RangeError('"value" argument is out of bounds');if(C+F>w.length)throw new RangeError("Index out of range")}function W(w,_,C,F,j,K){if(C+F>w.length)throw new RangeError("Index out of range");if(C<0)throw new RangeError("Index out of range")}function $(w,_,C,F,j){return _=+_,C>>>=0,j||W(w,0,C,4),o.write(w,_,C,F,23,4),C+4}function L(w,_,C,F,j){return _=+_,C>>>=0,j||W(w,0,C,8),o.write(w,_,C,F,52,8),C+8}c.prototype.slice=function(w,_){var C=this.length;w=~~w,_=_===void 0?C:~~_,w<0?(w+=C)<0&&(w=0):w>C&&(w=C),_<0?(_+=C)<0&&(_=0):_>C&&(_=C),_<w&&(_=w);var F=this.subarray(w,_);return F.__proto__=c.prototype,F},c.prototype.readUIntLE=function(w,_,C){w>>>=0,_>>>=0,C||et(w,_,this.length);for(var F=this[w],j=1,K=0;++K<_&&(j*=256);)F+=this[w+K]*j;return F},c.prototype.readUIntBE=function(w,_,C){w>>>=0,_>>>=0,C||et(w,_,this.length);for(var F=this[w+--_],j=1;_>0&&(j*=256);)F+=this[w+--_]*j;return F},c.prototype.readUInt8=function(w,_){return w>>>=0,_||et(w,1,this.length),this[w]},c.prototype.readUInt16LE=function(w,_){return w>>>=0,_||et(w,2,this.length),this[w]|this[w+1]<<8},c.prototype.readUInt16BE=function(w,_){return w>>>=0,_||et(w,2,this.length),this[w]<<8|this[w+1]},c.prototype.readUInt32LE=function(w,_){return w>>>=0,_||et(w,4,this.length),(this[w]|this[w+1]<<8|this[w+2]<<16)+16777216*this[w+3]},c.prototype.readUInt32BE=function(w,_){return w>>>=0,_||et(w,4,this.length),16777216*this[w]+(this[w+1]<<16|this[w+2]<<8|this[w+3])},c.prototype.readIntLE=function(w,_,C){w>>>=0,_>>>=0,C||et(w,_,this.length);for(var F=this[w],j=1,K=0;++K<_&&(j*=256);)F+=this[w+K]*j;return F>=(j*=128)&&(F-=Math.pow(2,8*_)),F},c.prototype.readIntBE=function(w,_,C){w>>>=0,_>>>=0,C||et(w,_,this.length);for(var F=_,j=1,K=this[w+--F];F>0&&(j*=256);)K+=this[w+--F]*j;return K>=(j*=128)&&(K-=Math.pow(2,8*_)),K},c.prototype.readInt8=function(w,_){return w>>>=0,_||et(w,1,this.length),128&this[w]?-1*(255-this[w]+1):this[w]},c.prototype.readInt16LE=function(w,_){w>>>=0,_||et(w,2,this.length);var C=this[w]|this[w+1]<<8;return 32768&C?4294901760|C:C},c.prototype.readInt16BE=function(w,_){w>>>=0,_||et(w,2,this.length);var C=this[w+1]|this[w]<<8;return 32768&C?4294901760|C:C},c.prototype.readInt32LE=function(w,_){return w>>>=0,_||et(w,4,this.length),this[w]|this[w+1]<<8|this[w+2]<<16|this[w+3]<<24},c.prototype.readInt32BE=function(w,_){return w>>>=0,_||et(w,4,this.length),this[w]<<24|this[w+1]<<16|this[w+2]<<8|this[w+3]},c.prototype.readFloatLE=function(w,_){return w>>>=0,_||et(w,4,this.length),o.read(this,w,!0,23,4)},c.prototype.readFloatBE=function(w,_){return w>>>=0,_||et(w,4,this.length),o.read(this,w,!1,23,4)},c.prototype.readDoubleLE=function(w,_){return w>>>=0,_||et(w,8,this.length),o.read(this,w,!0,52,8)},c.prototype.readDoubleBE=function(w,_){return w>>>=0,_||et(w,8,this.length),o.read(this,w,!1,52,8)},c.prototype.writeUIntLE=function(w,_,C,F){w=+w,_>>>=0,C>>>=0,F||z(this,w,_,C,Math.pow(2,8*C)-1,0);var j=1,K=0;for(this[_]=255&w;++K<C&&(j*=256);)this[_+K]=w/j&255;return _+C},c.prototype.writeUIntBE=function(w,_,C,F){w=+w,_>>>=0,C>>>=0,F||z(this,w,_,C,Math.pow(2,8*C)-1,0);var j=C-1,K=1;for(this[_+j]=255&w;--j>=0&&(K*=256);)this[_+j]=w/K&255;return _+C},c.prototype.writeUInt8=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,1,255,0),this[_]=255&w,_+1},c.prototype.writeUInt16LE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,2,65535,0),this[_]=255&w,this[_+1]=w>>>8,_+2},c.prototype.writeUInt16BE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,2,65535,0),this[_]=w>>>8,this[_+1]=255&w,_+2},c.prototype.writeUInt32LE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,4,4294967295,0),this[_+3]=w>>>24,this[_+2]=w>>>16,this[_+1]=w>>>8,this[_]=255&w,_+4},c.prototype.writeUInt32BE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,4,4294967295,0),this[_]=w>>>24,this[_+1]=w>>>16,this[_+2]=w>>>8,this[_+3]=255&w,_+4},c.prototype.writeIntLE=function(w,_,C,F){if(w=+w,_>>>=0,!F){var j=Math.pow(2,8*C-1);z(this,w,_,C,j-1,-j)}var K=0,nt=1,mt=0;for(this[_]=255&w;++K<C&&(nt*=256);)w<0&&mt===0&&this[_+K-1]!==0&&(mt=1),this[_+K]=(w/nt>>0)-mt&255;return _+C},c.prototype.writeIntBE=function(w,_,C,F){if(w=+w,_>>>=0,!F){var j=Math.pow(2,8*C-1);z(this,w,_,C,j-1,-j)}var K=C-1,nt=1,mt=0;for(this[_+K]=255&w;--K>=0&&(nt*=256);)w<0&&mt===0&&this[_+K+1]!==0&&(mt=1),this[_+K]=(w/nt>>0)-mt&255;return _+C},c.prototype.writeInt8=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,1,127,-128),w<0&&(w=255+w+1),this[_]=255&w,_+1},c.prototype.writeInt16LE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,2,32767,-32768),this[_]=255&w,this[_+1]=w>>>8,_+2},c.prototype.writeInt16BE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,2,32767,-32768),this[_]=w>>>8,this[_+1]=255&w,_+2},c.prototype.writeInt32LE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,4,2147483647,-2147483648),this[_]=255&w,this[_+1]=w>>>8,this[_+2]=w>>>16,this[_+3]=w>>>24,_+4},c.prototype.writeInt32BE=function(w,_,C){return w=+w,_>>>=0,C||z(this,w,_,4,2147483647,-2147483648),w<0&&(w=4294967295+w+1),this[_]=w>>>24,this[_+1]=w>>>16,this[_+2]=w>>>8,this[_+3]=255&w,_+4},c.prototype.writeFloatLE=function(w,_,C){return $(this,w,_,!0,C)},c.prototype.writeFloatBE=function(w,_,C){return $(this,w,_,!1,C)},c.prototype.writeDoubleLE=function(w,_,C){return L(this,w,_,!0,C)},c.prototype.writeDoubleBE=function(w,_,C){return L(this,w,_,!1,C)},c.prototype.copy=function(w,_,C,F){if(!c.isBuffer(w))throw new TypeError("argument should be a Buffer");if(C||(C=0),F||F===0||(F=this.length),_>=w.length&&(_=w.length),_||(_=0),F>0&&F<C&&(F=C),F===C||w.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(C<0||C>=this.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),w.length-_<F-C&&(F=w.length-_+C);var j=F-C;if(this===w&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(_,C,F);else if(this===w&&C<_&&_<F)for(var K=j-1;K>=0;--K)w[K+_]=this[K+C];else Uint8Array.prototype.set.call(w,this.subarray(C,F),_);return j},c.prototype.fill=function(w,_,C,F){if(typeof w=="string"){if(typeof _=="string"?(F=_,_=0,C=this.length):typeof C=="string"&&(F=C,C=this.length),F!==void 0&&typeof F!="string")throw new TypeError("encoding must be a string");if(typeof F=="string"&&!c.isEncoding(F))throw new TypeError("Unknown encoding: "+F);if(w.length===1){var j=w.charCodeAt(0);(F==="utf8"&&j<128||F==="latin1")&&(w=j)}}else typeof w=="number"&&(w&=255);if(_<0||this.length<_||this.length<C)throw new RangeError("Out of range index");if(C<=_)return this;var K;if(_>>>=0,C=C===void 0?this.length:C>>>0,w||(w=0),typeof w=="number")for(K=_;K<C;++K)this[K]=w;else{var nt=c.isBuffer(w)?w:c.from(w,F),mt=nt.length;if(mt===0)throw new TypeError('The value "'+w+'" is invalid for argument "value"');for(K=0;K<C-_;++K)this[K+_]=nt[K%mt]}return this};var N=/[^+/0-9A-Za-z-_]/g;function V(w){return w<16?"0"+w.toString(16):w.toString(16)}function H(w,_){var C;_=_||1/0;for(var F=w.length,j=null,K=[],nt=0;nt<F;++nt){if((C=w.charCodeAt(nt))>55295&&C<57344){if(!j){if(C>56319){(_-=3)>-1&&K.push(239,191,189);continue}if(nt+1===F){(_-=3)>-1&&K.push(239,191,189);continue}j=C;continue}if(C<56320){(_-=3)>-1&&K.push(239,191,189),j=C;continue}C=65536+(j-55296<<10|C-56320)}else j&&(_-=3)>-1&&K.push(239,191,189);if(j=null,C<128){if((_-=1)<0)break;K.push(C)}else if(C<2048){if((_-=2)<0)break;K.push(C>>6|192,63&C|128)}else if(C<65536){if((_-=3)<0)break;K.push(C>>12|224,C>>6&63|128,63&C|128)}else{if(!(C<1114112))throw new Error("Invalid code point");if((_-=4)<0)break;K.push(C>>18|240,C>>12&63|128,C>>6&63|128,63&C|128)}}return K}function Q(w){return s.toByteArray((function(_){if((_=(_=_.split("=")[0]).trim().replace(N,"")).length<2)return"";for(;_.length%4!=0;)_+="=";return _})(w))}function rt(w,_,C,F){for(var j=0;j<F&&!(j+C>=_.length||j>=w.length);++j)_[j+C]=w[j];return j}function tt(w,_){return w instanceof _||w!=null&&w.constructor!=null&&w.constructor.name!=null&&w.constructor.name===_.name}function it(w){return w!=w}}).call(this)}).call(this,i("buffer").Buffer)},{"base64-js":13,buffer:17,ieee754:23}],18:[function(i,r,n){(function(a){(function(){n.formatArgs=function(o){if(o[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+o[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;o.splice(1,0,l,"color: inherit");let h=0,c=0;o[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&u==="%c"&&(c=++h)}),o.splice(c,0,l)},n.save=function(o){try{o?n.storage.setItem("debug",o):n.storage.removeItem("debug")}catch{}},n.load=function(){let o;try{o=n.storage.getItem("debug")}catch{}return!o&&a!==void 0&&"env"in a&&(o=a.env.DEBUG),o},n.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage=(function(){try{return localStorage}catch{}})(),n.destroy=(()=>{let o=!1;return()=>{o||(o=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.log=console.debug||console.log||(()=>{}),r.exports=i("./common")(n);const{formatters:s}=r.exports;s.j=function(o){try{return JSON.stringify(o)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}}).call(this)}).call(this,i("_process"))},{"./common":19,_process:50}],19:[function(i,r,n){r.exports=function(a){function s(h){let c,u,d,f=null;function m(...p){if(!m.enabled)return;const g=m,y=Number(new Date),T=y-(c||y);g.diff=T,g.prev=c,g.curr=y,c=y,p[0]=s.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let b=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(S,I)=>{if(S==="%%")return"%";b++;const D=s.formatters[I];if(typeof D=="function"){const O=p[b];S=D.call(g,O),p.splice(b,1),b--}return S}),s.formatArgs.call(g,p),(g.log||s.log).apply(g,p)}return m.namespace=h,m.useColors=s.useColors(),m.color=s.selectColor(h),m.extend=o,m.destroy=s.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(u!==s.namespaces&&(u=s.namespaces,d=s.enabled(h)),d),set:p=>{f=p}}),typeof s.init=="function"&&s.init(m),m}function o(h,c){const u=s(this.namespace+(c===void 0?":":c)+h);return u.log=this.log,u}function l(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return s.debug=s,s.default=s,s.coerce=function(h){return h instanceof Error?h.stack||h.message:h},s.disable=function(){const h=[...s.names.map(l),...s.skips.map(l).map(c=>"-"+c)].join(",");return s.enable(""),h},s.enable=function(h){let c;s.save(h),s.namespaces=h,s.names=[],s.skips=[];const u=(typeof h=="string"?h:"").split(/[\s,]+/),d=u.length;for(c=0;c<d;c++)u[c]&&((h=u[c].replace(/\*/g,".*?"))[0]==="-"?s.skips.push(new RegExp("^"+h.substr(1)+"$")):s.names.push(new RegExp("^"+h+"$")))},s.enabled=function(h){if(h[h.length-1]==="*")return!0;let c,u;for(c=0,u=s.skips.length;c<u;c++)if(s.skips[c].test(h))return!1;for(c=0,u=s.names.length;c<u;c++)if(s.names[c].test(h))return!0;return!1},s.humanize=i("ms"),s.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(a).forEach(h=>{s[h]=a[h]}),s.names=[],s.skips=[],s.formatters={},s.selectColor=function(h){let c=0;for(let u=0;u<h.length;u++)c=(c<<5)-c+h.charCodeAt(u),c|=0;return s.colors[Math.abs(c)%s.colors.length]},s.enable(s.load()),s}},{ms:45}],20:[function(i,r,n){(function(a,s){(function(){var o=i("readable-stream"),l=i("end-of-stream"),h=i("inherits"),c=i("stream-shift"),u=s.from&&s.from!==Uint8Array.from?s.from([0]):new s([0]),d=function(g,y){g._corked?g.once("uncork",y):y()},f=function(g,y){return function(T){T?(function(b,S){b._autoDestroy&&b.destroy(S)})(g,T.message==="premature close"?null:T):y&&!g._ended&&g.end()}},m=function(){},p=function(g,y,T){if(!(this instanceof p))return new p(g,y,T);o.Duplex.call(this,T),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!T||T.autoDestroy!==!1,this._forwardDestroy=!T||T.destroy!==!1,this._forwardEnd=!T||T.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,g&&this.setWritable(g),y&&this.setReadable(y)};h(p,o.Duplex),p.obj=function(g,y,T){return T||(T={}),T.objectMode=!0,T.highWaterMark=16,new p(g,y,T)},p.prototype.cork=function(){++this._corked==1&&this.emit("cork")},p.prototype.uncork=function(){this._corked&&--this._corked==0&&this.emit("uncork")},p.prototype.setWritable=function(g){if(this._unwrite&&this._unwrite(),this.destroyed)g&&g.destroy&&g.destroy();else if(g!==null&&g!==!1){var y=this,T=l(g,{writable:!0,readable:!1},f(this,this._forwardEnd)),b=function(){var S=y._ondrain;y._ondrain=null,S&&S()};this._unwrite&&a.nextTick(b),this._writable=g,this._writable.on("drain",b),this._unwrite=function(){y._writable.removeListener("drain",b),T()},this.uncork()}else this.end()},p.prototype.setReadable=function(g){if(this._unread&&this._unread(),this.destroyed)g&&g.destroy&&g.destroy();else{if(g===null||g===!1)return this.push(null),void this.resume();var y,T=this,b=l(g,{writable:!1,readable:!0},f(this)),S=function(){T._forward()},I=function(){T.push(null)};this._drained=!0,this._readable=g,this._readable2=g._readableState?g:(y=g,new o.Readable({objectMode:!0,highWaterMark:16}).wrap(y)),this._readable2.on("readable",S),this._readable2.on("end",I),this._unread=function(){T._readable2.removeListener("readable",S),T._readable2.removeListener("end",I),b()},this._forward()}},p.prototype._read=function(){this._drained=!0,this._forward()},p.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var g;for(this._forwarding=!0;this._drained&&(g=c(this._readable2))!==null;)this.destroyed||(this._drained=this.push(g));this._forwarding=!1}},p.prototype.destroy=function(g,y){if(y||(y=m),this.destroyed)return y(null);this.destroyed=!0;var T=this;a.nextTick(function(){T._destroy(g),y(null)})},p.prototype._destroy=function(g){if(g){var y=this._ondrain;this._ondrain=null,y?y(g):this.emit("error",g)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},p.prototype._write=function(g,y,T){if(!this.destroyed)return this._corked?d(this,this._write.bind(this,g,y,T)):g===u?this._finish(T):this._writable?void(this._writable.write(g)===!1?this._ondrain=T:this.destroyed||T()):T()},p.prototype._finish=function(g){var y=this;this.emit("preend"),d(this,function(){var T,b;T=y._forwardEnd&&y._writable,b=function(){y._writableState.prefinished===!1&&(y._writableState.prefinished=!0),y.emit("prefinish"),d(y,g)},T?T._writableState&&T._writableState.finished?b():T._writableState?T.end(b):(T.end(),b()):b()})},p.prototype.end=function(g,y,T){return typeof g=="function"?this.end(null,null,g):typeof y=="function"?this.end(g,null,y):(this._ended=!0,g&&this.write(g),this._writableState.ending||this._writableState.destroyed||this.write(u),o.Writable.prototype.end.call(this,T))},r.exports=p}).call(this)}).call(this,i("_process"),i("buffer").Buffer)},{_process:50,buffer:17,"end-of-stream":21,inherits:24,"readable-stream":69,"stream-shift":74}],21:[function(i,r,n){(function(a){(function(){var s=i("once"),o=function(){},l=function(h,c,u){if(typeof c=="function")return l(h,null,c);c||(c={}),u=s(u||o);var d=h._writableState,f=h._readableState,m=c.readable||c.readable!==!1&&h.readable,p=c.writable||c.writable!==!1&&h.writable,g=!1,y=function(){h.writable||T()},T=function(){p=!1,m||u.call(h)},b=function(){m=!1,p||u.call(h)},S=function(q){u.call(h,q?new Error("exited with error code: "+q):null)},I=function(q){u.call(h,q)},D=function(){a.nextTick(O)},O=function(){if(!g)return(!m||f&&f.ended&&!f.destroyed)&&(!p||d&&d.ended&&!d.destroyed)?void 0:u.call(h,new Error("premature close"))},P=function(){h.req.on("finish",T)};return(function(q){return q.setHeader&&typeof q.abort=="function"})(h)?(h.on("complete",T),h.on("abort",D),h.req?P():h.on("request",P)):p&&!d&&(h.on("end",y),h.on("close",y)),(function(q){return q.stdio&&Array.isArray(q.stdio)&&q.stdio.length===3})(h)&&h.on("exit",S),h.on("end",b),h.on("finish",T),c.error!==!1&&h.on("error",I),h.on("close",D),function(){g=!0,h.removeListener("complete",T),h.removeListener("abort",D),h.removeListener("request",P),h.req&&h.req.removeListener("finish",T),h.removeListener("end",y),h.removeListener("close",y),h.removeListener("finish",T),h.removeListener("exit",S),h.removeListener("end",b),h.removeListener("error",I),h.removeListener("close",D)}};r.exports=l}).call(this)}).call(this,i("_process"))},{_process:50,once:48}],22:[function(i,r,n){var a=Object.create||function(b){var S=function(){};return S.prototype=b,new S},s=Object.keys||function(b){var S=[];for(var I in b)Object.prototype.hasOwnProperty.call(b,I)&&S.push(I);return I},o=Function.prototype.bind||function(b){var S=this;return function(){return S.apply(b,arguments)}};function l(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=a(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}r.exports=l,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._maxListeners=void 0;var h,c=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),h=u.x===0}catch{h=!1}function d(b){return b._maxListeners===void 0?l.defaultMaxListeners:b._maxListeners}function f(b,S,I,D){var O,P,q;if(typeof I!="function")throw new TypeError('"listener" argument must be a function');if((P=b._events)?(P.newListener&&(b.emit("newListener",S,I.listener?I.listener:I),P=b._events),q=P[S]):(P=b._events=a(null),b._eventsCount=0),q){if(typeof q=="function"?q=P[S]=D?[I,q]:[q,I]:D?q.unshift(I):q.push(I),!q.warned&&(O=d(b))&&O>0&&q.length>O){q.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+q.length+' "'+String(S)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');J.name="MaxListenersExceededWarning",J.emitter=b,J.type=S,J.count=q.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",J.name,J.message)}}else q=P[S]=I,++b._eventsCount;return b}function m(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var b=new Array(arguments.length),S=0;S<b.length;++S)b[S]=arguments[S];this.listener.apply(this.target,b)}}function p(b,S,I){var D={fired:!1,wrapFn:void 0,target:b,type:S,listener:I},O=o.call(m,D);return O.listener=I,D.wrapFn=O,O}function g(b,S,I){var D=b._events;if(!D)return[];var O=D[S];return O?typeof O=="function"?I?[O.listener||O]:[O]:I?(function(P){for(var q=new Array(P.length),J=0;J<q.length;++J)q[J]=P[J].listener||P[J];return q})(O):T(O,O.length):[]}function y(b){var S=this._events;if(S){var I=S[b];if(typeof I=="function")return 1;if(I)return I.length}return 0}function T(b,S){for(var I=new Array(S),D=0;D<S;++D)I[D]=b[D];return I}h?Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(b){if(typeof b!="number"||b<0||b!=b)throw new TypeError('"defaultMaxListeners" must be a positive number');c=b}}):l.defaultMaxListeners=c,l.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||isNaN(b))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=b,this},l.prototype.getMaxListeners=function(){return d(this)},l.prototype.emit=function(b){var S,I,D,O,P,q,J=b==="error";if(q=this._events)J=J&&q.error==null;else if(!J)return!1;if(J){if(arguments.length>1&&(S=arguments[1]),S instanceof Error)throw S;var A=new Error('Unhandled "error" event. ('+S+")");throw A.context=S,A}if(!(I=q[b]))return!1;var x=typeof I=="function";switch(D=arguments.length){case 1:(function(R,M,Y){if(M)R.call(Y);else for(var X=R.length,et=T(R,X),z=0;z<X;++z)et[z].call(Y)})(I,x,this);break;case 2:(function(R,M,Y,X){if(M)R.call(Y,X);else for(var et=R.length,z=T(R,et),W=0;W<et;++W)z[W].call(Y,X)})(I,x,this,arguments[1]);break;case 3:(function(R,M,Y,X,et){if(M)R.call(Y,X,et);else for(var z=R.length,W=T(R,z),$=0;$<z;++$)W[$].call(Y,X,et)})(I,x,this,arguments[1],arguments[2]);break;case 4:(function(R,M,Y,X,et,z){if(M)R.call(Y,X,et,z);else for(var W=R.length,$=T(R,W),L=0;L<W;++L)$[L].call(Y,X,et,z)})(I,x,this,arguments[1],arguments[2],arguments[3]);break;default:for(O=new Array(D-1),P=1;P<D;P++)O[P-1]=arguments[P];(function(R,M,Y,X){if(M)R.apply(Y,X);else for(var et=R.length,z=T(R,et),W=0;W<et;++W)z[W].apply(Y,X)})(I,x,this,O)}return!0},l.prototype.addListener=function(b,S){return f(this,b,S,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(b,S){return f(this,b,S,!0)},l.prototype.once=function(b,S){if(typeof S!="function")throw new TypeError('"listener" argument must be a function');return this.on(b,p(this,b,S)),this},l.prototype.prependOnceListener=function(b,S){if(typeof S!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(b,p(this,b,S)),this},l.prototype.removeListener=function(b,S){var I,D,O,P,q;if(typeof S!="function")throw new TypeError('"listener" argument must be a function');if(!(D=this._events))return this;if(!(I=D[b]))return this;if(I===S||I.listener===S)--this._eventsCount==0?this._events=a(null):(delete D[b],D.removeListener&&this.emit("removeListener",b,I.listener||S));else if(typeof I!="function"){for(O=-1,P=I.length-1;P>=0;P--)if(I[P]===S||I[P].listener===S){q=I[P].listener,O=P;break}if(O<0)return this;O===0?I.shift():(function(J,A){for(var x=A,R=x+1,M=J.length;R<M;x+=1,R+=1)J[x]=J[R];J.pop()})(I,O),I.length===1&&(D[b]=I[0]),D.removeListener&&this.emit("removeListener",b,q||S)}return this},l.prototype.removeAllListeners=function(b){var S,I,D;if(!(I=this._events))return this;if(!I.removeListener)return arguments.length===0?(this._events=a(null),this._eventsCount=0):I[b]&&(--this._eventsCount==0?this._events=a(null):delete I[b]),this;if(arguments.length===0){var O,P=s(I);for(D=0;D<P.length;++D)(O=P[D])!=="removeListener"&&this.removeAllListeners(O);return this.removeAllListeners("removeListener"),this._events=a(null),this._eventsCount=0,this}if(typeof(S=I[b])=="function")this.removeListener(b,S);else if(S)for(D=S.length-1;D>=0;D--)this.removeListener(b,S[D]);return this},l.prototype.listeners=function(b){return g(this,b,!0)},l.prototype.rawListeners=function(b){return g(this,b,!1)},l.listenerCount=function(b,S){return typeof b.listenerCount=="function"?b.listenerCount(S):y.call(b,S)},l.prototype.listenerCount=y,l.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],23:[function(i,r,n){n.read=function(a,s,o,l,h){var c,u,d=8*h-l-1,f=(1<<d)-1,m=f>>1,p=-7,g=o?h-1:0,y=o?-1:1,T=a[s+g];for(g+=y,c=T&(1<<-p)-1,T>>=-p,p+=d;p>0;c=256*c+a[s+g],g+=y,p-=8);for(u=c&(1<<-p)-1,c>>=-p,p+=l;p>0;u=256*u+a[s+g],g+=y,p-=8);if(c===0)c=1-m;else{if(c===f)return u?NaN:1/0*(T?-1:1);u+=Math.pow(2,l),c-=m}return(T?-1:1)*u*Math.pow(2,c-l)},n.write=function(a,s,o,l,h,c){var u,d,f,m=8*c-h-1,p=(1<<m)-1,g=p>>1,y=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=l?0:c-1,b=l?1:-1,S=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(d=isNaN(s)?1:0,u=p):(u=Math.floor(Math.log(s)/Math.LN2),s*(f=Math.pow(2,-u))<1&&(u--,f*=2),(s+=u+g>=1?y/f:y*Math.pow(2,1-g))*f>=2&&(u++,f/=2),u+g>=p?(d=0,u=p):u+g>=1?(d=(s*f-1)*Math.pow(2,h),u+=g):(d=s*Math.pow(2,g-1)*Math.pow(2,h),u=0));h>=8;a[o+T]=255&d,T+=b,d/=256,h-=8);for(u=u<<h|d,m+=h;m>0;a[o+T]=255&u,T+=b,u/=256,m-=8);a[o+T-b]|=128*S}},{}],24:[function(i,r,n){typeof Object.create=="function"?r.exports=function(a,s){s&&(a.super_=s,a.prototype=Object.create(s.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))}:r.exports=function(a,s){if(s){a.super_=s;var o=function(){};o.prototype=s.prototype,a.prototype=new o,a.prototype.constructor=a}}},{}],25:[function(i,r,n){Object.defineProperty(n,"__esModule",{value:!0});var a=(function(){function s(o,l){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=o,this.value=l}return s.prototype.rotateLeft=function(){var o=this.parent,l=this.brother,h=this.leftChild,c=this.rightChild;if(!c)throw new Error("unknown error");var u=c.leftChild,d=c.rightChild;return o&&(o.leftChild===this?o.leftChild=c:o.rightChild===this&&(o.rightChild=c)),c.parent=o,c.brother=l,c.leftChild=this,c.rightChild=d,l&&(l.brother=c),this.parent=c,this.brother=d,this.leftChild=h,this.rightChild=u,d&&(d.parent=c,d.brother=this),h&&(h.parent=this,h.brother=u),u&&(u.parent=this,u.brother=h),c},s.prototype.rotateRight=function(){var o=this.parent,l=this.brother,h=this.leftChild;if(!h)throw new Error("unknown error");var c=this.rightChild,u=h.leftChild,d=h.rightChild;return o&&(o.leftChild===this?o.leftChild=h:o.rightChild===this&&(o.rightChild=h)),h.parent=o,h.brother=l,h.leftChild=u,h.rightChild=this,l&&(l.brother=h),u&&(u.parent=h,u.brother=this),this.parent=h,this.brother=u,this.leftChild=d,this.rightChild=c,d&&(d.parent=this,d.brother=c),c&&(c.parent=this,c.brother=d),h},s.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},s.TreeNodeColorType={red:!0,black:!1},s})();Object.freeze(a),n.default=a},{}],26:[function(i,r,n){var a=this&&this.__generator||function(o,l){var h,c,u,d,f={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return d={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function m(p){return function(g){return(function(y){if(h)throw new TypeError("Generator is already executing.");for(;f;)try{if(h=1,c&&(u=2&y[0]?c.return:y[0]?c.throw||((u=c.return)&&u.call(c),0):c.next)&&!(u=u.call(c,y[1])).done)return u;switch(c=0,u&&(y=[2&y[0],u.value]),y[0]){case 0:case 1:u=y;break;case 4:return f.label++,{value:y[1],done:!1};case 5:f.label++,c=y[1],y=[0];continue;case 7:y=f.ops.pop(),f.trys.pop();continue;default:if(!(u=(u=f.trys).length>0&&u[u.length-1])&&(y[0]===6||y[0]===2)){f=0;continue}if(y[0]===3&&(!u||y[1]>u[0]&&y[1]<u[3])){f.label=y[1];break}if(y[0]===6&&f.label<u[1]){f.label=u[1],u=y;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(y);break}u[2]&&f.ops.pop(),f.trys.pop();continue}y=l.call(o,f)}catch(T){y=[6,T],c=0}finally{h=u=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}})([p,g])}}};function s(o){var l=this;o===void 0&&(o=[]);var h=[],c=0,u=0,d=0,f=0,m=0,p=0;this.size=function(){return p},this.empty=function(){return p===0},this.clear=function(){c=d=u=f=m=p=0,y.call(this,s.bucketSize),p=0},this.front=function(){return h[c][u]},this.back=function(){return h[d][f]},this.forEach=function(T){if(!this.empty()){var b=0;if(c!==d){for(I=u;I<s.bucketSize;++I)T(h[c][I],b++);for(I=c+1;I<d;++I)for(var S=0;S<s.bucketSize;++S)T(h[I][S],b++);for(I=0;I<=f;++I)T(h[d][I],b++)}else for(var I=u;I<=f;++I)T(h[c][I],b++)}};var g=function(T){var b=c*s.bucketSize+u,S=b+T,I=d*s.bucketSize+f;if(S<b||S>I)throw new Error("pos should more than 0 and less than queue's size");return{curNodeBucketIndex:Math.floor(S/s.bucketSize),curNodePointerIndex:S%s.bucketSize}};this.getElementByPos=function(T){var b=g(T),S=b.curNodeBucketIndex,I=b.curNodePointerIndex;return h[S][I]},this.eraseElementByPos=function(T){var b=this;if(T<0||T>p)throw new Error("pos should more than 0 and less than queue's size");if(T===0)this.popFront();else if(T===this.size())this.popBack();else{for(var S=[],I=T+1;I<p;++I)S.push(this.getElementByPos(I));this.cut(T),this.popBack(),S.forEach(function(D){return b.pushBack(D)})}},this.eraseElementByValue=function(T){if(!this.empty()){var b=[];this.forEach(function(D){D!==T&&b.push(D)});for(var S=b.length,I=0;I<S;++I)this.setElementByPos(I,b[I]);this.cut(S-1)}};var y=function(T){for(var b=[],S=T*s.sigma,I=Math.max(Math.ceil(S/s.bucketSize),2),D=0;D<I;++D)b.push(new Array(s.bucketSize));var O=Math.ceil(T/s.bucketSize),P=Math.floor(I/2)-Math.floor(O/2),q=P,J=0;if(this.size())for(D=0;D<O;++D){for(var A=0;A<s.bucketSize;++A)if(b[P+D][A]=this.front(),this.popFront(),this.empty()){q=P+D,J=A;break}if(this.empty())break}h=b,c=P,u=0,d=q,f=J,m=I,p=T};this.pushBack=function(T){this.empty()||(d===m-1&&f===s.bucketSize-1&&y.call(this,this.size()),f<s.bucketSize-1?++f:d<m-1&&(++d,f=0)),++p,h[d][f]=T},this.popBack=function(){this.empty()||(this.size()!==1&&(f>0?--f:c<d&&(--d,f=s.bucketSize-1)),p>0&&--p)},this.setElementByPos=function(T,b){var S=g(T),I=S.curNodeBucketIndex,D=S.curNodePointerIndex;h[I][D]=b},this.insert=function(T,b,S){var I=this;if(S===void 0&&(S=1),T===0)for(;S--;)this.pushFront(b);else if(T===this.size())for(;S--;)this.pushBack(b);else{for(var D=[],O=T;O<p;++O)D.push(this.getElementByPos(O));for(this.cut(T-1),O=0;O<S;++O)this.pushBack(b);D.forEach(function(P){return I.pushBack(P)})}},this.find=function(T){if(c===d){for(var b=u;b<=f;++b)if(h[c][b]===T)return!0;return!1}for(b=u;b<s.bucketSize;++b)if(h[c][b]===T)return!0;for(b=c+1;b<d;++b)for(var S=0;S<s.bucketSize;++S)if(h[b][S]===T)return!0;for(b=0;b<=f;++b)if(h[d][b]===T)return!0;return!1},this.reverse=function(){for(var T=0,b=p-1;T<b;){var S=this.getElementByPos(T);this.setElementByPos(T,this.getElementByPos(b)),this.setElementByPos(b,S),++T,--b}},this.unique=function(){if(!this.empty()){var T=[],b=this.front();this.forEach(function(I,D){D!==0&&I===b||(T.push(I),b=I)});for(var S=0;S<p;++S)this.setElementByPos(S,T[S]);this.cut(T.length-1)}},this.sort=function(T){var b=[];this.forEach(function(I){b.push(I)}),b.sort(T);for(var S=0;S<p;++S)this.setElementByPos(S,b[S])},this.pushFront=function(T){this.empty()||(c===0&&u===0&&y.call(this,this.size()),u>0?--u:c>0&&(--c,u=s.bucketSize-1)),++p,h[c][u]=T},this.popFront=function(){this.empty()||(this.size()!==1&&(u<s.bucketSize-1?++u:c<d&&(++c,u=0)),p>0&&--p)},this.shrinkToFit=function(){var T=this,b=[];this.forEach(function(O){b.push(O)});var S=b.length;h=[];for(var I=Math.ceil(S/s.bucketSize),D=0;D<I;++D)h.push(new Array(s.bucketSize));this.clear(),b.forEach(function(O){return T.pushBack(O)})},this.cut=function(T){if(T<0)this.clear();else{var b=g(T),S=b.curNodeBucketIndex,I=b.curNodePointerIndex;d=S,f=I,p=T+1}},this[Symbol.iterator]=function(){return(function(){var T,b;return a(this,function(S){switch(S.label){case 0:if(p===0)return[2];if(c!==d)return[3,5];b=u,S.label=1;case 1:return b<=f?[4,h[c][b]]:[3,4];case 2:S.sent(),S.label=3;case 3:return++b,[3,1];case 4:return[2];case 5:b=u,S.label=6;case 6:return b<s.bucketSize?[4,h[c][b]]:[3,9];case 7:S.sent(),S.label=8;case 8:return++b,[3,6];case 9:b=c+1,S.label=10;case 10:if(!(b<d))return[3,15];T=0,S.label=11;case 11:return T<s.bucketSize?[4,h[b][T]]:[3,14];case 12:S.sent(),S.label=13;case 13:return++T,[3,11];case 14:return++b,[3,10];case 15:b=0,S.label=16;case 16:return b<=f?[4,h[d][b]]:[3,19];case 17:S.sent(),S.label=18;case 18:return++b,[3,16];case 19:return[2]}})})()},(function(){var T=s.bucketSize;o.size?T=o.size():o.length&&(T=o.length);var b=T*s.sigma;m=Math.ceil(b/s.bucketSize),m=Math.max(m,3);for(var S=0;S<m;++S)h.push(new Array(s.bucketSize));var I=Math.ceil(T/s.bucketSize);c=Math.floor(m/2)-Math.floor(I/2),d=c,o.forEach(function(D){return l.pushBack(D)})})(),Object.freeze(this)}Object.defineProperty(n,"__esModule",{value:!0}),s.sigma=3,s.bucketSize=5e3,Object.freeze(s),n.default=s},{}],27:[function(i,r,n){var a=this&&this.__generator||function(c,u){var d,f,m,p,g={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return p={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function y(T){return function(b){return(function(S){if(d)throw new TypeError("Generator is already executing.");for(;g;)try{if(d=1,f&&(m=2&S[0]?f.return:S[0]?f.throw||((m=f.return)&&m.call(f),0):f.next)&&!(m=m.call(f,S[1])).done)return m;switch(f=0,m&&(S=[2&S[0],m.value]),S[0]){case 0:case 1:m=S;break;case 4:return g.label++,{value:S[1],done:!1};case 5:g.label++,f=S[1],S=[0];continue;case 7:S=g.ops.pop(),g.trys.pop();continue;default:if(!(m=(m=g.trys).length>0&&m[m.length-1])&&(S[0]===6||S[0]===2)){g=0;continue}if(S[0]===3&&(!m||S[1]>m[0]&&S[1]<m[3])){g.label=S[1];break}if(S[0]===6&&g.label<m[1]){g.label=m[1],m=S;break}if(m&&g.label<m[2]){g.label=m[2],g.ops.push(S);break}m[2]&&g.ops.pop(),g.trys.pop();continue}S=u.call(c,g)}catch(I){S=[6,I],f=0}finally{d=m=0}if(5&S[0])throw S[1];return{value:S[0]?S[1]:void 0,done:!0}})([T,b])}}},s=this&&this.__values||function(c){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&c[u],f=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&f>=c.length&&(c=void 0),{value:c&&c[f++],done:!c}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var o=i("../LinkList/LinkList"),l=i("../Map/Map");function h(c,u,d){var f=this;if(c===void 0&&(c=[]),u===void 0&&(u=h.initSize),d=d||function(y){var T,b,S=0,I="";if(typeof y=="number")S=((S=Math.floor(y))<<5)-S,S&=S;else{I=typeof y!="string"?JSON.stringify(y):y;try{for(var D=s(I),O=D.next();!O.done;O=D.next())S=(S<<5)-S+O.value.charCodeAt(0),S&=S}catch(P){T={error:P}}finally{try{O&&!O.done&&(b=D.return)&&b.call(D)}finally{if(T)throw T.error}}}return S^=S>>>16},(u&u-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var m=0,p=[],g=Math.max(h.initSize,Math.min(h.maxSize,u));this.size=function(){return m},this.empty=function(){return m===0},this.clear=function(){m=0,g=u,p=[]},this.forEach=function(y){var T=0;p.forEach(function(b){b.forEach(function(S){y(S,T++)})})},this.setElement=function(y,T){var b,S;if(y==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(T!=null){var I=d(y)&g-1;if(p[I]){var D=p[I].size();if(p[I]instanceof o.default){try{for(var O=s(p[I]),P=O.next();!P.done;P=O.next()){var q=P.value;if(q.key===y)return void(q.value=T)}}catch(A){b={error:A}}finally{try{P&&!P.done&&(S=O.return)&&S.call(O)}finally{if(b)throw b.error}}p[I].pushBack({key:y,value:T}),p[I].size()>=h.treeifyThreshold&&(p[I]=new l.default(p[I]))}else p[I].setElement(y,T);var J=p[I].size();m+=J-D}else++m,p[I]=new o.default([{key:y,value:T}]);m>g*h.sigma&&(function(A){if(!(A>=h.maxSize)){g=2*A;var x=[];p.forEach(function(R,M){if(!R.empty()){if(R instanceof o.default&&R.size()===1){var Y=R.front(),X=Y.key,et=Y.value;x[d(X)&g-1]=new o.default([{key:X,value:et}])}else if(R instanceof l.default){var z=new o.default,W=new o.default;R.forEach(function(N){(d(N.key)&A)==0?z.pushBack(N):W.pushBack(N)}),z.size()>h.untreeifyThreshold?x[M]=new l.default(z):z.size()&&(x[M]=z),W.size()>h.untreeifyThreshold?x[M+A]=new l.default(W):W.size()&&(x[M+A]=W)}else{var $=new o.default,L=new o.default;R.forEach(function(N){(d(N.key)&A)==0?$.pushBack(N):L.pushBack(N)}),$.size()&&(x[M]=$),L.size()&&(x[M+A]=L)}p[M].clear()}}),p=x}}).call(this,g)}else this.eraseElementByKey(y)},this.getElementByKey=function(y){var T,b,S=d(y)&g-1;if(p[S]){if(p[S]instanceof l.default)return p[S].getElementByKey(y);try{for(var I=s(p[S]),D=I.next();!D.done;D=I.next()){var O=D.value;if(O.key===y)return O.value}}catch(P){T={error:P}}finally{try{D&&!D.done&&(b=I.return)&&b.call(I)}finally{if(T)throw T.error}}}},this.eraseElementByKey=function(y){var T,b,S=d(y)&g-1;if(p[S]){var I=p[S].size();if(p[S]instanceof l.default)p[S].eraseElementByKey(y),p[S].size()<=h.untreeifyThreshold&&(p[S]=new o.default(p[S]));else{var D=-1;try{for(var O=s(p[S]),P=O.next();!P.done;P=O.next())if(++D,P.value.key===y){p[S].eraseElementByPos(D);break}}catch(J){T={error:J}}finally{try{P&&!P.done&&(b=O.return)&&b.call(O)}finally{if(T)throw T.error}}}var q=p[S].size();m+=q-I}},this.find=function(y){var T,b,S=d(y)&g-1;if(!p[S])return!1;if(p[S]instanceof l.default)return p[S].find(y);try{for(var I=s(p[S]),D=I.next();!D.done;D=I.next())if(D.value.key===y)return!0}catch(O){T={error:O}}finally{try{D&&!D.done&&(b=I.return)&&b.call(I)}finally{if(T)throw T.error}}return!1},this[Symbol.iterator]=function(){return(function(){var y,T,b,S,I,D;return a(this,function(O){switch(O.label){case 0:y=0,O.label=1;case 1:if(!(y<g))return[3,10];for(;y<g&&!p[y];)++y;if(y>=g)return[3,10];O.label=2;case 2:O.trys.push([2,7,8,9]),I=void 0,T=s(p[y]),b=T.next(),O.label=3;case 3:return b.done?[3,6]:[4,b.value];case 4:O.sent(),O.label=5;case 5:return b=T.next(),[3,3];case 6:return[3,9];case 7:return S=O.sent(),I={error:S},[3,9];case 8:try{b&&!b.done&&(D=T.return)&&D.call(T)}finally{if(I)throw I.error}return[7];case 9:return++y,[3,1];case 10:return[2]}})})()},c.forEach(function(y){var T=y.key,b=y.value;return f.setElement(T,b)}),Object.freeze(this)}h.initSize=16,h.maxSize=1<<30,h.sigma=.75,h.treeifyThreshold=8,h.untreeifyThreshold=6,h.minTreeifySize=64,Object.freeze(h),n.default=h},{"../LinkList/LinkList":29,"../Map/Map":30}],28:[function(i,r,n){var a=this&&this.__generator||function(c,u){var d,f,m,p,g={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return p={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function y(T){return function(b){return(function(S){if(d)throw new TypeError("Generator is already executing.");for(;g;)try{if(d=1,f&&(m=2&S[0]?f.return:S[0]?f.throw||((m=f.return)&&m.call(f),0):f.next)&&!(m=m.call(f,S[1])).done)return m;switch(f=0,m&&(S=[2&S[0],m.value]),S[0]){case 0:case 1:m=S;break;case 4:return g.label++,{value:S[1],done:!1};case 5:g.label++,f=S[1],S=[0];continue;case 7:S=g.ops.pop(),g.trys.pop();continue;default:if(!(m=(m=g.trys).length>0&&m[m.length-1])&&(S[0]===6||S[0]===2)){g=0;continue}if(S[0]===3&&(!m||S[1]>m[0]&&S[1]<m[3])){g.label=S[1];break}if(S[0]===6&&g.label<m[1]){g.label=m[1],m=S;break}if(m&&g.label<m[2]){g.label=m[2],g.ops.push(S);break}m[2]&&g.ops.pop(),g.trys.pop();continue}S=u.call(c,g)}catch(I){S=[6,I],f=0}finally{d=m=0}if(5&S[0])throw S[1];return{value:S[0]?S[1]:void 0,done:!0}})([T,b])}}},s=this&&this.__values||function(c){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&c[u],f=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&f>=c.length&&(c=void 0),{value:c&&c[f++],done:!c}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var o=i("../Set/Set"),l=i("../LinkList/LinkList");function h(c,u,d){var f=this;if(c===void 0&&(c=[]),u===void 0&&(u=h.initSize),d=d||function(y){var T=0,b="";if(typeof y=="number")T=((T=Math.floor(y))<<5)-T,T&=T;else{b=typeof y!="string"?JSON.stringify(y):y;for(var S=0;S<b.length;S++)T=(T<<5)-T+b.charCodeAt(S),T&=T}return T^=T>>>16},(u&u-1)!=0)throw new Error("initBucketNum must be 2 to the power of n");var m=0,p=[],g=Math.max(h.initSize,Math.min(h.maxSize,u));this.size=function(){return m},this.empty=function(){return m===0},this.clear=function(){m=0,g=u,p=[]},this.forEach=function(y){var T=0;p.forEach(function(b){b.forEach(function(S){y(S,T++)})})},this.insert=function(y){if(y==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");var T=d(y)&g-1;if(p[T]){var b=p[T].size();if(p[T]instanceof l.default){if(p[T].find(y))return;p[T].pushBack(y),p[T].size()>=h.treeifyThreshold&&(p[T]=new o.default(p[T]))}else p[T].insert(y);var S=p[T].size();m+=S-b}else p[T]=new l.default([y]),++m;m>g*h.sigma&&(function(I){if(!(I>=h.maxSize)){g=2*I;var D=[];p.forEach(function(O,P){if(!O.empty()){if(O instanceof l.default&&O.size()===1){var q=O.front();if(q===void 0)throw new Error("unknown error");D[d(q)&g-1]=new l.default([q])}else if(O instanceof o.default){var J=new l.default,A=new l.default;O.forEach(function(M){(d(M)&I)==0?J.pushBack(M):A.pushBack(M)}),J.size()>h.untreeifyThreshold?D[P]=new o.default(J):J.size()&&(D[P]=J),A.size()>h.untreeifyThreshold?D[P+I]=new o.default(A):A.size()&&(D[P+I]=A)}else{var x=new l.default,R=new l.default;O.forEach(function(M){(d(M)&I)==0?x.pushBack(M):R.pushBack(M)}),x.size()&&(D[P]=x),R.size()&&(D[P+I]=R)}p[P].clear()}}),p=D}}).call(this,g)},this.eraseElementByValue=function(y){var T=d(y)&g-1;if(p[T]){var b=p[T].size();p[T].eraseElementByValue(y),p[T]instanceof o.default&&p[T].size()<=h.untreeifyThreshold&&(p[T]=new l.default(p[T]));var S=p[T].size();m+=S-b}},this.find=function(y){var T=d(y)&g-1;return!!p[T]&&p[T].find(y)},this[Symbol.iterator]=function(){return(function(){var y,T,b,S,I,D;return a(this,function(O){switch(O.label){case 0:y=0,O.label=1;case 1:if(!(y<g))return[3,10];for(;y<g&&!p[y];)++y;if(y>=g)return[3,10];O.label=2;case 2:O.trys.push([2,7,8,9]),I=void 0,T=s(p[y]),b=T.next(),O.label=3;case 3:return b.done?[3,6]:[4,b.value];case 4:O.sent(),O.label=5;case 5:return b=T.next(),[3,3];case 6:return[3,9];case 7:return S=O.sent(),I={error:S},[3,9];case 8:try{b&&!b.done&&(D=T.return)&&D.call(T)}finally{if(I)throw I.error}return[7];case 9:return++y,[3,1];case 10:return[2]}})})()},c.forEach(function(y){return f.insert(y)}),Object.freeze(this)}h.initSize=16,h.maxSize=1<<30,h.sigma=.75,h.treeifyThreshold=8,h.untreeifyThreshold=6,h.minTreeifySize=64,Object.freeze(h),n.default=h},{"../LinkList/LinkList":29,"../Set/Set":33}],29:[function(i,r,n){var a=this&&this.__generator||function(l,h){var c,u,d,f,m={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(y){return(function(T){if(c)throw new TypeError("Generator is already executing.");for(;m;)try{if(c=1,u&&(d=2&T[0]?u.return:T[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,T[1])).done)return d;switch(u=0,d&&(T=[2&T[0],d.value]),T[0]){case 0:case 1:d=T;break;case 4:return m.label++,{value:T[1],done:!1};case 5:m.label++,u=T[1],T=[0];continue;case 7:T=m.ops.pop(),m.trys.pop();continue;default:if(!(d=(d=m.trys).length>0&&d[d.length-1])&&(T[0]===6||T[0]===2)){m=0;continue}if(T[0]===3&&(!d||T[1]>d[0]&&T[1]<d[3])){m.label=T[1];break}if(T[0]===6&&m.label<d[1]){m.label=d[1],d=T;break}if(d&&m.label<d[2]){m.label=d[2],m.ops.push(T);break}d[2]&&m.ops.pop(),m.trys.pop();continue}T=h.call(l,m)}catch(b){T=[6,b],u=0}finally{c=d=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}})([g,y])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=(function(){return function(l){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=l}})();function o(l){var h=this;l===void 0&&(l=[]);var c=0,u=void 0,d=void 0;this.size=function(){return c},this.empty=function(){return c===0},this.clear=function(){u=d=void 0,c=0},this.front=function(){return u==null?void 0:u.value},this.back=function(){return d==null?void 0:d.value},this.forEach=function(f){for(var m=u,p=0;m;){if(m.value===void 0)throw new Error("unknown error");f(m.value,p++),m=m.next}},this.getElementByPos=function(f){if(f<0||f>=c)throw new Error("pos must more then 0 and less then the list length");for(var m=u;f--&&m;)m=m.next;if(!m||m.value===void 0)throw new Error("unknown error");return m.value},this.eraseElementByPos=function(f){if(f<0||f>=c)throw new Error("erase pos must more then 0 and less then the list length");if(f===0)this.popFront();else if(f===c-1)this.popBack();else{for(var m=u;f--;){if(!(m!=null&&m.next))throw new Error("unknown error");m=m.next}if(!m||!m.pre||!m.next)throw new Error("unknown error");var p=m.pre,g=m.next;g.pre=p,p.next=g,c>0&&--c}},this.eraseElementByValue=function(f){for(;u&&u.value===f;)this.popFront();for(;d&&d.value===f;)this.popBack();if(u)for(var m=u;m;){if(m.value===f){var p=m.pre,g=m.next;g&&(g.pre=p),p&&(p.next=g),c>0&&--c}m=m.next}},this.pushBack=function(f){if(f==null)throw new Error("you can't push null or undefined here");++c;var m=new s(f);d?(d.next=m,m.pre=d,d=m):u=d=m},this.popBack=function(){d&&(c>0&&--c,d&&(u===d?u=d=void 0:(d=d.pre)&&(d.next=void 0)))},this.setElementByPos=function(f,m){if(m==null)throw new Error("you can't set null or undefined here");if(f<0||f>=c)throw new Error("pos must more then 0 and less then the list length");for(var p=u;f--;){if(!p)throw new Error("unknown error");p=p.next}p&&(p.value=m)},this.insert=function(f,m,p){if(p===void 0&&(p=1),m==null)throw new Error("you can't insert null or undefined here");if(f<0||f>c)throw new Error("insert pos must more then 0 and less then or equal to the list length");if(p<0)throw new Error("insert size must more than 0");if(f===0)for(;p--;)this.pushFront(m);else if(f===c)for(;p--;)this.pushBack(m);else{for(var g=u,y=1;y<f;++y){if(!(g!=null&&g.next))throw new Error("unknown error");g=g==null?void 0:g.next}if(!g)throw new Error("unknown error");var T=g.next;for(c+=p;p--;)g.next=new s(m),g.next.pre=g,g=g.next;g.next=T,T&&(T.pre=g)}},this.find=function(f){for(var m=u;m;){if(m.value===f)return!0;m=m.next}return!1},this.reverse=function(){for(var f=u,m=d,p=0;f&&m&&2*p<c;){var g=f.value;f.value=m.value,m.value=g,f=f.next,m=m.pre,++p}},this.unique=function(){for(var f=u;f;){for(var m=f;m&&m.next&&m.value===m.next.value;)m=m.next,c>0&&--c;f.next=m.next,f.next&&(f.next.pre=f),f=f.next}},this.sort=function(f){var m=[];this.forEach(function(g){m.push(g)}),m.sort(f);var p=u;m.forEach(function(g){p&&(p.value=g,p=p.next)})},this.pushFront=function(f){if(f==null)throw new Error("you can't push null or undefined here");++c;var m=new s(f);u?(m.next=u,u.pre=m,u=m):u=d=m},this.popFront=function(){u&&(c>0&&--c,u&&(u===d?u=d=void 0:(u=u.next)&&(u.pre=void 0)))},this.merge=function(f){var m=this,p=u;f.forEach(function(g){for(;p&&p.value!==void 0&&p.value<=g;)p=p.next;if(p===void 0)m.pushBack(g),p=d;else if(p===u)m.pushFront(g),p=u;else{++c;var y=p.pre;y&&(y.next=new s(g),y.next.pre=y,y.next.next=p,p&&(p.pre=y.next))}})},this[Symbol.iterator]=function(){return(function(){var f;return a(this,function(m){switch(m.label){case 0:f=u,m.label=1;case 1:if(f===void 0)return[3,3];if(!f.value)throw new Error("unknown error");return[4,f.value];case 2:return m.sent(),f=f.next,[3,1];case 3:return[2]}})})()},l.forEach(function(f){return h.pushBack(f)}),Object.freeze(this)}Object.freeze(o),n.default=o},{}],30:[function(i,r,n){var a=this&&this.__generator||function(h,c){var u,d,f,m,p={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return m={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function g(y){return function(T){return(function(b){if(u)throw new TypeError("Generator is already executing.");for(;p;)try{if(u=1,d&&(f=2&b[0]?d.return:b[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,b[1])).done)return f;switch(d=0,f&&(b=[2&b[0],f.value]),b[0]){case 0:case 1:f=b;break;case 4:return p.label++,{value:b[1],done:!1};case 5:p.label++,d=b[1],b=[0];continue;case 7:b=p.ops.pop(),p.trys.pop();continue;default:if(!(f=(f=p.trys).length>0&&f[f.length-1])&&(b[0]===6||b[0]===2)){p=0;continue}if(b[0]===3&&(!f||b[1]>f[0]&&b[1]<f[3])){p.label=b[1];break}if(b[0]===6&&p.label<f[1]){p.label=f[1],f=b;break}if(f&&p.label<f[2]){p.label=f[2],p.ops.push(b);break}f[2]&&p.ops.pop(),p.trys.pop();continue}b=c.call(h,p)}catch(S){b=[6,S],d=0}finally{u=f=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}})([y,T])}}},s=this&&this.__values||function(h){var c=typeof Symbol=="function"&&Symbol.iterator,u=c&&h[c],d=0;if(u)return u.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&d>=h.length&&(h=void 0),{value:h&&h[d++],done:!h}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var o=i("../Base/TreeNode");function l(h,c){var u=this;h===void 0&&(h=[]),c=c||function(A,x){return A<x?-1:A>x?1:0};var d=0,f=new o.default;f.color=o.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,f.key=f.value=void 0,f.leftChild=f.rightChild=f.brother=void 0};var m=function(A){if(!A||A.key===void 0)throw new Error("unknown error");return A.leftChild?m(A.leftChild):A},p=function(A){if(!A||A.key===void 0)throw new Error("unknown error");return A.rightChild?p(A.rightChild):A};this.front=function(){if(!this.empty()){var A=m(f);if(A.key===void 0||A.value===void 0)throw new Error("unknown error");return{key:A.key,value:A.value}}},this.back=function(){if(!this.empty()){var A=p(f);if(A.key===void 0||A.value===void 0)throw new Error("unknown error");return{key:A.key,value:A.value}}},this.forEach=function(A){var x,R,M=0;try{for(var Y=s(this),X=Y.next();!X.done;X=Y.next())A(X.value,M++)}catch(et){x={error:et}}finally{try{X&&!X.done&&(R=Y.return)&&R.call(Y)}finally{if(x)throw x.error}}},this.getElementByPos=function(A){var x,R;if(A<0||A>=this.size())throw new Error("pos must more than 0 and less than set's size");var M=0;try{for(var Y=s(this),X=Y.next();!X.done;X=Y.next()){var et=X.value;if(M===A)return et;++M}}catch(z){x={error:z}}finally{try{X&&!X.done&&(R=Y.return)&&R.call(Y)}finally{if(x)throw x.error}}throw new Error("unknown Error")};var g=function(A,x){if(A&&A.key!==void 0&&A.value!==void 0){var R=c(A.key,x);return R===0?{key:A.key,value:A.value}:R<0?g(A.rightChild,x):g(A.leftChild,x)||{key:A.key,value:A.value}}};this.lowerBound=function(A){return g(f,A)};var y=function(A,x){if(A&&A.key!==void 0&&A.value!==void 0)return c(A.key,x)<=0?y(A.rightChild,x):y(A.leftChild,x)||{key:A.key,value:A.value}};this.upperBound=function(A){return y(f,A)};var T=function(A,x){if(A&&A.key!==void 0&&A.value!==void 0){var R=c(A.key,x);return R===0?{key:A.key,value:A.value}:R>0?T(A.leftChild,x):T(A.rightChild,x)||{key:A.key,value:A.value}}};this.reverseLowerBound=function(A){return T(f,A)};var b=function(A,x){if(A&&A.key!==void 0&&A.value!==void 0)return c(A.key,x)>=0?b(A.leftChild,x):b(A.rightChild,x)||{key:A.key,value:A.value}};this.reverseUpperBound=function(A){return b(f,A)};var S=function(A){var x=A.parent;if(!x){if(A===f)return;throw new Error("unknown error")}if(A.color!==o.default.TreeNodeColorType.red){var R=A.brother;if(!R)throw new Error("unknown error");if(A===x.leftChild)if(R.color===o.default.TreeNodeColorType.red){R.color=o.default.TreeNodeColorType.black,x.color=o.default.TreeNodeColorType.red;var M=x.rotateLeft();f===x&&(f=M),S(A)}else R.color===o.default.TreeNodeColorType.black&&(R.rightChild&&R.rightChild.color===o.default.TreeNodeColorType.red?(R.color=x.color,x.color=o.default.TreeNodeColorType.black,R.rightChild&&(R.rightChild.color=o.default.TreeNodeColorType.black),M=x.rotateLeft(),f===x&&(f=M),A.color=o.default.TreeNodeColorType.black):R.rightChild&&R.rightChild.color!==o.default.TreeNodeColorType.black||!R.leftChild||R.leftChild.color!==o.default.TreeNodeColorType.red?R.leftChild&&R.leftChild.color!==o.default.TreeNodeColorType.black||R.rightChild&&R.rightChild.color!==o.default.TreeNodeColorType.black||(R.color=o.default.TreeNodeColorType.red,S(x)):(R.color=o.default.TreeNodeColorType.red,R.leftChild&&(R.leftChild.color=o.default.TreeNodeColorType.black),M=R.rotateRight(),f===R&&(f=M),S(A)));else A===x.rightChild&&(R.color===o.default.TreeNodeColorType.red?(R.color=o.default.TreeNodeColorType.black,x.color=o.default.TreeNodeColorType.red,M=x.rotateRight(),f===x&&(f=M),S(A)):R.color===o.default.TreeNodeColorType.black&&(R.leftChild&&R.leftChild.color===o.default.TreeNodeColorType.red?(R.color=x.color,x.color=o.default.TreeNodeColorType.black,R.leftChild&&(R.leftChild.color=o.default.TreeNodeColorType.black),M=x.rotateRight(),f===x&&(f=M),A.color=o.default.TreeNodeColorType.black):R.leftChild&&R.leftChild.color!==o.default.TreeNodeColorType.black||!R.rightChild||R.rightChild.color!==o.default.TreeNodeColorType.red?R.leftChild&&R.leftChild.color!==o.default.TreeNodeColorType.black||R.rightChild&&R.rightChild.color!==o.default.TreeNodeColorType.black||(R.color=o.default.TreeNodeColorType.red,S(x)):(R.color=o.default.TreeNodeColorType.red,R.rightChild&&(R.rightChild.color=o.default.TreeNodeColorType.black),M=R.rotateLeft(),f===R&&(f=M),S(A))))}else A.color=o.default.TreeNodeColorType.black},I=function(A){for(var x=A;x.leftChild||x.rightChild;){if(x.rightChild){x=m(x.rightChild);var R=A.key;A.key=x.key,x.key=R;var M=A.value;A.value=x.value,x.value=M,A=x}x.leftChild&&(x=p(x.leftChild),R=A.key,A.key=x.key,x.key=R,M=A.value,A.value=x.value,x.value=M,A=x)}S(x),x&&x.remove(),--d,f.color=o.default.TreeNodeColorType.black},D=function(A,x){return!(!A||A.key===void 0)&&(!!D(A.leftChild,x)||!!x(A)||D(A.rightChild,x))};this.eraseElementByPos=function(A){if(A<0||A>=d)throw new Error("pos must more than 0 and less than set's size");var x=0;D(f,function(R){return A===x?(I(R),!0):(++x,!1)})},this.eraseElementByKey=function(A){if(!this.empty()){var x=q(f,A);x!==void 0&&x.key!==void 0&&c(x.key,A)===0&&I(x)}};var O=function(A,x){if(!A||A.key===void 0)throw new Error("unknown error");var R=c(x,A.key);return R<0?A.leftChild?O(A.leftChild,x):(A.leftChild=new o.default,A.leftChild.parent=A,A.leftChild.brother=A.rightChild,A.rightChild&&(A.rightChild.brother=A.leftChild),A.leftChild):R>0?A.rightChild?O(A.rightChild,x):(A.rightChild=new o.default,A.rightChild.parent=A,A.rightChild.brother=A.leftChild,A.leftChild&&(A.leftChild.brother=A.rightChild),A.rightChild):A},P=function(A){var x=A.parent;if(!x){if(A===f)return;throw new Error("unknown error")}if(x.color!==o.default.TreeNodeColorType.black&&x.color===o.default.TreeNodeColorType.red){var R=x.brother,M=x.parent;if(!M)throw new Error("unknown error");if(R&&R.color===o.default.TreeNodeColorType.red)R.color=x.color=o.default.TreeNodeColorType.black,M.color=o.default.TreeNodeColorType.red,P(M);else if(!R||R.color===o.default.TreeNodeColorType.black)if(x===M.leftChild)if(A===x.leftChild){x.color=o.default.TreeNodeColorType.black,M.color=o.default.TreeNodeColorType.red;var Y=M.rotateRight();M===f&&(f=Y)}else A===x.rightChild&&(Y=x.rotateLeft(),M===f&&(f=Y),P(x));else x===M.rightChild&&(A===x.leftChild?(Y=x.rotateRight(),M===f&&(f=Y),P(x)):A===x.rightChild&&(x.color=o.default.TreeNodeColorType.black,M.color=o.default.TreeNodeColorType.red,Y=M.rotateLeft(),M===f&&(f=Y)))}};this.setElement=function(A,x){if(A==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(x!=null){if(this.empty())return++d,f.key=A,f.value=x,void(f.color=o.default.TreeNodeColorType.black);var R=O(f,A);R.key===void 0||c(R.key,A)!==0?(++d,R.key=A,R.value=x,P(R),f.color=o.default.TreeNodeColorType.black):R.value=x}else this.eraseElementByKey(A)};var q=function(A,x){if(A&&A.key!==void 0){var R=c(x,A.key);return R<0?q(A.leftChild,x):R>0?q(A.rightChild,x):A}};this.find=function(A){return!!q(f,A)},this.getElementByKey=function(A){var x=q(f,A);if((x==null?void 0:x.key)===void 0||(x==null?void 0:x.value)===void 0)throw new Error("unknown error");return x.value},this.union=function(A){var x=this;A.forEach(function(R){var M=R.key,Y=R.value;return x.setElement(M,Y)})},this.getHeight=function(){if(this.empty())return 0;var A=function(x){return x?Math.max(A(x.leftChild),A(x.rightChild))+1:1};return A(f)};var J=function(A){return a(this,function(x){switch(x.label){case 0:return A&&A.key!==void 0&&A.value!==void 0?[5,s(J(A.leftChild))]:[2];case 1:return x.sent(),[4,{key:A.key,value:A.value}];case 2:return x.sent(),[5,s(J(A.rightChild))];case 3:return x.sent(),[2]}})};this[Symbol.iterator]=function(){return J(f)},h.forEach(function(A){var x=A.key,R=A.value;return u.setElement(x,R)}),Object.freeze(this)}Object.freeze(l),n.default=l},{"../Base/TreeNode":25}],31:[function(i,r,n){function a(s,o){s===void 0&&(s=[]),o=o||function(d,f){return d>f?-1:d<f?1:0};var l=[];s.forEach(function(d){return l.push(d)});var h=l.length,c=function(d,f){if(d<0||d>=h)throw new Error("unknown error");if(f<0||f>=h)throw new Error("unknown error");var m=l[d];l[d]=l[f],l[f]=m},u=function(d){if(d<0||d>=h)throw new Error("unknown error");var f=2*d+1,m=2*d+2;f<h&&o(l[d],l[f])>0&&c(d,f),m<h&&o(l[d],l[m])>0&&c(d,m)};(function(){for(var d=Math.floor((h-1)/2);d>=0;--d)for(var f=d,m=2*f+1;m<h;){var p=m+1,g=m;if(p<h&&o(l[m],l[p])>0&&(g=p),o(l[f],l[g])<=0)break;c(f,g),m=2*(f=g)+1}})(),this.size=function(){return h},this.empty=function(){return h===0},this.clear=function(){h=0,l.length=0},this.push=function(d){if(l.push(d),++h!==1)for(var f=h-1;f>0;){var m=Math.floor((f-1)/2);if(o(l[m],d)<=0)break;u(m),f=m}},this.pop=function(){if(!this.empty())if(this.size()!==1){var d=l[h-1];--h;for(var f=0;f<this.size();){var m=2*f+1,p=2*f+2;if(m>=this.size())break;var g=m;if(p<this.size()&&o(l[m],l[p])>0&&(g=p),o(l[g],d)>=0)break;l[f]=l[g],f=g}l[f]=d}else--h},this.top=function(){return l[0]},Object.freeze(this)}Object.defineProperty(n,"__esModule",{value:!0}),Object.freeze(a),n.default=a},{}],32:[function(i,r,n){Object.defineProperty(n,"__esModule",{value:!0});var a=i("../LinkList/LinkList");function s(o){o===void 0&&(o=[]);var l=new a.default(o);this.size=function(){return l.size()},this.empty=function(){return l.empty()},this.clear=function(){l.clear()},this.push=function(h){l.pushBack(h)},this.pop=function(){l.popFront()},this.front=function(){return l.front()},Object.freeze(this)}Object.freeze(s),n.default=s},{"../LinkList/LinkList":29}],33:[function(i,r,n){var a=this&&this.__generator||function(h,c){var u,d,f,m,p={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return m={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function g(y){return function(T){return(function(b){if(u)throw new TypeError("Generator is already executing.");for(;p;)try{if(u=1,d&&(f=2&b[0]?d.return:b[0]?d.throw||((f=d.return)&&f.call(d),0):d.next)&&!(f=f.call(d,b[1])).done)return f;switch(d=0,f&&(b=[2&b[0],f.value]),b[0]){case 0:case 1:f=b;break;case 4:return p.label++,{value:b[1],done:!1};case 5:p.label++,d=b[1],b=[0];continue;case 7:b=p.ops.pop(),p.trys.pop();continue;default:if(!(f=(f=p.trys).length>0&&f[f.length-1])&&(b[0]===6||b[0]===2)){p=0;continue}if(b[0]===3&&(!f||b[1]>f[0]&&b[1]<f[3])){p.label=b[1];break}if(b[0]===6&&p.label<f[1]){p.label=f[1],f=b;break}if(f&&p.label<f[2]){p.label=f[2],p.ops.push(b);break}f[2]&&p.ops.pop(),p.trys.pop();continue}b=c.call(h,p)}catch(S){b=[6,S],d=0}finally{u=f=0}if(5&b[0])throw b[1];return{value:b[0]?b[1]:void 0,done:!0}})([y,T])}}},s=this&&this.__values||function(h){var c=typeof Symbol=="function"&&Symbol.iterator,u=c&&h[c],d=0;if(u)return u.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&d>=h.length&&(h=void 0),{value:h&&h[d++],done:!h}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var o=i("../Base/TreeNode");function l(h,c){var u=this;h===void 0&&(h=[]),c=c||function(A,x){return A<x?-1:A>x?1:0};var d=0,f=new o.default;f.color=o.default.TreeNodeColorType.black,this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,f.key=void 0,f.leftChild=f.rightChild=f.brother=f.parent=void 0,f.color=o.default.TreeNodeColorType.black};var m=function(A){if(!A||A.key===void 0)throw new Error("unknown error");return A.leftChild?m(A.leftChild):A},p=function(A){if(!A||A.key===void 0)throw new Error("unknown error");return A.rightChild?p(A.rightChild):A};this.front=function(){if(!this.empty())return m(f).key},this.back=function(){if(!this.empty())return p(f).key},this.forEach=function(A){var x,R,M=0;try{for(var Y=s(this),X=Y.next();!X.done;X=Y.next())A(X.value,M++)}catch(et){x={error:et}}finally{try{X&&!X.done&&(R=Y.return)&&R.call(Y)}finally{if(x)throw x.error}}},this.getElementByPos=function(A){var x,R;if(A<0||A>=this.size())throw new Error("pos must more than 0 and less than set's size");var M=0;try{for(var Y=s(this),X=Y.next();!X.done;X=Y.next()){var et=X.value;if(M===A)return et;++M}}catch(z){x={error:z}}finally{try{X&&!X.done&&(R=Y.return)&&R.call(Y)}finally{if(x)throw x.error}}throw new Error("unknown error")};var g=function(A){var x=A.parent;if(!x){if(A===f)return;throw new Error("unknown error")}if(A.color!==o.default.TreeNodeColorType.red){var R=A.brother;if(!R)throw new Error("unknown error");if(A===x.leftChild)if(R.color===o.default.TreeNodeColorType.red){R.color=o.default.TreeNodeColorType.black,x.color=o.default.TreeNodeColorType.red;var M=x.rotateLeft();f===x&&(f=M),g(A)}else R.color===o.default.TreeNodeColorType.black&&(R.rightChild&&R.rightChild.color===o.default.TreeNodeColorType.red?(R.color=x.color,x.color=o.default.TreeNodeColorType.black,R.rightChild&&(R.rightChild.color=o.default.TreeNodeColorType.black),M=x.rotateLeft(),f===x&&(f=M),A.color=o.default.TreeNodeColorType.black):R.rightChild&&R.rightChild.color!==o.default.TreeNodeColorType.black||!R.leftChild||R.leftChild.color!==o.default.TreeNodeColorType.red?R.leftChild&&R.leftChild.color!==o.default.TreeNodeColorType.black||R.rightChild&&R.rightChild.color!==o.default.TreeNodeColorType.black||(R.color=o.default.TreeNodeColorType.red,g(x)):(R.color=o.default.TreeNodeColorType.red,R.leftChild&&(R.leftChild.color=o.default.TreeNodeColorType.black),M=R.rotateRight(),f===R&&(f=M),g(A)));else A===x.rightChild&&(R.color===o.default.TreeNodeColorType.red?(R.color=o.default.TreeNodeColorType.black,x.color=o.default.TreeNodeColorType.red,M=x.rotateRight(),f===x&&(f=M),g(A)):R.color===o.default.TreeNodeColorType.black&&(R.leftChild&&R.leftChild.color===o.default.TreeNodeColorType.red?(R.color=x.color,x.color=o.default.TreeNodeColorType.black,R.leftChild&&(R.leftChild.color=o.default.TreeNodeColorType.black),M=x.rotateRight(),f===x&&(f=M),A.color=o.default.TreeNodeColorType.black):R.leftChild&&R.leftChild.color!==o.default.TreeNodeColorType.black||!R.rightChild||R.rightChild.color!==o.default.TreeNodeColorType.red?R.leftChild&&R.leftChild.color!==o.default.TreeNodeColorType.black||R.rightChild&&R.rightChild.color!==o.default.TreeNodeColorType.black||(R.color=o.default.TreeNodeColorType.red,g(x)):(R.color=o.default.TreeNodeColorType.red,R.rightChild&&(R.rightChild.color=o.default.TreeNodeColorType.black),M=R.rotateLeft(),f===R&&(f=M),g(A))))}else A.color=o.default.TreeNodeColorType.black},y=function(A){for(var x=A;x.leftChild||x.rightChild;){if(x.rightChild){x=m(x.rightChild);var R=A.key;A.key=x.key,x.key=R,A=x}x.leftChild&&(x=p(x.leftChild),R=A.key,A.key=x.key,x.key=R,A=x)}g(x),x&&x.remove(),--d,f.color=o.default.TreeNodeColorType.black},T=function(A,x){return!(!A||A.key===void 0)&&(!!T(A.leftChild,x)||!!x(A)||T(A.rightChild,x))};this.eraseElementByPos=function(A){if(A<0||A>=d)throw new Error("pos must more than 0 and less than set's size");var x=0;T(f,function(R){return A===x?(y(R),!0):(++x,!1)})},this.eraseElementByValue=function(A){if(!this.empty()){var x=I(f,A);x!==void 0&&x.key!==void 0&&c(x.key,A)===0&&y(x)}};var b=function(A,x){if(!A||A.key===void 0)throw new Error("unknown error");var R=c(x,A.key);return R<0?A.leftChild?b(A.leftChild,x):(A.leftChild=new o.default,A.leftChild.parent=A,A.leftChild.brother=A.rightChild,A.rightChild&&(A.rightChild.brother=A.leftChild),A.leftChild):R>0?A.rightChild?b(A.rightChild,x):(A.rightChild=new o.default,A.rightChild.parent=A,A.rightChild.brother=A.leftChild,A.leftChild&&(A.leftChild.brother=A.rightChild),A.rightChild):A},S=function(A){var x=A.parent;if(!x){if(A===f)return;throw new Error("unknown error")}if(x.color!==o.default.TreeNodeColorType.black&&x.color===o.default.TreeNodeColorType.red){var R=x.brother,M=x.parent;if(!M)throw new Error("unknown error");if(R&&R.color===o.default.TreeNodeColorType.red)R.color=x.color=o.default.TreeNodeColorType.black,M.color=o.default.TreeNodeColorType.red,S(M);else if(!R||R.color===o.default.TreeNodeColorType.black)if(x===M.leftChild)if(A===x.leftChild){x.color=o.default.TreeNodeColorType.black,M.color=o.default.TreeNodeColorType.red;var Y=M.rotateRight();M===f&&(f=Y)}else A===x.rightChild&&(Y=x.rotateLeft(),M===f&&(f=Y),S(x));else x===M.rightChild&&(A===x.leftChild?(Y=x.rotateRight(),M===f&&(f=Y),S(x)):A===x.rightChild&&(x.color=o.default.TreeNodeColorType.black,M.color=o.default.TreeNodeColorType.red,Y=M.rotateLeft(),M===f&&(f=Y)))}};this.insert=function(A){if(A==null)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++d,f.key=A,void(f.color=o.default.TreeNodeColorType.black);var x=b(f,A);x.key!==void 0&&c(x.key,A)===0||(++d,x.key=A,S(x),f.color=o.default.TreeNodeColorType.black)};var I=function(A,x){if(A&&A.key!==void 0){var R=c(x,A.key);return R<0?I(A.leftChild,x):R>0?I(A.rightChild,x):A}};this.find=function(A){var x=I(f,A);return x!==void 0&&x.key!==void 0&&c(x.key,A)===0};var D=function(A,x){if(A&&A.key!==void 0){var R=c(A.key,x);if(R===0)return A.key;if(R<0)return D(A.rightChild,x);var M=D(A.leftChild,x);return M!==void 0?M:A.key}};this.lowerBound=function(A){return D(f,A)};var O=function(A,x){if(A&&A.key!==void 0){if(c(A.key,x)<=0)return O(A.rightChild,x);var R=O(A.leftChild,x);return R!==void 0?R:A.key}};this.upperBound=function(A){return O(f,A)};var P=function(A,x){if(A&&A.key!==void 0){var R=c(A.key,x);if(R===0)return A.key;if(R>0)return P(A.leftChild,x);var M=P(A.rightChild,x);return M!==void 0?M:A.key}};this.reverseLowerBound=function(A){return P(f,A)};var q=function(A,x){if(A&&A.key!==void 0){if(c(A.key,x)>=0)return q(A.leftChild,x);var R=q(A.rightChild,x);return R!==void 0?R:A.key}};this.reverseUpperBound=function(A){return q(f,A)},this.union=function(A){var x=this;A.forEach(function(R){return x.insert(R)})},this.getHeight=function(){if(this.empty())return 0;var A=function(x){return x?Math.max(A(x.leftChild),A(x.rightChild))+1:1};return A(f)};var J=function(A){return a(this,function(x){switch(x.label){case 0:return A&&A.key!==void 0?[5,s(J(A.leftChild))]:[2];case 1:return x.sent(),[4,A.key];case 2:return x.sent(),[5,s(J(A.rightChild))];case 3:return x.sent(),[2]}})};this[Symbol.iterator]=function(){return J(f)},h.forEach(function(A){return u.insert(A)}),Object.freeze(this)}Object.freeze(l),n.default=l},{"../Base/TreeNode":25}],34:[function(i,r,n){function a(s){var o=this;s===void 0&&(s=[]);var l=0,h=[];this.size=function(){return l},this.empty=function(){return l===0},this.clear=function(){l=0,h.length=0},this.push=function(c){h.push(c),++l},this.pop=function(){h.pop(),l>0&&--l},this.top=function(){return h[l-1]},s.forEach(function(c){return o.push(c)}),Object.freeze(this)}Object.defineProperty(n,"__esModule",{value:!0}),Object.freeze(a),n.default=a},{}],35:[function(i,r,n){var a=this&&this.__generator||function(c,u){var d,f,m,p,g={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return p={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function y(T){return function(b){return(function(S){if(d)throw new TypeError("Generator is already executing.");for(;g;)try{if(d=1,f&&(m=2&S[0]?f.return:S[0]?f.throw||((m=f.return)&&m.call(f),0):f.next)&&!(m=m.call(f,S[1])).done)return m;switch(f=0,m&&(S=[2&S[0],m.value]),S[0]){case 0:case 1:m=S;break;case 4:return g.label++,{value:S[1],done:!1};case 5:g.label++,f=S[1],S=[0];continue;case 7:S=g.ops.pop(),g.trys.pop();continue;default:if(!(m=(m=g.trys).length>0&&m[m.length-1])&&(S[0]===6||S[0]===2)){g=0;continue}if(S[0]===3&&(!m||S[1]>m[0]&&S[1]<m[3])){g.label=S[1];break}if(S[0]===6&&g.label<m[1]){g.label=m[1],m=S;break}if(m&&g.label<m[2]){g.label=m[2],g.ops.push(S);break}m[2]&&g.ops.pop(),g.trys.pop();continue}S=u.call(c,g)}catch(I){S=[6,I],f=0}finally{d=m=0}if(5&S[0])throw S[1];return{value:S[0]?S[1]:void 0,done:!0}})([T,b])}}},s=this&&this.__read||function(c,u){var d=typeof Symbol=="function"&&c[Symbol.iterator];if(!d)return c;var f,m,p=d.call(c),g=[];try{for(;(u===void 0||u-- >0)&&!(f=p.next()).done;)g.push(f.value)}catch(y){m={error:y}}finally{try{f&&!f.done&&(d=p.return)&&d.call(p)}finally{if(m)throw m.error}}return g},o=this&&this.__spreadArray||function(c,u,d){if(d||arguments.length===2)for(var f,m=0,p=u.length;m<p;m++)!f&&m in u||(f||(f=Array.prototype.slice.call(u,0,m)),f[m]=u[m]);return c.concat(f||Array.prototype.slice.call(u))},l=this&&this.__values||function(c){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&c[u],f=0;if(d)return d.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&f>=c.length&&(c=void 0),{value:c&&c[f++],done:!c}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};function h(c){var u=this;c===void 0&&(c=[]);var d=0,f=[];this.size=function(){return d},this.empty=function(){return d===0},this.clear=function(){d=0,f.length=0},this.front=function(){if(!this.empty())return f[0]},this.back=function(){if(!this.empty())return f[d-1]},this.forEach=function(m){f.forEach(m)},this.getElementByPos=function(m){if(m<0||m>=d)throw new Error("pos must more than 0 and less than vector's size");return f[m]},this.eraseElementByPos=function(m){if(m<0||m>=d)throw new Error("pos must more than 0 and less than vector's size");for(var p=m;p<d-1;++p)f[p]=f[p+1];this.popBack()},this.eraseElementByValue=function(m){var p=[];this.forEach(function(y){y!==m&&p.push(y)}),p.forEach(function(y,T){f[T]=y});for(var g=p.length;d>g;)this.popBack()},this.pushBack=function(m){f.push(m),++d},this.popBack=function(){f.pop(),d>0&&--d},this.setElementByPos=function(m,p){if(m<0||m>=d)throw new Error("pos must more than 0 and less than vector's size");f[m]=p},this.insert=function(m,p,g){if(g===void 0&&(g=1),m<0||m>d)throw new Error("pos must more than 0 and less than or equal to vector's size");f.splice.apply(f,o([m,0],s(new Array(g).fill(p)),!1)),d+=g},this.find=function(m){return f.includes(m)},this.reverse=function(){f.reverse()},this.unique=function(){var m,p=[];this.forEach(function(y,T){T!==0&&y===m||(p.push(y),m=y)}),p.forEach(function(y,T){f[T]=y});for(var g=p.length;d>g;)this.popBack()},this.sort=function(m){f.sort(m)},this[Symbol.iterator]=function(){return(function(){return a(this,function(m){switch(m.label){case 0:return[5,l(f)];case 1:return[2,m.sent()]}})})()},c.forEach(function(m){return u.pushBack(m)}),Object.freeze(this)}Object.defineProperty(n,"__esModule",{value:!0}),Object.freeze(h),n.default=h},{}],36:[function(i,r,n){Object.defineProperty(n,"__esModule",{value:!0}),n.HashMap=n.HashSet=n.Map=n.Set=n.PriorityQueue=n.Deque=n.LinkList=n.Queue=n.Stack=n.Vector=void 0;var a=i("./Vector/Vector");n.Vector=a.default;var s=i("./Stack/Stack");n.Stack=s.default;var o=i("./Queue/Queue");n.Queue=o.default;var l=i("./LinkList/LinkList");n.LinkList=l.default;var h=i("./Deque/Deque");n.Deque=h.default;var c=i("./PriorityQueue/PriorityQueue");n.PriorityQueue=c.default;var u=i("./Set/Set");n.Set=u.default;var d=i("./Map/Map");n.Map=d.default;var f=i("./HashSet/HashSet");n.HashSet=f.default;var m=i("./HashMap/HashMap");n.HashMap=m.default},{"./Deque/Deque":26,"./HashMap/HashMap":27,"./HashSet/HashSet":28,"./LinkList/LinkList":29,"./Map/Map":30,"./PriorityQueue/PriorityQueue":31,"./Queue/Queue":32,"./Set/Set":33,"./Stack/Stack":34,"./Vector/Vector":35}],37:[function(i,r,n){const a=i("yallist"),s=Symbol("max"),o=Symbol("length"),l=Symbol("lengthCalculator"),h=Symbol("allowStale"),c=Symbol("maxAge"),u=Symbol("dispose"),d=Symbol("noDisposeOnSet"),f=Symbol("lruList"),m=Symbol("cache"),p=Symbol("updateAgeOnGet"),g=()=>1,y=(O,P,q)=>{const J=O[m].get(P);if(J){const A=J.value;if(T(O,A)){if(S(O,J),!O[h])return}else q&&(O[p]&&(J.value.now=Date.now()),O[f].unshiftNode(J));return A.value}},T=(O,P)=>{if(!P||!P.maxAge&&!O[c])return!1;const q=Date.now()-P.now;return P.maxAge?q>P.maxAge:O[c]&&q>O[c]},b=O=>{if(O[o]>O[s])for(let P=O[f].tail;O[o]>O[s]&&P!==null;){const q=P.prev;S(O,P),P=q}},S=(O,P)=>{if(P){const q=P.value;O[u]&&O[u](q.key,q.value),O[o]-=q.length,O[m].delete(q.key),O[f].removeNode(P)}};class I{constructor(P,q,J,A,x){this.key=P,this.value=q,this.length=J,this.now=A,this.maxAge=x||0}}const D=(O,P,q,J)=>{let A=q.value;T(O,A)&&(S(O,q),O[h]||(A=void 0)),A&&P.call(J,A.value,A.key,O)};r.exports=class{constructor(O){if(typeof O=="number"&&(O={max:O}),O||(O={}),O.max&&(typeof O.max!="number"||O.max<0))throw new TypeError("max must be a non-negative number");this[s]=O.max||1/0;const P=O.length||g;if(this[l]=typeof P!="function"?g:P,this[h]=O.stale||!1,O.maxAge&&typeof O.maxAge!="number")throw new TypeError("maxAge must be a number");this[c]=O.maxAge||0,this[u]=O.dispose,this[d]=O.noDisposeOnSet||!1,this[p]=O.updateAgeOnGet||!1,this.reset()}set max(O){if(typeof O!="number"||O<0)throw new TypeError("max must be a non-negative number");this[s]=O||1/0,b(this)}get max(){return this[s]}set allowStale(O){this[h]=!!O}get allowStale(){return this[h]}set maxAge(O){if(typeof O!="number")throw new TypeError("maxAge must be a non-negative number");this[c]=O,b(this)}get maxAge(){return this[c]}set lengthCalculator(O){typeof O!="function"&&(O=g),O!==this[l]&&(this[l]=O,this[o]=0,this[f].forEach(P=>{P.length=this[l](P.value,P.key),this[o]+=P.length})),b(this)}get lengthCalculator(){return this[l]}get length(){return this[o]}get itemCount(){return this[f].length}rforEach(O,P){P=P||this;for(let q=this[f].tail;q!==null;){const J=q.prev;D(this,O,q,P),q=J}}forEach(O,P){P=P||this;for(let q=this[f].head;q!==null;){const J=q.next;D(this,O,q,P),q=J}}keys(){return this[f].toArray().map(O=>O.key)}values(){return this[f].toArray().map(O=>O.value)}reset(){this[u]&&this[f]&&this[f].length&&this[f].forEach(O=>this[u](O.key,O.value)),this[m]=new Map,this[f]=new a,this[o]=0}dump(){return this[f].map(O=>!T(this,O)&&{k:O.key,v:O.value,e:O.now+(O.maxAge||0)}).toArray().filter(O=>O)}dumpLru(){return this[f]}set(O,P,q){if((q=q||this[c])&&typeof q!="number")throw new TypeError("maxAge must be a number");const J=q?Date.now():0,A=this[l](P,O);if(this[m].has(O)){if(A>this[s])return S(this,this[m].get(O)),!1;const R=this[m].get(O).value;return this[u]&&(this[d]||this[u](O,R.value)),R.now=J,R.maxAge=q,R.value=P,this[o]+=A-R.length,R.length=A,this.get(O),b(this),!0}const x=new I(O,P,A,J,q);return x.length>this[s]?(this[u]&&this[u](O,P),!1):(this[o]+=x.length,this[f].unshift(x),this[m].set(O,this[f].head),b(this),!0)}has(O){if(!this[m].has(O))return!1;const P=this[m].get(O).value;return!T(this,P)}get(O){return y(this,O,!0)}peek(O){return y(this,O,!1)}pop(){const O=this[f].tail;return O?(S(this,O),O.value):null}del(O){S(this,this[m].get(O))}load(O){this.reset();const P=Date.now();for(let q=O.length-1;q>=0;q--){const J=O[q],A=J.e||0;if(A===0)this.set(J.k,J.v);else{const x=A-P;x>0&&this.set(J.k,J.v,x)}}}prune(){this[m].forEach((O,P)=>y(this,P,!1))}}},{yallist:83}],38:[function(i,r,n){(function(a){(function(){const s=r.exports;s.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},s.codes={};for(const l in s.types){const h=s.types[l];s.codes[h]=l}s.CMD_SHIFT=4,s.CMD_MASK=240,s.DUP_MASK=8,s.QOS_MASK=3,s.QOS_SHIFT=1,s.RETAIN_MASK=1,s.VARBYTEINT_MASK=127,s.VARBYTEINT_FIN_MASK=128,s.VARBYTEINT_MAX=268435455,s.SESSIONPRESENT_MASK=1,s.SESSIONPRESENT_HEADER=a.from([s.SESSIONPRESENT_MASK]),s.CONNACK_HEADER=a.from([s.codes.connack<<s.CMD_SHIFT]),s.USERNAME_MASK=128,s.PASSWORD_MASK=64,s.WILL_RETAIN_MASK=32,s.WILL_QOS_MASK=24,s.WILL_QOS_SHIFT=3,s.WILL_FLAG_MASK=4,s.CLEAN_SESSION_MASK=2,s.CONNECT_HEADER=a.from([s.codes.connect<<s.CMD_SHIFT]),s.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},s.propertiesCodes={};for(const l in s.properties){const h=s.properties[l];s.propertiesCodes[h]=l}function o(l){return[0,1,2].map(h=>[0,1].map(c=>[0,1].map(u=>{const d=a.alloc(1);return d.writeUInt8(s.codes[l]<<s.CMD_SHIFT|(c?s.DUP_MASK:0)|h<<s.QOS_SHIFT|u,0,!0),d})))}s.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},s.PUBLISH_HEADER=o("publish"),s.SUBSCRIBE_HEADER=o("subscribe"),s.SUBSCRIBE_OPTIONS_QOS_MASK=3,s.SUBSCRIBE_OPTIONS_NL_MASK=1,s.SUBSCRIBE_OPTIONS_NL_SHIFT=2,s.SUBSCRIBE_OPTIONS_RAP_MASK=1,s.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,s.SUBSCRIBE_OPTIONS_RH_MASK=3,s.SUBSCRIBE_OPTIONS_RH_SHIFT=4,s.SUBSCRIBE_OPTIONS_RH=[0,16,32],s.SUBSCRIBE_OPTIONS_NL=4,s.SUBSCRIBE_OPTIONS_RAP=8,s.SUBSCRIBE_OPTIONS_QOS=[0,1,2],s.UNSUBSCRIBE_HEADER=o("unsubscribe"),s.ACKS={unsuback:o("unsuback"),puback:o("puback"),pubcomp:o("pubcomp"),pubrel:o("pubrel"),pubrec:o("pubrec")},s.SUBACK_HEADER=a.from([s.codes.suback<<s.CMD_SHIFT]),s.VERSION3=a.from([3]),s.VERSION4=a.from([4]),s.VERSION5=a.from([5]),s.VERSION131=a.from([131]),s.VERSION132=a.from([132]),s.QOS=[0,1,2].map(l=>a.from([l])),s.EMPTY={pingreq:a.from([s.codes.pingreq<<4,0]),pingresp:a.from([s.codes.pingresp<<4,0]),disconnect:a.from([s.codes.disconnect<<4,0])}}).call(this)}).call(this,i("buffer").Buffer)},{buffer:17}],39:[function(i,r,n){(function(a){(function(){const s=i("./writeToStream"),o=i("events");class l extends o{constructor(){super(),this._array=new Array(20),this._i=0}write(c){return this._array[this._i++]=c,!0}concat(){let c=0;const u=new Array(this._array.length),d=this._array;let f,m=0;for(f=0;f<d.length&&d[f]!==void 0;f++)typeof d[f]!="string"?u[f]=d[f].length:u[f]=a.byteLength(d[f]),c+=u[f];const p=a.allocUnsafe(c);for(f=0;f<d.length&&d[f]!==void 0;f++)typeof d[f]!="string"?(d[f].copy(p,m),m+=u[f]):(p.write(d[f],m),m+=u[f]);return p}}r.exports=function(h,c){const u=new l;return s(h,u,c),u.concat()}}).call(this)}).call(this,i("buffer").Buffer)},{"./writeToStream":44,buffer:17,events:22}],40:[function(i,r,n){n.parser=i("./parser").parser,n.generate=i("./generate"),n.writeToStream=i("./writeToStream")},{"./generate":39,"./parser":43,"./writeToStream":44}],41:[function(i,r,n){(function(a){(function(){const o={},l=a.isBuffer(a.from([1,2]).subarray(0,1));function h(c){const u=a.allocUnsafe(2);return u.writeUInt8(c>>8,0),u.writeUInt8(255&c,1),u}r.exports={cache:o,generateCache:function(){for(let c=0;c<65536;c++)o[c]=h(c)},generateNumber:h,genBufVariableByteInt:function(c){let u=0,d=0;const f=a.allocUnsafe(4);do u=c%128|0,(c=c/128|0)>0&&(u|=128),f.writeUInt8(u,d++);while(c>0&&d<4);return c>0&&(d=0),l?f.subarray(0,d):f.slice(0,d)},generate4ByteBuffer:function(c){const u=a.allocUnsafe(4);return u.writeUInt32BE(c,0),u}}}).call(this)}).call(this,i("buffer").Buffer)},{buffer:17}],42:[function(i,r,n){r.exports=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}}},{}],43:[function(i,r,n){const a=i("bl"),s=i("events"),o=i("./packet"),l=i("./constants"),h=i("debug")("mqtt-packet:parser");class c extends s{constructor(){super(),this.parser=this.constructor.parser}static parser(d){return this instanceof c?(this.settings=d||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new c().parser(d)}_resetState(){h("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new o,this.error=null,this._list=a(),this._stateCounter=0}parse(d){for(this.error&&this._resetState(),this._list.append(d),h("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,h("parse: state complete. _stateCounter is now: %d",this._stateCounter),h("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return h("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){const d=this._list.readUInt8(0);return this.packet.cmd=l.types[d>>l.CMD_SHIFT],this.packet.retain=(d&l.RETAIN_MASK)!=0,this.packet.qos=d>>l.QOS_SHIFT&l.QOS_MASK,this.packet.dup=(d&l.DUP_MASK)!=0,h("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}_parseLength(){const d=this._parseVarByteNum(!0);return d&&(this.packet.length=d.value,this._list.consume(d.bytes)),h("_parseLength %d",d.value),!!d}_parsePayload(){h("_parsePayload: payload %O",this._list);let d=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}d=!0}return h("_parsePayload complete result: %s",d),d}_parseConnect(){let d,f,m,p;h("_parseConnect");const g={},y=this.packet,T=this._parseString();if(T===null)return this._emitError(new Error("Cannot parse protocolId"));if(T!=="MQTT"&&T!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(y.protocolId=T,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(y.protocolVersion=this._list.readUInt8(this._pos),y.protocolVersion>=128&&(y.bridgeMode=!0,y.protocolVersion=y.protocolVersion-128),y.protocolVersion!==3&&y.protocolVersion!==4&&y.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(g.username=this._list.readUInt8(this._pos)&l.USERNAME_MASK,g.password=this._list.readUInt8(this._pos)&l.PASSWORD_MASK,g.will=this._list.readUInt8(this._pos)&l.WILL_FLAG_MASK,g.will&&(y.will={},y.will.retain=(this._list.readUInt8(this._pos)&l.WILL_RETAIN_MASK)!=0,y.will.qos=(this._list.readUInt8(this._pos)&l.WILL_QOS_MASK)>>l.WILL_QOS_SHIFT),y.clean=(this._list.readUInt8(this._pos)&l.CLEAN_SESSION_MASK)!=0,this._pos++,y.keepalive=this._parseNum(),y.keepalive===-1)return this._emitError(new Error("Packet too short"));if(y.protocolVersion===5){const S=this._parseProperties();Object.getOwnPropertyNames(S).length&&(y.properties=S)}const b=this._parseString();if(b===null)return this._emitError(new Error("Packet too short"));if(y.clientId=b,h("_parseConnect: packet.clientId: %s",y.clientId),g.will){if(y.protocolVersion===5){const S=this._parseProperties();Object.getOwnPropertyNames(S).length&&(y.will.properties=S)}if((d=this._parseString())===null)return this._emitError(new Error("Cannot parse will topic"));if(y.will.topic=d,h("_parseConnect: packet.will.topic: %s",y.will.topic),(f=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse will payload"));y.will.payload=f,h("_parseConnect: packet.will.paylaod: %s",y.will.payload)}if(g.username){if((p=this._parseString())===null)return this._emitError(new Error("Cannot parse username"));y.username=p,h("_parseConnect: packet.username: %s",y.username)}if(g.password){if((m=this._parseBuffer())===null)return this._emitError(new Error("Cannot parse password"));y.password=m}return this.settings=y,h("_parseConnect: complete"),y}_parseConnack(){h("_parseConnack");const d=this.packet;if(this._list.length<1)return null;if(d.sessionPresent=!!(this._list.readUInt8(this._pos++)&l.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?d.reasonCode=this._list.readUInt8(this._pos++):d.reasonCode=0;else{if(this._list.length<2)return null;d.returnCode=this._list.readUInt8(this._pos++)}if(d.returnCode===-1||d.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){const f=this._parseProperties();Object.getOwnPropertyNames(f).length&&(d.properties=f)}h("_parseConnack: complete")}_parsePublish(){h("_parsePublish");const d=this.packet;if(d.topic=this._parseString(),d.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(d.qos>0)||this._parseMessageId()){if(this.settings.protocolVersion===5){const f=this._parseProperties();Object.getOwnPropertyNames(f).length&&(d.properties=f)}d.payload=this._list.slice(this._pos,d.length),h("_parsePublish: payload from buffer list: %o",d.payload)}}_parseSubscribe(){h("_parseSubscribe");const d=this.packet;let f,m,p,g,y,T,b;if(d.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(d.subscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){const S=this._parseProperties();Object.getOwnPropertyNames(S).length&&(d.properties=S)}for(;this._pos<d.length;){if((f=this._parseString())===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=d.length)return this._emitError(new Error("Malformed Subscribe Payload"));p=(m=this._parseByte())&l.SUBSCRIBE_OPTIONS_QOS_MASK,T=(m>>l.SUBSCRIBE_OPTIONS_NL_SHIFT&l.SUBSCRIBE_OPTIONS_NL_MASK)!=0,y=(m>>l.SUBSCRIBE_OPTIONS_RAP_SHIFT&l.SUBSCRIBE_OPTIONS_RAP_MASK)!=0,g=m>>l.SUBSCRIBE_OPTIONS_RH_SHIFT&l.SUBSCRIBE_OPTIONS_RH_MASK,b={topic:f,qos:p},this.settings.protocolVersion===5?(b.nl=T,b.rap=y,b.rh=g):this.settings.bridgeMode&&(b.rh=0,b.rap=!0,b.nl=!0),h("_parseSubscribe: push subscription `%s` to subscription",b),d.subscriptions.push(b)}}}_parseSuback(){h("_parseSuback");const d=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(this.settings.protocolVersion===5){const f=this._parseProperties();Object.getOwnPropertyNames(f).length&&(d.properties=f)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseUnsubscribe(){h("_parseUnsubscribe");const d=this.packet;if(d.unsubscriptions=[],this._parseMessageId()){if(this.settings.protocolVersion===5){const f=this._parseProperties();Object.getOwnPropertyNames(f).length&&(d.properties=f)}for(;this._pos<d.length;){const f=this._parseString();if(f===null)return this._emitError(new Error("Cannot parse topic"));h("_parseUnsubscribe: push topic `%s` to unsubscriptions",f),d.unsubscriptions.push(f)}}}_parseUnsuback(){h("_parseUnsuback");const d=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){const f=this._parseProperties();for(Object.getOwnPropertyNames(f).length&&(d.properties=f),d.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseConfirmation(){h("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);const d=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(d.length>2?(d.reasonCode=this._parseByte(),h("_parseConfirmation: packet.reasonCode `%d`",d.reasonCode)):d.reasonCode=0,d.length>3)){const f=this._parseProperties();Object.getOwnPropertyNames(f).length&&(d.properties=f)}return!0}_parseDisconnect(){const d=this.packet;if(h("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?d.reasonCode=this._parseByte():d.reasonCode=0;const f=this._parseProperties();Object.getOwnPropertyNames(f).length&&(d.properties=f)}return h("_parseDisconnect result: true"),!0}_parseAuth(){h("_parseAuth");const d=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));d.reasonCode=this._parseByte();const f=this._parseProperties();return Object.getOwnPropertyNames(f).length&&(d.properties=f),h("_parseAuth: result: true"),!0}_parseMessageId(){const d=this.packet;return d.messageId=this._parseNum(),d.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(h("_parseMessageId: packet.messageId %d",d.messageId),!0)}_parseString(d){const f=this._parseNum(),m=f+this._pos;if(f===-1||m>this._list.length||m>this.packet.length)return null;const p=this._list.toString("utf8",this._pos,m);return this._pos+=f,h("_parseString: result: %s",p),p}_parseStringPair(){return h("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){const d=this._parseNum(),f=d+this._pos;if(d===-1||f>this._list.length||f>this.packet.length)return null;const m=this._list.slice(this._pos,f);return this._pos+=d,h("_parseBuffer: result: %o",m),m}_parseNum(){if(this._list.length-this._pos<2)return-1;const d=this._list.readUInt16BE(this._pos);return this._pos+=2,h("_parseNum: result: %s",d),d}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;const d=this._list.readUInt32BE(this._pos);return this._pos+=4,h("_parse4ByteNum: result: %s",d),d}_parseVarByteNum(d){h("_parseVarByteNum");let f,m=0,p=1,g=0,y=!1;const T=this._pos?this._pos:0;for(;m<4&&T+m<this._list.length;){if(g+=p*((f=this._list.readUInt8(T+m++))&l.VARBYTEINT_MASK),p*=128,(f&l.VARBYTEINT_FIN_MASK)==0){y=!0;break}if(this._list.length<=m)break}return!y&&m===4&&this._list.length>=m&&this._emitError(new Error("Invalid variable byte integer")),T&&(this._pos+=m),h("_parseVarByteNum: result: %o",y=!!y&&(d?{bytes:m,value:g}:g)),y}_parseByte(){let d;return this._pos<this._list.length&&(d=this._list.readUInt8(this._pos),this._pos++),h("_parseByte: result: %o",d),d}_parseByType(d){switch(h("_parseByType: type: %s",d),d){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){h("_parseProperties");const d=this._parseVarByteNum(),f=this._pos+d,m={};for(;this._pos<f;){const p=this._parseByte();if(!p)return this._emitError(new Error("Cannot parse property code type")),!1;const g=l.propertiesCodes[p];if(!g)return this._emitError(new Error("Unknown property")),!1;if(g!=="userProperties")m[g]?Array.isArray(m[g])?m[g].push(this._parseByType(l.propertiesTypes[g])):(m[g]=[m[g]],m[g].push(this._parseByType(l.propertiesTypes[g]))):m[g]=this._parseByType(l.propertiesTypes[g]);else{m[g]||(m[g]=Object.create(null));const y=this._parseByType(l.propertiesTypes[g]);if(m[g][y.name])if(Array.isArray(m[g][y.name]))m[g][y.name].push(y.value);else{const T=m[g][y.name];m[g][y.name]=[T],m[g][y.name].push(y.value)}else m[g][y.name]=y.value}}return m}_newPacket(){return h("_newPacket"),this.packet&&(this._list.consume(this.packet.length),h("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),h("_newPacket: new packet"),this.packet=new o,this._pos=0,!0}_emitError(d){h("_emitError"),this.error=d,this.emit("error",d)}}r.exports=c},{"./constants":38,"./packet":42,bl:15,debug:18,events:22}],44:[function(i,r,n){(function(a){(function(){const s=i("./constants"),o=a.allocUnsafe(0),l=a.from([0]),h=i("./numbers"),c=i("process-nextick-args").nextTick,u=i("debug")("mqtt-packet:writeToStream"),d=h.cache,f=h.generateNumber,m=h.generateCache,p=h.genBufVariableByteInt,g=h.generate4ByteBuffer;let y=q,T=!0;function b(z,W,$){switch(u("generate called"),W.cork&&(W.cork(),c(S,W)),T&&(T=!1,m()),u("generate: packet.cmd: %s",z.cmd),z.cmd){case"connect":return(function(L,N,V){const H=L||{},Q=H.protocolId||"MQTT";let rt=H.protocolVersion||4;const tt=H.will;let it=H.clean;const w=H.keepalive||0,_=H.clientId||"",C=H.username,F=H.password,j=H.properties;it===void 0&&(it=!0);let K=0;if(typeof Q!="string"&&!a.isBuffer(Q))return N.emit("error",new Error("Invalid protocolId")),!1;if(K+=Q.length+2,rt!==3&&rt!==4&&rt!==5)return N.emit("error",new Error("Invalid protocol version")),!1;if(K+=1,(typeof _=="string"||a.isBuffer(_))&&(_||rt>=4)&&(_||it))K+=a.byteLength(_)+2;else{if(rt<4)return N.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*it==0)return N.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof w!="number"||w<0||w>65535||w%1!=0)return N.emit("error",new Error("Invalid keepalive")),!1;if(K+=2,K+=1,rt===5){var nt=x(N,j);if(!nt)return!1;K+=nt.length}if(tt){if(typeof tt!="object")return N.emit("error",new Error("Invalid will")),!1;if(!tt.topic||typeof tt.topic!="string")return N.emit("error",new Error("Invalid will topic")),!1;if(K+=a.byteLength(tt.topic)+2,K+=2,tt.payload){if(!(tt.payload.length>=0))return N.emit("error",new Error("Invalid will payload")),!1;typeof tt.payload=="string"?K+=a.byteLength(tt.payload):K+=tt.payload.length}var mt={};if(rt===5){if(!(mt=x(N,tt.properties)))return!1;K+=mt.length}}let ft=!1;if(C!=null){if(!et(C))return N.emit("error",new Error("Invalid username")),!1;ft=!0,K+=a.byteLength(C)+2}if(F!=null){if(!ft)return N.emit("error",new Error("Username is required to use password")),!1;if(!et(F))return N.emit("error",new Error("Invalid password")),!1;K+=X(F)+2}N.write(s.CONNECT_HEADER),D(N,K),A(N,Q),H.bridgeMode&&(rt+=128),N.write(rt===131?s.VERSION131:rt===132?s.VERSION132:rt===4?s.VERSION4:rt===5?s.VERSION5:s.VERSION3);let gt=0;return gt|=C!=null?s.USERNAME_MASK:0,gt|=F!=null?s.PASSWORD_MASK:0,gt|=tt&&tt.retain?s.WILL_RETAIN_MASK:0,gt|=tt&&tt.qos?tt.qos<<s.WILL_QOS_SHIFT:0,gt|=tt?s.WILL_FLAG_MASK:0,gt|=it?s.CLEAN_SESSION_MASK:0,N.write(a.from([gt])),y(N,w),rt===5&&nt.write(),A(N,_),tt&&(rt===5&&mt.write(),O(N,tt.topic),A(N,tt.payload)),C!=null&&A(N,C),F!=null&&A(N,F),!0})(z,W);case"connack":return(function(L,N,V){const H=V?V.protocolVersion:4,Q=L||{},rt=H===5?Q.reasonCode:Q.returnCode,tt=Q.properties;let it=2;if(typeof rt!="number")return N.emit("error",new Error("Invalid return code")),!1;let w=null;if(H===5){if(!(w=x(N,tt)))return!1;it+=w.length}return N.write(s.CONNACK_HEADER),D(N,it),N.write(Q.sessionPresent?s.SESSIONPRESENT_HEADER:l),N.write(a.from([rt])),w!=null&&w.write(),!0})(z,W,$);case"publish":return(function(L,N,V){u("publish: packet: %o",L);const H=V?V.protocolVersion:4,Q=L||{},rt=Q.qos||0,tt=Q.retain?s.RETAIN_MASK:0,it=Q.topic,w=Q.payload||o,_=Q.messageId,C=Q.properties;let F=0;if(typeof it=="string")F+=a.byteLength(it)+2;else{if(!a.isBuffer(it))return N.emit("error",new Error("Invalid topic")),!1;F+=it.length+2}if(a.isBuffer(w)?F+=w.length:F+=a.byteLength(w),rt&&typeof _!="number")return N.emit("error",new Error("Invalid messageId")),!1;rt&&(F+=2);let j=null;if(H===5){if(!(j=x(N,C)))return!1;F+=j.length}return N.write(s.PUBLISH_HEADER[rt][Q.dup?1:0][tt?1:0]),D(N,F),y(N,X(it)),N.write(it),rt>0&&y(N,_),j!=null&&j.write(),u("publish: payload: %o",w),N.write(w)})(z,W,$);case"puback":case"pubrec":case"pubrel":case"pubcomp":return(function(L,N,V){const H=V?V.protocolVersion:4,Q=L||{},rt=Q.cmd||"puback",tt=Q.messageId,it=Q.dup&&rt==="pubrel"?s.DUP_MASK:0;let w=0;const _=Q.reasonCode,C=Q.properties;let F=H===5?3:2;if(rt==="pubrel"&&(w=1),typeof tt!="number")return N.emit("error",new Error("Invalid messageId")),!1;let j=null;if(H===5&&typeof C=="object"){if(!(j=R(N,C,V,F)))return!1;F+=j.length}return N.write(s.ACKS[rt][w][it][0]),D(N,F),y(N,tt),H===5&&N.write(a.from([_])),j!==null&&j.write(),!0})(z,W,$);case"subscribe":return(function(L,N,V){u("subscribe: packet: ");const H=V?V.protocolVersion:4,Q=L||{},rt=Q.dup?s.DUP_MASK:0,tt=Q.messageId,it=Q.subscriptions,w=Q.properties;let _=0;if(typeof tt!="number")return N.emit("error",new Error("Invalid messageId")),!1;_+=2;let C=null;if(H===5){if(!(C=x(N,w)))return!1;_+=C.length}if(typeof it!="object"||!it.length)return N.emit("error",new Error("Invalid subscriptions")),!1;for(let j=0;j<it.length;j+=1){const K=it[j].topic,nt=it[j].qos;if(typeof K!="string")return N.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof nt!="number")return N.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(H===5){if(typeof(it[j].nl||!1)!="boolean")return N.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(it[j].rap||!1)!="boolean")return N.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;const gt=it[j].rh||0;if(typeof gt!="number"||gt>2)return N.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}_+=a.byteLength(K)+2+1}u("subscribe: writing to stream: %o",s.SUBSCRIBE_HEADER),N.write(s.SUBSCRIBE_HEADER[1][rt?1:0][0]),D(N,_),y(N,tt),C!==null&&C.write();let F=!0;for(const j of it){const K=j.topic,nt=j.qos,mt=+j.nl,ft=+j.rap,gt=j.rh;let xt;O(N,K),xt=s.SUBSCRIBE_OPTIONS_QOS[nt],H===5&&(xt|=mt?s.SUBSCRIBE_OPTIONS_NL:0,xt|=ft?s.SUBSCRIBE_OPTIONS_RAP:0,xt|=gt?s.SUBSCRIBE_OPTIONS_RH[gt]:0),F=N.write(a.from([xt]))}return F})(z,W,$);case"suback":return(function(L,N,V){const H=V?V.protocolVersion:4,Q=L||{},rt=Q.messageId,tt=Q.granted,it=Q.properties;let w=0;if(typeof rt!="number")return N.emit("error",new Error("Invalid messageId")),!1;if(w+=2,typeof tt!="object"||!tt.length)return N.emit("error",new Error("Invalid qos vector")),!1;for(let C=0;C<tt.length;C+=1){if(typeof tt[C]!="number")return N.emit("error",new Error("Invalid qos vector")),!1;w+=1}let _=null;if(H===5){if(!(_=R(N,it,V,w)))return!1;w+=_.length}return N.write(s.SUBACK_HEADER),D(N,w),y(N,rt),_!==null&&_.write(),N.write(a.from(tt))})(z,W,$);case"unsubscribe":return(function(L,N,V){const H=V?V.protocolVersion:4,Q=L||{},rt=Q.messageId,tt=Q.dup?s.DUP_MASK:0,it=Q.unsubscriptions,w=Q.properties;let _=0;if(typeof rt!="number")return N.emit("error",new Error("Invalid messageId")),!1;if(_+=2,typeof it!="object"||!it.length)return N.emit("error",new Error("Invalid unsubscriptions")),!1;for(let j=0;j<it.length;j+=1){if(typeof it[j]!="string")return N.emit("error",new Error("Invalid unsubscriptions")),!1;_+=a.byteLength(it[j])+2}let C=null;if(H===5){if(!(C=x(N,w)))return!1;_+=C.length}N.write(s.UNSUBSCRIBE_HEADER[1][tt?1:0][0]),D(N,_),y(N,rt),C!==null&&C.write();let F=!0;for(let j=0;j<it.length;j++)F=O(N,it[j]);return F})(z,W,$);case"unsuback":return(function(L,N,V){const H=V?V.protocolVersion:4,Q=L||{},rt=Q.messageId,tt=Q.dup?s.DUP_MASK:0,it=Q.granted,w=Q.properties,_=Q.cmd;let C=2;if(typeof rt!="number")return N.emit("error",new Error("Invalid messageId")),!1;if(H===5){if(typeof it!="object"||!it.length)return N.emit("error",new Error("Invalid qos vector")),!1;for(let j=0;j<it.length;j+=1){if(typeof it[j]!="number")return N.emit("error",new Error("Invalid qos vector")),!1;C+=1}}let F=null;if(H===5){if(!(F=R(N,w,V,C)))return!1;C+=F.length}return N.write(s.ACKS[_][0][tt][0]),D(N,C),y(N,rt),F!==null&&F.write(),H===5&&N.write(a.from(it)),!0})(z,W,$);case"pingreq":case"pingresp":return(function(L,N,V){return N.write(s.EMPTY[L.cmd])})(z,W);case"disconnect":return(function(L,N,V){const H=V?V.protocolVersion:4,Q=L||{},rt=Q.reasonCode,tt=Q.properties;let it=H===5?1:0,w=null;if(H===5){if(!(w=R(N,tt,V,it)))return!1;it+=w.length}return N.write(a.from([s.codes.disconnect<<4])),D(N,it),H===5&&N.write(a.from([rt])),w!==null&&w.write(),!0})(z,W,$);case"auth":return(function(L,N,V){const H=V?V.protocolVersion:4,Q=L||{},rt=Q.reasonCode,tt=Q.properties;let it=H===5?1:0;H!==5&&N.emit("error",new Error("Invalid mqtt version for auth packet"));const w=R(N,tt,V,it);return w?(it+=w.length,N.write(a.from([s.codes.auth<<4])),D(N,it),N.write(a.from([rt])),w!==null&&w.write(),!0):!1})(z,W,$);default:return W.emit("error",new Error("Unknown command")),!1}}function S(z){z.uncork()}Object.defineProperty(b,"cacheNumbers",{get:()=>y===q,set(z){z?(d&&Object.keys(d).length!==0||(T=!0),y=q):(T=!1,y=J)}});const I={};function D(z,W){if(W>s.VARBYTEINT_MAX)return z.emit("error",new Error(`Invalid variable byte integer: ${W}`)),!1;let $=I[W];return $||($=p(W),W<16384&&(I[W]=$)),u("writeVarByteInt: writing to stream: %o",$),z.write($)}function O(z,W){const $=a.byteLength(W);return y(z,$),u("writeString: %s",W),z.write(W,"utf8")}function P(z,W,$){O(z,W),O(z,$)}function q(z,W){return u("writeNumberCached: number: %d",W),u("writeNumberCached: %o",d[W]),z.write(d[W])}function J(z,W){const $=f(W);return u("writeNumberGenerated: %o",$),z.write($)}function A(z,W){typeof W=="string"?O(z,W):W?(y(z,W.length),z.write(W)):y(z,0)}function x(z,W){if(typeof W!="object"||W.length!=null)return{length:1,write(){Y(z,{},0)}};let $=0;function L(N,V){let H=0;switch(s.propertiesTypes[N]){case"byte":if(typeof V!="boolean")return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=2;break;case"int8":if(typeof V!="number"||V<0||V>255)return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=2;break;case"binary":if(V&&V===null)return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=1+a.byteLength(V)+2;break;case"int16":if(typeof V!="number"||V<0||V>65535)return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=3;break;case"int32":if(typeof V!="number"||V<0||V>4294967295)return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=5;break;case"var":if(typeof V!="number"||V<0||V>268435455)return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=1+a.byteLength(p(V));break;case"string":if(typeof V!="string")return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=3+a.byteLength(V.toString());break;case"pair":if(typeof V!="object")return z.emit("error",new Error(`Invalid ${N}: ${V}`)),!1;H+=Object.getOwnPropertyNames(V).reduce((Q,rt)=>{const tt=V[rt];return Array.isArray(tt)?Q+=tt.reduce((it,w)=>it+=3+a.byteLength(rt.toString())+2+a.byteLength(w.toString()),0):Q+=3+a.byteLength(rt.toString())+2+a.byteLength(V[rt].toString()),Q},0);break;default:return z.emit("error",new Error(`Invalid property ${N}: ${V}`)),!1}return H}if(W)for(const N in W){let V=0,H=0;const Q=W[N];if(Array.isArray(Q))for(let rt=0;rt<Q.length;rt++){if(!(H=L(N,Q[rt])))return!1;V+=H}else{if(!(H=L(N,Q)))return!1;V=H}if(!V)return!1;$+=V}return{length:a.byteLength(p($))+$,write(){Y(z,W,$)}}}function R(z,W,$,L){const N=["reasonString","userProperties"],V=$&&$.properties&&$.properties.maximumPacketSize?$.properties.maximumPacketSize:0;let H=x(z,W);if(V)for(;L+H.length>V;){const Q=N.shift();if(!Q||!W[Q])return!1;delete W[Q],H=x(z,W)}return H}function M(z,W,$){switch(s.propertiesTypes[W]){case"byte":z.write(a.from([s.properties[W]])),z.write(a.from([+$]));break;case"int8":z.write(a.from([s.properties[W]])),z.write(a.from([$]));break;case"binary":z.write(a.from([s.properties[W]])),A(z,$);break;case"int16":z.write(a.from([s.properties[W]])),y(z,$);break;case"int32":z.write(a.from([s.properties[W]])),(function(L,N){const V=g(N);u("write4ByteNumber: %o",V),L.write(V)})(z,$);break;case"var":z.write(a.from([s.properties[W]])),D(z,$);break;case"string":z.write(a.from([s.properties[W]])),O(z,$);break;case"pair":Object.getOwnPropertyNames($).forEach(L=>{const N=$[L];Array.isArray(N)?N.forEach(V=>{z.write(a.from([s.properties[W]])),P(z,L.toString(),V.toString())}):(z.write(a.from([s.properties[W]])),P(z,L.toString(),N.toString()))});break;default:return z.emit("error",new Error(`Invalid property ${W} value: ${$}`)),!1}}function Y(z,W,$){D(z,$);for(const L in W)if(Object.prototype.hasOwnProperty.call(W,L)&&W[L]!==null){const N=W[L];if(Array.isArray(N))for(let V=0;V<N.length;V++)M(z,L,N[V]);else M(z,L,N)}}function X(z){return z?z instanceof a?z.length:a.byteLength(z):0}function et(z){return typeof z=="string"||z instanceof a}r.exports=b}).call(this)}).call(this,i("buffer").Buffer)},{"./constants":38,"./numbers":41,buffer:17,debug:18,"process-nextick-args":49}],45:[function(i,r,n){var a=1e3,s=60*a,o=60*s,l=24*o,h=7*l,c=365.25*l;function u(d,f,m,p){var g=f>=1.5*m;return Math.round(d/m)+" "+p+(g?"s":"")}r.exports=function(d,f){f=f||{};var m=typeof d;if(m==="string"&&d.length>0)return(function(p){if(!((p=String(p)).length>100)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(g){var y=parseFloat(g[1]);switch((g[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return y*c;case"weeks":case"week":case"w":return y*h;case"days":case"day":case"d":return y*l;case"hours":case"hour":case"hrs":case"hr":case"h":return y*o;case"minutes":case"minute":case"mins":case"min":case"m":return y*s;case"seconds":case"second":case"secs":case"sec":case"s":return y*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}})(d);if(m==="number"&&isFinite(d))return f.long?(function(p){var g=Math.abs(p);return g>=l?u(p,g,l,"day"):g>=o?u(p,g,o,"hour"):g>=s?u(p,g,s,"minute"):g>=a?u(p,g,a,"second"):p+" ms"})(d):(function(p){var g=Math.abs(p);return g>=l?Math.round(p/l)+"d":g>=o?Math.round(p/o)+"h":g>=s?Math.round(p/s)+"m":g>=a?Math.round(p/a)+"s":p+"ms"})(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],46:[function(i,r,n){const a=i("./lib/number-allocator.js");r.exports.NumberAllocator=a},{"./lib/number-allocator.js":47}],47:[function(i,r,n){const a=i("js-sdsl").Set,s=i("debug")("number-allocator:trace"),o=i("debug")("number-allocator:error");function l(c,u){this.low=c,this.high=u}function h(c,u){if(!(this instanceof h))return new h(c,u);this.min=c,this.max=u,this.ss=new a([],(d,f)=>d.compare(f)),s("Create"),this.clear()}l.prototype.equals=function(c){return this.low===c.low&&this.high===c.high},l.prototype.compare=function(c){return this.low<c.low&&this.high<c.low?-1:c.low<this.low&&c.high<this.low?1:0},h.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},h.prototype.alloc=function(){if(this.ss.size()===0)return s("alloc():empty"),null;const c=this.ss.front(),u=c.low;return u+1<=c.high?++c.low:this.ss.eraseElementByPos(0),s("alloc():"+u),u},h.prototype.use=function(c){const u=new l(c,c),d=this.ss.lowerBound(u);if(d){if(d.equals(u))return this.ss.eraseElementByValue(d),s("use():"+c),!0;if(d.low>c)return!1;if(d.low===c)return++d.low,s("use():"+c),!0;if(d.high===c)return--d.high,s("use():"+c),!0;const f=d.low;return d.low=c+1,this.ss.insert(new l(f,c-1)),s("use():"+c),!0}return s("use():failed"),!1},h.prototype.free=function(c){if(c<this.min||c>this.max)return void o("free():"+c+" is out of range");const u=new l(c,c),d=this.ss.lowerBound(u);if(d){if(d.low<=c&&c<=d.high)return void o("free():"+c+" has already been vacant");if(d===this.ss.front())c+1===d.low?--d.low:this.ss.insert(u);else{const f=this.ss.reverseLowerBound(u);f.high+1===c?c+1===d.low?(this.ss.eraseElementByValue(f),d.low=f.low):f.high=c:c+1===d.low?d.low=c:this.ss.insert(u)}}else{if(d===this.ss.front())return void this.ss.insert(u);const f=this.ss.reverseLowerBound(u);f.high+1===c?f.high=c:this.ss.insert(u)}s("free():"+c)},h.prototype.clear=function(){s("clear()"),this.ss.clear(),this.ss.insert(new l(this.min,this.max))},h.prototype.intervalCount=function(){return this.ss.size()},h.prototype.dump=function(){console.log("length:"+this.ss.size());for(const c of this.ss)console.log(c)},r.exports=h},{debug:18,"js-sdsl":36}],48:[function(i,r,n){var a=i("wrappy");function s(l){var h=function(){return h.called?h.value:(h.called=!0,h.value=l.apply(this,arguments))};return h.called=!1,h}function o(l){var h=function(){if(h.called)throw new Error(h.onceError);return h.called=!0,h.value=l.apply(this,arguments)},c=l.name||"Function wrapped with `once`";return h.onceError=c+" shouldn't be called more than once",h.called=!1,h}r.exports=a(s),r.exports.strict=a(o),s.proto=s(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return s(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})})},{wrappy:79}],49:[function(i,r,n){(function(a){(function(){a===void 0||!a.version||a.version.indexOf("v0.")===0||a.version.indexOf("v1.")===0&&a.version.indexOf("v1.8.")!==0?r.exports={nextTick:function(s,o,l,h){if(typeof s!="function")throw new TypeError('"callback" argument must be a function');var c,u,d=arguments.length;switch(d){case 0:case 1:return a.nextTick(s);case 2:return a.nextTick(function(){s.call(null,o)});case 3:return a.nextTick(function(){s.call(null,o,l)});case 4:return a.nextTick(function(){s.call(null,o,l,h)});default:for(c=new Array(d-1),u=0;u<c.length;)c[u++]=arguments[u];return a.nextTick(function(){s.apply(null,c)})}}}:r.exports=a}).call(this)}).call(this,i("_process"))},{_process:50}],50:[function(i,r,n){var a,s,o=r.exports={};function l(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function c(b){if(a===setTimeout)return setTimeout(b,0);if((a===l||!a)&&setTimeout)return a=setTimeout,setTimeout(b,0);try{return a(b,0)}catch{try{return a.call(null,b,0)}catch{return a.call(this,b,0)}}}(function(){try{a=typeof setTimeout=="function"?setTimeout:l}catch{a=l}try{s=typeof clearTimeout=="function"?clearTimeout:h}catch{s=h}})();var u,d=[],f=!1,m=-1;function p(){f&&u&&(f=!1,u.length?d=u.concat(d):m=-1,d.length&&g())}function g(){if(!f){var b=c(p);f=!0;for(var S=d.length;S;){for(u=d,d=[];++m<S;)u&&u[m].run();m=-1,S=d.length}u=null,f=!1,(function(I){if(s===clearTimeout)return clearTimeout(I);if((s===h||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(I);try{s(I)}catch{try{return s.call(null,I)}catch{return s.call(this,I)}}})(b)}}function y(b,S){this.fun=b,this.array=S}function T(){}o.nextTick=function(b){var S=new Array(arguments.length-1);if(arguments.length>1)for(var I=1;I<arguments.length;I++)S[I-1]=arguments[I];d.push(new y(b,S)),d.length!==1||f||c(g)},y.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=T,o.addListener=T,o.once=T,o.off=T,o.removeListener=T,o.removeAllListeners=T,o.emit=T,o.prependListener=T,o.prependOnceListener=T,o.listeners=function(b){return[]},o.binding=function(b){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(b){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],51:[function(i,r,n){(function(a){(function(){(function(s){var o=typeof n=="object"&&n&&!n.nodeType&&n,l=typeof r=="object"&&r&&!r.nodeType&&r,h=typeof a=="object"&&a;h.global!==h&&h.window!==h&&h.self!==h||(s=h);var c,u,d=2147483647,f=36,m=1,p=26,g=38,y=700,T=72,b=128,S="-",I=/^xn--/,D=/[^\x20-\x7E]/,O=/[\x2E\u3002\uFF0E\uFF61]/g,P={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},q=f-m,J=Math.floor,A=String.fromCharCode;function x(L){throw new RangeError(P[L])}function R(L,N){for(var V=L.length,H=[];V--;)H[V]=N(L[V]);return H}function M(L,N){var V=L.split("@"),H="";return V.length>1&&(H=V[0]+"@",L=V[1]),H+R((L=L.replace(O,".")).split("."),N).join(".")}function Y(L){for(var N,V,H=[],Q=0,rt=L.length;Q<rt;)(N=L.charCodeAt(Q++))>=55296&&N<=56319&&Q<rt?(64512&(V=L.charCodeAt(Q++)))==56320?H.push(((1023&N)<<10)+(1023&V)+65536):(H.push(N),Q--):H.push(N);return H}function X(L){return R(L,function(N){var V="";return N>65535&&(V+=A((N-=65536)>>>10&1023|55296),N=56320|1023&N),V+=A(N)}).join("")}function et(L,N){return L+22+75*(L<26)-((N!=0)<<5)}function z(L,N,V){var H=0;for(L=V?J(L/y):L>>1,L+=J(L/N);L>q*p>>1;H+=f)L=J(L/q);return J(H+(q+1)*L/(L+g))}function W(L){var N,V,H,Q,rt,tt,it,w,_,C,F,j=[],K=L.length,nt=0,mt=b,ft=T;for((V=L.lastIndexOf(S))<0&&(V=0),H=0;H<V;++H)L.charCodeAt(H)>=128&&x("not-basic"),j.push(L.charCodeAt(H));for(Q=V>0?V+1:0;Q<K;){for(rt=nt,tt=1,it=f;Q>=K&&x("invalid-input"),((w=(F=L.charCodeAt(Q++))-48<10?F-22:F-65<26?F-65:F-97<26?F-97:f)>=f||w>J((d-nt)/tt))&&x("overflow"),nt+=w*tt,!(w<(_=it<=ft?m:it>=ft+p?p:it-ft));it+=f)tt>J(d/(C=f-_))&&x("overflow"),tt*=C;ft=z(nt-rt,N=j.length+1,rt==0),J(nt/N)>d-mt&&x("overflow"),mt+=J(nt/N),nt%=N,j.splice(nt++,0,mt)}return X(j)}function $(L){var N,V,H,Q,rt,tt,it,w,_,C,F,j,K,nt,mt,ft=[];for(j=(L=Y(L)).length,N=b,V=0,rt=T,tt=0;tt<j;++tt)(F=L[tt])<128&&ft.push(A(F));for(H=Q=ft.length,Q&&ft.push(S);H<j;){for(it=d,tt=0;tt<j;++tt)(F=L[tt])>=N&&F<it&&(it=F);for(it-N>J((d-V)/(K=H+1))&&x("overflow"),V+=(it-N)*K,N=it,tt=0;tt<j;++tt)if((F=L[tt])<N&&++V>d&&x("overflow"),F==N){for(w=V,_=f;!(w<(C=_<=rt?m:_>=rt+p?p:_-rt));_+=f)mt=w-C,nt=f-C,ft.push(A(et(C+mt%nt,0))),w=J(mt/nt);ft.push(A(et(w,0))),rt=z(V,K,H==Q),V=0,++H}++V,++N}return ft.join("")}if(c={version:"1.4.1",ucs2:{decode:Y,encode:X},decode:W,encode:$,toASCII:function(L){return M(L,function(N){return D.test(N)?"xn--"+$(N):N})},toUnicode:function(L){return M(L,function(N){return I.test(N)?W(N.slice(4).toLowerCase()):N})}},o&&l)if(r.exports==o)l.exports=c;else for(u in c)c.hasOwnProperty(u)&&(o[u]=c[u]);else s.punycode=c})(this)}).call(this)}).call(this,typeof Vi<"u"?Vi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],52:[function(i,r,n){function a(o,l){return Object.prototype.hasOwnProperty.call(o,l)}r.exports=function(o,l,h,c){l=l||"&",h=h||"=";var u={};if(typeof o!="string"||o.length===0)return u;var d=/\+/g;o=o.split(l);var f=1e3;c&&typeof c.maxKeys=="number"&&(f=c.maxKeys);var m=o.length;f>0&&m>f&&(m=f);for(var p=0;p<m;++p){var g,y,T,b,S=o[p].replace(d,"%20"),I=S.indexOf(h);I>=0?(g=S.substr(0,I),y=S.substr(I+1)):(g=S,y=""),T=decodeURIComponent(g),b=decodeURIComponent(y),a(u,T)?s(u[T])?u[T].push(b):u[T]=[u[T],b]:u[T]=b}return u};var s=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"}},{}],53:[function(i,r,n){var a=function(h){switch(typeof h){case"string":return h;case"boolean":return h?"true":"false";case"number":return isFinite(h)?h:"";default:return""}};r.exports=function(h,c,u,d){return c=c||"&",u=u||"=",h===null&&(h=void 0),typeof h=="object"?o(l(h),function(f){var m=encodeURIComponent(a(f))+u;return s(h[f])?o(h[f],function(p){return m+encodeURIComponent(a(p))}).join(c):m+encodeURIComponent(a(h[f]))}).join(c):d?encodeURIComponent(a(d))+u+encodeURIComponent(a(h)):""};var s=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"};function o(h,c){if(h.map)return h.map(c);for(var u=[],d=0;d<h.length;d++)u.push(c(h[d],d));return u}var l=Object.keys||function(h){var c=[];for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&c.push(u);return c}},{}],54:[function(i,r,n){n.decode=n.parse=i("./decode"),n.encode=n.stringify=i("./encode")},{"./decode":52,"./encode":53}],55:[function(i,r,n){var a={};function s(l,h,c){c||(c=Error);var u=(function(d){var f,m;function p(g,y,T){return d.call(this,(function(b,S,I){return typeof h=="string"?h:h(b,S,I)})(g,y,T))||this}return m=d,(f=p).prototype=Object.create(m.prototype),f.prototype.constructor=f,f.__proto__=m,p})(c);u.prototype.name=c.name,u.prototype.code=l,a[l]=u}function o(l,h){if(Array.isArray(l)){var c=l.length;return l=l.map(function(u){return String(u)}),c>2?"one of ".concat(h," ").concat(l.slice(0,c-1).join(", "),", or ")+l[c-1]:c===2?"one of ".concat(h," ").concat(l[0]," or ").concat(l[1]):"of ".concat(h," ").concat(l[0])}return"of ".concat(h," ").concat(String(l))}s("ERR_INVALID_OPT_VALUE",function(l,h){return'The value "'+h+'" is invalid for option "'+l+'"'},TypeError),s("ERR_INVALID_ARG_TYPE",function(l,h,c){var u,d,f;if(typeof h=="string"&&(d="not ",h.substr(0,d.length)===d)?(u="must not be",h=h.replace(/^not /,"")):u="must be",(function(p,g,y){return(y===void 0||y>p.length)&&(y=p.length),p.substring(y-g.length,y)===g})(l," argument"))f="The ".concat(l," ").concat(u," ").concat(o(h,"type"));else{var m=(function(p,g,y){return typeof y!="number"&&(y=0),!(y+g.length>p.length)&&p.indexOf(g,y)!==-1})(l,".")?"property":"argument";f='The "'.concat(l,'" ').concat(m," ").concat(u," ").concat(o(h,"type"))}return f+=". Received type ".concat(typeof c)},TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",function(l){return"The "+l+" method is not implemented"}),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",function(l){return"Cannot call "+l+" after a stream was destroyed"}),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",function(l){return"Unknown encoding: "+l},TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),r.exports.codes=a},{}],56:[function(i,r,n){(function(a){(function(){var s=Object.keys||function(p){var g=[];for(var y in p)g.push(y);return g};r.exports=d;var o=i("./_stream_readable"),l=i("./_stream_writable");i("inherits")(d,o);for(var h=s(l.prototype),c=0;c<h.length;c++){var u=h[c];d.prototype[u]||(d.prototype[u]=l.prototype[u])}function d(p){if(!(this instanceof d))return new d(p);o.call(this,p),l.call(this,p),this.allowHalfOpen=!0,p&&(p.readable===!1&&(this.readable=!1),p.writable===!1&&(this.writable=!1),p.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",f)))}function f(){this._writableState.ended||a.nextTick(m,this)}function m(p){p.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(d.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(d.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(p){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=p,this._writableState.destroyed=p)}})}).call(this)}).call(this,i("_process"))},{"./_stream_readable":58,"./_stream_writable":60,_process:50,inherits:24}],57:[function(i,r,n){r.exports=s;var a=i("./_stream_transform");function s(o){if(!(this instanceof s))return new s(o);a.call(this,o)}i("inherits")(s,a),s.prototype._transform=function(o,l,h){h(null,o)}},{"./_stream_transform":59,inherits:24}],58:[function(i,r,n){(function(a,s){(function(){var o;r.exports=x,x.ReadableState=A,i("events").EventEmitter;var l=function(w,_){return w.listeners(_).length},h=i("./internal/streams/stream"),c=i("buffer").Buffer,u=s.Uint8Array||function(){},d,f=i("util");d=f&&f.debuglog?f.debuglog("stream"):function(){};var m,p,g,y=i("./internal/streams/buffer_list"),T=i("./internal/streams/destroy"),b=i("./internal/streams/state").getHighWaterMark,S=i("../errors").codes,I=S.ERR_INVALID_ARG_TYPE,D=S.ERR_STREAM_PUSH_AFTER_EOF,O=S.ERR_METHOD_NOT_IMPLEMENTED,P=S.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i("inherits")(x,h);var q=T.errorOrDestroy,J=["error","close","destroy","pause","resume"];function A(w,_,C){o=o||i("./_stream_duplex"),w=w||{},typeof C!="boolean"&&(C=_ instanceof o),this.objectMode=!!w.objectMode,C&&(this.objectMode=this.objectMode||!!w.readableObjectMode),this.highWaterMark=b(this,w,"readableHighWaterMark",C),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=w.emitClose!==!1,this.autoDestroy=!!w.autoDestroy,this.destroyed=!1,this.defaultEncoding=w.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,w.encoding&&(m||(m=i("string_decoder/").StringDecoder),this.decoder=new m(w.encoding),this.encoding=w.encoding)}function x(w){if(o=o||i("./_stream_duplex"),!(this instanceof x))return new x(w);var _=this instanceof o;this._readableState=new A(w,this,_),this.readable=!0,w&&(typeof w.read=="function"&&(this._read=w.read),typeof w.destroy=="function"&&(this._destroy=w.destroy)),h.call(this)}function R(w,_,C,F,j){d("readableAddChunk",_);var K,nt=w._readableState;if(_===null)nt.reading=!1,(function(mt,ft){if(d("onEofChunk"),!ft.ended){if(ft.decoder){var gt=ft.decoder.end();gt&&gt.length&&(ft.buffer.push(gt),ft.length+=ft.objectMode?1:gt.length)}ft.ended=!0,ft.sync?et(mt):(ft.needReadable=!1,ft.emittedReadable||(ft.emittedReadable=!0,z(mt)))}})(w,nt);else if(j||(K=(function(mt,ft){var gt;xt=ft,c.isBuffer(xt)||xt instanceof u||typeof ft=="string"||ft===void 0||mt.objectMode||(gt=new I("chunk",["string","Buffer","Uint8Array"],ft));var xt;return gt})(nt,_)),K)q(w,K);else if(nt.objectMode||_&&_.length>0)if(typeof _=="string"||nt.objectMode||Object.getPrototypeOf(_)===c.prototype||(_=(function(mt){return c.from(mt)})(_)),F)nt.endEmitted?q(w,new P):M(w,nt,_,!0);else if(nt.ended)q(w,new D);else{if(nt.destroyed)return!1;nt.reading=!1,nt.decoder&&!C?(_=nt.decoder.write(_),nt.objectMode||_.length!==0?M(w,nt,_,!1):W(w,nt)):M(w,nt,_,!1)}else F||(nt.reading=!1,W(w,nt));return!nt.ended&&(nt.length<nt.highWaterMark||nt.length===0)}function M(w,_,C,F){_.flowing&&_.length===0&&!_.sync?(_.awaitDrain=0,w.emit("data",C)):(_.length+=_.objectMode?1:C.length,F?_.buffer.unshift(C):_.buffer.push(C),_.needReadable&&et(w)),W(w,_)}Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),x.prototype.destroy=T.destroy,x.prototype._undestroy=T.undestroy,x.prototype._destroy=function(w,_){_(w)},x.prototype.push=function(w,_){var C,F=this._readableState;return F.objectMode?C=!0:typeof w=="string"&&((_=_||F.defaultEncoding)!==F.encoding&&(w=c.from(w,_),_=""),C=!0),R(this,w,_,!1,C)},x.prototype.unshift=function(w){return R(this,w,null,!0,!1)},x.prototype.isPaused=function(){return this._readableState.flowing===!1},x.prototype.setEncoding=function(w){m||(m=i("string_decoder/").StringDecoder);var _=new m(w);this._readableState.decoder=_,this._readableState.encoding=this._readableState.decoder.encoding;for(var C=this._readableState.buffer.head,F="";C!==null;)F+=_.write(C.data),C=C.next;return this._readableState.buffer.clear(),F!==""&&this._readableState.buffer.push(F),this._readableState.length=F.length,this};var Y=1073741824;function X(w,_){return w<=0||_.length===0&&_.ended?0:_.objectMode?1:w!=w?_.flowing&&_.length?_.buffer.head.data.length:_.length:(w>_.highWaterMark&&(_.highWaterMark=(function(C){return C>=Y?C=Y:(C--,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,C|=C>>>16,C++),C})(w)),w<=_.length?w:_.ended?_.length:(_.needReadable=!0,0))}function et(w){var _=w._readableState;d("emitReadable",_.needReadable,_.emittedReadable),_.needReadable=!1,_.emittedReadable||(d("emitReadable",_.flowing),_.emittedReadable=!0,a.nextTick(z,w))}function z(w){var _=w._readableState;d("emitReadable_",_.destroyed,_.length,_.ended),_.destroyed||!_.length&&!_.ended||(w.emit("readable"),_.emittedReadable=!1),_.needReadable=!_.flowing&&!_.ended&&_.length<=_.highWaterMark,H(w)}function W(w,_){_.readingMore||(_.readingMore=!0,a.nextTick($,w,_))}function $(w,_){for(;!_.reading&&!_.ended&&(_.length<_.highWaterMark||_.flowing&&_.length===0);){var C=_.length;if(d("maybeReadMore read 0"),w.read(0),C===_.length)break}_.readingMore=!1}function L(w){var _=w._readableState;_.readableListening=w.listenerCount("readable")>0,_.resumeScheduled&&!_.paused?_.flowing=!0:w.listenerCount("data")>0&&w.resume()}function N(w){d("readable nexttick read 0"),w.read(0)}function V(w,_){d("resume",_.reading),_.reading||w.read(0),_.resumeScheduled=!1,w.emit("resume"),H(w),_.flowing&&!_.reading&&w.read(0)}function H(w){var _=w._readableState;for(d("flow",_.flowing);_.flowing&&w.read()!==null;);}function Q(w,_){return _.length===0?null:(_.objectMode?C=_.buffer.shift():!w||w>=_.length?(C=_.decoder?_.buffer.join(""):_.buffer.length===1?_.buffer.first():_.buffer.concat(_.length),_.buffer.clear()):C=_.buffer.consume(w,_.decoder),C);var C}function rt(w){var _=w._readableState;d("endReadable",_.endEmitted),_.endEmitted||(_.ended=!0,a.nextTick(tt,_,w))}function tt(w,_){if(d("endReadableNT",w.endEmitted,w.length),!w.endEmitted&&w.length===0&&(w.endEmitted=!0,_.readable=!1,_.emit("end"),w.autoDestroy)){var C=_._writableState;(!C||C.autoDestroy&&C.finished)&&_.destroy()}}function it(w,_){for(var C=0,F=w.length;C<F;C++)if(w[C]===_)return C;return-1}x.prototype.read=function(w){d("read",w),w=parseInt(w,10);var _=this._readableState,C=w;if(w!==0&&(_.emittedReadable=!1),w===0&&_.needReadable&&((_.highWaterMark!==0?_.length>=_.highWaterMark:_.length>0)||_.ended))return d("read: emitReadable",_.length,_.ended),_.length===0&&_.ended?rt(this):et(this),null;if((w=X(w,_))===0&&_.ended)return _.length===0&&rt(this),null;var F,j=_.needReadable;return d("need readable",j),(_.length===0||_.length-w<_.highWaterMark)&&d("length less than watermark",j=!0),_.ended||_.reading?d("reading or ended",j=!1):j&&(d("do read"),_.reading=!0,_.sync=!0,_.length===0&&(_.needReadable=!0),this._read(_.highWaterMark),_.sync=!1,_.reading||(w=X(C,_))),(F=w>0?Q(w,_):null)===null?(_.needReadable=_.length<=_.highWaterMark,w=0):(_.length-=w,_.awaitDrain=0),_.length===0&&(_.ended||(_.needReadable=!0),C!==w&&_.ended&&rt(this)),F!==null&&this.emit("data",F),F},x.prototype._read=function(w){q(this,new O("_read()"))},x.prototype.pipe=function(w,_){var C=this,F=this._readableState;switch(F.pipesCount){case 0:F.pipes=w;break;case 1:F.pipes=[F.pipes,w];break;default:F.pipes.push(w)}F.pipesCount+=1,d("pipe count=%d opts=%j",F.pipesCount,_);var j=(!_||_.end!==!1)&&w!==a.stdout&&w!==a.stderr?nt:he;function K(zt,qt){d("onunpipe"),zt===C&&qt&&qt.hasUnpiped===!1&&(qt.hasUnpiped=!0,d("cleanup"),w.removeListener("close",xe),w.removeListener("finish",we),w.removeListener("drain",mt),w.removeListener("error",xt),w.removeListener("unpipe",K),C.removeListener("end",nt),C.removeListener("end",he),C.removeListener("data",gt),ft=!0,!F.awaitDrain||w._writableState&&!w._writableState.needDrain||mt())}function nt(){d("onend"),w.end()}F.endEmitted?a.nextTick(j):C.once("end",j),w.on("unpipe",K);var mt=(function(zt){return function(){var qt=zt._readableState;d("pipeOnDrain",qt.awaitDrain),qt.awaitDrain&&qt.awaitDrain--,qt.awaitDrain===0&&l(zt,"data")&&(qt.flowing=!0,H(zt))}})(C);w.on("drain",mt);var ft=!1;function gt(zt){d("ondata");var qt=w.write(zt);d("dest.write",qt),qt===!1&&((F.pipesCount===1&&F.pipes===w||F.pipesCount>1&&it(F.pipes,w)!==-1)&&!ft&&(d("false write response, pause",F.awaitDrain),F.awaitDrain++),C.pause())}function xt(zt){d("onerror",zt),he(),w.removeListener("error",xt),l(w,"error")===0&&q(w,zt)}function xe(){w.removeListener("finish",we),he()}function we(){d("onfinish"),w.removeListener("close",xe),he()}function he(){d("unpipe"),C.unpipe(w)}return C.on("data",gt),(function(zt,qt,Ei){if(typeof zt.prependListener=="function")return zt.prependListener(qt,Ei);zt._events&&zt._events[qt]?Array.isArray(zt._events[qt])?zt._events[qt].unshift(Ei):zt._events[qt]=[Ei,zt._events[qt]]:zt.on(qt,Ei)})(w,"error",xt),w.once("close",xe),w.once("finish",we),w.emit("pipe",C),F.flowing||(d("pipe resume"),C.resume()),w},x.prototype.unpipe=function(w){var _=this._readableState,C={hasUnpiped:!1};if(_.pipesCount===0)return this;if(_.pipesCount===1)return w&&w!==_.pipes?this:(w||(w=_.pipes),_.pipes=null,_.pipesCount=0,_.flowing=!1,w&&w.emit("unpipe",this,C),this);if(!w){var F=_.pipes,j=_.pipesCount;_.pipes=null,_.pipesCount=0,_.flowing=!1;for(var K=0;K<j;K++)F[K].emit("unpipe",this,{hasUnpiped:!1});return this}var nt=it(_.pipes,w);return nt===-1?this:(_.pipes.splice(nt,1),_.pipesCount-=1,_.pipesCount===1&&(_.pipes=_.pipes[0]),w.emit("unpipe",this,C),this)},x.prototype.on=function(w,_){var C=h.prototype.on.call(this,w,_),F=this._readableState;return w==="data"?(F.readableListening=this.listenerCount("readable")>0,F.flowing!==!1&&this.resume()):w==="readable"&&(F.endEmitted||F.readableListening||(F.readableListening=F.needReadable=!0,F.flowing=!1,F.emittedReadable=!1,d("on readable",F.length,F.reading),F.length?et(this):F.reading||a.nextTick(N,this))),C},x.prototype.addListener=x.prototype.on,x.prototype.removeListener=function(w,_){var C=h.prototype.removeListener.call(this,w,_);return w==="readable"&&a.nextTick(L,this),C},x.prototype.removeAllListeners=function(w){var _=h.prototype.removeAllListeners.apply(this,arguments);return w!=="readable"&&w!==void 0||a.nextTick(L,this),_},x.prototype.resume=function(){var w=this._readableState;return w.flowing||(d("resume"),w.flowing=!w.readableListening,(function(_,C){C.resumeScheduled||(C.resumeScheduled=!0,a.nextTick(V,_,C))})(this,w)),w.paused=!1,this},x.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},x.prototype.wrap=function(w){var _=this,C=this._readableState,F=!1;for(var j in w.on("end",function(){if(d("wrapped end"),C.decoder&&!C.ended){var nt=C.decoder.end();nt&&nt.length&&_.push(nt)}_.push(null)}),w.on("data",function(nt){d("wrapped data"),C.decoder&&(nt=C.decoder.write(nt)),(!C.objectMode||nt!=null)&&(C.objectMode||nt&&nt.length)&&(_.push(nt)||(F=!0,w.pause()))}),w)this[j]===void 0&&typeof w[j]=="function"&&(this[j]=(function(nt){return function(){return w[nt].apply(w,arguments)}})(j));for(var K=0;K<J.length;K++)w.on(J[K],this.emit.bind(this,J[K]));return this._read=function(nt){d("wrapped _read",nt),F&&(F=!1,w.resume())},this},typeof Symbol=="function"&&(x.prototype[Symbol.asyncIterator]=function(){return p===void 0&&(p=i("./internal/streams/async_iterator")),p(this)}),Object.defineProperty(x.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(x.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(x.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),x._fromList=Q,Object.defineProperty(x.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(x.from=function(w,_){return g===void 0&&(g=i("./internal/streams/from")),g(x,w,_)})}).call(this)}).call(this,i("_process"),typeof Vi<"u"?Vi:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/async_iterator":61,"./internal/streams/buffer_list":62,"./internal/streams/destroy":63,"./internal/streams/from":65,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,events:22,inherits:24,"string_decoder/":75,util:16}],59:[function(i,r,n){r.exports=u;var a=i("../errors").codes,s=a.ERR_METHOD_NOT_IMPLEMENTED,o=a.ERR_MULTIPLE_CALLBACK,l=a.ERR_TRANSFORM_ALREADY_TRANSFORMING,h=a.ERR_TRANSFORM_WITH_LENGTH_0,c=i("./_stream_duplex");function u(m){if(!(this instanceof u))return new u(m);c.call(this,m),this._transformState={afterTransform:(function(p,g){var y=this._transformState;y.transforming=!1;var T=y.writecb;if(T===null)return this.emit("error",new o);y.writechunk=null,y.writecb=null,g!=null&&this.push(g),T(p);var b=this._readableState;b.reading=!1,(b.needReadable||b.length<b.highWaterMark)&&this._read(b.highWaterMark)}).bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,m&&(typeof m.transform=="function"&&(this._transform=m.transform),typeof m.flush=="function"&&(this._flush=m.flush)),this.on("prefinish",d)}function d(){var m=this;typeof this._flush!="function"||this._readableState.destroyed?f(this,null,null):this._flush(function(p,g){f(m,p,g)})}function f(m,p,g){if(p)return m.emit("error",p);if(g!=null&&m.push(g),m._writableState.length)throw new h;if(m._transformState.transforming)throw new l;return m.push(null)}i("inherits")(u,c),u.prototype.push=function(m,p){return this._transformState.needTransform=!1,c.prototype.push.call(this,m,p)},u.prototype._transform=function(m,p,g){g(new s("_transform()"))},u.prototype._write=function(m,p,g){var y=this._transformState;if(y.writecb=g,y.writechunk=m,y.writeencoding=p,!y.transforming){var T=this._readableState;(y.needTransform||T.needReadable||T.length<T.highWaterMark)&&this._read(T.highWaterMark)}},u.prototype._read=function(m){var p=this._transformState;p.writechunk===null||p.transforming?p.needTransform=!0:(p.transforming=!0,this._transform(p.writechunk,p.writeencoding,p.afterTransform))},u.prototype._destroy=function(m,p){c.prototype._destroy.call(this,m,function(g){p(g)})}},{"../errors":55,"./_stream_duplex":56,inherits:24}],60:[function(i,r,n){(function(a,s){(function(){function o(W){var $=this;this.next=null,this.entry=null,this.finish=function(){(function(L,N,V){var H=L.entry;for(L.entry=null;H;){var Q=H.callback;N.pendingcb--,Q(V),H=H.next}N.corkedRequestsFree.next=L})($,W)}}var l;r.exports=x,x.WritableState=A;var h={deprecate:i("util-deprecate")},c=i("./internal/streams/stream"),u=i("buffer").Buffer,d=s.Uint8Array||function(){},f,m=i("./internal/streams/destroy"),p=i("./internal/streams/state").getHighWaterMark,g=i("../errors").codes,y=g.ERR_INVALID_ARG_TYPE,T=g.ERR_METHOD_NOT_IMPLEMENTED,b=g.ERR_MULTIPLE_CALLBACK,S=g.ERR_STREAM_CANNOT_PIPE,I=g.ERR_STREAM_DESTROYED,D=g.ERR_STREAM_NULL_VALUES,O=g.ERR_STREAM_WRITE_AFTER_END,P=g.ERR_UNKNOWN_ENCODING,q=m.errorOrDestroy;function J(){}function A(W,$,L){l=l||i("./_stream_duplex"),W=W||{},typeof L!="boolean"&&(L=$ instanceof l),this.objectMode=!!W.objectMode,L&&(this.objectMode=this.objectMode||!!W.writableObjectMode),this.highWaterMark=p(this,W,"writableHighWaterMark",L),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var N=W.decodeStrings===!1;this.decodeStrings=!N,this.defaultEncoding=W.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(V){(function(H,Q){var rt=H._writableState,tt=rt.sync,it=rt.writecb;if(typeof it!="function")throw new b;if((function(_){_.writing=!1,_.writecb=null,_.length-=_.writelen,_.writelen=0})(rt),Q)(function(_,C,F,j,K){--C.pendingcb,F?(a.nextTick(K,j),a.nextTick(z,_,C),_._writableState.errorEmitted=!0,q(_,j)):(K(j),_._writableState.errorEmitted=!0,q(_,j),z(_,C))})(H,rt,tt,Q,it);else{var w=X(rt)||H.destroyed;w||rt.corked||rt.bufferProcessing||!rt.bufferedRequest||Y(H,rt),tt?a.nextTick(M,H,rt,w,it):M(H,rt,w,it)}})($,V)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=W.emitClose!==!1,this.autoDestroy=!!W.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function x(W){var $=this instanceof(l=l||i("./_stream_duplex"));if(!$&&!f.call(x,this))return new x(W);this._writableState=new A(W,this,$),this.writable=!0,W&&(typeof W.write=="function"&&(this._write=W.write),typeof W.writev=="function"&&(this._writev=W.writev),typeof W.destroy=="function"&&(this._destroy=W.destroy),typeof W.final=="function"&&(this._final=W.final)),c.call(this)}function R(W,$,L,N,V,H,Q){$.writelen=N,$.writecb=Q,$.writing=!0,$.sync=!0,$.destroyed?$.onwrite(new I("write")):L?W._writev(V,$.onwrite):W._write(V,H,$.onwrite),$.sync=!1}function M(W,$,L,N){L||(function(V,H){H.length===0&&H.needDrain&&(H.needDrain=!1,V.emit("drain"))})(W,$),$.pendingcb--,N(),z(W,$)}function Y(W,$){$.bufferProcessing=!0;var L=$.bufferedRequest;if(W._writev&&L&&L.next){var N=$.bufferedRequestCount,V=new Array(N),H=$.corkedRequestsFree;H.entry=L;for(var Q=0,rt=!0;L;)V[Q]=L,L.isBuf||(rt=!1),L=L.next,Q+=1;V.allBuffers=rt,R(W,$,!0,$.length,V,"",H.finish),$.pendingcb++,$.lastBufferedRequest=null,H.next?($.corkedRequestsFree=H.next,H.next=null):$.corkedRequestsFree=new o($),$.bufferedRequestCount=0}else{for(;L;){var tt=L.chunk,it=L.encoding,w=L.callback;if(R(W,$,!1,$.objectMode?1:tt.length,tt,it,w),L=L.next,$.bufferedRequestCount--,$.writing)break}L===null&&($.lastBufferedRequest=null)}$.bufferedRequest=L,$.bufferProcessing=!1}function X(W){return W.ending&&W.length===0&&W.bufferedRequest===null&&!W.finished&&!W.writing}function et(W,$){W._final(function(L){$.pendingcb--,L&&q(W,L),$.prefinished=!0,W.emit("prefinish"),z(W,$)})}function z(W,$){var L=X($);if(L&&((function(V,H){H.prefinished||H.finalCalled||(typeof V._final!="function"||H.destroyed?(H.prefinished=!0,V.emit("prefinish")):(H.pendingcb++,H.finalCalled=!0,a.nextTick(et,V,H)))})(W,$),$.pendingcb===0&&($.finished=!0,W.emit("finish"),$.autoDestroy))){var N=W._readableState;(!N||N.autoDestroy&&N.endEmitted)&&W.destroy()}return L}i("inherits")(x,c),A.prototype.getBuffer=function(){for(var W=this.bufferedRequest,$=[];W;)$.push(W),W=W.next;return $},(function(){try{Object.defineProperty(A.prototype,"buffer",{get:h.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(x,Symbol.hasInstance,{value:function(W){return!!f.call(this,W)||this===x&&W&&W._writableState instanceof A}})):f=function(W){return W instanceof this},x.prototype.pipe=function(){q(this,new S)},x.prototype.write=function(W,$,L){var N,V=this._writableState,H=!1,Q=!V.objectMode&&(N=W,u.isBuffer(N)||N instanceof d);return Q&&!u.isBuffer(W)&&(W=(function(rt){return u.from(rt)})(W)),typeof $=="function"&&(L=$,$=null),Q?$="buffer":$||($=V.defaultEncoding),typeof L!="function"&&(L=J),V.ending?(function(rt,tt){var it=new O;q(rt,it),a.nextTick(tt,it)})(this,L):(Q||(function(rt,tt,it,w){var _;return it===null?_=new D:typeof it=="string"||tt.objectMode||(_=new y("chunk",["string","Buffer"],it)),!_||(q(rt,_),a.nextTick(w,_),!1)})(this,V,W,L))&&(V.pendingcb++,H=(function(rt,tt,it,w,_,C){if(!it){var F=(function(mt,ft,gt){return mt.objectMode||mt.decodeStrings===!1||typeof ft!="string"||(ft=u.from(ft,gt)),ft})(tt,w,_);w!==F&&(it=!0,_="buffer",w=F)}var j=tt.objectMode?1:w.length;tt.length+=j;var K=tt.length<tt.highWaterMark;if(K||(tt.needDrain=!0),tt.writing||tt.corked){var nt=tt.lastBufferedRequest;tt.lastBufferedRequest={chunk:w,encoding:_,isBuf:it,callback:C,next:null},nt?nt.next=tt.lastBufferedRequest:tt.bufferedRequest=tt.lastBufferedRequest,tt.bufferedRequestCount+=1}else R(rt,tt,!1,j,w,_,C);return K})(this,V,Q,W,$,L)),H},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var W=this._writableState;W.corked&&(W.corked--,W.writing||W.corked||W.bufferProcessing||!W.bufferedRequest||Y(this,W))},x.prototype.setDefaultEncoding=function(W){if(typeof W=="string"&&(W=W.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((W+"").toLowerCase())>-1))throw new P(W);return this._writableState.defaultEncoding=W,this},Object.defineProperty(x.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(x.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),x.prototype._write=function(W,$,L){L(new T("_write()"))},x.prototype._writev=null,x.prototype.end=function(W,$,L){var N=this._writableState;return typeof W=="function"?(L=W,W=null,$=null):typeof $=="function"&&(L=$,$=null),W!=null&&this.write(W,$),N.corked&&(N.corked=1,this.uncork()),N.ending||(function(V,H,Q){H.ending=!0,z(V,H),Q&&(H.finished?a.nextTick(Q):V.once("finish",Q)),H.ended=!0,V.writable=!1})(this,N,L),this},Object.defineProperty(x.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(W){this._writableState&&(this._writableState.destroyed=W)}}),x.prototype.destroy=m.destroy,x.prototype._undestroy=m.undestroy,x.prototype._destroy=function(W,$){$(W)}}).call(this)}).call(this,i("_process"),typeof Vi<"u"?Vi:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":55,"./_stream_duplex":56,"./internal/streams/destroy":63,"./internal/streams/state":67,"./internal/streams/stream":68,_process:50,buffer:17,inherits:24,"util-deprecate":78}],61:[function(i,r,n){(function(a){(function(){var s;function o(S,I,D){return I in S?Object.defineProperty(S,I,{value:D,enumerable:!0,configurable:!0,writable:!0}):S[I]=D,S}var l=i("./end-of-stream"),h=Symbol("lastResolve"),c=Symbol("lastReject"),u=Symbol("error"),d=Symbol("ended"),f=Symbol("lastPromise"),m=Symbol("handlePromise"),p=Symbol("stream");function g(S,I){return{value:S,done:I}}function y(S){var I=S[h];if(I!==null){var D=S[p].read();D!==null&&(S[f]=null,S[h]=null,S[c]=null,I(g(D,!1)))}}var T=Object.getPrototypeOf(function(){}),b=Object.setPrototypeOf((o(s={get stream(){return this[p]},next:function(){var S=this,I=this[u];if(I!==null)return Promise.reject(I);if(this[d])return Promise.resolve(g(void 0,!0));if(this[p].destroyed)return new Promise(function(q,J){a.nextTick(function(){S[u]?J(S[u]):q(g(void 0,!0))})});var D,O=this[f];if(O)D=new Promise((function(q,J){return function(A,x){q.then(function(){J[d]?A(g(void 0,!0)):J[m](A,x)},x)}})(O,this));else{var P=this[p].read();if(P!==null)return Promise.resolve(g(P,!1));D=new Promise(this[m])}return this[f]=D,D}},Symbol.asyncIterator,function(){return this}),o(s,"return",function(){var S=this;return new Promise(function(I,D){S[p].destroy(null,function(O){O?D(O):I(g(void 0,!0))})})}),s),T);r.exports=function(S){var I,D=Object.create(b,(o(I={},p,{value:S,writable:!0}),o(I,h,{value:null,writable:!0}),o(I,c,{value:null,writable:!0}),o(I,u,{value:null,writable:!0}),o(I,d,{value:S._readableState.endEmitted,writable:!0}),o(I,m,{value:function(O,P){var q=D[p].read();q?(D[f]=null,D[h]=null,D[c]=null,O(g(q,!1))):(D[h]=O,D[c]=P)},writable:!0}),I));return D[f]=null,l(S,function(O){if(O&&O.code!=="ERR_STREAM_PREMATURE_CLOSE"){var P=D[c];return P!==null&&(D[f]=null,D[h]=null,D[c]=null,P(O)),void(D[u]=O)}var q=D[h];q!==null&&(D[f]=null,D[h]=null,D[c]=null,q(g(void 0,!0))),D[d]=!0}),S.on("readable",(function(O){a.nextTick(y,O)}).bind(null,D)),D}}).call(this)}).call(this,i("_process"))},{"./end-of-stream":64,_process:50}],62:[function(i,r,n){function a(u,d){var f=Object.keys(u);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(u);d&&(m=m.filter(function(p){return Object.getOwnPropertyDescriptor(u,p).enumerable})),f.push.apply(f,m)}return f}function s(u,d,f){return d in u?Object.defineProperty(u,d,{value:f,enumerable:!0,configurable:!0,writable:!0}):u[d]=f,u}function o(u,d){for(var f=0;f<d.length;f++){var m=d[f];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,m.key,m)}}var l=i("buffer").Buffer,h=i("util").inspect,c=h&&h.custom||"inspect";r.exports=(function(){function u(){(function(m,p){if(!(m instanceof p))throw new TypeError("Cannot call a class as a function")})(this,u),this.head=null,this.tail=null,this.length=0}var d,f;return d=u,(f=[{key:"push",value:function(m){var p={data:m,next:null};this.length>0?this.tail.next=p:this.head=p,this.tail=p,++this.length}},{key:"unshift",value:function(m){var p={data:m,next:this.head};this.length===0&&(this.tail=p),this.head=p,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var p=this.head,g=""+p.data;p=p.next;)g+=m+p.data;return g}},{key:"concat",value:function(m){if(this.length===0)return l.alloc(0);for(var p,g,y,T=l.allocUnsafe(m>>>0),b=this.head,S=0;b;)p=b.data,g=T,y=S,l.prototype.copy.call(p,g,y),S+=b.data.length,b=b.next;return T}},{key:"consume",value:function(m,p){var g;return m<this.head.data.length?(g=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):g=m===this.head.data.length?this.shift():p?this._getString(m):this._getBuffer(m),g}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var p=this.head,g=1,y=p.data;for(m-=y.length;p=p.next;){var T=p.data,b=m>T.length?T.length:m;if(b===T.length?y+=T:y+=T.slice(0,m),(m-=b)===0){b===T.length?(++g,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p,p.data=T.slice(b));break}++g}return this.length-=g,y}},{key:"_getBuffer",value:function(m){var p=l.allocUnsafe(m),g=this.head,y=1;for(g.data.copy(p),m-=g.data.length;g=g.next;){var T=g.data,b=m>T.length?T.length:m;if(T.copy(p,p.length-m,0,b),(m-=b)===0){b===T.length?(++y,g.next?this.head=g.next:this.head=this.tail=null):(this.head=g,g.data=T.slice(b));break}++y}return this.length-=y,p}},{key:c,value:function(m,p){return h(this,(function(g){for(var y=1;y<arguments.length;y++){var T=arguments[y]!=null?arguments[y]:{};y%2?a(Object(T),!0).forEach(function(b){s(g,b,T[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(T)):a(Object(T)).forEach(function(b){Object.defineProperty(g,b,Object.getOwnPropertyDescriptor(T,b))})}return g})({},p,{depth:0,customInspect:!1}))}}])&&o(d.prototype,f),u})()},{buffer:17,util:16}],63:[function(i,r,n){(function(a){(function(){function s(h,c){l(h,c),o(h)}function o(h){h._writableState&&!h._writableState.emitClose||h._readableState&&!h._readableState.emitClose||h.emit("close")}function l(h,c){h.emit("error",c)}r.exports={destroy:function(h,c){var u=this,d=this._readableState&&this._readableState.destroyed,f=this._writableState&&this._writableState.destroyed;return d||f?(c?c(h):h&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,a.nextTick(l,this,h)):a.nextTick(l,this,h)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,function(m){!c&&m?u._writableState?u._writableState.errorEmitted?a.nextTick(o,u):(u._writableState.errorEmitted=!0,a.nextTick(s,u,m)):a.nextTick(s,u,m):c?(a.nextTick(o,u),c(m)):a.nextTick(o,u)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(h,c){var u=h._readableState,d=h._writableState;u&&u.autoDestroy||d&&d.autoDestroy?h.destroy(c):h.emit("error",c)}}}).call(this)}).call(this,i("_process"))},{_process:50}],64:[function(i,r,n){var a=i("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function s(){}r.exports=function o(l,h,c){if(typeof h=="function")return o(l,null,h);h||(h={}),c=(function(I){var D=!1;return function(){if(!D){D=!0;for(var O=arguments.length,P=new Array(O),q=0;q<O;q++)P[q]=arguments[q];I.apply(this,P)}}})(c||s);var u=h.readable||h.readable!==!1&&l.readable,d=h.writable||h.writable!==!1&&l.writable,f=function(){l.writable||p()},m=l._writableState&&l._writableState.finished,p=function(){d=!1,m=!0,u||c.call(l)},g=l._readableState&&l._readableState.endEmitted,y=function(){u=!1,g=!0,d||c.call(l)},T=function(I){c.call(l,I)},b=function(){var I;return u&&!g?(l._readableState&&l._readableState.ended||(I=new a),c.call(l,I)):d&&!m?(l._writableState&&l._writableState.ended||(I=new a),c.call(l,I)):void 0},S=function(){l.req.on("finish",p)};return(function(I){return I.setHeader&&typeof I.abort=="function"})(l)?(l.on("complete",p),l.on("abort",b),l.req?S():l.on("request",S)):d&&!l._writableState&&(l.on("end",f),l.on("close",f)),l.on("end",y),l.on("finish",p),h.error!==!1&&l.on("error",T),l.on("close",b),function(){l.removeListener("complete",p),l.removeListener("abort",b),l.removeListener("request",S),l.req&&l.req.removeListener("finish",p),l.removeListener("end",f),l.removeListener("close",f),l.removeListener("finish",p),l.removeListener("end",y),l.removeListener("error",T),l.removeListener("close",b)}}},{"../../../errors":55}],65:[function(i,r,n){r.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],66:[function(i,r,n){var a,s=i("../../../errors").codes,o=s.ERR_MISSING_ARGS,l=s.ERR_STREAM_DESTROYED;function h(d){if(d)throw d}function c(d){d()}function u(d,f){return d.pipe(f)}r.exports=function(){for(var d=arguments.length,f=new Array(d),m=0;m<d;m++)f[m]=arguments[m];var p,g=(function(T){return T.length?typeof T[T.length-1]!="function"?h:T.pop():h})(f);if(Array.isArray(f[0])&&(f=f[0]),f.length<2)throw new o("streams");var y=f.map(function(T,b){var S=b<f.length-1;return(function(I,D,O,P){P=(function(A){var x=!1;return function(){x||(x=!0,A.apply(void 0,arguments))}})(P);var q=!1;I.on("close",function(){q=!0}),a===void 0&&(a=i("./end-of-stream")),a(I,{readable:D,writable:O},function(A){if(A)return P(A);q=!0,P()});var J=!1;return function(A){if(!q&&!J)return J=!0,(function(x){return x.setHeader&&typeof x.abort=="function"})(I)?I.abort():typeof I.destroy=="function"?I.destroy():void P(A||new l("pipe"))}})(T,S,b>0,function(I){p||(p=I),I&&y.forEach(c),S||(y.forEach(c),g(p))})});return f.reduce(u)}},{"../../../errors":55,"./end-of-stream":64}],67:[function(i,r,n){var a=i("../../../errors").codes.ERR_INVALID_OPT_VALUE;r.exports={getHighWaterMark:function(s,o,l,h){var c=(function(u,d,f){return u.highWaterMark!=null?u.highWaterMark:d?u[f]:null})(o,h,l);if(c!=null){if(!isFinite(c)||Math.floor(c)!==c||c<0)throw new a(h?l:"highWaterMark",c);return Math.floor(c)}return s.objectMode?16:16384}}},{"../../../errors":55}],68:[function(i,r,n){r.exports=i("events").EventEmitter},{events:22}],69:[function(i,r,n){(n=r.exports=i("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=i("./lib/_stream_writable.js"),n.Duplex=i("./lib/_stream_duplex.js"),n.Transform=i("./lib/_stream_transform.js"),n.PassThrough=i("./lib/_stream_passthrough.js"),n.finished=i("./lib/internal/streams/end-of-stream.js"),n.pipeline=i("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":56,"./lib/_stream_passthrough.js":57,"./lib/_stream_readable.js":58,"./lib/_stream_transform.js":59,"./lib/_stream_writable.js":60,"./lib/internal/streams/end-of-stream.js":64,"./lib/internal/streams/pipeline.js":66}],70:[function(i,r,n){r.exports=function(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var a;if(arguments.length>0){a=new Array(arguments.length-2);for(var s=0;s<a.length;s++)a[s]=arguments[s+2]}return new function(o,l,h){var c=this;this._callback=o,this._args=h,this._interval=setInterval(o,l,this._args),this.reschedule=function(u){u||(u=c._interval),c._interval&&clearInterval(c._interval),c._interval=setInterval(c._callback,u,c._args)},this.clear=function(){c._interval&&(clearInterval(c._interval),c._interval=void 0)},this.destroy=function(){c._interval&&clearInterval(c._interval),c._callback=void 0,c._interval=void 0,c._args=void 0}}(arguments[0],arguments[1],a)}},{}],71:[function(i,r,n){r.exports=i("./index.js")()},{"./index.js":72}],72:[function(i,r,n){(function(a){(function(){function s(o){return o instanceof a?a.from(o):new o.constructor(o.buffer.slice(),o.byteOffset,o.length)}r.exports=function(o){return(o=o||{}).circles?(function(h){var c=[],u=[];return h.proto?function f(m){if(typeof m!="object"||m===null)return m;if(m instanceof Date)return new Date(m);if(Array.isArray(m))return d(m,f);if(m instanceof Map)return new Map(d(Array.from(m),f));if(m instanceof Set)return new Set(d(Array.from(m),f));var p={};for(var g in c.push(m),u.push(p),m){var y=m[g];if(typeof y!="object"||y===null)p[g]=y;else if(y instanceof Date)p[g]=new Date(y);else if(y instanceof Map)p[g]=new Map(d(Array.from(y),f));else if(y instanceof Set)p[g]=new Set(d(Array.from(y),f));else if(ArrayBuffer.isView(y))p[g]=s(y);else{var T=c.indexOf(y);p[g]=T!==-1?u[T]:f(y)}}return c.pop(),u.pop(),p}:function f(m){if(typeof m!="object"||m===null)return m;if(m instanceof Date)return new Date(m);if(Array.isArray(m))return d(m,f);if(m instanceof Map)return new Map(d(Array.from(m),f));if(m instanceof Set)return new Set(d(Array.from(m),f));var p={};for(var g in c.push(m),u.push(p),m)if(Object.hasOwnProperty.call(m,g)!==!1){var y=m[g];if(typeof y!="object"||y===null)p[g]=y;else if(y instanceof Date)p[g]=new Date(y);else if(y instanceof Map)p[g]=new Map(d(Array.from(y),f));else if(y instanceof Set)p[g]=new Set(d(Array.from(y),f));else if(ArrayBuffer.isView(y))p[g]=s(y);else{var T=c.indexOf(y);p[g]=T!==-1?u[T]:f(y)}}return c.pop(),u.pop(),p};function d(f,m){for(var p=Object.keys(f),g=new Array(p.length),y=0;y<p.length;y++){var T=p[y],b=f[T];if(typeof b!="object"||b===null)g[T]=b;else if(b instanceof Date)g[T]=new Date(b);else if(ArrayBuffer.isView(b))g[T]=s(b);else{var S=c.indexOf(b);g[T]=S!==-1?u[S]:m(b)}}return g}})(o):o.proto?function h(c){if(typeof c!="object"||c===null)return c;if(c instanceof Date)return new Date(c);if(Array.isArray(c))return l(c,h);if(c instanceof Map)return new Map(l(Array.from(c),h));if(c instanceof Set)return new Set(l(Array.from(c),h));var u={};for(var d in c){var f=c[d];typeof f!="object"||f===null?u[d]=f:f instanceof Date?u[d]=new Date(f):f instanceof Map?u[d]=new Map(l(Array.from(f),h)):f instanceof Set?u[d]=new Set(l(Array.from(f),h)):ArrayBuffer.isView(f)?u[d]=s(f):u[d]=h(f)}return u}:function h(c){if(typeof c!="object"||c===null)return c;if(c instanceof Date)return new Date(c);if(Array.isArray(c))return l(c,h);if(c instanceof Map)return new Map(l(Array.from(c),h));if(c instanceof Set)return new Set(l(Array.from(c),h));var u={};for(var d in c)if(Object.hasOwnProperty.call(c,d)!==!1){var f=c[d];typeof f!="object"||f===null?u[d]=f:f instanceof Date?u[d]=new Date(f):f instanceof Map?u[d]=new Map(l(Array.from(f),h)):f instanceof Set?u[d]=new Set(l(Array.from(f),h)):ArrayBuffer.isView(f)?u[d]=s(f):u[d]=h(f)}return u};function l(h,c){for(var u=Object.keys(h),d=new Array(u.length),f=0;f<u.length;f++){var m=u[f],p=h[m];typeof p!="object"||p===null?d[m]=p:p instanceof Date?d[m]=new Date(p):ArrayBuffer.isView(p)?d[m]=s(p):d[m]=c(p)}return d}}}).call(this)}).call(this,i("buffer").Buffer)},{buffer:17}],73:[function(i,r,n){var a=i("buffer"),s=a.Buffer;function o(h,c){for(var u in h)c[u]=h[u]}function l(h,c,u){return s(h,c,u)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?r.exports=a:(o(a,n),n.Buffer=l),l.prototype=Object.create(s.prototype),o(s,l),l.from=function(h,c,u){if(typeof h=="number")throw new TypeError("Argument must not be a number");return s(h,c,u)},l.alloc=function(h,c,u){if(typeof h!="number")throw new TypeError("Argument must be a number");var d=s(h);return c!==void 0?typeof u=="string"?d.fill(c,u):d.fill(c):d.fill(0),d},l.allocUnsafe=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return s(h)},l.allocUnsafeSlow=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return a.SlowBuffer(h)}},{buffer:17}],74:[function(i,r,n){r.exports=function(a){var s=a._readableState;return s?s.objectMode||typeof a._duplexState=="number"?a.read():a.read((o=s,o.buffer.length?o.buffer.head?o.buffer.head.data.length:o.buffer[0].length:o.length)):null;var o}},{}],75:[function(i,r,n){var a=i("safe-buffer").Buffer,s=a.isEncoding||function(g){switch((g=""+g)&&g.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(g){var y;switch(this.encoding=(function(T){var b=(function(S){if(!S)return"utf8";for(var I;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(I)return;S=(""+S).toLowerCase(),I=!0}})(T);if(typeof b!="string"&&(a.isEncoding===s||!s(T)))throw new Error("Unknown encoding: "+T);return b||T})(g),this.encoding){case"utf16le":this.text=c,this.end=u,y=4;break;case"utf8":this.fillLast=h,y=4;break;case"base64":this.text=d,this.end=f,y=3;break;default:return this.write=m,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=a.allocUnsafe(y)}function l(g){return g<=127?0:g>>5==6?2:g>>4==14?3:g>>3==30?4:g>>6==2?-1:-2}function h(g){var y=this.lastTotal-this.lastNeed,T=(function(b,S,I){if((192&S[0])!=128)return b.lastNeed=0,"�";if(b.lastNeed>1&&S.length>1){if((192&S[1])!=128)return b.lastNeed=1,"�";if(b.lastNeed>2&&S.length>2&&(192&S[2])!=128)return b.lastNeed=2,"�"}})(this,g);return T!==void 0?T:this.lastNeed<=g.length?(g.copy(this.lastChar,y,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(g.copy(this.lastChar,y,0,g.length),void(this.lastNeed-=g.length))}function c(g,y){if((g.length-y)%2==0){var T=g.toString("utf16le",y);if(T){var b=T.charCodeAt(T.length-1);if(b>=55296&&b<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=g[g.length-2],this.lastChar[1]=g[g.length-1],T.slice(0,-1)}return T}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=g[g.length-1],g.toString("utf16le",y,g.length-1)}function u(g){var y=g&&g.length?this.write(g):"";if(this.lastNeed){var T=this.lastTotal-this.lastNeed;return y+this.lastChar.toString("utf16le",0,T)}return y}function d(g,y){var T=(g.length-y)%3;return T===0?g.toString("base64",y):(this.lastNeed=3-T,this.lastTotal=3,T===1?this.lastChar[0]=g[g.length-1]:(this.lastChar[0]=g[g.length-2],this.lastChar[1]=g[g.length-1]),g.toString("base64",y,g.length-T))}function f(g){var y=g&&g.length?this.write(g):"";return this.lastNeed?y+this.lastChar.toString("base64",0,3-this.lastNeed):y}function m(g){return g.toString(this.encoding)}function p(g){return g&&g.length?this.write(g):""}n.StringDecoder=o,o.prototype.write=function(g){if(g.length===0)return"";var y,T;if(this.lastNeed){if((y=this.fillLast(g))===void 0)return"";T=this.lastNeed,this.lastNeed=0}else T=0;return T<g.length?y?y+this.text(g,T):this.text(g,T):y||""},o.prototype.end=function(g){var y=g&&g.length?this.write(g):"";return this.lastNeed?y+"�":y},o.prototype.text=function(g,y){var T=(function(S,I,D){var O=I.length-1;if(O<D)return 0;var P=l(I[O]);return P>=0?(P>0&&(S.lastNeed=P-1),P):--O<D||P===-2?0:(P=l(I[O]))>=0?(P>0&&(S.lastNeed=P-2),P):--O<D||P===-2?0:(P=l(I[O]))>=0?(P>0&&(P===2?P=0:S.lastNeed=P-3),P):0})(this,g,y);if(!this.lastNeed)return g.toString("utf8",y);this.lastTotal=T;var b=g.length-(T-this.lastNeed);return g.copy(this.lastChar,0,b),g.toString("utf8",y,b)},o.prototype.fillLast=function(g){if(this.lastNeed<=g.length)return g.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);g.copy(this.lastChar,this.lastTotal-this.lastNeed,0,g.length),this.lastNeed-=g.length}},{"safe-buffer":73}],76:[function(i,r,n){var a=i("punycode"),s=i("./util");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=I,n.resolve=function(D,O){return I(D,!1,!0).resolve(O)},n.resolveObject=function(D,O){return D?I(D,!1,!0).resolveObject(O):O},n.format=function(D){return s.isString(D)&&(D=I(D)),D instanceof o?D.format():o.prototype.format.call(D)},n.Url=o;var l=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),d=["'"].concat(u),f=["%","/","?",";","#"].concat(d),m=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:!0,"javascript:":!0},T={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},S=i("querystring");function I(D,O,P){if(D&&s.isObject(D)&&D instanceof o)return D;var q=new o;return q.parse(D,O,P),q}o.prototype.parse=function(D,O,P){if(!s.isString(D))throw new TypeError("Parameter 'url' must be a string, not "+typeof D);var q=D.indexOf("?"),J=q!==-1&&q<D.indexOf("#")?"?":"#",A=D.split(J);A[0]=A[0].replace(/\\/g,"/");var x=D=A.join(J);if(x=x.trim(),!P&&D.split("#").length===1){var R=c.exec(x);if(R)return this.path=x,this.href=x,this.pathname=R[1],R[2]?(this.search=R[2],this.query=O?S.parse(this.search.substr(1)):this.search.substr(1)):O&&(this.search="",this.query={}),this}var M=l.exec(x);if(M){var Y=(M=M[0]).toLowerCase();this.protocol=Y,x=x.substr(M.length)}if(P||M||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var X=x.substr(0,2)==="//";!X||M&&T[M]||(x=x.substr(2),this.slashes=!0)}if(!T[M]&&(X||M&&!b[M])){for(var et,z,W=-1,$=0;$<m.length;$++)(L=x.indexOf(m[$]))!==-1&&(W===-1||L<W)&&(W=L);for((z=W===-1?x.lastIndexOf("@"):x.lastIndexOf("@",W))!==-1&&(et=x.slice(0,z),x=x.slice(z+1),this.auth=decodeURIComponent(et)),W=-1,$=0;$<f.length;$++){var L;(L=x.indexOf(f[$]))!==-1&&(W===-1||L<W)&&(W=L)}W===-1&&(W=x.length),this.host=x.slice(0,W),x=x.slice(W),this.parseHost(),this.hostname=this.hostname||"";var N=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!N)for(var V=this.hostname.split(/\./),H=($=0,V.length);$<H;$++){var Q=V[$];if(Q&&!Q.match(p)){for(var rt="",tt=0,it=Q.length;tt<it;tt++)Q.charCodeAt(tt)>127?rt+="x":rt+=Q[tt];if(!rt.match(p)){var w=V.slice(0,$),_=V.slice($+1),C=Q.match(g);C&&(w.push(C[1]),_.unshift(C[2])),_.length&&(x="/"+_.join(".")+x),this.hostname=w.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=a.toASCII(this.hostname));var F=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+F,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),x[0]!=="/"&&(x="/"+x))}if(!y[Y])for($=0,H=d.length;$<H;$++){var K=d[$];if(x.indexOf(K)!==-1){var nt=encodeURIComponent(K);nt===K&&(nt=escape(K)),x=x.split(K).join(nt)}}var mt=x.indexOf("#");mt!==-1&&(this.hash=x.substr(mt),x=x.slice(0,mt));var ft=x.indexOf("?");if(ft!==-1?(this.search=x.substr(ft),this.query=x.substr(ft+1),O&&(this.query=S.parse(this.query)),x=x.slice(0,ft)):O&&(this.search="",this.query={}),x&&(this.pathname=x),b[Y]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){F=this.pathname||"";var gt=this.search||"";this.path=F+gt}return this.href=this.format(),this},o.prototype.format=function(){var D=this.auth||"";D&&(D=(D=encodeURIComponent(D)).replace(/%3A/i,":"),D+="@");var O=this.protocol||"",P=this.pathname||"",q=this.hash||"",J=!1,A="";this.host?J=D+this.host:this.hostname&&(J=D+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(J+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(A=S.stringify(this.query));var x=this.search||A&&"?"+A||"";return O&&O.substr(-1)!==":"&&(O+=":"),this.slashes||(!O||b[O])&&J!==!1?(J="//"+(J||""),P&&P.charAt(0)!=="/"&&(P="/"+P)):J||(J=""),q&&q.charAt(0)!=="#"&&(q="#"+q),x&&x.charAt(0)!=="?"&&(x="?"+x),O+J+(P=P.replace(/[?#]/g,function(R){return encodeURIComponent(R)}))+(x=x.replace("#","%23"))+q},o.prototype.resolve=function(D){return this.resolveObject(I(D,!1,!0)).format()},o.prototype.resolveObject=function(D){if(s.isString(D)){var O=new o;O.parse(D,!1,!0),D=O}for(var P=new o,q=Object.keys(this),J=0;J<q.length;J++){var A=q[J];P[A]=this[A]}if(P.hash=D.hash,D.href==="")return P.href=P.format(),P;if(D.slashes&&!D.protocol){for(var x=Object.keys(D),R=0;R<x.length;R++){var M=x[R];M!=="protocol"&&(P[M]=D[M])}return b[P.protocol]&&P.hostname&&!P.pathname&&(P.path=P.pathname="/"),P.href=P.format(),P}if(D.protocol&&D.protocol!==P.protocol){if(!b[D.protocol]){for(var Y=Object.keys(D),X=0;X<Y.length;X++){var et=Y[X];P[et]=D[et]}return P.href=P.format(),P}if(P.protocol=D.protocol,D.host||T[D.protocol])P.pathname=D.pathname;else{for(var z=(D.pathname||"").split("/");z.length&&!(D.host=z.shift()););D.host||(D.host=""),D.hostname||(D.hostname=""),z[0]!==""&&z.unshift(""),z.length<2&&z.unshift(""),P.pathname=z.join("/")}if(P.search=D.search,P.query=D.query,P.host=D.host||"",P.auth=D.auth,P.hostname=D.hostname||D.host,P.port=D.port,P.pathname||P.search){var W=P.pathname||"",$=P.search||"";P.path=W+$}return P.slashes=P.slashes||D.slashes,P.href=P.format(),P}var L=P.pathname&&P.pathname.charAt(0)==="/",N=D.host||D.pathname&&D.pathname.charAt(0)==="/",V=N||L||P.host&&D.pathname,H=V,Q=P.pathname&&P.pathname.split("/")||[],rt=(z=D.pathname&&D.pathname.split("/")||[],P.protocol&&!b[P.protocol]);if(rt&&(P.hostname="",P.port=null,P.host&&(Q[0]===""?Q[0]=P.host:Q.unshift(P.host)),P.host="",D.protocol&&(D.hostname=null,D.port=null,D.host&&(z[0]===""?z[0]=D.host:z.unshift(D.host)),D.host=null),V=V&&(z[0]===""||Q[0]==="")),N)P.host=D.host||D.host===""?D.host:P.host,P.hostname=D.hostname||D.hostname===""?D.hostname:P.hostname,P.search=D.search,P.query=D.query,Q=z;else if(z.length)Q||(Q=[]),Q.pop(),Q=Q.concat(z),P.search=D.search,P.query=D.query;else if(!s.isNullOrUndefined(D.search))return rt&&(P.hostname=P.host=Q.shift(),(C=!!(P.host&&P.host.indexOf("@")>0)&&P.host.split("@"))&&(P.auth=C.shift(),P.host=P.hostname=C.shift())),P.search=D.search,P.query=D.query,s.isNull(P.pathname)&&s.isNull(P.search)||(P.path=(P.pathname?P.pathname:"")+(P.search?P.search:"")),P.href=P.format(),P;if(!Q.length)return P.pathname=null,P.search?P.path="/"+P.search:P.path=null,P.href=P.format(),P;for(var tt=Q.slice(-1)[0],it=(P.host||D.host||Q.length>1)&&(tt==="."||tt==="..")||tt==="",w=0,_=Q.length;_>=0;_--)(tt=Q[_])==="."?Q.splice(_,1):tt===".."?(Q.splice(_,1),w++):w&&(Q.splice(_,1),w--);if(!V&&!H)for(;w--;w)Q.unshift("..");!V||Q[0]===""||Q[0]&&Q[0].charAt(0)==="/"||Q.unshift(""),it&&Q.join("/").substr(-1)!=="/"&&Q.push("");var C,F=Q[0]===""||Q[0]&&Q[0].charAt(0)==="/";return rt&&(P.hostname=P.host=F?"":Q.length?Q.shift():"",(C=!!(P.host&&P.host.indexOf("@")>0)&&P.host.split("@"))&&(P.auth=C.shift(),P.host=P.hostname=C.shift())),(V=V||P.host&&Q.length)&&!F&&Q.unshift(""),Q.length?P.pathname=Q.join("/"):(P.pathname=null,P.path=null),s.isNull(P.pathname)&&s.isNull(P.search)||(P.path=(P.pathname?P.pathname:"")+(P.search?P.search:"")),P.auth=D.auth||P.auth,P.slashes=P.slashes||D.slashes,P.href=P.format(),P},o.prototype.parseHost=function(){var D=this.host,O=h.exec(D);O&&((O=O[0])!==":"&&(this.port=O.substr(1)),D=D.substr(0,D.length-O.length)),D&&(this.hostname=D)}},{"./util":77,punycode:51,querystring:54}],77:[function(i,r,n){r.exports={isString:function(a){return typeof a=="string"},isObject:function(a){return typeof a=="object"&&a!==null},isNull:function(a){return a===null},isNullOrUndefined:function(a){return a==null}}},{}],78:[function(i,r,n){(function(a){(function(){function s(o){try{if(!a.localStorage)return!1}catch{return!1}var l=a.localStorage[o];return l!=null&&String(l).toLowerCase()==="true"}r.exports=function(o,l){if(s("noDeprecation"))return o;var h=!1;return function(){if(!h){if(s("throwDeprecation"))throw new Error(l);s("traceDeprecation")?console.trace(l):console.warn(l),h=!0}return o.apply(this,arguments)}}}).call(this)}).call(this,typeof Vi<"u"?Vi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],79:[function(i,r,n){r.exports=function a(s,o){if(s&&o)return a(s)(o);if(typeof s!="function")throw new TypeError("need wrapper function");return Object.keys(s).forEach(function(h){l[h]=s[h]}),l;function l(){for(var h=new Array(arguments.length),c=0;c<h.length;c++)h[c]=arguments[c];var u=s.apply(this,h),d=h[h.length-1];return typeof u=="function"&&u!==d&&Object.keys(d).forEach(function(f){u[f]=d[f]}),u}}},{}],80:[function(i,r,n){r.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],81:[function(i,r,n){r.exports=function(){for(var s={},o=0;o<arguments.length;o++){var l=arguments[o];for(var h in l)a.call(l,h)&&(s[h]=l[h])}return s};var a=Object.prototype.hasOwnProperty},{}],82:[function(i,r,n){r.exports=function(a){a.prototype[Symbol.iterator]=function*(){for(let s=this.head;s;s=s.next)yield s.value}}},{}],83:[function(i,r,n){function a(c){var u=this;if(u instanceof a||(u=new a),u.tail=null,u.head=null,u.length=0,c&&typeof c.forEach=="function")c.forEach(function(m){u.push(m)});else if(arguments.length>0)for(var d=0,f=arguments.length;d<f;d++)u.push(arguments[d]);return u}function s(c,u,d){var f=u===c.head?new h(d,null,u,c):new h(d,u,u.next,c);return f.next===null&&(c.tail=f),f.prev===null&&(c.head=f),c.length++,f}function o(c,u){c.tail=new h(u,c.tail,null,c),c.head||(c.head=c.tail),c.length++}function l(c,u){c.head=new h(u,null,c.head,c),c.tail||(c.tail=c.head),c.length++}function h(c,u,d,f){if(!(this instanceof h))return new h(c,u,d,f);this.list=f,this.value=c,u?(u.next=this,this.prev=u):this.prev=null,d?(d.prev=this,this.next=d):this.next=null}r.exports=a,a.Node=h,a.create=a,a.prototype.removeNode=function(c){if(c.list!==this)throw new Error("removing node which does not belong to this list");var u=c.next,d=c.prev;return u&&(u.prev=d),d&&(d.next=u),c===this.head&&(this.head=u),c===this.tail&&(this.tail=d),c.list.length--,c.next=null,c.prev=null,c.list=null,u},a.prototype.unshiftNode=function(c){if(c!==this.head){c.list&&c.list.removeNode(c);var u=this.head;c.list=this,c.next=u,u&&(u.prev=c),this.head=c,this.tail||(this.tail=c),this.length++}},a.prototype.pushNode=function(c){if(c!==this.tail){c.list&&c.list.removeNode(c);var u=this.tail;c.list=this,c.prev=u,u&&(u.next=c),this.tail=c,this.head||(this.head=c),this.length++}},a.prototype.push=function(){for(var c=0,u=arguments.length;c<u;c++)o(this,arguments[c]);return this.length},a.prototype.unshift=function(){for(var c=0,u=arguments.length;c<u;c++)l(this,arguments[c]);return this.length},a.prototype.pop=function(){if(this.tail){var c=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,c}},a.prototype.shift=function(){if(this.head){var c=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,c}},a.prototype.forEach=function(c,u){u=u||this;for(var d=this.head,f=0;d!==null;f++)c.call(u,d.value,f,this),d=d.next},a.prototype.forEachReverse=function(c,u){u=u||this;for(var d=this.tail,f=this.length-1;d!==null;f--)c.call(u,d.value,f,this),d=d.prev},a.prototype.get=function(c){for(var u=0,d=this.head;d!==null&&u<c;u++)d=d.next;if(u===c&&d!==null)return d.value},a.prototype.getReverse=function(c){for(var u=0,d=this.tail;d!==null&&u<c;u++)d=d.prev;if(u===c&&d!==null)return d.value},a.prototype.map=function(c,u){u=u||this;for(var d=new a,f=this.head;f!==null;)d.push(c.call(u,f.value,this)),f=f.next;return d},a.prototype.mapReverse=function(c,u){u=u||this;for(var d=new a,f=this.tail;f!==null;)d.push(c.call(u,f.value,this)),f=f.prev;return d},a.prototype.reduce=function(c,u){var d,f=this.head;if(arguments.length>1)d=u;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");f=this.head.next,d=this.head.value}for(var m=0;f!==null;m++)d=c(d,f.value,m),f=f.next;return d},a.prototype.reduceReverse=function(c,u){var d,f=this.tail;if(arguments.length>1)d=u;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");f=this.tail.prev,d=this.tail.value}for(var m=this.length-1;f!==null;m--)d=c(d,f.value,m),f=f.prev;return d},a.prototype.toArray=function(){for(var c=new Array(this.length),u=0,d=this.head;d!==null;u++)c[u]=d.value,d=d.next;return c},a.prototype.toArrayReverse=function(){for(var c=new Array(this.length),u=0,d=this.tail;d!==null;u++)c[u]=d.value,d=d.prev;return c},a.prototype.slice=function(c,u){(u=u||this.length)<0&&(u+=this.length),(c=c||0)<0&&(c+=this.length);var d=new a;if(u<c||u<0)return d;c<0&&(c=0),u>this.length&&(u=this.length);for(var f=0,m=this.head;m!==null&&f<c;f++)m=m.next;for(;m!==null&&f<u;f++,m=m.next)d.push(m.value);return d},a.prototype.sliceReverse=function(c,u){(u=u||this.length)<0&&(u+=this.length),(c=c||0)<0&&(c+=this.length);var d=new a;if(u<c||u<0)return d;c<0&&(c=0),u>this.length&&(u=this.length);for(var f=this.length,m=this.tail;m!==null&&f>u;f--)m=m.prev;for(;m!==null&&f>c;f--,m=m.prev)d.push(m.value);return d},a.prototype.splice=function(c,u,...d){c>this.length&&(c=this.length-1),c<0&&(c=this.length+c);for(var f=0,m=this.head;m!==null&&f<c;f++)m=m.next;var p=[];for(f=0;m&&f<u;f++)p.push(m.value),m=this.removeNode(m);for(m===null&&(m=this.tail),m!==this.head&&m!==this.tail&&(m=m.prev),f=0;f<d.length;f++)m=s(this,m,d[f]);return p},a.prototype.reverse=function(){for(var c=this.head,u=this.tail,d=c;d!==null;d=d.prev){var f=d.prev;d.prev=d.next,d.next=f}return this.head=u,this.tail=c,this};try{i("./iterator.js")(a)}catch{}},{"./iterator.js":82}]},{},[12])(12)})})(Vc)),Vc.exports}var Uo=RE();const Af={success:{color:"#2ba471",icon:'<svg fill="none" viewBox="0 0 24 24"><path d="M12 23a11 11 0 100-22 11 11 0 000 22zM7.5 10.59l3 3 6-6L17.91 9l-7.41 7.41L6.09 12l1.41-1.41z"></path></svg>'},info:{color:"#0052d9",icon:'<svg fill="none" viewBox="0 0 24 24"><path d="M12 23a11 11 0 100-22 11 11 0 000 22zM11 8.5v-2h2v2h-2zm2 1.5v7.5h-2V10h2z"></path></svg>'},warning:{color:"#e37318",icon:'<svg fill="none" viewBox="0 0 24 24"><path d="M12 1a11 11 0 110 22 11 11 0 010-22zm-1 13h2V6.5h-2V14zm2 1.5h-2v2h2v-2z"></path></svg>'},error:{color:"#d54941",icon:'<svg fill="none" viewBox="0 0 24 24"><path d="M12 1a11 11 0 110 22 11 11 0 010-22zm-1 13h2V6.5h-2V14zm2 1.5h-2v2h2v-2z"></path></svg>'},question:{color:"#0052d9",icon:'<svg fill="none" viewBox="0 0 24 24"><path d="M12 23a11 11 0 100-22 11 11 0 000 22zm-.17-11.11c.43-.53.97-.97 1.4-1.32A2 2 0 0012 7a2 2 0 00-1.89 1.33l-.33.95L7.9 8.6l.34-.94a4 4 0 116.24 4.47 7 7 0 00-1.1 1.01c-.27.34-.37.61-.37.85v1.25h-2V14c0-.87.39-1.57.83-2.11zM11 18.25v-2h2v2h-2z"></path></svg>'}},ui={};class kE{constructor(t,i){B(this,"parentElement");B(this,"box");B(this,"icon");B(this,"text");B(this,"closeBtn");B(this,"duration");B(this,"content");B(this,"theme");B(this,"placement");B(this,"height");B(this,"id");this.parentElement=t,this.box=document.createElement("div"),this.icon=document.createElement("div"),this.text=document.createElement("div"),this.box.className="meta2d-message",this.icon.className="icon",this.text.className="text",this.icon.innerHTML=Af[i.theme||"info"].icon,this.text.innerHTML=i.content,this.box.appendChild(this.icon),this.box.appendChild(this.text),i.closeBtn&&(this.closeBtn=document.createElement("div"),this.closeBtn.className="close",this.closeBtn.innerHTML="x",this.closeBtn.onclick=()=>{this.close()},this.box.appendChild(this.closeBtn)),t.appendChild(this.box);let r;for(let n=0;n<document.styleSheets.length;n++)document.styleSheets[n].title==="le5le.com/message"&&(r=document.styleSheets[n]);if(!r){let n=document.createElement("style");n.type="text/css",n.title="le5le.com/message",document.head.appendChild(n),n=document.createElement("style"),n.type="text/css",document.head.appendChild(n),r=n.sheet,r.insertRule(`.meta2d-message{
           position:absolute;
           z-index:999;
           transform: translateX(-50%); 
           padding:12px 16px;
           max-width:400px;
           background:#fff;
           border-radius:6px;
           box-shadow:0 3px 14px 2px rgba(0, 0, 0, .05),0 8px 10px 1px rgba(0, 0, 0, 6%),0 5px 5px -3px rgba(0, 0, 0, 10%);
           display:flex;
           animation: fadein .5s;}`),r.insertRule(`
        @keyframes fadein {
          0% {
              transform: translate(-50%, -100%);
          }
          100% {
              transform: translate(-50%,0);
          }
      }`),r.insertRule(".meta2d-message .icon{width:20px;height:20px;}"),r.insertRule(".meta2d-message .text{color:rgba(0, 0, 0, 0.9);font-size:12px;margin-left:8px;line-height:20px;}"),r.insertRule(".meta2d-message .close{width:20px;height:20px;padding-left: 16px; cursor: pointer;}")}this.id=i.id||Mt(),this.duration=i.duration??3e3,this.placement=i.placement||"top",this.theme=i.theme||"info",this.height=i.height}init(){ui[this.id]=this,this.duration&&setTimeout(()=>{this.close()},this.duration);let t=-1;Object.keys(ui).forEach(i=>{var r;((r=ui[i])==null?void 0:r.placement)===this.placement&&t++}),this.setPosition(this.placement,t),this.icon.children[0].style.fill=Af[this.theme].color}setPosition(t,i=0){switch(t){case"top":this.box.style.top=`${30+i*(this.height||60)}px`,this.box.style.left="50%";break;case"bottom":this.box.style.bottom=`${30+i*(this.height||60)}px`,this.box.style.left="50%";break;case"left":this.box.style.top=`${30+i*(this.height||60)}px`,this.box.style.left="30px";break;case"right":this.box.style.top=`${30+i*(this.height||60)}px`,this.box.style.right="30px";break}}close(){Object.keys(ui).forEach(t=>{var i;if(((i=ui[t])==null?void 0:i.placement)===this.placement)switch(this.placement){case"top":case"left":case"right":ui[t].box.style.top=parseInt(ui[t].box.style.top)-60+"px";break;case"bottom":ui[t].box.style.bottom=parseInt(ui[t].box.style.bottom)-60+"px";break}}),ui[this.id]=null,delete ui[this.id],this.box.remove()}}function IE(e,t){if(e.jetLinksList.length){let i=t.url;i.startsWith("/")&&(i=(location.protocol==="https:"?"wss://":"ws://")+window.location.host+i),e.jetLinksClient=new WebSocket(`${i}/${localStorage.getItem("X-Access-Token")||dl("X-Access-Token")||new URLSearchParams(location.search).get("X-Access-Token")||""}`),e.jetLinksClient.onmessage=r=>{var a;const n=JSON.parse(r.data);if(n.payload)if((a=n.payload)!=null&&a.properties){const s=[];for(let o in n.payload.properties)s.push({id:`${n.payload.headers.productId}#${n.payload.deviceId}#${o}`,value:n.payload.properties[o]});e.setDatas(s,{history:!1})}else n.topic.startsWith("/notifications")&&cv(e,n)},e.jetLinksClient.onopen=()=>{e.jetLinksList.forEach(r=>{e.jetLinksClient.send(JSON.stringify({type:"sub",topic:`/device${r.topic}/message/property/report`,parameter:{deviceId:r.deviceId,properties:r.properties,history:1},id:r.topic+"-"+Mt()}))}),t.notification&&e.jetLinksClient.send(JSON.stringify({type:"sub",topic:"/notifications",id:"notification",parameter:{}}))}}}function cv(e,t){var s,o;let i=t.payload.topicName,r=t.payload.message,n=t.payload.notifyTime,a=`<div style="padding:0px 12px 0px 0px;width:300px;">
      <div style="display:flex;height: 20px;justify-content: space-between">
        <div style="color: #000000d9;
      font-size: 14px;
      font-weight: 700;">${i}</div><div style="color: #00000073;">${CE(n)}</div>
      </div>
      <span>${r}</span>
   </div>`;e.message({content:a,duration:0,closeBtn:!0,placement:"right",height:75}),(s=t.payload.detail)!=null&&s.alarmConfigId&&PE(e,(o=t.payload.detail)==null?void 0:o.alarmConfigId)}globalThis.doWarning=cv;function CE(e){const t=new Date(e),i=t.getFullYear(),r=(t.getMonth()+1+"").padStart(2,"0"),n=(t.getDate()+"").padStart(2,"0"),a=(t.getHours()+"").padStart(2,"0"),s=(t.getMinutes()+"").padStart(2,"0"),o=(t.getSeconds()+"").padStart(2,"0");return i+"-"+r+"-"+n+" "+a+":"+s+":"+o}function DE(e){e.jetLinksClient&&(e.jetLinksClient.close(),e.jetLinksClient=void 0)}function OE(e,t,i){const r=[];return i.list.forEach((n,a)=>{var o,l;const s=n.params?e.findOne(n.params):t;r[a]={deviceId:s.deviceId,productId:s.productId,properties:{}};for(let h in n.value)if(n.value[h]===void 0||n.value[h]===""){const c=(o=s.realTimes)==null?void 0:o.find(u=>u.propertyId===h);c&&(r[a].properties[h]=s[c.key])}else if(typeof n.value[h]=="string"&&((l=n.value[h])==null?void 0:l.indexOf("${"))>-1){let c=n.value[h].match(new RegExp("(?<=\\$\\{).*?(?=\\})","g"));c!=null&&c.length&&(r[a].properties[h]=s[c[0]]??e.getDynamicParam(c[0]))}else r[a].properties[h]=n.value[h]}),r}async function ME(e,t){t.forEach(async i=>{let r=i.deviceId;if(r&&r.indexOf("${")>-1){let a=r.match(new RegExp("(?<=\\$\\{).*?(?=\\})","g"));a!=null&&a.length&&(r=e.getDynamicParam(a[0])||r)}(await fetch(`/api/device-instance/${r}/property`,{headers:{"X-Access-Token":localStorage.getItem("X-Access-Token")||new URLSearchParams(location.search).get("X-Access-Token")||"","Content-Type":"application/json"},method:"put",body:JSON.stringify(i.properties)})).ok?(console.info("发送成功"),e.message({theme:"success",content:"下发成功"})):e.message({theme:"error",content:"下发失败"})})}async function PE(e,t){const i=await fetch(`/api/alarm/config/${t}`,{headers:{"X-Access-Token":localStorage.getItem("X-Access-Token")||new URLSearchParams(location.search).get("X-Access-Token")||"","Content-Type":"application/json"},method:"GET"});if(i.ok){let r=await i.json();r.result.media&&hv(e,r.result.media,r.result.playTimes)}}function hv(e,t,i){if(e.store.globalAudio||(e.store.globalAudio=document.createElement("audio")),e.store.globalAudio.src=t,e.store.globalAudio.play(),i===-1)e.store.globalAudio.loop=!0;else{e.store.globalAudio.loop=!1;let r=0;e.store.globalAudio.onended=()=>{r++,r<i&&e.store.globalAudio.play()}}}globalThis.createAudio=hv;const NE=/^echarts/;class LE{constructor(t,i={}){B(this,"store");B(this,"canvas");B(this,"websocket");B(this,"mqttClient");B(this,"websockets");B(this,"mqttClients");B(this,"eventSources");B(this,"penPluginMap",new Map);B(this,"socketFn");B(this,"events",{});B(this,"map");B(this,"mapTimer");B(this,"facePen",Ma);B(this,"getWords",xp);B(this,"calcTextLines",to);B(this,"calcTextRect",Ji);B(this,"calcTextDrawRect",cu);B(this,"jetLinksList",[]);B(this,"jetLinksClient");B(this,"register",Tr);B(this,"registerCanvasDraw",En);B(this,"registerAnchors",vh);B(this,"registerLineAnimateDraws",(t,i)=>{this.store.data.lineAnimateDraws[t]=i,St.lineAnimateDraws[t]=new Function("ctx","pen","state","index",i)});B(this,"websocketTimes",0);B(this,"mqttTimes",0);B(this,"httpTimer");B(this,"httpTimerList",[]);B(this,"updateTimer");B(this,"updateTimerList",[]);B(this,"sqlTimerList",[]);B(this,"iotMqttClient");B(this,"iotTimer");B(this,"iotWebsocketClient");B(this,"onEvent",(t,i)=>{switch(t){case"add":i.forEach(r=>{var n;(n=r.onAdd)==null||n.call(r,r)}),this.onSizeUpdate();break;case"enter":i&&i.onMouseEnter&&i.onMouseEnter(i,this.canvas.mousePos),this.store.data.locked&&this.doEvent(i,t);break;case"leave":i&&i.onMouseLeave&&i.onMouseLeave(i,this.canvas.mousePos),this.store.data.locked&&this.doEvent(i,t);break;case"active":case"inactive":this.store.data.locked&&i.forEach(r=>{this.doEvent(r,t)});break;case"click":if(this.store.data.locked&&i.pen&&!i.pen.disabled&&i.pen.switch&&(i.pen.checked=!i.pen.checked,i.pen.calculative.checked=i.pen.checked,i.pen.calculative.gradient=void 0,i.pen.calculative.radialGradient=void 0),i.pen&&i.pen.formId){const r=this.store.pens[i.pen.formId];i.pen.formType==="submit"?this.store.data.locked&&r&&!r.disabled&&this.doEvent(r,"submit"):i.pen.formType==="reset"&&(fE(i.pen),this.store.data.locked&&r&&!r.disabled&&this.doEvent(r,"reset"))}i.pen&&i.pen.onClick&&!i.pen.disabled&&i.pen.onClick(i.pen,this.canvas.mousePos),this.store.data.locked&&i.pen&&!i.pen.disabled&&this.doEvent(i.pen,t);break;case"contextmenu":i.pen&&i.pen.onContextmenu&&!i.pen.disabled&&i.pen.onContextmenu(i.pen,this.canvas.mousePos),this.store.data.locked&&i.pen&&!i.pen.disabled&&this.doEvent(i.pen,t);break;case"mousedown":i.pen&&i.pen.onMouseDown&&!i.pen.disabled&&i.pen.onMouseDown(i.pen,this.canvas.mousePos),this.store.data.locked&&i.pen&&!i.pen.disabled&&this.doEvent(i.pen,t);break;case"mouseup":i.pen&&i.pen.onMouseUp&&!i.pen.disabled&&i.pen.onMouseUp(i.pen,this.canvas.mousePos),this.store.data.locked&&i.pen&&!i.pen.disabled&&this.doEvent(i.pen,t);break;case"dblclick":this.store.data.locked&&i.pen&&!i.pen.disabled&&this.doEvent(i.pen,t);break;case"valueUpdate":i&&Ef(i,i.formValue),this.store.data.locked&&this.doEvent(i,t),this.canvas.tooltip.updateText(i);break;case"update":case"delete":case"translatePens":case"rotatePens":case"resizePens":this.onSizeUpdate();break;case"navigator":this.store.data.id||console.warn("请先保存当前图纸"),this.navigatorTo(i.params);break;case"input":this.store.data.locked&&i&&!i.disabled&&this.doEvent(i,t);break;case"change":i.pen&&Ef(i.pen),i.pen?this.store.data.locked&&!i.pen.disabled&&this.doEvent(i.pen,t):this.store.data.locked&&i&&!i.disabled&&this.doEvent(i,t);break}this.doMessageEvent(t,i)});B(this,"doEvent",(t,i)=>{var a,s,o,l,h,c,u,d,f,m;if(!t)return;let r=!1,n=[];if((a=t.events)==null||a.forEach((p,g)=>{var y;if(p.actions&&p.actions.length){if(p.name===i){let T=!1;p.conditions&&p.conditions.length?p.conditionType==="and"?T=p.conditions.every(b=>this.judgeCondition(t,b.key,b)):p.conditionType==="or"&&(T=p.conditions.some(b=>this.judgeCondition(t,b.key,b))):T=!0,T&&n.push(g)}}else if(r=!0,this.events[p.action]&&p.name===i){let T=!((y=p.where)!=null&&y.type);if(p.where){const{fn:b,fnJs:S,comparison:I,key:D,value:O}=p.where;if(b)T=b(t,{meta2d:this});else if(S){try{p.where.fn=new Function("pen","context",S)}catch(P){console.error("Error: make function:",P)}p.where.fn&&(T=p.where.fn(t,{meta2d:this}))}else{let P=t[D];switch(["x","y","width","height"].includes(D)&&(P=this.getPenRect(t)[D]),I){case">":T=P>+O;break;case">=":T=P>=+O;break;case"<":T=P<+O;break;case"<=":T=P<=+O;break;case"=":case"==":T=P==O;break;case"!=":T=P!=O;break;case"[)":T=ea(+P,O);break;case"![)":T=!ea(+P,O);break;case"[]":T=ia(P,O);break;case"![]":T=!ia(P,O);break}}}T&&n.push(g)}}),r?(s=t.events)==null||s.forEach((p,g)=>{n.includes(g)&&this.events[p.action](t,p)}):(o=t.events)==null||o.forEach(async(p,g)=>{if(n.includes(g)){if(p.confirm&&!await this.canvas.popconfirm.showModal(t,this.canvas.mousePos,p.confirmTitle))return;p.actions.forEach(y=>{if(y.timeout){let T=setTimeout(()=>{this.events[y.action]&&(this.events[y.action](t,y),clearTimeout(T),T=null)},y.timeout)}else this.events[y.action]&&this.events[y.action](t,y)})}}),i==="valueUpdate"){(l=t.realTimes)==null||l.forEach(g=>{var T,b;let y=[];(T=g.triggers)==null||T.forEach((S,I)=>{var O;let D=!1;(O=S.conditions)!=null&&O.length?S.conditionType==="and"?D=S.conditions.every(P=>this.judgeCondition(t,g.key,P)):S.conditionType==="or"&&(D=S.conditions.some(P=>this.judgeCondition(t,g.key,P))):D=!0,D&&y.push(I)}),(b=g.triggers)==null||b.forEach((S,I)=>{var D;y.includes(I)&&((D=S.actions)==null||D.forEach(O=>{if(O.timeout){let P=setTimeout(()=>{this.events[O.action]&&(this.events[O.action](t,O),clearTimeout(P),P=null)},O.timeout)}else this.events[O.action](t,O)}))})});let p=[];if((h=this.store.globalTriggers[t.id])==null||h.forEach((g,y)=>{var b;let T=!1;(b=g.conditions)!=null&&b.length?g.conditionType==="and"?T=g.conditions.every(S=>this.judgeCondition(this.store.pens[S.source],S.key,S)):g.conditionType==="or"&&(T=g.conditions.some(S=>this.judgeCondition(this.store.pens[S.source],S.key,S))):T=!0,T&&p.push(y)}),(c=this.store.globalTriggers[t.id])==null||c.forEach((g,y)=>{var T;p.includes(y)&&((T=g.actions)==null||T.forEach(b=>{if(b.timeout){let S=setTimeout(()=>{this.events[b.action]&&(this.events[b.action](t,b),clearTimeout(S),S=null)},b.timeout)}else this.events[b.action](t,b)}))}),(u=t.triggers)!=null&&u.length){for(let g of t.triggers)if((d=g.status)!=null&&d.length)for(let y of g.status){let T=!1;if((f=y.conditions)!=null&&f.length?y.conditionType==="and"?T=y.conditions.every(b=>this.judgeCondition(t,b.key,b)):y.conditionType==="or"&&(T=y.conditions.some(b=>this.judgeCondition(t,b.key,b))):T=!0,T){(m=y.actions)==null||m.forEach(b=>{if(b.timeout){let S=setTimeout(()=>{this.events[b.action]&&(this.events[b.action](t,b),clearTimeout(S),S=null)},b.timeout)}else this.events[b.action](t,b)});break}}}}this.doEvent(this.store.pens[t.parentId],i)});B(this,"doDataEvent",t=>{var n,a,s;if(!((n=this.store.data.dataEvents)!=null&&n.length))return;const i=t.reduce((o,{dataId:l,id:h,value:c})=>(o[h||l]=c,o),{});let r=[];(a=this.store.data.dataEvents)==null||a.forEach((o,l)=>{let h=!1;o.conditions&&o.conditions.length?o.conditionType==="and"?h=o.conditions.every(c=>this.dataJudegeCondition(i,c.key,c)):o.conditionType==="or"&&(h=o.conditions.some(c=>this.dataJudegeCondition(i,c.key,c))):h=!0,h&&r.push(l)}),(s=this.store.data.dataEvents)==null||s.forEach((o,l)=>{var h;r.includes(l)&&((h=o.actions)==null||h.forEach(c=>{this.events[c.action](i,c)}))})});B(this,"renderPenRaw",pl);B(this,"setElemPosition",Se);B(this,"setLifeCycleFunc",Ww);this.store=Wb(Mt()),this.setOptions(i),this.setDatabyOptions(i),this.init(t),this.register(SE()),this.registerCanvasDraw({cube:wT}),this.registerAnchors(AE()),globalThis.meta2d=this,this.initEventFns(),this.store.emitter.on("*",this.onEvent)}get beforeAddPen(){return this.canvas.beforeAddPen}set beforeAddPen(t){this.canvas.beforeAddPen=t}get beforeAddPens(){return this.canvas.beforeAddPens}set beforeAddPens(t){this.canvas.beforeAddPens=t}get beforeAddAnchor(){return this.canvas.beforeAddAnchor}set beforeAddAnchor(t){this.canvas.beforeAddAnchor=t}get beforeRemovePens(){return this.canvas.beforeRemovePens}set beforeRemovePens(t){this.canvas.beforeRemovePens=t}get beforeRemoveAnchor(){return this.canvas.beforeRemoveAnchor}set beforeRemoveAnchor(t){this.canvas.beforeRemoveAnchor=t}setOptions(t={}){var i,r;(t.grid!==void 0||t.gridColor!==void 0||t.gridSize!==void 0)&&this.canvas&&(this.canvas.canvasTemplate.bgPatchFlags=!0),(t.rule!==void 0||t.ruleColor!==void 0||t.ruleOptions!==void 0)&&(this.store.patchFlagsTop=!0,t.ruleOptions&&(i=this.store.options)!=null&&i.ruleOptions&&(Object.assign(this.store.options.ruleOptions,t.ruleOptions),t.ruleOptions=this.store.options.ruleOptions)),t.background!==void 0&&this.canvas&&(this.canvas.canvasTemplate.bgPatchFlags=!0),t.resizeMode!==void 0&&(t.resizeMode||(this.canvas.hotkeyType=Xt.None)),(t.width!==void 0||t.height!==void 0)&&(this.canvas&&(this.canvas.canvasTemplate.bgPatchFlags=!0),this.canvas&&this.canvas.canvasTemplate.canvas.style.backgroundImage&&(this.canvas.canvasTemplate.canvas.style.backgroundImage="")),this.store.options=Object.assign(this.store.options,t),this.canvas&&t.scroll!==void 0&&(t.scroll?(!this.canvas.scroll&&(this.canvas.scroll=new av(this.canvas)),this.canvas.scroll.show()):this.canvas.scroll&&this.canvas.scroll.hide()),(r=this.canvas)==null||r.initGlobalStyle()}getOptions(){return this.store.options}registerTheme(t,i){if(!Array.isArray(i))return;const r=/^\s*\S+\s*:\s*\S+\s*$/;if(!i.every(o=>r.test(o)))return;const a={},s=[];for(let o=0;o<i.length;o++){const h=i[o].split(":"),c=h[0].trim(),u=h[1].trim();s.push([c,u].join(":")),a[c]=u}us.addTheme(t,s),this.store.theme[t]=a}setTheme(t){if(this.store.data.theme=t,this.setBackgroundColor(this.store.theme[t].background),this.canvas.parentElement.style.background=this.store.theme[t].parentBackground,this.setOptions({ruleColor:this.store.theme[t].ruleColor,ruleOptions:this.store.theme[t].ruleOptions}),!(this.store.options.themeOnlyCanvas||this.store.data.themeOnlyCanvas)){this.store.data.color=this.store.theme[t].color,us.updateCssRule(this.store.id,t),this.canvas.initGlobalStyle();for(let i=0;i<this.store.data.pens.length;i++){const r=this.store.data.pens[i];r.setTheme&&r.setTheme(r,this.store.styles)}}this.render()}setDatabyOptions(t={}){const{color:i,activeColor:r,activeBackground:n,grid:a,gridColor:s,gridSize:o,fromArrow:l,toArrow:h,rule:c,ruleColor:u,textColor:d,x:f=0,y:m=0}=t;this.setRule({rule:c,ruleColor:u}),this.setGrid({grid:a,gridColor:s,gridSize:o}),this.store.data=Object.assign(this.store.data,{textColor:d,color:i,activeColor:r,activeBackground:n,fromArrow:l,toArrow:h,x:f,y:m})}init(t){typeof t=="string"?this.canvas=new wf(this,document.getElementById(t),this.store):this.canvas=new wf(this,t,this.store),this.canvas.initGlobalStyle(),this.resize(),this.canvas.listen(),us.createThemeSheet(this.store.data.theme,this.store.id)}initEventFns(){this.events[ve.Link]=(t,i)=>{var r;if(window&&i.value&&typeof i.value=="string"){let n=i.value;if(n.includes("${")){let a=(r=n.match(/\$\{([^}]+)\}/g))==null?void 0:r.map(s=>s.slice(2,-1));a&&(a==null||a.forEach(s=>{n=n.replace(`\${${s}}`,t[s]||this.getDynamicParam(s))}))}window.open(n,i.params??"_blank");return}console.warn("[meta2d] Link param is not a string")},this.events[ve.SetProps]=(t,i)=>{var n,a,s;const r=i.value;if(r&&typeof r=="object"){const o=i.params?this.find(i.params):this.find(t.id),l={};for(let h in r)if((n=r[h])!=null&&n.id)l[h]=(a=this.store.pens[r[h].id])==null?void 0:a[r[h].key];else if(typeof r[h]=="string"&&r[h].includes("${")){let c=r[h],u=(s=c.match(/\$\{([^}]+)\}/g))==null?void 0:s.map(d=>d.slice(2,-1));u&&u.forEach(d=>{c=c.replace(`\${${d}}`,t[d]||this.getDynamicParam(d))}),l[h]=c}else if(typeof r[h]=="string"&&(r[h].startsWith("{")&&r[h].endsWith("}")||r[h].startsWith("[")&&r[h].endsWith("]")))try{l[h]=JSON.parse(r[h])}catch{l[h]=r[h]}else l[h]=r[h];o.forEach(h=>{l.hasOwnProperty("visible")&&h.visible!==l.visible&&this.setVisible(h,l.visible),this.setValue({id:h.id,...l},{render:!1,doEvent:!1})}),this.render();return}console.warn("[meta2d] SetProps value is not an object")},this.events[ve.StartAnimate]=(t,i)=>{let r=t;if(i.value&&(r=this.findOne(i.value)),!(this.store.animates.has(r)&&!r.calculative.pause&&r.animateName===i.params)){if(i.targetType&&i.params){this.startAnimate(i.value||[t],i.params);return}if(!i.value||typeof i.value=="string"){this.startAnimate(i.value||[t]);return}console.warn("[meta2d] StartAnimate value is not a string")}},this.events[ve.PauseAnimate]=(t,i)=>{if(!i.value||typeof i.value=="string"){this.pauseAnimate(i.value||[t]);return}console.warn("[meta2d] PauseAnimate value is not a string")},this.events[ve.StopAnimate]=(t,i)=>{if(!i.value||typeof i.value=="string"){if(i.value){let r=this.findOne(i.value);if(!this.store.animates.has(r))return}else if(!this.store.animates.has(t))return;this.stopAnimate(i.value||[t]);return}console.warn("[meta2d] StopAnimate event value is not a string")},this.events[ve.StartVideo]=(t,i)=>{if(!i.value||typeof i.value=="string"){this.startVideo(i.value||[t]);return}console.warn("[meta2d] StartVideo value is not a string")},this.events[ve.PauseVideo]=(t,i)=>{if(!i.value||typeof i.value=="string"){this.pauseVideo(i.value||[t]);return}console.warn("[meta2d] PauseVideo value is not a string")},this.events[ve.StopVideo]=(t,i)=>{if(!i.value||typeof i.value=="string"){this.stopVideo(i.value||[t]);return}console.warn("[meta2d] StopVideo event value is not a string")},this.events[ve.JS]=(t,i,r)=>{var n;if(i.value&&!i.fn)try{if(typeof i.value!="string")throw new Error("[meta2d] Function value must be string");const a=i.value;i.fn=new Function("pen","params","context",a)}catch(a){console.error("[meta2d]: Error on make a function:",a)}(n=i.fn)==null||n.call(i,t,r||i.params,{meta2d:this,eventName:i.name})},this.events[ve.GlobalFn]=(t,i)=>{if(typeof i.value!="string"){console.warn("[meta2d] GlobalFn value must be a string");return}globalThis[i.value]&&globalThis[i.value](t,i.params)},this.events[ve.Emit]=(t,i)=>{if(typeof i.value!="string"){console.warn("[meta2d] Emit value must be a string");return}this.store.emitter.emit(i.value,{pen:t,params:i.params,eventName:i.name})},this.events[ve.SendPropData]=(t,i)=>{const r=lt(i.value);if(r&&typeof r=="object"){const n=i.params?this.findOne(i.params):t;for(let a in r)(r[a]===void 0||r[a]==="")&&(r[a]=n[a]);r.id=n.id,this.doSendDataEvent(r,i.extend);return}console.warn("[meta2d] SendPropData value is not an object")},this.events[ve.SendVarData]=(t,i)=>{const r=lt(i.value);if(r&&typeof r=="object"){const n=i.params?this.findOne(i.params):t;let a=[];for(let s in r){let o={dataId:s,value:r[s]};if(!o.value){let l=n.form.find(h=>h.dataIds&&h.dataIds.dataId===o.dataId);l&&(o.value=n[l.key])}a.push(o)}this.doSendDataEvent(a,i.extend);return}console.warn("[meta2d] SendVarData value is not an object")},this.events[ve.Navigator]=(t,i)=>{i.value&&typeof i.value=="string"&&this.navigatorTo(i.value)},this.events[ve.Dialog]=(t,i)=>{var r;if(i.params&&typeof i.params=="string"){let n=i.params;if(i.params.includes("${")){let s=(r=i.params.match(/\$\{([^}]+)\}/g))==null?void 0:r.map(o=>o.slice(2,-1));s&&(s==null||s.forEach(o=>{n=n.replace(`\${${o}}`,t[o]||this.getDynamicParam(o))}))}Object.keys(i.extend).forEach(s=>{["x","y","width","height"].includes(s)||(n.indexOf("?")!==-1?n+=`&${s}=${i.extend[s]}`:n+=`?${s}=${i.extend[s]}`)});let a=this.getEventData(i.list,t);Object.keys(a).length&&(a=null),this.canvas.dialog.show(i.value,n,i.extend,a)}},this.events[ve.SendData]=(t,i)=>{var n,a,s,o;if((n=i.data)!=null&&n.length){const l=this.getSendData(i.data,t);t.formId&&t.formData&&Object.assign(l,t.formData),this.sendDataToNetWork(l,t,i);return}if((a=i.list)!=null&&a.length){if(i.network&&i.network.protocol==="ADIIOT"){const h=OE(this,t,i);h.length&&ME(this,h);return}const l=this.getEventData(i.list,t);t.deviceId&&(l.deviceId=t.deviceId),t.formId&&t.formData&&Object.assign(l,t.formData),this.sendDataToNetWork(l,t,i);return}const r=lt(i.value);if(r&&typeof r=="object"&&i.targetType==="id"){const l=i.params?this.findOne(i.params):t;for(let h in r)if(r[h]===void 0||r[h]==="")r[h]=l[h];else if(typeof r[h]=="string"&&((s=r[h])==null?void 0:s.indexOf("${"))>-1){let c=(o=r[h].match(/\$\{([^}]+)\}/g))==null?void 0:o.map(u=>u.slice(2,-1));c!=null&&c.length&&(r[h]=l[c[0]]??this.getDynamicParam(c[0]))}l.deviceId&&(r.deviceId=l.deviceId),this.sendDataToNetWork(r,t,i);return}},this.events[ve.PostMessage]=(t,i)=>{if(typeof i.value!="string"){console.warn("[meta2d] Emit value must be a string");return}const r=i.params?this.findOne(i.params):t;if(r.name!=="iframe"||!r.iframe){console.warn("不是嵌入页面");return}let n=fa(r.iframe.split("?")[1]);const a=this.getEventData(i.list,r);r.calculative.singleton.div.children[0].contentWindow.postMessage(JSON.stringify({name:i.value,id:n.id,data:a}),"*")},this.events[ve.PostMessageToParent]=(t,i)=>{if(typeof i.value!="string"){console.warn("[meta2d] Emit value must be a string");return}const r=this.getEventData(i.list,t);window.parent.postMessage(JSON.stringify({name:i.value,data:r}),"*")},this.events[ve.Message]=(t,i,r)=>{let n=i.params,a=i.value;!a&&r&&r.type==="http"&&(a=r.error.statusText,n||(n="error")),this.message({theme:n,content:a,...i.extend})}}getSendData(t,i){const r={};return t.forEach(n=>{var a;if(n.prop)if(n.id&&n.id!=="固定值"){const s=this.findOne(n.id);r[n.prop]=Zi(s,n.key)}else if(typeof n.value=="string"&&n.value.includes("${")){let s=n.value,o=(a=s.match(/\$\{([^}]+)\}/g))==null?void 0:a.map(l=>l.slice(2,-1));o&&o.forEach(l=>{s=s.replace(`\${${l}}`,Zi(i,l)||this.getDynamicParam(l))}),r[n.prop]=s}else r[n.prop]=this.convertType(n.value,n.type)}),r}convertType(t,i){var r;if(typeof t=="string"){if(["switch","bool","boolean"].includes(i)){if(t==="false")return!1;if(t==="true")return!0}else if(["integer","number","int","enum","double","float"].includes(i)&&!isNaN(Number(t)))return Number(t)}else if(typeof t=="object"){let n=JSON.stringify(t),a=(r=n.match(/\$\{([^}]+)\}/g))==null?void 0:r.map(s=>s.slice(2,-1));if(a!=null&&a.length)for(let s=0;s<a.length;s++)n=n.replace(`\${${a[s]}}`,this.getDynamicParam(a[s]));return JSON.parse(n)}return t}getEventData(t,i){const r={};return t!=null&&t.length&&t.forEach(n=>{var s,o;const a=n.params?this.findOne(n.params):i;for(let l in n.value)if(n.value[l]===void 0||n.value[l]==="")r[l]=a[l];else if(typeof n.value[l]=="string"&&((s=n.value[l])==null?void 0:s.indexOf("${"))>-1){let h=(o=n.value[l].match(/\$\{([^}]+)\}/g))==null?void 0:o.map(c=>c.slice(2,-1));h!=null&&h.length&&(r[l]=a[h[0]]??this.getDynamicParam(h[0]))}else r[l]=n.value[l]}),Object.keys(r).length?r:{}}message(t){new kE(this.canvas.parentElement,t).init()}closeAll(){for(let t in ui)ui[t].close()}async navigatorTo(t){var n;if(!t)return;if((n=fa())==null?void 0:n.id){const a=new URL(window.location);a.searchParams.set("id",t),history.pushState({},"",a)}const r=await Cp(this.store,t);if(r){this.open(r),this.canvas.opening=!1,this.lock(1);const a=this.store.data.width||this.store.options.width,s=this.store.data.height||this.store.options.height;a&&s?this.fitSizeView(!0,0):this.fitView(!0,10)}}doSendDataEvent(t,i){let r=JSON.stringify(t);this.mqttClient&&this.mqttClient.connected&&(i?i.split(",").forEach(n=>{this.mqttClient.publish(n,r)}):this.store.data.mqttTopics&&this.store.data.mqttTopics.split(",").forEach(n=>{this.mqttClient.publish(n,r)})),this.websocket&&this.websocket.readyState===1&&this.websocket.send(r),(this.store.data.https||this.store.data.http)&&this.sendDatabyHttp(r),this.store.emitter.emit("sendData",r)}async sendDataToNetWork(t,i,r){var a,s,o,l,h,c;const n=lt(r.network);if(n.data&&(Object.assign(n,n.data),delete n.data),n.protocol==="iot"){this.iotMqttClient&&this.iotMqttClient.publish(`le5le-iot/property/set/${(a=this.store.data.iot)==null?void 0:a.token}`,JSON.stringify(t));return}if(n.url){if(n.protocol==="http"){if(typeof n.headers=="object"){let m=JSON.stringify(n.headers),p=(s=m.match(/\$\{([^}]+)\}/g))==null?void 0:s.map(g=>g.slice(2,-1));if(p!=null&&p.length)for(let g=0;g<p.length;g++)m=m.replace(`\${${p[g]}}`,this.getDynamicParam(p[g]));n.headers=JSON.parse(m)}let u,d=n.url;if(n.method==="GET"&&Object.keys(t).length!==0&&(d.includes("?")?u="&"+Object.keys(t).map(m=>m+"="+t[m]).join("&"):u="?"+Object.keys(t).map(m=>m+"="+t[m]).join("&")),d.indexOf("${")>-1){let m=(o=d.match(/\$\{([^}]+)\}/g))==null?void 0:o.map(p=>p.slice(2,-1));m&&m.forEach(p=>{d=d.replace(`\${${p}}`,Zi(i,p)||this.getDynamicParam(p))})}const f=await fetch(d+(u||""),{headers:n.headers||{},method:n.method,body:n.method==="POST"?JSON.stringify(t):void 0});if(f.ok){if(r.callback){const m=await f.text();if(!r.fn)try{if(typeof r.callback!="string")throw new Error("[meta2d] Function callback must be string");const p=r.callback;r.fn=new Function("pen","data","context",p)}catch(p){console.error("[meta2d]: Error on make a function:",p)}(l=r.fn)==null||l.call(r,i,m,{meta2d:this,e:r})}console.info("http消息发送成功")}else this.store.emitter.emit("error",{type:"http",error:f})}else if(n.protocol==="mqtt"){const u=(h=this.mqttClients)==null?void 0:h.filter(d=>d.options.href===n.url);if(u&&u.length)u[0].connected&&n.topics.split(",").forEach(d=>{u[0].publish(d,JSON.stringify(t))});else{let d=Uo.connect(n.url,n.options);d.on("connect",()=>{console.info("mqtt连接成功"),n.topics.split(",").forEach(f=>{d.publish(f,JSON.stringify(t)),setTimeout(()=>{d==null||d.end()},1e3)})})}}else if(n.protocol==="websocket"){const u=(c=this.websockets)==null?void 0:c.filter(d=>d.url===n.url);if(u&&u.length)u[0].readyState===1&&u[0].send(JSON.stringify(t));else{let d=new WebSocket(n.url,n.protocols||void 0);d.onopen=function(){console.info("websocket连接成功"),d.send(JSON.stringify(t)),setTimeout(()=>{d.close()},100)}}}}}resize(t,i){this.canvas.resize(t,i),this.render(),this.store.emitter.emit("resize",{width:t,height:i}),this.canvas.scroll&&this.canvas.scroll.isShow&&this.canvas.scroll.init()}async addPen(t,i,r=!0,n=!1){return await this.canvas.addPen(t,i,r,n)}addPenSync(t,i,r=!0,n=!1){return this.canvas.addPenSync(t,i,r,n)}async addPens(t,i,r=!1){return await this.canvas.addPens(t,i,r)}render(t){var i;(i=this.canvas)==null||i.render(t)}async setBackgroundImage(t,i){var o,l,h,c;let r=this;async function n(u){return new Promise(d=>{const f=new Image;f.src=u,r.store.options.cdn&&!(u.startsWith("http")||u.startsWith("//")||u.startsWith("data:image"))&&(f.src=r.store.options.cdn+u),f.crossOrigin="anonymous",f.onload=()=>{d(f)}})}this.store.data.bkImage=t;const a=(i==null?void 0:i.width)||((o=this.store.data)==null?void 0:o.width)||((l=this.store.options)==null?void 0:l.width),s=(i==null?void 0:i.height)||((h=this.store.data)==null?void 0:h.height)||((c=this.store.options)==null?void 0:c.height);if(a&&s?(this.canvas.canvasTemplate.canvas.style.backgroundImage=null,this.canvas&&(this.canvas.canvasTemplate.bgPatchFlags=!0)):this.canvas.canvasTemplate.canvas.style.backgroundImage=t?`url('${t}')`:"",t){const u=await n(t);this.store.bkImg=u,a&&s&&this.canvas&&(this.canvas.canvasTemplate.init(),this.render())}else this.store.bkImg=null}setBackgroundColor(t=this.store.data.background){this.store.data.background=t,this.canvas&&(this.canvas.canvasTemplate.bgPatchFlags=!0)}setGrid({grid:t=this.store.data.grid,gridColor:i=this.store.data.gridColor,gridSize:r=this.store.data.gridSize,gridRotate:n=this.store.data.gridRotate}={}){this.store.data.grid=t,this.store.data.gridColor=i,this.store.data.gridSize=r<0?0:r,this.store.data.gridRotate=n,this.canvas&&(this.canvas.canvasTemplate.bgPatchFlags=!0)}setRule({rule:t=this.store.data.rule,ruleColor:i=this.store.data.ruleColor}={}){this.store.data.rule=t,this.store.data.ruleColor=i,this.store.patchFlagsTop=!0}open(t,i=!0){if(this.clear(!1,t==null?void 0:t.template),this.canvas.autoPolylineFlag=!0,t){t.theme&&this.setTheme(t.theme),VT(t.pens),this.setBackgroundImage(t.bkImage,t),Object.assign(this.store.data,t),this.store.data.pens=[];for(const r of t.pens)r.id||(r.id=Mt()),!r.calculative&&(r.calculative={canvas:this.canvas}),this.store.pens[r.id]=r;for(const r of t.pens)this.canvas.makePen(r)}if(this.canvas.patchFlagsLines.forEach(r=>{r.type&&this.canvas.initLineRect(r)}),this.store.data.template||(this.store.data.template=Mt()),i||(this.canvas.opening=!0),this.doInitJS(),this.initBindDatas(),this.initBinds(),this.doInitFn(),this.loadLineAnimateDraws(),this.initMessageEvents(),this.initGlobalTriggers(),this.startAnimate(),this.startVideo(),this.listenSocket(),this.connectSocket(),this.connectNetwork(),this.startDataMock(),this.canvas.initGlobalStyle(),this.render(),setTimeout(()=>{const r=this.store.data.pens.find(n=>n.autofocus);r&&this.focus(r.id)},100),this.store.data.iconUrls)for(const r of this.store.data.iconUrls)$b(r,()=>{this.render()});this.canvas.autoPolylineFlag=!1,this.store.emitter.emit("opened"),this.canvas.scroll&&this.canvas.scroll.isShow&&this.canvas.scroll.init()}dirtyData(t){const i=this.store.data.pens,r=this.store.data.width||this.store.options.width,n=this.store.data.height||this.store.options.height,a=[];for(let s=i.length-1;s>=0;s--){let o=i[s];if(o.parentId){const l=this.store.pens[o.parentId];(o.x>10||o.y>10||o.width>10||o.height>10||!l.children||!l.children.includes(o.id))&&a.push(o)}if(r&&n){let l=this.getPenRect(o);(l.x<-10||l.y<-10||l.x+l.width>r||l.y+l.height>n)&&a.push(o)}o.name==="line"&&o.anchors.length<2&&a.push(o)}return(!r||!n)&&Bw(i).forEach(o=>{a.filter(h=>h.id===o.id).length||a.push(o)}),t&&this.active(a),a}clearDirtyData(){let t=this.dirtyData();this.delete(t,!0)}cacheData(t){if(t&&this.store.options.cacheLength){let i=this.store.cacheDatas.findIndex(r=>r.data&&r.data._id===t);if(i===-1)this.store.cacheDatas.push({data:lt(this.store.data,!0)}),this.store.cacheDatas.length>this.store.options.cacheLength&&this.store.cacheDatas.shift();else{let r=this.store.cacheDatas.splice(i,1)[0];this.store.cacheDatas.push(r)}}}loadCacheData(t){let i=this.store.cacheDatas.findIndex(r=>r.data&&r.data._id===t);i!==-1&&(this.store.data=this.store.cacheDatas[i].data,this.setBackgroundImage(this.store.data.bkImage),this.store.pens={},this.store.data.pens.forEach(r=>{r.calculative.canvas=this.canvas,this.store.pens[r.id]=r,St.path2dDraws[r.name]&&this.store.path2dMap.set(r,St.path2dDraws[r.name](r)),r.type&&this.store.path2dMap.set(r,St.path2dDraws[r.name](r)),r.image&&(r.calculative.imageDrawed=!1,this.canvas.loadImage(r))}),this.render())}loadLineAnimateDraws(){St.lineAnimateDraws={},Object.entries(this.store.data.lineAnimateDraws).forEach(([t,i])=>{St.lineAnimateDraws[t]=new Function("ctx","pen","state","index",i)})}statistics(){const t=this.store.data.pens.length,i=this.store.data.pens.filter(o=>o.image).length,r=this.store.data.pens.filter(o=>o.image&&o.calculative.inView).length,n=this.store.data.pens.filter(o=>o.name.endsWith("Dom")||_p.includes(o.name)||this.store.options.domShapes.includes(o.name)||o.externElement).length,a=this.store.animates.size;let s=0;return Object.keys(this.store.bind).forEach(o=>{s+=this.store.bind[o].length}),Object.keys(this.store.bindDatas).forEach(o=>{s+=this.store.bindDatas[o].length}),{图元总数量:t,图片图元数量:i,图片图元绘制数量:r,dom图元数量:n,正在执行的动画数量:a,数据点数量:s}}initBindDatas(){this.store.bindDatas={},this.store.data.pens.forEach(t=>{var i;(i=t.form)==null||i.forEach(r=>{let n;r.dataIds&&(Array.isArray(r.dataIds)?n=r.dataIds:n=[r.dataIds]),n==null||n.forEach(a=>{this.store.bindDatas[a.dataId]||(this.store.bindDatas[a.dataId]=[]),this.store.bindDatas[a.dataId].push({id:t.id,formItem:r})})})})}initBinds(){this.jetLinksList=[],this.store.bind={};const t=[],i=[];this.store.data.pens.forEach(r=>{var n,a;(n=r.realTimes)==null||n.forEach(s=>{var o;if(s.bind&&s.bind.id){const l=(o=this.store.data.networks)==null?void 0:o.some(f=>f.protocol==="ADIIOT");let h=s.productId||r.productId,c=s.deviceId||r.deviceId,u=s.propertyId,d=!1;if(l){if(h&&typeof h=="string"&&h.indexOf("${")>-1){let f=h.match(new RegExp("(?<=\\$\\{).*?(?=\\})","g"));f!=null&&f.length&&(h=this.getDynamicParam(f[0])||h),d=!0}if(c&&typeof c=="string"&&c.indexOf("${")>-1){let f=c.match(new RegExp("(?<=\\$\\{).*?(?=\\})","g"));f!=null&&f.length&&(c=this.getDynamicParam(f[0])||c),d=!0}if(u&&typeof u=="string"&&u.indexOf("${")>-1){let f=u.match(new RegExp("(?<=\\$\\{).*?(?=\\})","g"));f!=null&&f.length&&(u=this.getDynamicParam(f[0])||u),d=!0}d&&s.bind&&(s.bind.id=h+"#"+c+"#"+u)}if(this.store.bind[s.bind.id]||(this.store.bind[s.bind.id]=[]),this.store.bind[s.bind.id].push({id:r.id,key:s.key}),l&&h&&c&&u){const f=this.jetLinksList.findIndex(m=>m.topic.startsWith(`/${h}/${c}`));f>-1?this.jetLinksList[f].properties.includes(s.propertyId)||this.jetLinksList[f].properties.push(s.propertyId):this.jetLinksList.push({topic:`/${h}/${c}`,deviceId:c,properties:[s.propertyId]})}if(s.bind.class==="iot"){let f=s.bind.id.split("#"),m=t.findIndex(g=>g.deviceId===f[0]);m>-1?t[m].properties.includes(f[1])||t[m].properties.push(f[1]):t.push({deviceId:f[0],properties:[f[1]],token:s.bind.token}),i.findIndex(g=>g.key===s.bind.id)===-1&&i.push({key:s.bind.id,label:s.bind.label})}else if(s.bind.class==="sql"){let f=s.bind.id.split("#");const m=this.store.data.sqls.find(p=>p.bindId===f[0]);if(m){m.keys||(m.keys=[]),f.shift();const p=f.join("#");m.keys.includes(p)||m.keys.push(p)}}}}),(a=r.events)==null||a.forEach(s=>{var l;const o=(l=s.actions)==null?void 0:l.filter(h=>h.action===ve.SendData);o==null||o.forEach(h=>{var c;(c=h.data)==null||c.forEach(u=>{if(u.class==="iot"){let d=u.prop.split("#"),f=t.findIndex(m=>m.deviceId===d[0]);f>-1?t[f].properties.includes(d[1])||t[f].properties.push(d[1]):t.push({deviceId:d[0],properties:[d[1]],token:u.token})}})})})}),this.store.data.iot||(this.store.data.iot={}),t.length?this.store.data.iot.devices=t:delete this.store.data.iot.devices,i.length?this.store.data.iot.list=i:delete this.store.data.iot.list}connectSocket(){this.connectWebsocket(),this.connectMqtt(),this.connectHttp()}doInitJS(){const t=this.store.data.initJs;if(t&&t.trim())try{let i=new Function("context",t);i({meta2d:this}),i=null}catch(i){console.warn("initJs error",i)}}doInitFn(){let t=fa(),i=[];for(let r in t)t.hasOwnProperty(r)&&r.startsWith("bind-")&&i.push({id:r.replace("bind-",""),dataId:r.replace("bind-",""),value:t[r]});i.length&&this.setDatas(i,{history:!1})}drawLine(t){t&&sv(this.store),this.canvas.drawingLineName=t}alignPenToGrid(t){this.canvas.alignPenToGrid(t)}drawingPencil(){this.canvas.drawingPencil()}stopPencil(){this.canvas.stopPencil()}lock(t){this.store.data.locked=t,this.finishDrawLine(!0),this.canvas.drawingLineName="",this.stopPencil(),this.store.data.pens.forEach(i=>{var r;i.externElement===!0&&(r=i.calculative.singleton)!=null&&r.div&&Se(i,i.calculative.singleton.div)}),t>0&&this.initMessageEvents()}async finishDrawLine(t){await this.canvas.finishDrawline(t)}async finishPencil(){await this.canvas.finishPencil()}updateLineType(t,i){if(!t||t.name!="line"||!i||!this.canvas[i])return;t.lineName=i;const r=ge(t),n=Gt(t);r.prev=void 0,r.next=void 0,n.prev=void 0,n.next=void 0,t.calculative.worldAnchors=[r,n],t.calculative.activeAnchor=r,this.canvas[i](this.store,t,n),t.lineName==="curve"&&(r.prev={penId:r.penId,x:r.x-50,y:r.y},r.next={penId:r.penId,x:r.x+50,y:r.y},n.prev={penId:n.penId,x:n.x-50,y:n.y},n.next={penId:n.penId,x:n.x+50,y:n.y}),t.calculative.activeAnchor=void 0,this.canvas.initLineRect(t),this.render()}addDrawLineFn(t,i){this.canvas[t]=i,this.canvas.drawLineFns.push(t)}removeDrawLineFn(t){const i=this.canvas.drawLineFns.indexOf(t);i>-1&&this.canvas.drawLineFns.splice(i,1)}showMagnifier(){this.canvas.showMagnifier()}hideMagnifier(){this.canvas.hideMagnifier()}toggleMagnifier(){this.canvas.toggleMagnifier()}clear(t=!0,i){var r;for(const n of this.store.data.pens)(r=n.onDestroy)==null||r.call(n,n);zb(this.store,i),this.hideInput(),this.canvas.tooltip.hide(),this.map&&this.map.isShow&&(this.map.show(),this.map.setView()),this.canvas.clearCanvas(),sessionStorage.removeItem("page"),this.store.clipboard=void 0,this.store.sameTemplate||(this.canvas.canvasTemplate.bgPatchFlags=!0),this.store.patchFlagsBackground=!0,this.store.patchFlagsTop=!0,this.setBackgroundImage(void 0),t&&this.render()}emit(t,i){this.store.emitter.emit(t,i)}on(t,i){return this.store.emitter.on(t,i),this}off(t,i){return this.store.emitter.off(t,i),this}updateLineAnimateDraws(t,i){i&&(delete this.store.data.lineAnimateDraws[t],delete St.lineAnimateDraws[t],i!==-1&&this.registerLineAnimateDraws(i.name||t,i.code))}registerMoveDock(t){this.canvas.customMoveDock=t}registerResizeDock(t){this.canvas.customResizeDock=t}find(t){return this.canvas.find(t)}findOne(t){return this.canvas.findOne(t)}getPenRect(t){return this.canvas.getPenRect(t)}setPenRect(t,i,r=!0){this.canvas.setPenRect(t,i,r)}startAnimate(t,i){this.stopAnimate(t);let r;t?typeof t=="string"?r=this.find(t):r=t:r=this.store.data.pens.filter(n=>(n.type||n.frames)&&n.autoPlay||n.animations&&n.animations.length&&n.animations.findIndex(a=>a.autoPlay)!==-1),r.length&&(r.forEach(n=>{var a,s;if(n.calculative.pause){const o=Date.now()-n.calculative.pause;n.calculative.pause=void 0,n.calculative.frameStart+=o,n.calculative.frameEnd+=o}else{let o=-1;if(i!==void 0&&n.animations){if(typeof i=="string"){if(o=n.animations.findIndex(l=>l.name===i),o===-1)return}else if(typeof i=="number")if(n.animations.length>i)o=i;else return}else i===void 0&&(o=(a=n.animations)==null?void 0:a.findIndex(l=>l.autoPlay),o===-1&&((s=n.animations)!=null&&s.length)&&(o=0));if(o!==-1&&o!==void 0){const l=lt(n.animations[o]);l.animateName=l.name,delete l.name,l.currentAnimation=o,!n.type&&l.frames&&(l.showDuration=this.calcAnimateDuration(l)),this.setValue({id:n.id,...l},{doEvent:!1,history:!1})}this.store.animates.add(n),n.type||this.store.animateMap.set(n,n.calculative.canvas.getFrameProps(n))}}),this.initImageCanvas(r),this.canvas.animate())}pauseAnimate(t){let i=[];t?typeof t=="string"?i=this.find(t):i=t:this.store.animates.forEach(r=>{i.push(r)}),i.forEach(r=>{r.calculative.pause||(r.calculative.pause=Date.now())})}stopAnimate(t){let i=[];t?typeof t=="string"?i=this.find(t):i=t:this.store.animates.forEach(r=>{i.push(r)}),i.forEach(r=>{r.currentAnimation=void 0,r.calculative.pause=void 0,r.calculative.start=void 0,r.calculative.cycleStart=void 0,r.calculative.duration=void 0,r.calculative.animatePos=0,this.store.animates.delete(r),this.canvas.restoreNodeAnimate(r),this.canvas.updateLines(r),this.store.animateMap.delete(r)}),this.initImageCanvas(i),this.store.data.locked===jt.None&&setTimeout(()=>{var r;(r=this.canvas)==null||r.calcActiveRect(),this.render()},20)}startVideo(t){let i;t?typeof t=="string"?i=this.find(t):i=t:i=this.store.data.pens.filter(r=>(r.video||r.audio)&&r.autoPlay),i.forEach(r=>{var n,a;(n=r.calculative.media)==null||n.play(),(a=r.onStartVideo)==null||a.call(r,r)})}pauseVideo(t){let i=[];t?typeof t=="string"?i=this.find(t):i=t:i=this.store.data.pens.filter(r=>(r.video||r.audio)&&r.autoPlay),i.forEach(r=>{var n,a;(n=r.calculative.media)==null||n.pause(),(a=r.onPauseVideo)==null||a.call(r,r)})}stopVideo(t){let i=[];t?typeof t=="string"?i=this.find(t):i=t:i=this.store.data.pens.filter(r=>(r.video||r.audio)&&r.autoPlay),i.forEach(r=>{var n;r.calculative.media&&(r.calculative.media.currentTime=0,r.calculative.media.pause()),(n=r.onStopVideo)==null||n.call(r,r)})}calcAnimateDuration(t){return t.frames.reduce((i,r)=>i+r.duration,0)}combine(t=this.store.active,i,r=!0){if(!t||!t.length)return;const n=lt(t);if(t.length===1&&t[0].type){t[0].type=$t.Node,this.canvas.active(t),this.pushHistory({type:_t.Update,initPens:n,pens:lt(t,!0)}),this.render();return}const a=Di(t);let s={id:Mt(),name:"combine",...a,children:[],showChild:i};this.canvas.makePen(s);const o=lt(s);let l=1/0;return t.forEach(h=>{const c=this.store.data.pens.findIndex(d=>d.id===h.id);if(c<l&&(l=c),h===s||h.parentId===s.id||h.id===s.id)return;s.children.push(h.id),h.parentId=s.id;const u=Jr(h.calculative.worldRect,a);Object.assign(h,u),h.locked=h.lockedOnCombine??jt.None,h.locked=h.interaction||Nc.includes(h.name)?0:h.locked}),this.store.data.pens.splice(l,0,s),this.store.data.pens.pop(),r&&this.canvas.active([s]),this.pushHistory({type:_t.Add,pens:[o],step:3}),this.pushHistory({type:_t.Update,initPens:[o],pens:[s],step:3}),this.pushHistory({type:_t.Update,initPens:n,pens:t,step:3}),i!=null&&(t.forEach(h=>{kr(h,!0)}),this.initImageCanvas([s])),this.store.emitter.emit("combine",[s]),this.render(),s}uncombine(t){if(!t&&this.store.active&&(t=this.store.active[0]),!t||!t.children)return;const i=t.children.map(a=>this.store.pens[a]);let r=lt(i);i.forEach(a=>{a.parentId=void 0,a.x=a.calculative.worldRect.x,a.y=a.calculative.worldRect.y,a.width=a.calculative.worldRect.width,a.height=a.calculative.worldRect.height,a.locked=jt.None,a.calculative.active=void 0,a.calculative.hover=!1,this.setVisible(a,!0)});const n=this.isCombine(t)?3:2;this.pushHistory({type:_t.Update,initPens:r,pens:i,step:n}),r=[lt(t)],this.inactive(),t.children=void 0,this.pushHistory({type:_t.Update,initPens:r,pens:[t],step:n}),this.isCombine(t)&&(this.delete([t]),this.store.histories[this.store.histories.length-1].step=n)}clearCombine(t){if(!t&&this.store.active&&(t=this.store.active[0]),!t||!t.children)return;const i=di(t,this.store);i.forEach(n=>{n.parentId=void 0,n.x=n.calculative.worldRect.x,n.y=n.calculative.worldRect.y,n.width=n.calculative.worldRect.width,n.height=n.calculative.worldRect.height,n.locked=jt.None,n.calculative.active=void 0,n.calculative.hover=!1,n.showChild!==void 0&&this.setVisible(n,!0),n.children=void 0});const r=[];i.forEach((n,a)=>{n.name==="combine"&&(n.children=void 0,r.push(n))}),this.delete(r,!0,!1),t.children=void 0,this.isCombine(t)&&this.delete([t],!0,!1),this.inactive()}appendChild(t=this.store.active){if(!t||t.length<2)return;const i=t.findIndex(r=>r.name==="combine"&&r.showChild!==void 0);if(i!==-1){let r=t[i];const n=Di(t);Object.assign(r,n),Object.assign(r.calculative.worldRect,n),Ia(r),r.children.forEach(a=>{const s=this.store.pens[a],o=Jr(s.calculative.worldRect,n);Object.assign(s,o)}),t.forEach(a=>{if(a.id!==r.id){r.children.push(a.id),a.parentId=r.id;const s=Jr(a.calculative.worldRect,n);Object.assign(a,s),a.locked=a.lockedOnCombine??jt.DisableMove,a.locked=a.interaction||Nc.includes(a.name)?0:a.locked,kr(a,!0)}}),this.initImageCanvas(t),this.render()}else console.warn("Invalid operation!")}updateRectbyChild(t,i,r){if(le(t),ne(t),i.calculative.worldRect=t,r.container&&Dr(t,r.calculative.worldRect,!0)){const n=Jr(t,r.calculative.worldRect);Object.assign(i,n)}else{if(r.container){let n=Math.min(t.x,r.calculative.worldRect.x),a=Math.min(t.y,r.calculative.worldRect.y),s=Math.max(t.ex,r.calculative.worldRect.ex),o=Math.max(t.ey,r.calculative.worldRect.ey);r.calculative.worldRect={x:n,y:a,width:s-n,height:o-a,ex:s,ey:o},ne(r.calculative.worldRect)}else{const n=r.children.map(a=>this.store.pens[a]);r.calculative.worldRect=Di(n)}r.parentId||Object.assign(r,r.calculative.worldRect),r.children.forEach(n=>{const a=this.store.pens[n],s=Jr(a.calculative.worldRect,r.calculative.worldRect);Object.assign(a,s)}),r.parentId&&this.updateRectbyChild(r.calculative.worldRect,r,this.store.pens[r.parentId])}this.canvas.updatePenRect(r),this.render()}isCombine(t){return!!(t.name==="combine"||t.children&&t.children.length>0)}active(t,i=!0){this.canvas.active(t,i)}inactive(){this.canvas.inactive()}activeAll(){this.canvas.active(this.store.data.pens.filter(t=>!t.parentId&&t.locked!==jt.Disable)),this.render()}focus(t){const i=this.findOne(t);i&&(this.store.hover=i,this.store.hover.calculative.hover=!0,this.showInput(i))}delete(t,i=!1,r=!0){this.canvas.delete(t,i,r)}deleteSync(t,i=!1,r=!0){this.canvas.deleteSync(t,i,r)}scale(t,i={x:0,y:0}){this.canvas.scale(t,i)}translate(t,i){this.canvas.translate(t,i)}translatePens(t,i,r){this.canvas.translatePens(t,i,r)}getParent(t,i){return Ge(t,i)}getAllChildren(t){return di(t,this.store)}getAllFollowers(t){return hu(t,this.store)}data(){this.initBinds();const t=lt(this.store.data),{pens:i,paths:r}=this.store.data;t.version=Ap.version,t.paths={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&i.find(a=>a.pathId===n)&&(t.paths[n]=r[n]);return t.dataPoints=[...Object.keys(this.store.bind),...Object.keys(this.store.bindDatas)],t}copy(t){this.canvas.copy(t)}cut(t){this.canvas.cut(t)}paste(){this.canvas.paste()}undo(){this.canvas.undo()}redo(){this.canvas.redo()}listenSocket(){try{let t;const i=this.store.data.socketCbJs;if(i&&(t=new Function("e","context",i)),!t)return this.socketFn=null,!1;this.socketFn=t}catch(t){return console.error("Create the function for socket:",t),!1}return!0}connectWebsocket(t){this.closeWebsocket(),t&&(this.store.data.websocket=t),this.store.data.websocket&&(this.websocket=new WebSocket(this.store.data.websocket,this.store.data.websocketProtocols||void 0),this.websocket.onmessage=i=>{this.socketCallback(i.data,{type:"websocket",url:this.store.data.websocket})},this.websocket.onerror=i=>{this.store.emitter.emit("error",{type:"websocket",error:i})},this.websocket.onclose=()=>{if(this.store.options.reconnetTimes&&(this.websocketTimes++,this.websocketTimes>=this.store.options.reconnetTimes)){this.websocketTimes=0,this.closeWebsocket();return}console.info("Canvas websocket closed and reconneting..."),this.connectWebsocket()})}closeWebsocket(){this.websocket&&(this.websocket.onclose=void 0,this.websocket.close(),this.websocket=void 0)}connectMqtt(t){if(this.closeMqtt(),t&&(this.store.data.mqtt=t.mqtt,this.store.data.mqttTopics=t.mqttTopics,this.store.data.mqttOptions=t.mqttOptions),this.store.data.mqtt){this.store.data.mqttOptions.clientId&&!this.store.data.mqttOptions.customClientId&&(this.store.data.mqttOptions.clientId=Mt());const i={...this.store.data.mqttOptions};i.username||delete i.username,i.password||delete i.password;const{username:r,password:n}=i;r&&n||!r&&!n?(this.mqttClient=Uo.connect(this.store.data.mqtt,i),this.mqttClient.on("message",(a,s)=>{this.socketCallback(s.toString(),{topic:a,type:"mqtt",url:this.store.data.mqtt})}),this.mqttClient.on("error",a=>{this.store.emitter.emit("error",{type:"mqtt",error:a})}),this.mqttClient.on("close",()=>{this.store.options.reconnetTimes&&(this.mqttTimes++,this.mqttTimes>=this.store.options.reconnetTimes&&(this.mqttTimes=0,this.closeMqtt()))}),this.store.data.mqttTopics&&this.mqttClient.subscribe(this.store.data.mqttTopics.split(","))):console.warn("缺少用户名或密码")}}closeMqtt(){var t;(t=this.mqttClient)==null||t.end()}connectHttp(){this.closeHttp();const{https:t}=this.store.data;if(t)this.store.data.cancelFirstConnect||t.forEach(async i=>{this.oldRequestHttp(i)}),t.forEach((i,r)=>{i.http&&i.httpTimeInterval!==0&&(i.times=0,this.httpTimerList[r]=setInterval(async()=>{this.oldRequestHttp(i),this.store.options.reconnetTimes&&i.times>=this.store.options.reconnetTimes&&(i.times=0,clearInterval(this.httpTimerList[r]),this.httpTimerList[r]=void 0)},i.httpTimeInterval||1e3))});else{const{http:i,httpTimeInterval:r,httpHeaders:n}=this.store.data;i&&(this.httpTimer=setInterval(async()=>{const a=await fetch(i,{headers:n});if(a.ok){const s=await a.text();this.socketCallback(s,{type:"http",url:i})}},r||1e3))}}async oldRequestHttp(t){let i=lt(t);if(i.http){const r=await fetch(i.http,{headers:i.httpHeaders,method:i.method||"GET",body:i.method==="POST"?JSON.stringify(i.body):void 0});if(r.ok){const n=await r.text();this.socketCallback(n,{type:"http",url:i.http})}else t.times++,this.store.emitter.emit("error",{type:"http",error:r})}}async sendDatabyHttp(t){const{https:i}=this.store.data;if(i)i.forEach(async r=>{r.http&&(await fetch(r.http,{method:"post",body:t,headers:r.httpHeaders})).ok&&console.info("http消息发送成功")});else{const{http:r,httpHeaders:n}=this.store.data;r&&(await fetch(r,{method:"post",body:t,headers:n})).ok&&console.info("http消息发送成功")}}closeHttp(){clearInterval(this.httpTimer),this.httpTimer=void 0,this.httpTimerList&&this.httpTimerList.forEach(t=>{clearInterval(t),t=void 0})}connectNetwork(){this.closeNetwork();const{networks:t}=this.store.data,i=[];if(t){let r=0,n=0,a=0,s=0;this.mqttClients=[],this.websockets=[],this.eventSources=[],t.forEach(async o=>{o.protocol==="mqtt"?(o.index=r,this.connectNetMqtt(o),r+=1):o.protocol==="websocket"?(o.index=a,this.connectNetWebSocket(o),a+=1):o.protocol==="http"?(o.index=n,i.push({url:o.url,interval:o.interval,headers:o.headers||void 0,method:o.method,body:o.body,enable:o.enable,index:o.index,once:o.once}),n+=1):o.protocol==="ADIIOT"?IE(this,o):o.protocol==="SSE"&&(o.index=s,this.connectSSE(o),s+=1)})}this.onNetworkConnect(i),this.connectIot(),this.connectSqls()}reconnectNetwork(t){var r,n;const i=this.store.data.networks[t];if(i.protocol==="mqtt")this.mqttClients&&((r=this.mqttClients[i.index])==null||r.end()),this.connectNetMqtt(i);else if(i.protocol==="websocket")this.websockets&&this.websockets[i.index]&&(this.websockets[i.index].onclose=void 0,this.websockets[i.index].close(),this.websockets[i.index]=void 0),this.connectNetWebSocket(i);else if(i.protocol==="http"){this.updateTimerList&&(clearInterval(this.updateTimerList[i.index]),this.updateTimerList[i.index]=void 0);const a=lt(i);this.store.data.cancelFirstConnect||this.requestHttp(a),i.interval!==0&&(this.updateTimerList[i.index]=setInterval(async()=>{this.requestHttp(a)},a.interval||1e3))}else i.protocol==="SSE"&&(this.eventSources&&((n=this.eventSources[i.index])==null||n.close(),this.eventSources[i.index]=void 0),this.connectSSE(i))}async connectIot(){var n;const{iot:t}=this.store.data;if(!(t&&((n=t==null?void 0:t.devices)!=null&&n.length))||t&&t.enable===!1)return;const i=globalThis.iotUrl||await this.getMqttUrl();if(!i){console.warn("iot Request address error");return}const r=await this.getIotToken(t.devices,t.protocol==="websocket"?1:void 0);t.token=r,this.iotMqttClient=Uo.connect(i),this.iotMqttClient.on("message",(a,s)=>{this.socketCallback(s.toString(),{topic:`le5le-iot/properties/${r}`,type:"iot",url:i,method:"mqtt"})}),this.iotMqttClient.on("error",a=>{this.store.emitter.emit("error",{type:"mqtt",error:a})}),this.iotMqttClient.subscribe(`le5le-iot/properties/${r}`),this.iotTimer=setInterval(()=>{this.iotMqttClient&&this.iotMqttClient.publish("le5le-iot/subscribe/ping",r)},3e5)}closeIot(){if(this.iotMqttClient){const{iot:t}=this.store.data;t!=null&&t.token&&this.unsubscribeIot(t.token),this.iotMqttClient.end(),this.iotMqttClient=void 0}clearInterval(this.iotTimer),this.iotTimer=void 0}connectSqls(){const{sqls:t}=this.store.data;t&&t.length&&t.forEach(async(i,r)=>{i.enable!==!1&&(await this.doSqlCode(i),i.interval&&(i.index=r,this.sqlTimerList[r]=setInterval(async()=>{await this.doSqlCode(i)},i.interval)))})}connectSSE(t){t.enable!==!1&&(this.eventSources[t.index]=new EventSource(t.url,{withCredentials:t.withCredentials}),this.eventSources[t.index].onmessage=i=>{this.socketCallback(i.data,{type:"SSE",url:t.url,name:t.name,net:t})},this.eventSources[t.index].onerror=i=>{this.store.emitter.emit("error",{type:"SSE",error:i})})}closeSSE(){this.eventSources&&this.eventSources.forEach(t=>{t&&(t.close(),t=void 0)})}connectNetMqtt(t){var n,a,s;if(t.enable===!1)return;t.options.clientId&&!t.options.customClientId&&(t.options.clientId=Mt());let i=t.url;if(i.indexOf("${")>-1){let o=(n=i.match(/\$\{([^}]+)\}/g))==null?void 0:n.map(l=>l.slice(2,-1));o&&o.forEach(l=>{i=i.replace(`\${${l}}`,this.getDynamicParam(l))})}t.times=0;let r=lt(t.options);if(r!=null&&r.username&&r.username.includes("${")){let o=(a=r.username.match(/\$\{([^}]+)\}/g))==null?void 0:a.map(l=>l.slice(2,-1));o&&o.forEach(l=>{r.username=r.username.replace(`\${${l}}`,this.getDynamicParam(l))})}if(r!=null&&r.password&&r.password.includes("${")){let o=(s=r.password.match(/\$\{([^}]+)\}/g))==null?void 0:s.map(l=>l.slice(2,-1));o&&o.forEach(l=>{r.password=r.password.replace(`\${${l}}`,this.getDynamicParam(l))})}r.hasOwnProperty("keepalive")||Object.assign(r,{keepallive:30}),r.hasOwnProperty("reconnectPeriod")||Object.assign(r,{reconnectPeriod:5e3}),r.hasOwnProperty("connectTimeout")||Object.assign(r,{connectTimeout:10*1e3}),this.mqttClients[t.index]=Uo.connect(i,r),this.mqttClients[t.index].on("message",(o,l)=>{this.socketCallback(l.toString(),{topic:o,type:"mqtt",url:t.url,name:t.name,net:t})}),this.mqttClients[t.index].on("error",o=>{this.store.emitter.emit("error",{type:"mqtt",error:o})}),this.mqttClients[t.index].on("connect",o=>{var l;if(!o.sessionPresent&&t.topics){let h=t.topics;if(h.indexOf("${")>-1){let c=(l=h.match(/\$\{([^}]+)\}/g))==null?void 0:l.map(u=>u.slice(2,-1));c&&c.forEach(u=>{h=h.replace(`\${${u}}`,this.getDynamicParam(u))})}this.mqttClients[t.index].subscribe(h.split(","),{qos:1},c=>{c&&console.error("订阅失败：",c)})}})}connectNetWebSocket(t){var r,n;if(this.websockets[t.index]&&(this.websockets[t.index].onclose=void 0,(r=this.websockets[t.index])==null||r.close(),this.websockets[t.index]=void 0),t.enable===!1)return;let i=t.url;if(i.indexOf("${")>-1){let a=(n=i.match(/\$\{([^}]+)\}/g))==null?void 0:n.map(s=>s.slice(2,-1));a&&a.forEach(s=>{i=i.replace(`\${${s}}`,this.getDynamicParam(s))})}this.websockets[t.index]=new WebSocket(i,t.protocols||void 0),this.websockets[t.index].onmessage=a=>{this.socketCallback(a.data,{type:"websocket",url:t.url,name:t.name,net:t})},this.websockets[t.index].onerror=a=>{this.store.emitter.emit("error",{type:"websocket",error:a})},this.websockets[t.index].onclose=()=>{var a;if(this.store.options.reconnetTimes&&(t.times++,t.times>=this.store.options.reconnetTimes)){t.times=0,this.websockets[t.index].onclose=void 0,(a=this.websockets[t.index])==null||a.close(),this.websockets[t.index]=void 0;return}setTimeout(()=>{console.info("Canvas websocket closed and reconneting..."),this.connectNetWebSocket(t)},2e3)}}async getMqttUrl(){const t=await fetch("/api/iot/app/mqtt",{method:"GET",headers:{Authorization:ds()}});if(t.ok){const i=await t.text();let r=JSON.parse(i);return r.wssPort||r.wsPort?`${location.protocol==="https:"?"wss":"ws"}://${r.host}:${location.protocol==="https:"?r.wssPort:r.wsPort}${r.path}`:void 0}}async getIotToken(t,i){const r=await fetch("/api/iot/subscribe/properties",{method:"POST",headers:{Authorization:ds()},body:JSON.stringify({devices:t,type:i})});if(r.ok){const n=await r.text();return JSON.parse(n).token}}async unsubscribeIot(t){return await fetch("/api/iot/unsubscribe/properties",{method:"POST",headers:{Authorization:ds()},body:JSON.stringify({token:t})})}async doSqlCode(t){var a;const i=t.method||"get";let r=t.sql;i==="list"&&t.pageSize!==-1&&(t.dbType==="oracle"?r.includes("OFFSET")||(r+=` OFFSET ${((t.current||1)-1)*(t.pageSize||20)} ROWS FETCH NEXT ${t.pageSize||20} ROWS ONLY`):r.includes("LIMIT")||(r+=` LIMIT ${t.pageSize||20}`+(t.current>1?" OFFSET "+(t.current-1)*(t.pageSize||20):"")));const n=await fetch(`/api/iot/data/sql/${i}`,{method:"POST",headers:{Authorization:ds()},body:JSON.stringify({dbId:t.dbId||t.dbid,sql:r})});if(n.ok){let s=await n.text();if(s){const o=[];if(s=JSON.parse(s),s.error){this.store.emitter.emit("error",{type:"sql",error:s.error});return}(a=t.keys)==null||a.forEach(l=>{o.push({id:t.bindId+"#"+l,value:Zi(s,l.split("#").join("."))})}),o.push({id:t.bindId,value:s}),this.socketCallback(JSON.stringify(o),{type:"sql",url:`/api/iot/data/sql/${i}`,method:i})}}}randomString(t){t=t||32;let i="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",r=i.length,n="";for(let a=0;a<t;a++)n+=i.charAt(Math.floor(Math.random()*r));return n}mockValue(t){let i;if(t.enableMock&&t.mock!==void 0)if(t.type==="float")if(t.mock&&t.mock.indexOf(",")!==-1){let r=t.mock.split(","),n=Math.floor(Math.random()*r.length);i=parseFloat(r[n])}else if(t.mock&&t.mock.indexOf("-")!==-1){let r,n,a,s=t.mock.split("-");if(t.mock.charAt(0)==="-"?s.length===4?(r=-parseFloat(s[3]),n=-parseFloat(s[1]),a=s[3]):(r=parseFloat(s[2]),n=-parseFloat(s[1]),a=s[2]):(r=parseFloat(s[1]),n=parseFloat(s[0]),a=s[1]),(a+"").indexOf(".")!==-1){let o=(a+"").split(".")[1].length;i=(Math.random()*(r-n)+n).toFixed(o)}else i=Math.random()*(r-n)+n}else i=parseFloat(t.mock);else if(t.type==="integer")if(t.mock&&t.mock.indexOf(",")!==-1){let r=t.mock.split(","),n=Math.floor(Math.random()*r.length);i=parseInt(r[n])}else if(t.mock&&t.mock.indexOf("-")!==-1){let r,n,a=t.mock.split("-");t.mock.charAt(0)==="-"?a.length===4?(r=-parseFloat(a[3]),n=-parseFloat(a[1])):(r=parseFloat(a[2]),n=-parseFloat(a[1])):(r=parseInt(a[1]),n=parseInt(a[0])),i=parseInt(Math.random()*(r-n)+n+"")}else i=parseInt(t.mock);else if(t.type==="bool")typeof t.mock=="boolean"?i=t.mock:t.mock==="true"?i=!0:t.mock==="false"?i=!1:i=Math.random()<.5;else if(t.type==="object"||t.type==="array")t.mock;else if(t.mock&&t.mock.indexOf(",")!==-1){let r=t.mock.split(","),n=Math.floor(Math.random()*r.length);i=r[n]}else if(t.mock&&t.mock.startsWith("[")&&t.mock.endsWith("]")){let r=parseInt(t.mock.substring(1,t.mock.length-1));i=this.randomString(r)}else i=t.mock;return i}dataMock(){var i,r;let t=[];(r=(i=this.store.data.dataset)==null?void 0:i.devices)==null||r.forEach(n=>{let a=this.mockValue(n);a!==void 0&&t.push({id:n.id,value:a})}),t.length&&this.setDatas(t,{render:!0,doEvent:!0,history:!1})}networkMock(){if(this.store.data.networks&&this.store.data.networks.length){let t=[];this.store.data.networks.forEach(i=>{var r;i.enable===!1&&((r=i.children)==null||r.forEach(n=>{let a=lt(n);a.enableMock=!0;let s=this.mockValue(a);s!==void 0&&t.push({id:n.id,value:s})}))}),t.length&&this.setDatas(t,{render:!0,doEvent:!0,history:!1})}}startDataMock(){this.store.data.enableMock?(this.stopDataMock(),this.initBinds(),this.updateTimer=setInterval(()=>{this.store.data.pens.forEach(i=>{this.penMock(i)}),this.networkMock(),this.render()},this.store.data.networkInterval||1e3)):this.stopDataMock()}stopDataMock(){clearInterval(this.updateTimer),this.updateTimer=void 0}penMock(t){var i;if(t.realTimes){let r={};if(t.realTimes.forEach(n=>{let a=this.mockValue(n);a!==void 0&&(r[n.key]=a)}),Object.keys(r).length){let n=t.onBeforeValue?t.onBeforeValue(t,r):r;this.canvas.updateValue(t,n),(i=t.onValue)==null||i.call(t,t),this.store.emitter.emit("valueUpdate",t)}}}penNetwork(t){const i={url:t.apiUrl,method:t.apiMethod,headers:t.apiHeaders,body:t.apiBody};this.requestHttp(i),t.apiEnable?(this.store.pensNetwork||(this.store.pensNetwork={}),this.store.pensNetwork[t.id]=i):delete this.store.pensNetwork[t.id]}getDynamicParam(t){let i=localStorage.getItem(t);return globalThis.le5leTokenD&&[globalThis.le5leSSOTokenName??"ssotoken",globalThis.le5leTokenName??"token"].includes(t)&&(i=Ip(i)),fa()[t]||i||dl(t)||globalThis[t]||""}onNetworkConnect(t){if(t&&t.length){if(this.store.pensNetwork)for(let i in this.store.pensNetwork)t.push(this.store.pensNetwork[i]);this.store.data.cancelFirstConnect||t.forEach(async i=>{i.enable!==!1&&this.requestHttp(i)}),t.forEach((i,r)=>{i.times=0,i.interval!==0&&i.enable!==!1&&(i.once?setTimeout(async()=>{this.requestHttp(i)},i.interval||1e3):this.updateTimerList[r]=setInterval(async()=>{this.requestHttp(i),this.store.options.reconnetTimes&&i.times>=this.store.options.reconnetTimes&&(i.times=0,clearInterval(this.updateTimerList[r]),this.updateTimerList[r]=void 0)},i.interval||1e3))})}}async requestHttp(t){var r,n,a;let i=lt(t);if(i.url){if(i.url.indexOf("${")>-1){let o=(r=i.url.match(/\$\{([^}]+)\}/g))==null?void 0:r.map(l=>l.slice(2,-1));o&&o.forEach(l=>{i.url=i.url.replace(`\${${l}}`,this.getDynamicParam(l))})}if(typeof i.headers=="object"){let o=JSON.stringify(i.headers),l=(n=o.match(/\$\{([^}]+)\}/g))==null?void 0:n.map(h=>h.slice(2,-1));if(l!=null&&l.length)for(let h=0;h<l.length;h++)o=o.replace(`\${${l[h]}}`,this.getDynamicParam(l[h]));i.headers=JSON.parse(o)}if(typeof i.body=="object"){let o=JSON.stringify(i.body),l=(a=o.match(/\$\{([^}]+)\}/g))==null?void 0:a.map(h=>h.slice(2,-1));if(l!=null&&l.length)for(let h=0;h<l.length;h++)o=o.replace(`\${${l[h]}}`,this.getDynamicParam(l[h]));i.body=JSON.parse(o)}const s=await fetch(i.url,{headers:i.headers,method:i.method,body:i.method==="GET"?void 0:JSON.stringify(i.body)});if(s.ok){const o=await s.text(),l=this.store.data.networks.filter(h=>h.protocol==="http")[i.index];this.socketCallback(o,{type:"http",method:i.method,url:i.url,name:i.name,net:l})}else t.times++,this.store.emitter.emit("error",{type:"http",error:s})}}closeNetwork(){this.mqttClients&&this.mqttClients.forEach(t=>{t.end()}),this.websockets&&this.websockets.forEach(t=>{t&&(t.onclose=void 0,t.close(),t=void 0)}),this.mqttClients=void 0,this.websockets=void 0,this.updateTimerList&&this.updateTimerList.forEach(t=>{clearInterval(t),t=void 0}),this.sqlTimerList&&this.sqlTimerList.forEach(t=>{clearInterval(t),t=void 0}),this.closeIot(),DE(this),this.closeSSE()}socketCallback(t,i){var a,s;this.store.emitter.emit("socket",{message:t,context:i});let r=t;if((a=i.net)!=null&&a.socketCbJs&&((s=i.net)!=null&&s.socketFn||(i.net.socketFn=new Function("e","context",i.net.socketCbJs)),i.net.socketFn)){if(r=i.net.socketFn(t,{meta2d:this,type:i.type,topic:i.topic,url:i.url,method:i.method}),!r)return;r&&r!==!0&&(t=r)}if(this.socketFn&&(r=this.socketFn(t,{meta2d:this,type:i.type,topic:i.topic,url:i.url,method:i.method,net:i.net}),!r))return;r===!0&&(r=t);let n;if(r.constructor===Object||r.constructor===Array)n=r;else if(typeof r=="string")try{n=JSON.parse(r)}catch(o){console.warn("Invalid socket data:",n,o)}else return;n&&(Array.isArray(n)||(n=[n]),n.length&&(n[0].dataId?this.setDatas(n):n.forEach(o=>{this.setValue(o)})))}setDatas(t,{render:i=!0,doEvent:r=!0,history:n}={}){const a=new Map;t.forEach(l=>{var h,c;(h=this.store.bindDatas[l.dataId])==null||h.forEach(u=>{const d=this.store.pens[u.id];if(!d)return;let f=a.get(d);if(!d.noOnBinds&&typeof d.onBinds=="function"){if(f)return;a.set(d,d.onBinds(d,t,u.formItem));return}f?f[u.formItem.key]=l.value:(f={id:u.id,[u.formItem.key]:l.value},a.set(d,f))}),(c=this.store.bind[l.id||l.dataId])==null||c.forEach(u=>{const d=this.store.pens[u.id];if(!d)return;let f=a.get(d);f?f[u.key]=l.value:(f={id:u.id,[u.key]:l.value},a.set(d,f))})}),this.store.data.locked&&this.doDataEvent(t);let s,o;n&&(s=[]),a.forEach((l,h)=>{this.setValue(l,{render:!1,doEvent:r,history:!1}),n&&(s.push(lt(h,!0)),o.push(h))}),i&&this.render(),n&&this.pushHistory({type:_t.Update,initPens:s,pens:o})}setValue(t,{render:i=!0,doEvent:r=!0,history:n}={}){let a=[];if(!t)return;if(t.id){if(t.id===this.store.data.id){this.setDatabyOptions(t),t.bkImage&&this.setBackgroundImage(t.bkImage),t.background&&this.setBackgroundColor(t.background),this.render();return}const o=this.store.pens[t.id];if(o)a=[o];else{let l=this.store.bind[t.id];if(l&&l.length){a=[],this.setDatas([t],{render:i,doEvent:r,history:n});return}}}else if(t.dataId){a=[],this.setDatas([t],{render:i,doEvent:r,history:n});return}else if(t.tag)a=this.find(t.tag);else{let o=[];for(let l in t)o.push({dataId:l,id:l,value:t[l]});o.length&&this.setDatas(o,{render:i,doEvent:r,history:n});return}n=n&&!this.store.data.locked;let s;if(n&&(s=lt(a)),a.forEach(o=>{var h;if(o.name==="echarts"&&!o.onBeforeValue&&Object.keys(t).some(u=>NE.test(u)))return;const l=o.onBeforeValue?o.onBeforeValue(o,t):t;t.frames&&(this.stopAnimate([o]),t.showDuration||(t.showDuration=t.frames.reduce((c,u)=>c+u.duration,0))),gu(o,l),this.canvas.updateValue(o,l),(h=o.onValue)==null||h.call(o,o)}),!this.store.data.locked&&this.store.active.length&&!this.canvas.movingPens&&this.canvas.calcActiveRect(),n){let o=lt(a);this.pushHistory({type:_t.Update,initPens:s,pens:o})}r&&a.forEach(o=>{this.store.emitter.emit("valueUpdate",o)}),i&&this.render()}_setValue(t,i=!1){this.setValue(t,{history:i,render:!1,doEvent:!1})}pushHistory(t){this.canvas.pushHistory(t)}showInput(t,i){this.canvas.showInput(t,i)}hideInput(){this.canvas.hideInput()}clearDropdownList(){this.canvas.clearDropdownList()}clearRuleLines(){this.canvas.clearRuleLines()}doMessageEvent(t,i){this.store.messageEvents[t]&&this.store.messageEvents[t].forEach(r=>{let n=!1;r.event.conditions&&r.event.conditions.length?r.event.conditionType==="and"?n=r.event.conditions.every(a=>this.judgeCondition(r.pen,a.key,a)):r.event.conditionType==="or"&&(n=r.event.conditions.some(a=>this.judgeCondition(r.pen,a.key,a))):n=!0,n&&r.event.actions.forEach(a=>{this.events[a.action](r.pen,a,i)})})}initGlobalTriggers(){var t;this.store.globalTriggers={},(t=this.store.data.triggers)==null||t.forEach(i=>{i.conditions.forEach(r=>{r.source&&(this.store.globalTriggers[r.source]||(this.store.globalTriggers[r.source]=[]),this.store.globalTriggers[r.source].includes(i)||this.store.globalTriggers[r.source].push(i))})})}initMessageEvents(){this.store.messageEvents={},this.store.data.pens.forEach(t=>{var i;(i=t.events)==null||i.forEach(r=>{r.name==="message"&&r.message&&(this.store.messageEvents[r.message]||(this.store.messageEvents[r.message]=[]),this.store.messageEvents[r.message].push({pen:t,event:r}))})})}dataJudegeCondition(t,i,r){const{type:n,target:a,fnJs:s,fn:o,operator:l,valueType:h}=r;let c=!1;if(n==="fn"){if(o)c=o(t,{meta2d:this});else if(s){try{r.fn=new Function("data","context",s)}catch(u){console.error("Error: make function:",u)}r.fn&&(c=r.fn(t,{meta2d:this}))}}else{let u=r.value;h==="prop"&&(u=t[r.value]);let d=t[i];switch(l){case">":c=d>+u;break;case">=":c=d>=+u;break;case"<":c=d<+u;break;case"<=":c=d<=+u;break;case"=":case"==":c=d==u;break;case"!=":c=d!=u;break;case"[)":c=ea(+d,u);break;case"![)":c=!ea(+d,u);break;case"[]":c=ia(d,u);break;case"![]":c=!ia(d,u);break}}return c}judgeCondition(t,i,r){const{type:n,target:a,fnJs:s,fn:o,operator:l,valueType:h}=r;let c=!1;if(n==="fn"){if(o)c=o(t,{meta2d:this});else if(s){try{r.fn=new Function("pen","context",s)}catch(u){console.error("Error: make function:",u)}r.fn&&(c=r.fn(t,{meta2d:this}))}}else{let u=r.value;h==="prop"&&(u=this.store.pens[a][r.value]);let d=Zi(t,i);switch(["x","y","width","height"].includes(i)&&(d=this.getPenRect(t)[i]),l){case">":c=d>+u;break;case">=":c=d>=+u;break;case"<":c=d<+u;break;case"<=":c=d<=+u;break;case"=":case"==":c=d==u;break;case"!=":c=d!=u;break;case"[)":c=ea(+d,u);break;case"![)":c=!ea(+d,u);break;case"[]":c=ia(d,u);break;case"![]":c=!ia(d,u);break}}return c}pushChildren(t,i){const r=[lt(t,!0)],n=[];t.children||(t.children=[]);const a=[];i.forEach(o=>{let l=lt(o,!0);if((!o.id||!this.store.pens[o.id])&&(this.canvas.makePen(o),l=null),o.parentId){const c=this.store.pens[o.parentId],u=c.children.findIndex(d=>d===o.id);r.push(lt(c,!0)),c.children.splice(u,1),a.push(lt(c,!0))}t.children.push(o.id),o.parentId=t.id;const h=Jr(o.calculative.worldRect,t.calculative.worldRect);Object.assign(o,h),o.locked=o.lockedOnCombine??jt.DisableMove,o.locked=o.interaction||Nc.includes(o.name)?0:o.locked,l?(r.push(l),a.push(lt(o,!0))):n.push(lt(o,!0))}),a.push(lt(t,!0));let s=1;n.length&&(s=2,this.pushHistory({type:_t.Add,pens:n,step:s})),this.pushHistory({type:_t.Update,initPens:r,pens:a,step:s})}toPng(t,i,r=!1,n){return this.canvas.toPng(t,i,r,n)}activeToPng(t,i){return this.canvas.activeToPng(t,i)}pensToPng(t=this.store.active,i,r){return this.canvas.pensToPng(t,i,r)}downloadPng(t,i,r){var n;for(const a of this.store.data.pens)(a.calculative.img||["iframe"].includes(a.name))&&((n=a.onRenderPenRaw)==null||n.call(a,a));setTimeout(()=>{const a=document.createElement("a");a.setAttribute("download",(t||this.store.data.name||"le5le.meta2d")+".png"),a.setAttribute("href",this.toPng(i,void 0,!0,r));const s=document.createEvent("MouseEvents");s.initEvent("click",!0,!0),a.dispatchEvent(s)},1e3)}downloadSvg(t){if(!window.C2S)throw console.error("请先加载乐吾乐官网下的canvas2svg.js","https://assets.le5lecdn.com/2d/canvas2svg.js"),new Error("请先加载乐吾乐官网下的canvas2svg.js");let i=!1;const r=this.store.data.width||this.store.options.width,n=this.store.data.height||this.store.options.height;r&&n&&!this.store.data.component&&(i=!0);const a=this.getRect();i&&(a.x=this.store.data.origin.x,a.y=this.store.data.origin.y,a.width=r*this.store.data.scale,a.height=n*this.store.data.scale),a.x-=10,a.y-=10;const s=new window.C2S(a.width+20,a.height+20);s.textBaseline="middle",s.strokeStyle=this.store.styles.color;const o=this.store.options.downloadBgTransparent?void 0:this.store.data.background||this.store.styles.background;o&&i&&(s.save(),s.fillStyle=o,s.fillRect(0,0,a.width,a.height),s.restore()),this.store.bkImg&&i&&s.drawImage(this.store.bkImg,0,0,a.width,a.height),o&&!i&&(s.save(),s.fillStyle=o,s.fillRect(0,0,a.width+20,a.height+20),s.restore());for(const m of this.store.data.pens)m.visible==!1||!vl(m,this.store)||pl(s,m,a,!0);let l=s.getSerializedSvg();t!=null&&t.length&&(l=l.replace("<defs/>",`<defs>
          <style type="text/css">
            ${t.join(`
`)}
          </style>
          {{bk}}
        </defs>
        {{bkRect}}`)),o?(l=l.replace("{{bk}}",""),l=l.replace("{{bkRect}}",`<rect x="0" y="0" width="100%" height="100%" fill="${o}"></rect>`)):(l=l.replace("{{bk}}",""),l=l.replace("{{bkRect}}","")),l=l.replace(/--le5le--/g,"&#x");const h=window.URL,c=new Blob([l]),u=h.createObjectURL(c),d=document.createElement("a");d.setAttribute("download",`${this.store.data.name||"le5le.meta2d"}.svg`),d.setAttribute("href",u);const f=document.createEvent("MouseEvents");f.initEvent("click",!0,!0),d.dispatchEvent(f)}getRect(t=this.store.data.pens){return Di(t)}hiddenTemplate(){this.canvas.canvasTemplate.hidden()}showTemplate(){this.canvas.canvasTemplate.show()}lockTemplate(t){this.store.data.pens.forEach(i=>{i.canvasLayer===Ht.CanvasTemplate&&(i.locked=t)})}fitView(t=!0,i=10,r=!0){var d,f;if(!this.hasView())return;const{canvas:n}=this.canvas,{offsetWidth:a,offsetHeight:s}=n;this.resize(a,s);const o=Rr(i),l=this.getRect(),h=(a-o[1]-o[3])/l.width,c=(s-o[0]-o[2])/l.height;let u=h;t?u=h>c?c:h:u=h>c?h:c,(d=this.store.data.fits)!=null&&d.length&&(this.canvas.opening=!0),this.scale(u*this.store.data.scale),this.centerView(),r&&((f=this.store.data.fits)!=null&&f.length)&&this.fillView()}fillView(){var n,a;if(this.store.options.unFill)return;const t=this.getRect(),i=this.canvas.width-t.width,r=this.canvas.height-t.height;if(Math.abs(i)>10){(n=this.store.data.fits)==null||n.forEach(l=>{let h=[];l.children.forEach(u=>{this.store.pens[u]&&(this.store.pens[u].locked=jt.None,h.push(this.store.pens[u]))});let c=i/2;if(l.left&&l.right){let u=l.leftValue,d=l.rightValue;u?u=Math.abs(u)<1?u*t.width:u:u=0,d?d=Math.abs(d)<1?d*t.width:d:d=0;let f=(this.canvas.width-u-d)/(t.width-u-d);h.forEach(m=>{var p,g;m.image&&m.imageRatio&&m.calculative.worldRect.width/this.canvas.width>.1&&(m.imageRatio=!1,m.ratio=!1),m.name==="tablePlus"&&(m.colWidth=(m.colWidth??150)*f,m.styles.forEach(y=>{y.width&&(y.width=y.width*f)})),Math.abs(l.leftValue)<1?m.calculative.worldRect.x=t.x-i/2+u+(m.calculative.worldRect.x-t.x-u)*f:m.calculative.worldRect.x=t.x-i/2+u+(m.calculative.worldRect.x-t.x)*f,m.calculative.worldRect.width*=f,m.calculative.worldRect.ex=m.calculative.worldRect.x+m.calculative.worldRect.width,m.calculative.width=m.calculative.worldRect.width,m.calculative.x=m.calculative.worldRect.x,m.width=m.calculative.worldRect.width,m.x=m.calculative.worldRect.x,m.textWidth*=f,m.calculative.textWidth*=f,this.canvas.updatePenRect(m,{worldRectIsReady:!1}),m.externElement&&((p=m.onResize)==null||p.call(m,m)),(g=m.children)!=null&&g.length&&di(m,this.store).forEach(T=>{var b;T.externElement&&((b=T.onResize)==null||b.call(T,T))})})}else l.left?(c=-c,l.leftValue&&(c+=Math.abs(l.leftValue)<1?l.leftValue*this.canvas.width:l.leftValue),this.translatePens(h,c,0)):l.right&&(l.rightValue&&(c=c-(Math.abs(l.rightValue)<1?l.rightValue*this.canvas.width:l.rightValue)),this.translatePens(h,c,0))});const s=this.store.data.pens.filter(l=>l.name==="iframe");s==null||s.forEach(l=>{var c,u;const h=l.calculative.worldRect;if(h.width/this.store.data.scale>t.width*.8){let d=h.width;l.calculative.worldRect.x=h.x-i/2,l.calculative.worldRect.width=h.width+i,l.calculative.worldRect.ex=h.ex+i,l.operationalRect.x=l.operationalRect.x*d/l.calculative.worldRect.width,l.operationalRect.width=(l.calculative.worldRect.width-(1-l.operationalRect.width)*d)/l.calculative.worldRect.width,(c=l.onBeforeValue)==null||c.call(l,l,{operationalRect:l.operationalRect}),(u=l.onResize)==null||u.call(l,l)}});const o=this.store.data.pens.filter(l=>l.name==="video");o==null||o.forEach(l=>{var c;const h=l.calculative.worldRect;h.width/this.store.data.scale>t.width*.8&&(l.calculative.worldRect.x=h.x-i/2,l.calculative.worldRect.width=h.width+i,l.calculative.worldRect.ex=h.ex+i,(c=l.onResize)==null||c.call(l,l))})}if(Math.abs(r)>10){(a=this.store.data.fits)==null||a.forEach(l=>{let h=[];l.children.forEach(u=>{this.store.pens[u]&&(this.store.pens[u].locked=jt.None,h.push(this.store.pens[u]))});let c=r/2;if(l.top&&l.bottom){let u=l.topValue,d=l.bottomValue;u?u=Math.abs(u)<1?u*this.canvas.height:u:u=0,d?d=Math.abs(d)<1?d*this.canvas.height:d:d=0;let f=(this.canvas.height-u-d)/t.height;h.forEach(m=>{var p,g;m.image&&m.imageRatio&&m.calculative.worldRect.height/this.canvas.height>.1&&(m.imageRatio=!1,m.ratio=!1),m.calculative.worldRect.y=t.y-r/2+u+(m.calculative.worldRect.y-t.y)*f,m.calculative.worldRect.height*=f,m.calculative.worldRect.ey=m.calculative.worldRect.y+m.calculative.worldRect.height,m.calculative.height=m.calculative.worldRect.height,m.calculative.y=m.calculative.worldRect.y,m.height=m.calculative.worldRect.height,m.y=m.calculative.worldRect.y,this.canvas.updatePenRect(m,{worldRectIsReady:!1}),m.externElement&&((p=m.onResize)==null||p.call(m,m)),(g=m.children)!=null&&g.length&&di(m,this.store).forEach(T=>{var b;T.externElement&&((b=T.onResize)==null||b.call(T,T))})})}else l.top?(c=-c,l.topValue&&(c+=Math.abs(l.topValue)<1?l.topValue*this.canvas.height:l.topValue),this.translatePens(h,0,c)):l.bottom&&(l.bottomValue&&(c=c-(Math.abs(l.bottomValue)<1?l.bottomValue*this.canvas.height:l.bottomValue)),this.translatePens(h,0,c))});const s=this.store.data.pens.filter(l=>l.name==="iframe");s==null||s.forEach(l=>{var c,u;const h=l.calculative.worldRect;if(h.height/this.store.data.scale>t.height*.8){let d=h.height;l.calculative.worldRect.y=h.y-r/2,l.calculative.worldRect.height=h.height+r,l.calculative.worldRect.ey=h.ey+r,l.operationalRect.y=l.operationalRect.y*d/l.calculative.worldRect.width,l.operationalRect.height=(l.calculative.worldRect.height-(1-l.operationalRect.height)*d)/l.calculative.worldRect.height,(c=l.onBeforeValue)==null||c.call(l,l,{operationalRect:l.operationalRect}),(u=l.onResize)==null||u.call(l,l)}});const o=this.store.data.pens.filter(l=>l.name==="video");o==null||o.forEach(l=>{var c;const h=l.calculative.worldRect;h.height/this.store.data.scale>t.height*.8&&(l.calculative.worldRect.y=h.y-r/2,l.calculative.worldRect.height=h.height+r,l.calculative.worldRect.ey=h.ey+r,(c=l.onResize)==null||c.call(l,l))})}this.canvas.canvasTemplate.fit=!0,this.canvas.canvasTemplate.init(),this.canvas.canvasImage.init(),this.canvas.canvasImageBottom.init(),this.render(!0)}trimPens(){let t=this.store.data.pens.filter(i=>i.name==="line"&&i.anchors.length<2);this.delete(t)}fitTemplateView(t=!0,i=10){if(!this.hasView())return;const{canvas:r}=this.canvas,{offsetWidth:n,offsetHeight:a}=r,s=Rr(i),o=this.getRect(),l=(n-s[1]-s[3])/o.width,h=(a-s[0]-s[2])/o.height;let c=l;t?c=l>h?h:l:c=l>h?l:h,this.canvas.templateScale(c*this.store.data.scale);let u=this.getRect(),d=this.store.data.pens.filter(f=>!f.parentId);this.canvas.templateTranslatePens(d,-u.x,-u.y),this.store.data.pens.forEach(f=>{f.type?this.canvas.initLineRect(f):this.canvas.updateLines(f)}),this.centerView()}fitSizeView(t=!0,i=10,r=!0){var f,m;const{canvas:n}=this.canvas,{offsetWidth:a,offsetHeight:s}=n;this.resize(a,s);const o=Rr(i),l=(this.store.data.width||this.store.options.width)*this.store.data.scale,h=(this.store.data.height||this.store.options.height)*this.store.data.scale,c=(a-o[1]-o[3])/l,u=(s-o[0]-o[2])/h;let d=c;t==="width"?d=c:t==="height"?d=u:t?d=c>u?u:c:d=c>u?c:u,(f=this.store.data.fits)!=null&&f.length&&(this.canvas.opening=!0),this.scale(d*this.store.data.scale),this.centerSizeView(),r&&((m=this.store.data.fits)!=null&&m.length)&&this.fillView()}centerSizeView(){const t=this.getViewCenter(),i=this.store.data.width||this.store.options.width,r=this.store.data.height||this.store.options.height,n={x:0,y:0,width:i,height:r};ne(n);const{center:a}=n,{scale:s,origin:o,x:l,y:h}=this.store.data;this.translate((t.x-o.x)/s-a.x-l/s,(t.y-o.y)/s-a.y-h/s);const{canvas:c}=this.canvas,u=(c.scrollWidth-c.offsetWidth)/2,d=(c.scrollHeight-c.offsetHeight)/2;c.scrollTo(u,d)}scrollView(t=10,i=!1){if(!this.hasView()||!this.canvas.scroll)return;const{canvas:r}=this.canvas,{offsetWidth:n,offsetHeight:a}=r;this.resize(n,a);const s=Rr(t);let o=null;const l=this.store.data.width||this.store.options.width,h=this.store.data.height||this.store.options.height;l&&h?o={width:l*this.store.data.scale,height:h*this.store.data.scale}:o=this.getRect();const c=(n-s[1]-s[3])/o.width;this.scale(c*this.store.data.scale),this.topView(s[0]),i&&this.canvas.scroll.changeMode(s[0])}screenView(t=10,i=!0){if(!this.hasView())return;const{canvas:r}=this.canvas,{offsetWidth:n,offsetHeight:a}=r;this.resize(n,a);const s=Rr(t),o=this.getRect();let l=(n-s[1]-s[3])/o.width;i||(l=(a-s[0]-s[2])/o.height),this.scale(l*this.store.data.scale),this.topView(s[0])}topView(t=10){if(!this.hasView())return;const i=this.getRect(),r=this.getViewCenter(),n=this.store.data.width||this.store.options.width,a=this.store.data.height||this.store.options.height;let s=null;n&&a?s={x:0,y:0,width:n,height:a}:s=this.getPenRect(i),ne(s);const{center:o}=s,{scale:l,origin:h,x:c,y:u}=this.store.data;this.translate((r.x-h.x)/l-o.x-c/l,(t-h.y)/l-s.y-u/l);const{canvas:d}=this.canvas,f=(d.scrollWidth-d.offsetWidth)/2,m=(d.scrollHeight-d.offsetHeight)/2;d.scrollTo(f,m)}centerView(){if(!this.hasView())return;const t=this.getRect(),i=this.getViewCenter(),r=this.getPenRect(t);ne(r);const{center:n}=r,{scale:a,origin:s,x:o,y:l}=this.store.data;this.translate((i.x-s.x)/a-n.x-o/a,(i.y-s.y)/a-n.y-l/a);const{canvas:h}=this.canvas,c=(h.scrollWidth-h.offsetWidth)/2,u=(h.scrollHeight-h.offsetHeight)/2;h.scrollTo(c,u)}hasView(){return!!this.store.data.pens.filter(t=>!t.isRuleLine).length}getViewCenter(){const{width:t,height:i}=this.canvas;return{x:t/2,y:i/2}}beSameByFirst(t=this.store.data.pens,i){const r=lt(t),n=t[0],{width:a,height:s}=this.getPenRect(n);for(let o=1;o<t.length;o++){const l=t[o];i==="width"?this.setValue({id:l.id,width:a},{render:!1,doEvent:!1}):i==="height"?this.setValue({id:l.id,height:s},{render:!1,doEvent:!1}):this.setValue({id:l.id,width:a,height:s},{render:!1,doEvent:!1})}this.render(),this.pushHistory({type:_t.Update,initPens:r,pens:t})}beSameByLast(t=this.store.data.pens,i){const r=lt(t),n=t[t.length-1],{width:a,height:s}=this.getPenRect(n);for(let o=0;o<t.length-1;o++){const l=t[o];i==="width"?this.setValue({id:l.id,width:a},{render:!1,doEvent:!1}):i==="height"?this.setValue({id:l.id,height:s},{render:!1,doEvent:!1}):this.setValue({id:l.id,width:a,height:s},{render:!1,doEvent:!1})}this.render(),this.pushHistory({type:_t.Update,initPens:r,pens:t})}formatPainterByFirst(t=this.store.data.pens){const i=lt(t),r=t[0],n={};rs.forEach(a=>{n[a]=r[a]});for(let a=1;a<t.length;a++){const s=t[a];this.setValue({id:s.id,...Lc,...n},{render:!1,doEvent:!1})}this.render(),this.pushHistory({type:_t.Update,initPens:i,pens:t})}formatPainterByLast(t=this.store.data.pens){const i=lt(t),r=t[t.length-1],n={};rs.forEach(a=>{n[a]=r[a]});for(let a=0;a<t.length-1;a++){const s=t[a];this.setValue({id:s.id,...Lc,...n},{render:!1,doEvent:!1})}this.render(),this.pushHistory({type:_t.Update,initPens:i,pens:t})}setFormatPainter(){const t=this.store.active,i={};if(t.length>0){const r=t[0];rs.forEach(n=>{i[n]=r[n]!==void 0?r[n]:this.store.options.defaultFormat[n]||this.store.data[n]||this.store.options[n]})}else rs.forEach(r=>{this.store.options.defaultFormat[r]||this.store.data[r]||this.store.options[r]});localStorage.setItem("meta2d-formatPainter",JSON.stringify(i))}formatPainter(){const t=this.store.active,i=lt(t),r=JSON.parse(localStorage.getItem("meta2d-formatPainter"));for(let n=0;n<t.length;n++){const a=t[n];this.setValue({id:a.id,...Lc,...r},{render:!1,doEvent:!1})}this.render(),this.pushHistory({type:_t.Update,initPens:i,pens:t})}clearFormatPainter(){const t=this.store.active,i=lt(t);rs.forEach(r=>{for(let n=0;n<t.length;n++){const a=t[n],{fontSize:s,lineHeight:o}=this.store.options;r==="lineWidth"?(a.lineWidth=1,a.calculative.lineWidth=1):r==="fontSize"?(a.fontSize=s,a.calculative.fontSize=s):r==="lineHeight"?(a.lineHeight=o,a.calculative.lineHeight=o):(delete a[r],delete a.calculative[r])}}),this.render(),this.pushHistory({type:_t.Update,initPens:i,pens:t})}alignNodes(t,i=this.store.data.pens,r){!r&&(r=this.getPenRect(this.getRect(i)));const n=lt(i);for(const a of i)this.alignPen(t,a,r);this.initImageCanvas(i),this.initTemplateCanvas(i),this.render(),this.pushHistory({type:_t.Update,initPens:n,pens:i})}alignNodesV(t,i=this.store.data.pens,r=!1){const n=this.store.data.width||this.store.options.width,a=this.store.data.height||this.store.options.height;let s={x:0,y:0,width:n,height:a};const o=lt(i);if(r){const l=this.store.data.scale,h=this.getRect(i),c=(h.x-this.store.data.origin.x)/l,u=(h.y-this.store.data.origin.y)/l,d=h.width/l,f=h.height/l;let m=0,p=0;switch(t){case"left":m=-c;break;case"right":m=n-(c+d);break;case"top":p=-u;break;case"bottom":p=a-(u+f);break;case"center":m=n/2-(c+d/2);break;case"middle":p=a/2-(u+f/2);break}this.translatePens(i,m*l,p*l)}else for(const l of i)this.alignPen(t,l,s);this.initImageCanvas(i),this.initTemplateCanvas(i),this.render(),this.pushHistory({type:_t.Update,initPens:o,pens:i})}alignNodesByFirst(t,i=this.store.data.pens){const r=lt(i),n=i[0],a=this.getPenRect(n);for(let s=1;s<i.length;s++){const o=i[s];this.alignPen(t,o,a)}this.initImageCanvas(i),this.initTemplateCanvas(i),this.render(),this.pushHistory({type:_t.Update,initPens:r,pens:i})}alignNodesByLast(t,i=this.store.data.pens){const r=lt(i),n=i[i.length-1],a=this.getPenRect(n);for(let s=0;s<i.length-1;s++){const o=i[s];this.alignPen(t,o,a)}this.initImageCanvas(i),this.initTemplateCanvas(i),this.render(),this.pushHistory({type:_t.Update,initPens:r,pens:i})}alignPen(t,i,r){const n=this.getPenRect(i);switch(t){case"left":n.x=r.x;break;case"right":n.x=r.x+r.width-n.width;break;case"top":n.y=r.y;break;case"bottom":n.y=r.y+r.height-n.height;break;case"center":n.x=r.x+r.width/2-n.width/2;break;case"middle":n.y=r.y+r.height/2-n.height/2;break}this.setValue({id:i.id,...n},{render:!1,doEvent:!1})}spaceBetweenByDirection(t,i=this.store.data.pens,r){if(!r){let h=1/0,c=-1/0,u=t==="width"?"x":"y";i.forEach(d=>{h=Math.min(h,d.calculative.worldRect[u]),c=Math.max(c,d.calculative.worldRect["e"+u])}),r=(c-h)/this.store.data.scale}if(i=i.filter(h=>!h.parentId),i.length<=2)return;const n=lt(i),a=i.reduce((h,c)=>{const u=this.getPenRect(c);return h+u[t]},0),s=(r-a)/(i.length-1);i=i.sort((h,c)=>t==="width"?h.x-c.x:h.y-c.y);const o=this.getPenRect(i[0]);let l=t==="width"?o.x:o.y;for(const h of i){const c=this.getPenRect(h);t==="width"?c.x=l:c.y=l,l+=c[t]+s,this.setValue({id:h.id,...c},{render:!1,doEvent:!1})}this.initImageCanvas(i),this.initTemplateCanvas(i),this.render(),this.pushHistory({type:_t.Update,initPens:n,pens:i})}spaceBetween(t,i){this.spaceBetweenByDirection("width",t,i)}spaceBetweenColumn(t,i){this.spaceBetweenByDirection("height",t,i)}layout(t=this.store.data.pens,i,r=30){const n=this.getPenRect(Di(t));!i&&(i=n.width),t=t.filter(h=>!h.type&&!h.parentId);const a=lt(t);let s=0;t.forEach(h=>{const c=this.getPenRect(h);c.height>s&&(s=c.height)});let o=n.x,l=n.y;t.forEach((h,c)=>{const u=this.getPenRect(h);if(u.x=o,u.y=l+s/2-u.height/2,this.setValue({id:h.id,...u},{render:!1,doEvent:!1}),c===t.length-1)return;const d=o+u.width-n.x,f=this.getPenRect(t[c+1]);Math.round(i-d)>=Math.round(f.width+r)?o+=u.width+r:(o=n.x,l+=s+r)}),this.initImageCanvas(t),this.initTemplateCanvas(t),this.render(),this.pushHistory({type:_t.Update,initPens:a,pens:t})}gotoView(t){const i=this.getViewCenter(),r=i.x-t.calculative.worldRect.x-t.calculative.worldRect.width/2,n=i.y-t.calculative.worldRect.y-t.calculative.worldRect.height/2;this.canvas.scroll&&this.canvas.scroll.isShow&&this.canvas.scroll.translate(r-this.store.data.x,n-this.store.data.y),this.store.data.x=r,this.store.data.y=n;for(const a of this.store.data.pens)kr(a);this.canvas.canvasImage.init(),this.canvas.canvasImageBottom.init(),this.render()}showMap(){this.map||(this.map=new xE(this.canvas)),this.map.show()}hideMap(){this.map.hide()}onSizeUpdate(){this.mapTimer&&(clearTimeout(this.mapTimer),this.mapTimer=void 0),this.mapTimer=setTimeout(()=>{this.map&&this.map.isShow&&this.map.show(),this.canvas&&this.canvas.scroll&&this.canvas.scroll.isShow&&this.canvas.scroll.resize()},500)}toggleAnchorMode(){this.canvas.toggleAnchorMode()}addAnchorHand(){this.canvas.addAnchorHand()}removeAnchorHand(){this.canvas.removeAnchorHand()}toggleAnchorHand(){this.canvas.toggleAnchorHand()}top(t){t||(t=this.store.active),Array.isArray(t)||(t=[t]);for(const i of t){const r=this.store.data.pens,n=[...di(i,this.store),i].map(s=>s.id);r.filter(s=>n.includes(s.id)).forEach(s=>{const o=r.findIndex(l=>l.id===s.id);o>-1&&(r.push(r[o]),r.splice(o,1),this.initTemplateCanvas([s]),this.initImageCanvas([s])),this.specificLayerMove(s,"top")})}this.store.emitter.emit("layer",{type:"top",pens:t})}initImageCanvas(t){this.canvas&&this.canvas.initImageCanvas(t)}initTemplateCanvas(t){this.canvas&&this.canvas.initTemplateCanvas(t)}bottom(t){t||(t=this.store.active),Array.isArray(t)||(t=[t]);for(const i of t){const r=this.store.data.pens,n=[...di(i,this.store),i].map(s=>s.id),a=r.filter(s=>n.includes(s.id));for(let s=a.length-1;s>=0;s--){const o=a[s],l=r.findIndex(h=>h.id===o.id);l>-1&&(r.unshift(r[l]),r.splice(l+1,1),this.initTemplateCanvas([o]),this.initImageCanvas([o])),this.specificLayerMove(o,"bottom")}}this.store.emitter.emit("layer",{type:"bottom",pens:t})}upByArea(t){if(this.store.data.pens.findIndex(l=>l.id===t.id)===-1){console.warn("upByArea: pen not in canvas");return}const r=[t,...di(t,this.store)];let n=r.map(l=>this.store.data.pens.findIndex(h=>h.id===l.id));n.includes(-1)&&(console.warn("upByArea: pen children not in canvas"),n=n.filter(l=>l!==-1));const a=Math.min(...n),s=t.calculative.worldRect,o=this.store.data.pens.findIndex((l,h)=>{if(h<=a||l.id===t.id||Qb(l,t))return!1;const c=l.calculative.worldRect;return Dr(s,c)});if(o===-1){this.up(t);return}this.store.data.pens.splice(o+1,0,...r);for(const l of r){const h=this.store.data.pens.findIndex(c=>c.id===l.id);h>-1&&this.store.data.pens.splice(h,1)}this.initImageCanvas([t])}specificLayerMove(t,i){var r;if(t.image&&t.name!=="gif"){let n=Ht.CanvasImageBottom;i==="top"?n=Ht.CanvasImage:(i==="up"||i==="down")&&(n=Ht.CanvasMain),this.setValue({id:t.id,canvasLayer:n},{render:!1,doEvent:!1,history:!1})}else if(t.externElement||t.name==="gif"){let n=0;i==="top"?(t.calculative.canvas.maxZindex+=1,n=t.calculative.canvas.maxZindex):i==="up"?n=t.calculative.zIndex===void 0?6:t.calculative.zIndex+1:i==="down"&&(n=t.calculative.zIndex===void 0?3:t.calculative.zIndex-1,n<0&&(n=0)),this.setValue({id:t.id,zIndex:n},{render:!1,doEvent:!1,history:!1}),(r=t.calculative.singleton)!=null&&r.div&&Se(t,t.calculative.singleton.div)}}up(t){t||(t=this.store.active),Array.isArray(t)||(t=[t]);for(const i of t){const r=this.store.data.pens;if(i.children&&i.children.length){const n=[...di(i,this.store),i],a=[];for(let l=0;l<r.length;l++){const h=r[l];n.findIndex(c=>c.id===h.id)!==-1&&(h.temIndex=l,a.push(h))}let s=-1,o=0;a.forEach(l=>{l.temIndex-=o,r.splice(l.temIndex,1),o+=1,s=l.temIndex,delete l.temIndex,this.specificLayerMove(l,"up")}),r.splice(s+1,0,...a),this.initTemplateCanvas(a),this.initImageCanvas(a)}else{const n=r.findIndex(a=>a.id===i.id);n>-1&&n!==r.length-1&&(r.splice(n+2,0,r[n]),r.splice(n,1),this.initTemplateCanvas([i]),this.initImageCanvas([i])),this.specificLayerMove(i,"up")}}this.store.emitter.emit("layer",{type:"up",pens:t})}down(t){t||(t=this.store.active),Array.isArray(t)||(t=[t]);for(const i of t){const r=this.store.data.pens;if(i.children&&i.children.length){const n=[...di(i,this.store),i],a=[];for(let l=0;l<r.length;l++){const h=r[l];n.findIndex(c=>c.id===h.id)!==-1&&(h.temIndex=l,a.push(h))}let s=-1,o=0;a.forEach((l,h)=>{l.temIndex-=o,r.splice(l.temIndex,1),o+=1,h===0&&(s=l.temIndex),delete l.temIndex,this.specificLayerMove(l,"down")}),r.splice(s-1,0,...a),this.initTemplateCanvas(a),this.initImageCanvas(a)}else{const n=r.findIndex(a=>a.id===i.id);n>-1&&n!==0&&(r.splice(n-1,0,r[n]),r.splice(n+1,1),this.initTemplateCanvas([i]),this.initImageCanvas([i])),this.specificLayerMove(i,"down")}}this.store.emitter.emit("layer",{type:"down",pens:t})}setLayer(t,i,r=this.store.data.pens){const n=r.findIndex(a=>a.id===t.id);n>-1&&(n>i?(r.splice(i,0,r[n]),r.splice(n+1,1)):n<i&&(r.splice(i,0,r[n]),r.splice(n,1))),this.initTemplateCanvas([t]),this.initImageCanvas([t])}changePenId(t,i){this.canvas.changePenId(t,i)}getLines(t,i="all"){var n;if(t.type===$t.Line)return[];const r=[];return(n=t.connectedLines)==null||n.forEach(({lineId:a})=>{const s=this.store.pens[a];if(!s){console.warn(t,"node contain a error connectedLine");return}if(!r.find(o=>o.id===s.id))switch(i){case"all":r.push(s);break;case"in":Gt(s).connectTo===t.id&&r.push(s);break;case"out":ge(s).connectTo===t.id&&r.push(s);break}}),r}nextNode(t){if(t.type===$t.Line){const i=this.store.pens[Gt(t).connectTo];return i?[i]:[]}else{const i=this.getLines(t,"out"),r=[];return i.forEach(n=>{const a=this.nextNode(n);for(const s of a)!r.find(l=>l.id===s.id)&&r.push(s)}),r}}previousNode(t){if(t.type===$t.Line){const i=this.store.pens[ge(t).connectTo];return i?[i]:[]}else{const i=this.getLines(t,"in"),r=[];return i.forEach(n=>{const a=this.previousNode(n);for(const s of a)!r.find(l=>l.id===s.id)&&r.push(s)}),r}}getNext(t){var r;if(t.type===$t.Line){console.warn("非连线节点");return}const i=[];return(r=t.connectedLines)==null||r.forEach(({lineId:n,anchor:a})=>{var l,h;const s=(l=t.anchors)==null?void 0:l.filter(c=>c.id===a)[0],o=this.findOne(n);if(o.anchors[0].connectTo==t.id){const c=o.anchors[o.anchors.length-1].connectTo;if(c){const u=this.findOne(c),d=(h=u.connectedLines)==null?void 0:h.filter(m=>m.lineId===o.id)[0],f=u.anchors.filter(m=>m.id===d.anchor)[0];i.push({from:t,fromAnchor:s,line:o,to:u,toAnchor:f})}}}),i}addAnchor(t,i,r){if(!t)return;if(t.anchors||(t.anchors=[]),t.calculative.worldAnchors||(t.calculative.worldAnchors=[]),t.type===$t.Line&&(r<0&&(r=t.anchors.length+1+r),r>t.anchors.length&&(r=t.anchors.length),r<0&&(r=0),r==0&&t.anchors[0].connectTo||r==t.anchors.length&&t.anchors[r-1].connectTo)){console.warn("端点存在连接关系");return}let n=null,a=null;i.x<=1&&i.x>=0&&i.y<=1&&i.y>=0?(a={id:i.id||Mt(),penId:t.id,x:t.calculative.worldRect.x+t.calculative.worldRect.width*i.x,y:t.calculative.worldRect.y+t.calculative.worldRect.height*i.y},t.calculative.worldRect&&t.rotate%360&&Zt(a,t.rotate,t.calculative.worldRect.center),n={id:a.id,penId:t.id,x:i.x,y:i.y}):(a={id:i.id||Mt(),penId:t.id,x:i.x,y:i.y},t.calculative.worldRect&&(t.rotate%360&&Zt(i,-t.rotate,t.calculative.worldRect.center),n={id:a.id,penId:t.id,x:(i.x-t.calculative.worldRect.x)/t.calculative.worldRect.width,y:(i.y-t.calculative.worldRect.y)/t.calculative.worldRect.height})),t.type===$t.Line?(t.calculative.worldAnchors.splice(r,0,a),t.anchors.splice(r,0,n),this.canvas.updateLines(t),this.canvas.initLineRect(t),this.render()):(t.calculative.worldAnchors.push(a),t.anchors.push(n))}connectLine(t,i,r,n,a=!0){if(!r){const h=i.calculative.worldRect;r=ma(t,{x:h.x+h.width/2,y:h.y+h.height/2})}if(!n){const h=t.calculative.worldRect;n=ma(i,{x:h.x+h.width/2,y:h.y+h.height/2})}const s=Math.abs(r.x-n.x),l={height:Math.abs(r.y-n.y),lineName:"line",lineWidth:1,name:"line",type:1,width:s,x:Math.min(r.x,n.x),y:Math.min(r.y,n.y),anchors:[{x:r.x>n.x?1:0,y:r.y>n.y?1:0,id:Mt()},{x:r.x>n.x?0:1,y:r.x>n.x?0:1,id:Mt()}]};return this.addPens([l]),Oe(t,r,l,l.calculative.worldAnchors[0]),Oe(i,n,l,l.calculative.worldAnchors[1]),l.calculative.active=!1,this.canvas.updateLines(l),this.canvas.updateLines(t),this.canvas.updateLines(i),this.canvas.initLineRect(l),a&&this.render(),l}toComponent(t=this.store.data.pens,i,r){if(t.length===1){const c=lt(t[0]);return c.type=$t.Node,c.id=void 0,[c]}const n=lt(t,!0),a=Di(n);let s={id:Mt(),name:"combine",...a,children:[],showChild:i};r&&(s.anchors=[{id:"0",penId:s.id,x:.5,y:0},{id:"1",penId:s.id,x:1,y:.5},{id:"2",penId:s.id,x:.5,y:1},{id:"3",penId:s.id,x:0,y:.5}]);const o=n.filter(c=>!c.parentId),l=n.find(c=>c.width===a.width&&c.height===a.height),h=l&&i===void 0;return o.length===1?s=o[0]:h&&(l.children||(l.children=[]),s=l),n.forEach(c=>{if(c===s||c.parentId===s.id||c.parentId)return;s.children.push(c.id),c.parentId=s.id;const u=Jr(c.calculative.worldRect,a);Object.assign(c,u),c.locked=c.lockedOnCombine??jt.DisableMove}),h||o.length===1?lt(n):lt([s,...n])}installPenPlugins(t,i){if(!t.tag&&!t.name&&!t.id)return;let r;t.id?r="id":t.tag?r="tag":t.name&&(r="name"),i.forEach(n=>{let a=n.plugin,s=n.options;if(a&&zw(a)&&r)if(a.install(t,s),!this.penPluginMap.has(a))this.penPluginMap.set(a,[{[r]:t[r],option:s}]);else{let o=this.penPluginMap.get(a).find(l=>l[r]===t[r]);o?o.option=s:this.penPluginMap.get(a).push({[r]:t[r],option:s})}})}uninstallPenPlugins(t,i){let r;t.id?r="id":t.tag?r="tag":t.name&&(r="name"),r&&i.forEach(n=>{let a=n.plugin;a.uninstall(t,n.options);let s=this.penPluginMap.get(a),o=s.findIndex(l=>l[r]===t[r]);o!==-1&&(s.splice(o,1),s.length===0&&this.penPluginMap.delete(a))})}setVisible(t,i,r=!0){if(this.onSizeUpdate(),this.setValue({id:t.id,visible:i},{render:!1,doEvent:!1}),t.children)for(const a of t.children){const s=this.store.pens[a];s&&this.setVisible(s,i,!1)}let n=di(t,this.store);n.push(t),this.initImageCanvas(n),r&&this.render()}clearHover(){this.canvas.clearHover()}closeSocket(){this.closeWebsocket(),this.closeMqtt(),this.closeHttp()}destroy(t){if(this.clear(!1),zT(),this.stopDataMock(),this.closeSocket(),this.closeNetwork(),this.closeAll(),us.destroyThemeSheet(this.store.id),this.store.emitter.all.clear(),this.canvas.destroy(),this.canvas=void 0,St[this.store.id]=void 0,!t){for(const i in St)delete St[i];St.path2dDraws={},St.canvasDraws={},St.anchors={},St.htmlElements={}}}}const UE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";function FE(e=16,t=UE){let i="",r=e;const n=t.length;for(;r--;)i+=t[Math.random()*n|0];return i}const $r={A:{nameText:"加速度",valueText:"测点值（m/s²）"},V:{nameText:"速度",valueText:"测点值（m/s）"},D:{nameText:"位移",valueText:"测点值（m）"},T:{nameText:"温度",valueText:"测点值（°C）"}};function Fo(e,t,i,r,n={}){const a=(n==null?void 0:n.id)||Mt(),s=(n==null?void 0:n.dataId)||"",o=(n==null?void 0:n.tags)||[],[l,h,c,u,d,f,m]=Array.from({length:7},()=>Mt()),p=`point-combine-${FE(6)}`,g=D=>`__${p}_${D}`,y=[g("textColor"),g("fontFamily"),g("fontSize"),g("fontWeight"),g("fontStyle"),g("textAlign"),g("textBaseline"),g("valueTextColor")],T=s?[...y,`${s}__value`]:y,b=[g("textColor"),g("fontFamily"),g("fontSize"),g("fontWeight"),g("fontStyle"),g("textAlign"),g("textBaseline")],S=s?[...b,`${s}__time`]:b;return[{id:a,dataId:s,tags:o,width:120,height:100,name:p,children:[l,h,c,u,d,f,m]},{id:l,tags:[g("color"),g("background"),g("dash"),g("borderRadius"),g("globalAlpha"),g("border")],x:0,y:0,width:1,height:1,name:"rectangle",disableInput:!0,borderRadius:.05,background:"#FFB65D",globalAlpha:.75},{x:0,y:0,width:1,height:.25,id:h,tags:[g("textColor"),g("fontFamily"),g("fontSize"),g("fontWeight"),g("fontStyle"),g("textAlign"),g("textBaseline")],name:"text",text:e,disableInput:!0,disableRotate:!0,disableSize:!0,disableAnchor:!0},{x:0,y:.25,width:1,height:.25,id:c,tags:[g("textColor"),g("fontFamily"),g("fontSize"),g("fontWeight"),g("fontStyle"),g("textAlign"),g("textBaseline")],name:"text",text:t,disableInput:!0,disableRotate:!0,disableSize:!0,disableAnchor:!0},{x:0,y:.5,width:1,height:.25,id:u,tags:T,name:"text",text:i,disableInput:!0,disableRotate:!0,disableSize:!0,disableAnchor:!0},{x:0,y:.75,width:1,height:.25,id:d,tags:S,name:"text",text:r,disableInput:!0,disableRotate:!0,disableSize:!0,disableAnchor:!0},{x:0,y:.24,width:1,height:.001,id:f,tags:[g("color"),g("border")],name:"line",disableRotate:!0,disableSize:!0,disableAnchor:!0},{x:.15,y:.325,width:.1,height:.1,id:m,tags:[g("signalBackground")],name:"circle",background:"#00B42A",color:"#00B42A",disableInput:!0,disableRotate:!0,disableSize:!0,disableAnchor:!0}]}Mt(),Fo("测点名称",$r.A.nameText,$r.A.valueText,"时间"),Mt(),Fo("测点名称",$r.V.nameText,$r.V.valueText,"时间"),Mt(),Fo("测点名称",$r.D.nameText,$r.D.valueText,"时间"),Mt(),Fo("测点名称",$r.T.nameText,$r.T.valueText,"时间");var BE=(e=>(e.DARK="#434345",e.LIGHT="#E4E4E6",e))(BE||{}),jE=(e=>(e.DARK="#5A4F4F",e.LIGHT="#4E5969",e))(jE||{}),WE=(e=>(e.DARK="#F6F6F6",e.LIGHT="#1D2129",e))(WE||{}),zE=(e=>(e.DARK="#182033",e.LIGHT="#fbfbff",e))(zE||{});const VE=()=>Zs.value?"#434345":"#E4E4E6",HE=()=>Zs.value?"#5A4F4F":"#4E5969",YE=()=>Zs.value?"#F6F6F6":"#1D2129",qE=()=>Zs.value?"#182033":"#fbfbff",KE=()=>Zs.value?"#798395":"#4E5969";function B2(){return{width:1920,height:1080,grid:!0,gridColor:VE(),gridSize:15,x:0,y:0,strictScope:!0,rule:!0,ruleColor:HE(),ruleOptions:{height:15,textColor:KE(),textTop:6,textLeft:-25},color:YE(),disableScale:!0,background:qE(),activeColor:"#1677ff",hoverColor:"#A871E3"}}function uv(e,t){return function(){return e.apply(t,arguments)}}const{toString:GE}=Object.prototype,{getPrototypeOf:yu}=Object,{iterator:tc,toStringTag:dv}=Symbol,ec=(e=>t=>{const i=GE.call(t);return e[i]||(e[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Li=e=>(e=e.toLowerCase(),t=>ec(t)===e),ic=e=>t=>typeof t===e,{isArray:Va}=Array,Pa=ic("undefined");function io(e){return e!==null&&!Pa(e)&&e.constructor!==null&&!Pa(e.constructor)&&si(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const fv=Li("ArrayBuffer");function $E(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&fv(e.buffer),t}const XE=ic("string"),si=ic("function"),mv=ic("number"),ro=e=>e!==null&&typeof e=="object",QE=e=>e===!0||e===!1,tl=e=>{if(ec(e)!=="object")return!1;const t=yu(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(dv in e)&&!(tc in e)},JE=e=>{if(!ro(e)||io(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},ZE=Li("Date"),t_=Li("File"),e_=Li("Blob"),i_=Li("FileList"),r_=e=>ro(e)&&si(e.pipe),n_=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||si(e.append)&&((t=ec(e))==="formdata"||t==="object"&&si(e.toString)&&e.toString()==="[object FormData]"))},a_=Li("URLSearchParams"),[s_,o_,l_,c_]=["ReadableStream","Request","Response","Headers"].map(Li),h_=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function no(e,t,{allOwnKeys:i=!1}={}){if(e===null||typeof e>"u")return;let r,n;if(typeof e!="object"&&(e=[e]),Va(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{if(io(e))return;const a=i?Object.getOwnPropertyNames(e):Object.keys(e),s=a.length;let o;for(r=0;r<s;r++)o=a[r],t.call(null,e[o],o,e)}}function gv(e,t){if(io(e))return null;t=t.toLowerCase();const i=Object.keys(e);let r=i.length,n;for(;r-- >0;)if(n=i[r],t===n.toLowerCase())return n;return null}const Nn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,pv=e=>!Pa(e)&&e!==Nn;function kh(){const{caseless:e,skipUndefined:t}=pv(this)&&this||{},i={},r=(n,a)=>{const s=e&&gv(i,a)||a;tl(i[s])&&tl(n)?i[s]=kh(i[s],n):tl(n)?i[s]=kh({},n):Va(n)?i[s]=n.slice():(!t||!Pa(n))&&(i[s]=n)};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&no(arguments[n],r);return i}const u_=(e,t,i,{allOwnKeys:r}={})=>(no(t,(n,a)=>{i&&si(n)?e[a]=uv(n,i):e[a]=n},{allOwnKeys:r}),e),d_=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),f_=(e,t,i,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},m_=(e,t,i,r)=>{let n,a,s;const o={};if(t=t||{},e==null)return t;do{for(n=Object.getOwnPropertyNames(e),a=n.length;a-- >0;)s=n[a],(!r||r(s,e,t))&&!o[s]&&(t[s]=e[s],o[s]=!0);e=i!==!1&&yu(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},g_=(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;const r=e.indexOf(t,i);return r!==-1&&r===i},p_=e=>{if(!e)return null;if(Va(e))return e;let t=e.length;if(!mv(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},v_=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&yu(Uint8Array)),y_=(e,t)=>{const r=(e&&e[tc]).call(e);let n;for(;(n=r.next())&&!n.done;){const a=n.value;t.call(e,a[0],a[1])}},b_=(e,t)=>{let i;const r=[];for(;(i=e.exec(t))!==null;)r.push(i);return r},w_=Li("HTMLFormElement"),T_=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),xf=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),E_=Li("RegExp"),vv=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),r={};no(i,(n,a)=>{let s;(s=t(n,a,e))!==!1&&(r[a]=s||n)}),Object.defineProperties(e,r)},__=e=>{vv(e,(t,i)=>{if(si(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=e[i];if(si(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},S_=(e,t)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return Va(e)?r(e):r(String(e).split(t)),i},A_=()=>{},x_=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function R_(e){return!!(e&&si(e.append)&&e[dv]==="FormData"&&e[tc])}const k_=e=>{const t=new Array(10),i=(r,n)=>{if(ro(r)){if(t.indexOf(r)>=0)return;if(io(r))return r;if(!("toJSON"in r)){t[n]=r;const a=Va(r)?[]:{};return no(r,(s,o)=>{const l=i(s,n+1);!Pa(l)&&(a[o]=l)}),t[n]=void 0,a}}return r};return i(e,0)},I_=Li("AsyncFunction"),C_=e=>e&&(ro(e)||si(e))&&si(e.then)&&si(e.catch),yv=((e,t)=>e?setImmediate:t?((i,r)=>(Nn.addEventListener("message",({source:n,data:a})=>{n===Nn&&a===i&&r.length&&r.shift()()},!1),n=>{r.push(n),Nn.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",si(Nn.postMessage)),D_=typeof queueMicrotask<"u"?queueMicrotask.bind(Nn):typeof process<"u"&&process.nextTick||yv,O_=e=>e!=null&&si(e[tc]),ot={isArray:Va,isArrayBuffer:fv,isBuffer:io,isFormData:n_,isArrayBufferView:$E,isString:XE,isNumber:mv,isBoolean:QE,isObject:ro,isPlainObject:tl,isEmptyObject:JE,isReadableStream:s_,isRequest:o_,isResponse:l_,isHeaders:c_,isUndefined:Pa,isDate:ZE,isFile:t_,isBlob:e_,isRegExp:E_,isFunction:si,isStream:r_,isURLSearchParams:a_,isTypedArray:v_,isFileList:i_,forEach:no,merge:kh,extend:u_,trim:h_,stripBOM:d_,inherits:f_,toFlatObject:m_,kindOf:ec,kindOfTest:Li,endsWith:g_,toArray:p_,forEachEntry:y_,matchAll:b_,isHTMLForm:w_,hasOwnProperty:xf,hasOwnProp:xf,reduceDescriptors:vv,freezeMethods:__,toObjectSet:S_,toCamelCase:T_,noop:A_,toFiniteNumber:x_,findKey:gv,global:Nn,isContextDefined:pv,isSpecCompliantForm:R_,toJSONObject:k_,isAsyncFn:I_,isThenable:C_,setImmediate:yv,asap:D_,isIterable:O_};function Ft(e,t,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}ot.inherits(Ft,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ot.toJSONObject(this.config),code:this.code,status:this.status}}});const bv=Ft.prototype,wv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{wv[e]={value:e}});Object.defineProperties(Ft,wv);Object.defineProperty(bv,"isAxiosError",{value:!0});Ft.from=(e,t,i,r,n,a)=>{const s=Object.create(bv);ot.toFlatObject(e,s,function(c){return c!==Error.prototype},h=>h!=="isAxiosError");const o=e&&e.message?e.message:"Error",l=t==null&&e?e.code:t;return Ft.call(s,o,l,i,r,n),e&&s.cause==null&&Object.defineProperty(s,"cause",{value:e,configurable:!0}),s.name=e&&e.name||"Error",a&&Object.assign(s,a),s};const M_=null;function Ih(e){return ot.isPlainObject(e)||ot.isArray(e)}function Tv(e){return ot.endsWith(e,"[]")?e.slice(0,-2):e}function Rf(e,t,i){return e?e.concat(t).map(function(n,a){return n=Tv(n),!i&&a?"["+n+"]":n}).join(i?".":""):t}function P_(e){return ot.isArray(e)&&!e.some(Ih)}const N_=ot.toFlatObject(ot,{},null,function(t){return/^is[A-Z]/.test(t)});function rc(e,t,i){if(!ot.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,i=ot.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,g){return!ot.isUndefined(g[p])});const r=i.metaTokens,n=i.visitor||c,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&ot.isSpecCompliantForm(t);if(!ot.isFunction(n))throw new TypeError("visitor must be a function");function h(m){if(m===null)return"";if(ot.isDate(m))return m.toISOString();if(ot.isBoolean(m))return m.toString();if(!l&&ot.isBlob(m))throw new Ft("Blob is not supported. Use a Buffer instead.");return ot.isArrayBuffer(m)||ot.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,p,g){let y=m;if(m&&!g&&typeof m=="object"){if(ot.endsWith(p,"{}"))p=r?p:p.slice(0,-2),m=JSON.stringify(m);else if(ot.isArray(m)&&P_(m)||(ot.isFileList(m)||ot.endsWith(p,"[]"))&&(y=ot.toArray(m)))return p=Tv(p),y.forEach(function(b,S){!(ot.isUndefined(b)||b===null)&&t.append(s===!0?Rf([p],S,a):s===null?p:p+"[]",h(b))}),!1}return Ih(m)?!0:(t.append(Rf(g,p,a),h(m)),!1)}const u=[],d=Object.assign(N_,{defaultVisitor:c,convertValue:h,isVisitable:Ih});function f(m,p){if(!ot.isUndefined(m)){if(u.indexOf(m)!==-1)throw Error("Circular reference detected in "+p.join("."));u.push(m),ot.forEach(m,function(y,T){(!(ot.isUndefined(y)||y===null)&&n.call(t,y,ot.isString(T)?T.trim():T,p,d))===!0&&f(y,p?p.concat(T):[T])}),u.pop()}}if(!ot.isObject(e))throw new TypeError("data must be an object");return f(e),t}function kf(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function bu(e,t){this._pairs=[],e&&rc(e,this,t)}const Ev=bu.prototype;Ev.append=function(t,i){this._pairs.push([t,i])};Ev.toString=function(t){const i=t?function(r){return t.call(this,r,kf)}:kf;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function L_(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _v(e,t,i){if(!t)return e;const r=i&&i.encode||L_;ot.isFunction(i)&&(i={serialize:i});const n=i&&i.serialize;let a;if(n?a=n(t,i):a=ot.isURLSearchParams(t)?t.toString():new bu(t,i).toString(r),a){const s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e}class If{constructor(){this.handlers=[]}use(t,i,r){return this.handlers.push({fulfilled:t,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ot.forEach(this.handlers,function(r){r!==null&&t(r)})}}const Sv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},U_=typeof URLSearchParams<"u"?URLSearchParams:bu,F_=typeof FormData<"u"?FormData:null,B_=typeof Blob<"u"?Blob:null,j_={isBrowser:!0,classes:{URLSearchParams:U_,FormData:F_,Blob:B_},protocols:["http","https","file","blob","url","data"]},wu=typeof window<"u"&&typeof document<"u",Ch=typeof navigator=="object"&&navigator||void 0,W_=wu&&(!Ch||["ReactNative","NativeScript","NS"].indexOf(Ch.product)<0),z_=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",V_=wu&&window.location.href||"http://localhost",H_=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:wu,hasStandardBrowserEnv:W_,hasStandardBrowserWebWorkerEnv:z_,navigator:Ch,origin:V_},Symbol.toStringTag,{value:"Module"})),He={...H_,...j_};function Y_(e,t){return rc(e,new He.classes.URLSearchParams,{visitor:function(i,r,n,a){return He.isNode&&ot.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...t})}function q_(e){return ot.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function K_(e){const t={},i=Object.keys(e);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],t[a]=e[a];return t}function Av(e){function t(i,r,n,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&ot.isArray(n)?n.length:s,l?(ot.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!ot.isObject(n[s]))&&(n[s]=[]),t(i,r,n[s],a)&&ot.isArray(n[s])&&(n[s]=K_(n[s])),!o)}if(ot.isFormData(e)&&ot.isFunction(e.entries)){const i={};return ot.forEachEntry(e,(r,n)=>{t(q_(r),n,i,0)}),i}return null}function G_(e,t,i){if(ot.isString(e))try{return(t||JSON.parse)(e),ot.trim(e)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(e)}const ao={transitional:Sv,adapter:["xhr","http","fetch"],transformRequest:[function(t,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=ot.isObject(t);if(a&&ot.isHTMLForm(t)&&(t=new FormData(t)),ot.isFormData(t))return n?JSON.stringify(Av(t)):t;if(ot.isArrayBuffer(t)||ot.isBuffer(t)||ot.isStream(t)||ot.isFile(t)||ot.isBlob(t)||ot.isReadableStream(t))return t;if(ot.isArrayBufferView(t))return t.buffer;if(ot.isURLSearchParams(t))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Y_(t,this.formSerializer).toString();if((o=ot.isFileList(t))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return rc(o?{"files[]":t}:t,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),G_(t)):t}],transformResponse:[function(t){const i=this.transitional||ao.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(ot.isResponse(t)||ot.isReadableStream(t))return t;if(t&&ot.isString(t)&&(r&&!this.responseType||n)){const s=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(t,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?Ft.from(o,Ft.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:He.classes.FormData,Blob:He.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ot.forEach(["delete","get","head","post","put","patch"],e=>{ao.headers[e]={}});const $_=ot.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),X_=e=>{const t={};let i,r,n;return e&&e.split(`
`).forEach(function(s){n=s.indexOf(":"),i=s.substring(0,n).trim().toLowerCase(),r=s.substring(n+1).trim(),!(!i||t[i]&&$_[i])&&(i==="set-cookie"?t[i]?t[i].push(r):t[i]=[r]:t[i]=t[i]?t[i]+", "+r:r)}),t},Cf=Symbol("internals");function as(e){return e&&String(e).trim().toLowerCase()}function el(e){return e===!1||e==null?e:ot.isArray(e)?e.map(el):String(e)}function Q_(e){const t=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(e);)t[r[1]]=r[2];return t}const J_=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Hc(e,t,i,r,n){if(ot.isFunction(r))return r.call(this,t,i);if(n&&(t=i),!!ot.isString(t)){if(ot.isString(r))return t.indexOf(r)!==-1;if(ot.isRegExp(r))return r.test(t)}}function Z_(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,i,r)=>i.toUpperCase()+r)}function tS(e,t){const i=ot.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+i,{value:function(n,a,s){return this[r].call(this,t,n,a,s)},configurable:!0})})}let oi=class{constructor(t){t&&this.set(t)}set(t,i,r){const n=this;function a(o,l,h){const c=as(l);if(!c)throw new Error("header name must be a non-empty string");const u=ot.findKey(n,c);(!u||n[u]===void 0||h===!0||h===void 0&&n[u]!==!1)&&(n[u||l]=el(o))}const s=(o,l)=>ot.forEach(o,(h,c)=>a(h,c,l));if(ot.isPlainObject(t)||t instanceof this.constructor)s(t,i);else if(ot.isString(t)&&(t=t.trim())&&!J_(t))s(X_(t),i);else if(ot.isObject(t)&&ot.isIterable(t)){let o={},l,h;for(const c of t){if(!ot.isArray(c))throw TypeError("Object iterator must return a key-value pair");o[h=c[0]]=(l=o[h])?ot.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}s(o,i)}else t!=null&&a(i,t,r);return this}get(t,i){if(t=as(t),t){const r=ot.findKey(this,t);if(r){const n=this[r];if(!i)return n;if(i===!0)return Q_(n);if(ot.isFunction(i))return i.call(this,n,r);if(ot.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=as(t),t){const r=ot.findKey(this,t);return!!(r&&this[r]!==void 0&&(!i||Hc(this,this[r],r,i)))}return!1}delete(t,i){const r=this;let n=!1;function a(s){if(s=as(s),s){const o=ot.findKey(r,s);o&&(!i||Hc(r,r[o],o,i))&&(delete r[o],n=!0)}}return ot.isArray(t)?t.forEach(a):a(t),n}clear(t){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!t||Hc(this,this[a],a,t,!0))&&(delete this[a],n=!0)}return n}normalize(t){const i=this,r={};return ot.forEach(this,(n,a)=>{const s=ot.findKey(r,a);if(s){i[s]=el(n),delete i[a];return}const o=t?Z_(a):String(a).trim();o!==a&&delete i[a],i[o]=el(n),r[o]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const i=Object.create(null);return ot.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=t&&ot.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,i])=>t+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...i){const r=new this(t);return i.forEach(n=>r.set(n)),r}static accessor(t){const r=(this[Cf]=this[Cf]={accessors:{}}).accessors,n=this.prototype;function a(s){const o=as(s);r[o]||(tS(n,s),r[o]=!0)}return ot.isArray(t)?t.forEach(a):a(t),this}};oi.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ot.reduceDescriptors(oi.prototype,({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(r){this[i]=r}}});ot.freezeMethods(oi);function Yc(e,t){const i=this||ao,r=t||i,n=oi.from(r.headers);let a=r.data;return ot.forEach(e,function(o){a=o.call(i,a,n.normalize(),t?t.status:void 0)}),n.normalize(),a}function xv(e){return!!(e&&e.__CANCEL__)}function Ha(e,t,i){Ft.call(this,e??"canceled",Ft.ERR_CANCELED,t,i),this.name="CanceledError"}ot.inherits(Ha,Ft,{__CANCEL__:!0});function Rv(e,t,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?e(i):t(new Ft("Request failed with status code "+i.status,[Ft.ERR_BAD_REQUEST,Ft.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function eS(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function iS(e,t){e=e||10;const i=new Array(e),r=new Array(e);let n=0,a=0,s;return t=t!==void 0?t:1e3,function(l){const h=Date.now(),c=r[a];s||(s=h),i[n]=l,r[n]=h;let u=a,d=0;for(;u!==n;)d+=i[u++],u=u%e;if(n=(n+1)%e,n===a&&(a=(a+1)%e),h-s<t)return;const f=c&&h-c;return f?Math.round(d*1e3/f):void 0}}function rS(e,t){let i=0,r=1e3/t,n,a;const s=(h,c=Date.now())=>{i=c,n=null,a&&(clearTimeout(a),a=null),e(...h)};return[(...h)=>{const c=Date.now(),u=c-i;u>=r?s(h,c):(n=h,a||(a=setTimeout(()=>{a=null,s(n)},r-u)))},()=>n&&s(n)]}const Tl=(e,t,i=3)=>{let r=0;const n=iS(50,250);return rS(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-r,h=n(l),c=s<=o;r=s;const u={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:h||void 0,estimated:h&&o&&c?(o-s)/h:void 0,event:a,lengthComputable:o!=null,[t?"download":"upload"]:!0};e(u)},i)},Df=(e,t)=>{const i=e!=null;return[r=>t[0]({lengthComputable:i,total:e,loaded:r}),t[1]]},Of=e=>(...t)=>ot.asap(()=>e(...t)),nS=He.hasStandardBrowserEnv?((e,t)=>i=>(i=new URL(i,He.origin),e.protocol===i.protocol&&e.host===i.host&&(t||e.port===i.port)))(new URL(He.origin),He.navigator&&/(msie|trident)/i.test(He.navigator.userAgent)):()=>!0,aS=He.hasStandardBrowserEnv?{write(e,t,i,r,n,a,s){if(typeof document>"u")return;const o=[`${e}=${encodeURIComponent(t)}`];ot.isNumber(i)&&o.push(`expires=${new Date(i).toUTCString()}`),ot.isString(r)&&o.push(`path=${r}`),ot.isString(n)&&o.push(`domain=${n}`),a===!0&&o.push("secure"),ot.isString(s)&&o.push(`SameSite=${s}`),document.cookie=o.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function sS(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function oS(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function kv(e,t,i){let r=!sS(t);return e&&(r||i==!1)?oS(e,t):t}const Mf=e=>e instanceof oi?{...e}:e;function qn(e,t){t=t||{};const i={};function r(h,c,u,d){return ot.isPlainObject(h)&&ot.isPlainObject(c)?ot.merge.call({caseless:d},h,c):ot.isPlainObject(c)?ot.merge({},c):ot.isArray(c)?c.slice():c}function n(h,c,u,d){if(ot.isUndefined(c)){if(!ot.isUndefined(h))return r(void 0,h,u,d)}else return r(h,c,u,d)}function a(h,c){if(!ot.isUndefined(c))return r(void 0,c)}function s(h,c){if(ot.isUndefined(c)){if(!ot.isUndefined(h))return r(void 0,h)}else return r(void 0,c)}function o(h,c,u){if(u in t)return r(h,c);if(u in e)return r(void 0,h)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(h,c,u)=>n(Mf(h),Mf(c),u,!0)};return ot.forEach(Object.keys({...e,...t}),function(c){const u=l[c]||n,d=u(e[c],t[c],c);ot.isUndefined(d)&&u!==o||(i[c]=d)}),i}const Iv=e=>{const t=qn({},e);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:s,auth:o}=t;if(t.headers=s=oi.from(s),t.url=_v(kv(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),ot.isFormData(i)){if(He.hasStandardBrowserEnv||He.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(ot.isFunction(i.getHeaders)){const l=i.getHeaders(),h=["content-type","content-length"];Object.entries(l).forEach(([c,u])=>{h.includes(c.toLowerCase())&&s.set(c,u)})}}if(He.hasStandardBrowserEnv&&(r&&ot.isFunction(r)&&(r=r(t)),r||r!==!1&&nS(t.url))){const l=n&&a&&aS.read(a);l&&s.set(n,l)}return t},lS=typeof XMLHttpRequest<"u",cS=lS&&function(e){return new Promise(function(i,r){const n=Iv(e);let a=n.data;const s=oi.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:h}=n,c,u,d,f,m;function p(){f&&f(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function y(){if(!g)return;const b=oi.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),I={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:b,config:e,request:g};Rv(function(O){i(O),p()},function(O){r(O),p()},I),g=null}"onloadend"in g?g.onloadend=y:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(y)},g.onabort=function(){g&&(r(new Ft("Request aborted",Ft.ECONNABORTED,e,g)),g=null)},g.onerror=function(S){const I=S&&S.message?S.message:"Network Error",D=new Ft(I,Ft.ERR_NETWORK,e,g);D.event=S||null,r(D),g=null},g.ontimeout=function(){let S=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const I=n.transitional||Sv;n.timeoutErrorMessage&&(S=n.timeoutErrorMessage),r(new Ft(S,I.clarifyTimeoutError?Ft.ETIMEDOUT:Ft.ECONNABORTED,e,g)),g=null},a===void 0&&s.setContentType(null),"setRequestHeader"in g&&ot.forEach(s.toJSON(),function(S,I){g.setRequestHeader(I,S)}),ot.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),o&&o!=="json"&&(g.responseType=n.responseType),h&&([d,m]=Tl(h,!0),g.addEventListener("progress",d)),l&&g.upload&&([u,f]=Tl(l),g.upload.addEventListener("progress",u),g.upload.addEventListener("loadend",f)),(n.cancelToken||n.signal)&&(c=b=>{g&&(r(!b||b.type?new Ha(null,e,g):b),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const T=eS(n.url);if(T&&He.protocols.indexOf(T)===-1){r(new Ft("Unsupported protocol "+T+":",Ft.ERR_BAD_REQUEST,e));return}g.send(a||null)})},hS=(e,t)=>{const{length:i}=e=e?e.filter(Boolean):[];if(t||i){let r=new AbortController,n;const a=function(h){if(!n){n=!0,o();const c=h instanceof Error?h:this.reason;r.abort(c instanceof Ft?c:new Ha(c instanceof Error?c.message:c))}};let s=t&&setTimeout(()=>{s=null,a(new Ft(`timeout ${t} of ms exceeded`,Ft.ETIMEDOUT))},t);const o=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(a):h.removeEventListener("abort",a)}),e=null)};e.forEach(h=>h.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>ot.asap(o),l}},uS=function*(e,t){let i=e.byteLength;if(i<t){yield e;return}let r=0,n;for(;r<i;)n=r+t,yield e.slice(r,n),r=n},dS=async function*(e,t){for await(const i of fS(e))yield*uS(i,t)},fS=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:i,value:r}=await t.read();if(i)break;yield r}}finally{await t.cancel()}},Pf=(e,t,i,r)=>{const n=dS(e,t);let a=0,s,o=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:h,value:c}=await n.next();if(h){o(),l.close();return}let u=c.byteLength;if(i){let d=a+=u;i(d)}l.enqueue(new Uint8Array(c))}catch(h){throw o(h),h}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},Nf=64*1024,{isFunction:Bo}=ot,mS=(({Request:e,Response:t})=>({Request:e,Response:t}))(ot.global),{ReadableStream:Lf,TextEncoder:Uf}=ot.global,Ff=(e,...t)=>{try{return!!e(...t)}catch{return!1}},gS=e=>{e=ot.merge.call({skipUndefined:!0},mS,e);const{fetch:t,Request:i,Response:r}=e,n=t?Bo(t):typeof fetch=="function",a=Bo(i),s=Bo(r);if(!n)return!1;const o=n&&Bo(Lf),l=n&&(typeof Uf=="function"?(m=>p=>m.encode(p))(new Uf):async m=>new Uint8Array(await new i(m).arrayBuffer())),h=a&&o&&Ff(()=>{let m=!1;const p=new i(He.origin,{body:new Lf,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!p}),c=s&&o&&Ff(()=>ot.isReadableStream(new r("").body)),u={stream:c&&(m=>m.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!u[m]&&(u[m]=(p,g)=>{let y=p&&p[m];if(y)return y.call(p);throw new Ft(`Response type '${m}' is not supported`,Ft.ERR_NOT_SUPPORT,g)})});const d=async m=>{if(m==null)return 0;if(ot.isBlob(m))return m.size;if(ot.isSpecCompliantForm(m))return(await new i(He.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(ot.isArrayBufferView(m)||ot.isArrayBuffer(m))return m.byteLength;if(ot.isURLSearchParams(m)&&(m=m+""),ot.isString(m))return(await l(m)).byteLength},f=async(m,p)=>{const g=ot.toFiniteNumber(m.getContentLength());return g??d(p)};return async m=>{let{url:p,method:g,data:y,signal:T,cancelToken:b,timeout:S,onDownloadProgress:I,onUploadProgress:D,responseType:O,headers:P,withCredentials:q="same-origin",fetchOptions:J}=Iv(m),A=t||fetch;O=O?(O+"").toLowerCase():"text";let x=hS([T,b&&b.toAbortSignal()],S),R=null;const M=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let Y;try{if(D&&h&&g!=="get"&&g!=="head"&&(Y=await f(P,y))!==0){let L=new i(p,{method:"POST",body:y,duplex:"half"}),N;if(ot.isFormData(y)&&(N=L.headers.get("content-type"))&&P.setContentType(N),L.body){const[V,H]=Df(Y,Tl(Of(D)));y=Pf(L.body,Nf,V,H)}}ot.isString(q)||(q=q?"include":"omit");const X=a&&"credentials"in i.prototype,et={...J,signal:x,method:g.toUpperCase(),headers:P.normalize().toJSON(),body:y,duplex:"half",credentials:X?q:void 0};R=a&&new i(p,et);let z=await(a?A(R,J):A(p,et));const W=c&&(O==="stream"||O==="response");if(c&&(I||W&&M)){const L={};["status","statusText","headers"].forEach(Q=>{L[Q]=z[Q]});const N=ot.toFiniteNumber(z.headers.get("content-length")),[V,H]=I&&Df(N,Tl(Of(I),!0))||[];z=new r(Pf(z.body,Nf,V,()=>{H&&H(),M&&M()}),L)}O=O||"text";let $=await u[ot.findKey(u,O)||"text"](z,m);return!W&&M&&M(),await new Promise((L,N)=>{Rv(L,N,{data:$,headers:oi.from(z.headers),status:z.status,statusText:z.statusText,config:m,request:R})})}catch(X){throw M&&M(),X&&X.name==="TypeError"&&/Load failed|fetch/i.test(X.message)?Object.assign(new Ft("Network Error",Ft.ERR_NETWORK,m,R),{cause:X.cause||X}):Ft.from(X,X&&X.code,m,R)}}},pS=new Map,Cv=e=>{let t=e&&e.env||{};const{fetch:i,Request:r,Response:n}=t,a=[r,n,i];let s=a.length,o=s,l,h,c=pS;for(;o--;)l=a[o],h=c.get(l),h===void 0&&c.set(l,h=o?new Map:gS(t)),c=h;return h};Cv();const Tu={http:M_,xhr:cS,fetch:{get:Cv}};ot.forEach(Tu,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Bf=e=>`- ${e}`,vS=e=>ot.isFunction(e)||e===null||e===!1;function yS(e,t){e=ot.isArray(e)?e:[e];const{length:i}=e;let r,n;const a={};for(let s=0;s<i;s++){r=e[s];let o;if(n=r,!vS(r)&&(n=Tu[(o=String(r)).toLowerCase()],n===void 0))throw new Ft(`Unknown adapter '${o}'`);if(n&&(ot.isFunction(n)||(n=n.get(t))))break;a[o||"#"+s]=n}if(!n){const s=Object.entries(a).map(([l,h])=>`adapter ${l} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=i?s.length>1?`since :
`+s.map(Bf).join(`
`):" "+Bf(s[0]):"as no adapter specified";throw new Ft("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const Dv={getAdapter:yS,adapters:Tu};function qc(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ha(null,e)}function jf(e){return qc(e),e.headers=oi.from(e.headers),e.data=Yc.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Dv.getAdapter(e.adapter||ao.adapter,e)(e).then(function(r){return qc(e),r.data=Yc.call(e,e.transformResponse,r),r.headers=oi.from(r.headers),r},function(r){return xv(r)||(qc(e),r&&r.response&&(r.response.data=Yc.call(e,e.transformResponse,r.response),r.response.headers=oi.from(r.response.headers))),Promise.reject(r)})}const Ov="1.13.2",nc={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{nc[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const Wf={};nc.transitional=function(t,i,r){function n(a,s){return"[Axios v"+Ov+"] Transitional option '"+a+"'"+s+(r?". "+r:"")}return(a,s,o)=>{if(t===!1)throw new Ft(n(s," has been removed"+(i?" in "+i:"")),Ft.ERR_DEPRECATED);return i&&!Wf[s]&&(Wf[s]=!0,console.warn(n(s," has been deprecated since v"+i+" and will be removed in the near future"))),t?t(a,s,o):!0}};nc.spelling=function(t){return(i,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function bS(e,t,i){if(typeof e!="object")throw new Ft("options must be an object",Ft.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let n=r.length;for(;n-- >0;){const a=r[n],s=t[a];if(s){const o=e[a],l=o===void 0||s(o,a,e);if(l!==!0)throw new Ft("option "+a+" must be "+l,Ft.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Ft("Unknown option "+a,Ft.ERR_BAD_OPTION)}}const il={assertOptions:bS,validators:nc},Yi=il.validators;let Hn=class{constructor(t){this.defaults=t||{},this.interceptors={request:new If,response:new If}}async request(t,i){try{return await this._request(t,i)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(t,i){typeof t=="string"?(i=i||{},i.url=t):i=t||{},i=qn(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&il.assertOptions(r,{silentJSONParsing:Yi.transitional(Yi.boolean),forcedJSONParsing:Yi.transitional(Yi.boolean),clarifyTimeoutError:Yi.transitional(Yi.boolean)},!1),n!=null&&(ot.isFunction(n)?i.paramsSerializer={serialize:n}:il.assertOptions(n,{encode:Yi.function,serialize:Yi.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),il.assertOptions(i,{baseUrl:Yi.spelling("baseURL"),withXsrfToken:Yi.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&ot.merge(a.common,a[i.method]);a&&ot.forEach(["delete","get","head","post","put","patch","common"],m=>{delete a[m]}),i.headers=oi.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(i)===!1||(l=l&&p.synchronous,o.unshift(p.fulfilled,p.rejected))});const h=[];this.interceptors.response.forEach(function(p){h.push(p.fulfilled,p.rejected)});let c,u=0,d;if(!l){const m=[jf.bind(this),void 0];for(m.unshift(...o),m.push(...h),d=m.length,c=Promise.resolve(i);u<d;)c=c.then(m[u++],m[u++]);return c}d=o.length;let f=i;for(;u<d;){const m=o[u++],p=o[u++];try{f=m(f)}catch(g){p.call(this,g);break}}try{c=jf.call(this,f)}catch(m){return Promise.reject(m)}for(u=0,d=h.length;u<d;)c=c.then(h[u++],h[u++]);return c}getUri(t){t=qn(this.defaults,t);const i=kv(t.baseURL,t.url,t.allowAbsoluteUrls);return _v(i,t.params,t.paramsSerializer)}};ot.forEach(["delete","get","head","options"],function(t){Hn.prototype[t]=function(i,r){return this.request(qn(r||{},{method:t,url:i,data:(r||{}).data}))}});ot.forEach(["post","put","patch"],function(t){function i(r){return function(a,s,o){return this.request(qn(o||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}Hn.prototype[t]=i(),Hn.prototype[t+"Form"]=i(!0)});let wS=class Mv{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const s=new Promise(o=>{r.subscribe(o),a=o}).then(n);return s.cancel=function(){r.unsubscribe(a)},s},t(function(a,s,o){r.reason||(r.reason=new Ha(a,s,o),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const t=new AbortController,i=r=>{t.abort(r)};return this.subscribe(i),t.signal.unsubscribe=()=>this.unsubscribe(i),t.signal}static source(){let t;return{token:new Mv(function(n){t=n}),cancel:t}}};function TS(e){return function(i){return e.apply(null,i)}}function ES(e){return ot.isObject(e)&&e.isAxiosError===!0}const Dh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Dh).forEach(([e,t])=>{Dh[t]=e});function Pv(e){const t=new Hn(e),i=uv(Hn.prototype.request,t);return ot.extend(i,Hn.prototype,t,{allOwnKeys:!0}),ot.extend(i,t,null,{allOwnKeys:!0}),i.create=function(n){return Pv(qn(e,n))},i}const Ae=Pv(ao);Ae.Axios=Hn;Ae.CanceledError=Ha;Ae.CancelToken=wS;Ae.isCancel=xv;Ae.VERSION=Ov;Ae.toFormData=rc;Ae.AxiosError=Ft;Ae.Cancel=Ae.CanceledError;Ae.all=function(t){return Promise.all(t)};Ae.spread=TS;Ae.isAxiosError=ES;Ae.mergeConfig=qn;Ae.AxiosHeaders=oi;Ae.formToJSON=e=>Av(ot.isHTMLForm(e)?new FormData(e):e);Ae.getAdapter=Dv.getAdapter;Ae.HttpStatusCode=Dh;Ae.default=Ae;const{Axios:z2,AxiosError:V2,CanceledError:H2,isCancel:Y2,CancelToken:q2,VERSION:K2,all:G2,Cancel:$2,isAxiosError:X2,spread:Q2,toFormData:J2,AxiosHeaders:Z2,HttpStatusCode:tU,formToJSON:eU,getAdapter:iU,mergeConfig:rU}=Ae;var zf={},Oh=function(e,t){return Oh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},Oh(e,t)};function Ui(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Oh(e,t),e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}function _S(e,t,i,r){return new(i||(i=Promise))(function(n,a){function s(h){try{l(r.next(h))}catch(c){a(c)}}function o(h){try{l(r.throw(h))}catch(c){a(c)}}function l(h){h.done?n(h.value):(function(c){return c instanceof i?c:new i(function(u){u(c)})})(h.value).then(s,o)}l((r=r.apply(e,[])).next())})}function Nv(e,t){var i,r,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(l){return function(h){return(function(c){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(a=0)),a;)try{if(i=1,r&&(n=2&c[0]?r.return:c[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,c[1])).done)return n;switch(r=0,n&&(c=[2&c[0],n.value]),c[0]){case 0:case 1:n=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!((n=n.length>0&&n[n.length-1])||c[0]!==6&&c[0]!==2)){a=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){a.label=c[1];break}if(c[0]===6&&a.label<n[1]){a.label=n[1],n=c;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(c);break}n[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(u){c=[6,u],r=0}finally{i=n=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}})([l,h])}}}function Hs(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Na(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(t===void 0||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(o){n={error:o}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}function La(e,t,i){if(arguments.length===2)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}function Ca(e){return this instanceof Ca?(this.v=e,this):new Ca(e)}function SS(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=i.apply(e,t||[]),a=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(u){return function(d){return Promise.resolve(d).then(u,h)}}),r[Symbol.asyncIterator]=function(){return this},r;function s(u,d){n[u]&&(r[u]=function(f){return new Promise(function(m,p){a.push([u,f,m,p])>1||o(u,f)})},d&&(r[u]=d(r[u])))}function o(u,d){try{(function(f){f.value instanceof Ca?Promise.resolve(f.value.v).then(l,h):c(a[0][2],f)})(n[u](d))}catch(f){c(a[0][3],f)}}function l(u){o("next",u)}function h(u){o("throw",u)}function c(u,d){u(d),a.shift(),a.length&&o(a[0][0],a[0][1])}}function AS(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=Hs(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(a){return new Promise(function(s,o){(function(l,h,c,u){Promise.resolve(u).then(function(d){l({value:d,done:c})},h)})(s,o,(a=e[n](a)).done,a.value)})}}}function ce(e){return typeof e=="function"}function Lv(e){var t=e(function(i){Error.call(i),i.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Kc=Lv(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,r){return r+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function El(e,t){if(e){var i=e.indexOf(t);0<=i&&e.splice(i,1)}}var mn=(function(){function e(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var i,r,n,a,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var l=Hs(o),h=l.next();!h.done;h=l.next())h.value.remove(this)}catch(p){i={error:p}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(i)throw i.error}}else o.remove(this);var c=this.initialTeardown;if(ce(c))try{c()}catch(p){s=p instanceof Kc?p.errors:[p]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var d=Hs(u),f=d.next();!f.done;f=d.next()){var m=f.value;try{Vf(m)}catch(p){s=s??[],p instanceof Kc?s=La(La([],Na(s)),Na(p.errors)):s.push(p)}}}catch(p){n={error:p}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}}if(s)throw new Kc(s)}},e.prototype.add=function(i){var r;if(i&&i!==this)if(this.closed)Vf(i);else{if(i instanceof e){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(i)}},e.prototype._hasParent=function(i){var r=this._parentage;return r===i||Array.isArray(r)&&r.includes(i)},e.prototype._addParent=function(i){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(i),r):r?[r,i]:i},e.prototype._removeParent=function(i){var r=this._parentage;r===i?this._parentage=null:Array.isArray(r)&&El(r,i)},e.prototype.remove=function(i){var r=this._finalizers;r&&El(r,i),i instanceof e&&i._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e})(),Uv=mn.EMPTY;function Fv(e){return e instanceof mn||e&&"closed"in e&&ce(e.remove)&&ce(e.add)&&ce(e.unsubscribe)}function Vf(e){ce(e)?e():e.unsubscribe()}var xS={Promise:void 0},RS={setTimeout:function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return setTimeout.apply(void 0,La([e,t],Na(i)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Bv(e){RS.setTimeout(function(){throw e})}function _l(){}function rl(e){e()}var ac=(function(e){function t(i){var r=e.call(this)||this;return r.isStopped=!1,i?(r.destination=i,Fv(i)&&i.add(r)):r.destination=IS,r}return Ui(t,e),t.create=function(i,r,n){return new Mh(i,r,n)},t.prototype.next=function(i){this.isStopped?void 0:this._next(i)},t.prototype.error=function(i){this.isStopped?void 0:(this.isStopped=!0,this._error(i))},t.prototype.complete=function(){this.isStopped?void 0:(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(i){this.destination.next(i)},t.prototype._error=function(i){try{this.destination.error(i)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t})(mn),kS=(function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var i=this.partialObserver;if(i.next)try{i.next(t)}catch(r){jo(r)}},e.prototype.error=function(t){var i=this.partialObserver;if(i.error)try{i.error(t)}catch(r){jo(r)}else jo(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(i){jo(i)}},e})(),Mh=(function(e){function t(i,r,n){var a,s=e.call(this)||this;return ce(i)||!i?a={next:i??void 0,error:r??void 0,complete:n??void 0}:a=i,s.destination=new kS(a),s}return Ui(t,e),t})(ac);function jo(e){Bv(e)}var IS={closed:!0,next:_l,error:function(e){throw e},complete:_l},Eu=typeof Symbol=="function"&&Symbol.observable||"@@observable";function CS(e){return e}var _e=(function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(t,i,r){var n=this,a=(function(s){return s&&s instanceof ac||(function(o){return o&&ce(o.next)&&ce(o.error)&&ce(o.complete)})(s)&&Fv(s)})(t)?t:new Mh(t,i,r);return rl(function(){var s=n,o=s.operator,l=s.source;a.add(o?o.call(a,l):l?n._subscribe(a):n._trySubscribe(a))}),a},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(i){t.error(i)}},e.prototype.forEach=function(t,i){var r=this;return new(i=Hf(i))(function(n,a){var s=new Mh({next:function(o){try{t(o)}catch(l){a(l),s.unsubscribe()}},error:a,complete:n});r.subscribe(s)})},e.prototype._subscribe=function(t){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(t)},e.prototype[Eu]=function(){return this},e.prototype.pipe=function(){for(var t,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return((t=i).length===0?CS:t.length===1?t[0]:function(n){return t.reduce(function(a,s){return s(a)},n)})(this)},e.prototype.toPromise=function(t){var i=this;return new(t=Hf(t))(function(r,n){var a;i.subscribe(function(s){return a=s},function(s){return n(s)},function(){return r(a)})})},e.create=function(t){return new e(t)},e})();function Hf(e){var t;return(t=e??xS.Promise)!==null&&t!==void 0?t:Promise}function jv(e){return ce(e==null?void 0:e.lift)}function sr(e){return function(t){if(jv(t))return t.lift(function(i){try{return e(i,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ni(e,t,i,r,n){return new DS(e,t,i,r,n)}var DS=(function(e){function t(i,r,n,a,s,o){var l=e.call(this,i)||this;return l.onFinalize=s,l.shouldUnsubscribe=o,l._next=r?function(h){try{r(h)}catch(c){i.error(c)}}:e.prototype._next,l._error=a?function(h){try{a(h)}catch(c){i.error(c)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=n?function(){try{n()}catch(h){i.error(h)}finally{this.unsubscribe()}}:e.prototype._complete,l}return Ui(t,e),t.prototype.unsubscribe=function(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((i=this.onFinalize)===null||i===void 0||i.call(this))}},t})(ac);function _u(){return sr(function(e,t){var i=null;e._refCount++;var r=Ni(t,void 0,void 0,void 0,function(){if(!e||e._refCount<=0||0<--e._refCount)i=null;else{var n=e._connection,a=i;i=null,!n||a&&n!==a||n.unsubscribe(),t.unsubscribe()}});e.subscribe(r),r.closed||(i=e.connect())})}var OS=(function(e){function t(i,r){var n=e.call(this)||this;return n.source=i,n.subjectFactory=r,n._subject=null,n._refCount=0,n._connection=null,jv(i)&&(n.lift=i.lift),n}return Ui(t,e),t.prototype._subscribe=function(i){return this.getSubject().subscribe(i)},t.prototype.getSubject=function(){var i=this._subject;return i&&!i.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var i=this._connection;this._subject=this._connection=null,i==null||i.unsubscribe()},t.prototype.connect=function(){var i=this,r=this._connection;if(!r){r=this._connection=new mn;var n=this.getSubject();r.add(this.source.subscribe(Ni(n,void 0,function(){i._teardown(),n.complete()},function(a){i._teardown(),n.error(a)},function(){return i._teardown()}))),r.closed&&(this._connection=null,r=mn.EMPTY)}return r},t.prototype.refCount=function(){return _u()(this)},t})(_e),MS=Lv(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),or=(function(e){function t(){var i=e.call(this)||this;return i.closed=!1,i.currentObservers=null,i.observers=[],i.isStopped=!1,i.hasError=!1,i.thrownError=null,i}return Ui(t,e),t.prototype.lift=function(i){var r=new Ph(this,this);return r.operator=i,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new MS},t.prototype.next=function(i){var r=this;rl(function(){var n,a;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=Hs(r.currentObservers),o=s.next();!o.done;o=s.next())o.value.next(i)}catch(l){n={error:l}}finally{try{o&&!o.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}}})},t.prototype.error=function(i){var r=this;rl(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=i;for(var n=r.observers;n.length;)n.shift().error(i)}})},t.prototype.complete=function(){var i=this;rl(function(){if(i._throwIfClosed(),!i.isStopped){i.isStopped=!0;for(var r=i.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var i;return((i=this.observers)===null||i===void 0?void 0:i.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(i){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,i)},t.prototype._subscribe=function(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)},t.prototype._innerSubscribe=function(i){var r=this,n=this,a=n.hasError,s=n.isStopped,o=n.observers;return a||s?Uv:(this.currentObservers=null,o.push(i),new mn(function(){r.currentObservers=null,El(o,i)}))},t.prototype._checkFinalizedStatuses=function(i){var r=this,n=r.hasError,a=r.thrownError,s=r.isStopped;n?i.error(a):s&&i.complete()},t.prototype.asObservable=function(){var i=new _e;return i.source=this,i},t.create=function(i,r){return new Ph(i,r)},t})(_e),Ph=(function(e){function t(i,r){var n=e.call(this)||this;return n.destination=i,n.source=r,n}return Ui(t,e),t.prototype.next=function(i){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.next)===null||n===void 0||n.call(r,i)},t.prototype.error=function(i){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.error)===null||n===void 0||n.call(r,i)},t.prototype.complete=function(){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.complete)===null||r===void 0||r.call(i)},t.prototype._subscribe=function(i){var r,n;return(n=(r=this.source)===null||r===void 0?void 0:r.subscribe(i))!==null&&n!==void 0?n:Uv},t})(or),Yf=(function(e){function t(i){var r=e.call(this)||this;return r._value=i,r}return Ui(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(i){var r=e.prototype._subscribe.call(this,i);return!r.closed&&i.next(this._value),r},t.prototype.getValue=function(){var i=this,r=i.hasError,n=i.thrownError,a=i._value;if(r)throw n;return this._throwIfClosed(),a},t.prototype.next=function(i){e.prototype.next.call(this,this._value=i)},t})(or),Su={now:function(){return(Su.delegate||Date).now()},delegate:void 0},be=(function(e){function t(i,r,n){i===void 0&&(i=1/0),r===void 0&&(r=1/0),n===void 0&&(n=Su);var a=e.call(this)||this;return a._bufferSize=i,a._windowTime=r,a._timestampProvider=n,a._buffer=[],a._infiniteTimeWindow=!0,a._infiniteTimeWindow=r===1/0,a._bufferSize=Math.max(1,i),a._windowTime=Math.max(1,r),a}return Ui(t,e),t.prototype.next=function(i){var r=this,n=r.isStopped,a=r._buffer,s=r._infiniteTimeWindow,o=r._timestampProvider,l=r._windowTime;n||(a.push(i),!s&&a.push(o.now()+l)),this._trimBuffer(),e.prototype.next.call(this,i)},t.prototype._subscribe=function(i){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(i),n=this._infiniteTimeWindow,a=this._buffer.slice(),s=0;s<a.length&&!i.closed;s+=n?1:2)i.next(a[s]);return this._checkFinalizedStatuses(i),r},t.prototype._trimBuffer=function(){var i=this,r=i._bufferSize,n=i._timestampProvider,a=i._buffer,s=i._infiniteTimeWindow,o=(s?1:2)*r;if(r<1/0&&o<a.length&&a.splice(0,a.length-o),!s){for(var l=n.now(),h=0,c=1;c<a.length&&a[c]<=l;c+=2)h=c;h&&a.splice(0,h+1)}},t})(or),PS=(function(e){function t(i,r){return e.call(this)||this}return Ui(t,e),t.prototype.schedule=function(i,r){return this},t})(mn),Nh={setInterval:function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var n=Nh.delegate;return n!=null&&n.setInterval?n.setInterval.apply(n,La([e,t],Na(i))):setInterval.apply(void 0,La([e,t],Na(i)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},NS=(function(e){function t(i,r){var n=e.call(this,i,r)||this;return n.scheduler=i,n.work=r,n.pending=!1,n}return Ui(t,e),t.prototype.schedule=function(i,r){var n;if(r===void 0&&(r=0),this.closed)return this;this.state=i;var a=this.id,s=this.scheduler;return a!=null&&(this.id=this.recycleAsyncId(s,a,r)),this.pending=!0,this.delay=r,this.id=(n=this.id)!==null&&n!==void 0?n:this.requestAsyncId(s,this.id,r),this},t.prototype.requestAsyncId=function(i,r,n){return n===void 0&&(n=0),Nh.setInterval(i.flush.bind(i,this),n)},t.prototype.recycleAsyncId=function(i,r,n){if(n===void 0&&(n=0),n!=null&&this.delay===n&&this.pending===!1)return r;r!=null&&Nh.clearInterval(r)},t.prototype.execute=function(i,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(i,r);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(i,r){var n,a=!1;try{this.work(i)}catch(s){a=!0,n=s||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var i=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,El(n,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t})(PS),qf=(function(){function e(t,i){i===void 0&&(i=e.now),this.schedulerActionCtor=t,this.now=i}return e.prototype.schedule=function(t,i,r){return i===void 0&&(i=0),new this.schedulerActionCtor(this,t).schedule(r,i)},e.now=Su.now,e})(),LS=new((function(e){function t(i,r){r===void 0&&(r=qf.now);var n=e.call(this,i,r)||this;return n.actions=[],n._active=!1,n}return Ui(t,e),t.prototype.flush=function(i){var r=this.actions;if(this._active)r.push(i);else{var n;this._active=!0;do if(n=i.execute(i.state,i.delay))break;while(i=r.shift());if(this._active=!1,n){for(;i=r.shift();)i.unsubscribe();throw n}}},t})(qf))(NS),US=LS;function Wv(e){return e&&ce(e.schedule)}function zv(e){return e[e.length-1]}function FS(e){return ce(zv(e))?e.pop():void 0}function BS(e){return Wv(zv(e))?e.pop():void 0}var Vv=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Hv(e){return ce(e==null?void 0:e.then)}function Yv(e){return ce(e[Eu])}function qv(e){return Symbol.asyncIterator&&ce(e==null?void 0:e[Symbol.asyncIterator])}function Kv(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Gv=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator";function $v(e){return ce(e==null?void 0:e[Gv])}function Xv(e){return SS(this,arguments,function(){var t,i,r;return Nv(this,function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,Ca(t.read())];case 3:return i=n.sent(),r=i.value,i.done?[4,Ca(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,Ca(r)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Qv(e){return ce(e==null?void 0:e.getReader)}function Fr(e){if(e instanceof _e)return e;if(e!=null){if(Yv(e))return n=e,new _e(function(a){var s=n[Eu]();if(ce(s.subscribe))return s.subscribe(a);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(Vv(e))return r=e,new _e(function(a){for(var s=0;s<r.length&&!a.closed;s++)a.next(r[s]);a.complete()});if(Hv(e))return i=e,new _e(function(a){i.then(function(s){a.closed||(a.next(s),a.complete())},function(s){return a.error(s)}).then(null,Bv)});if(qv(e))return Kf(e);if($v(e))return t=e,new _e(function(a){var s,o;try{for(var l=Hs(t),h=l.next();!h.done;h=l.next()){var c=h.value;if(a.next(c),a.closed)return}}catch(u){s={error:u}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(s)throw s.error}}a.complete()});if(Qv(e))return Kf(Xv(e))}var t,i,r,n;throw Kv(e)}function Kf(e){return new _e(function(t){(function(i,r){var n,a,s,o;return _S(this,void 0,void 0,function(){var l,h;return Nv(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=AS(i),c.label=1;case 1:return[4,n.next()];case 2:if((a=c.sent()).done)return[3,4];if(l=a.value,r.next(l),r.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return h=c.sent(),s={error:h},[3,11];case 6:return c.trys.push([6,,9,10]),a&&!a.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})})(e,t).catch(function(i){return t.error(i)})})}function Yn(e,t,i,r,n){r===void 0&&(r=0),n===void 0&&(n=!1);var a=t.schedule(function(){i(),n?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(a),!n)return a}function Gf(e,t){return t===void 0&&(t=0),sr(function(i,r){i.subscribe(Ni(r,function(n){return Yn(r,e,function(){return r.next(n)},t)},function(){return Yn(r,e,function(){return r.complete()},t)},function(n){return Yn(r,e,function(){return r.error(n)},t)}))})}function $f(e,t){return t===void 0&&(t=0),sr(function(i,r){r.add(e.schedule(function(){return i.subscribe(r)},t))})}function Xf(e,t){if(!e)throw new Error("Iterable cannot be null");return new _e(function(i){Yn(i,t,function(){var r=e[Symbol.asyncIterator]();Yn(i,t,function(){r.next().then(function(n){n.done?i.complete():i.next(n.value)})},0,!0)})})}function jS(e,t){if(e!=null){if(Yv(e))return(function(i,r){return Fr(i).pipe($f(r),Gf(r))})(e,t);if(Vv(e))return(function(i,r){return new _e(function(n){var a=0;return r.schedule(function(){a===i.length?n.complete():(n.next(i[a++]),n.closed||this.schedule())})})})(e,t);if(Hv(e))return(function(i,r){return Fr(i).pipe($f(r),Gf(r))})(e,t);if(qv(e))return Xf(e,t);if($v(e))return(function(i,r){return new _e(function(n){var a;return Yn(n,r,function(){a=i[Gv](),Yn(n,r,function(){var s,o,l;try{o=(s=a.next()).value,l=s.done}catch(h){return void n.error(h)}l?n.complete():n.next(o)},0,!0)}),function(){return ce(a==null?void 0:a.return)&&a.return()}})})(e,t);if(Qv(e))return(function(i,r){return Xf(Xv(i),r)})(e,t)}throw Kv(e)}function xn(e,t){return t?jS(e,t):Fr(e)}function sn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xn(e,BS(e))}function Gc(e,t){var i=ce(e)?e:function(){return e},r=function(n){return n.error(i())};return new _e(r)}function Ua(e,t){return sr(function(i,r){var n=0;i.subscribe(Ni(r,function(a){r.next(e.call(t,a,n++))}))})}var WS=Array.isArray;function zS(e){return Ua(function(t){return(function(i,r){return WS(r)?i.apply(void 0,La([],Na(r))):i(r)})(e,t)})}var VS=Array.isArray,HS=Object.getPrototypeOf,YS=Object.prototype,qS=Object.keys;function KS(e){if(e.length===1){var t=e[0];if(VS(t))return{args:t,keys:null};if((r=t)&&typeof r=="object"&&HS(r)===YS){var i=qS(t);return{args:i.map(function(n){return t[n]}),keys:i}}}var r;return{args:e,keys:null}}function GS(e,t){return e.reduce(function(i,r,n){return i[r]=t[n],i},{})}var $S={connector:function(){return new or},resetOnDisconnect:!0};function Qf(e,t){t===void 0&&(t=$S);var i=null,r=t.connector,n=t.resetOnDisconnect,a=n===void 0||n,s=r(),o=new _e(function(l){return s.subscribe(l)});return o.connect=function(){var l;return i&&!i.closed||(i=(l=function(){return e},new _e(function(h){Fr(l()).subscribe(h)})).subscribe(s),a&&i.add(function(){return s=r()})),i},o}function Jf(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=FS(e),r=KS(e),n=r.args,a=r.keys,s=new _e(function(o){var l=n.length;if(l)for(var h=new Array(l),c=l,u=l,d=function(m){var p=!1;Fr(n[m]).subscribe(Ni(o,function(g){p||(p=!0,u--),h[m]=g},function(){return c--},void 0,function(){c&&p||(u||o.next(a?GS(a,h):h),o.complete())}))},f=0;f<l;f++)d(f);else o.complete()});return i?s.pipe(zS(i)):s}function XS(e,t,i){e===void 0&&(e=0),i===void 0&&(i=US);var r=-1;return t!=null&&(Wv(t)?i=t:r=t),new _e(function(n){var a=(function(o){return o instanceof Date&&!isNaN(o)})(e)?+e-i.now():e;a<0&&(a=0);var s=0;return i.schedule(function(){n.closed||(n.next(s++),0<=r?this.schedule(void 0,r):n.complete())},a)})}function QS(e,t){return sr(function(i,r){var n=0;i.subscribe(Ni(r,function(a){return e.call(t,a,n++)&&r.next(a)}))})}var JS={connector:function(){return new or}};function ZS(e,t){t===void 0&&(t=JS);var i=t.connector;return sr(function(r,n){var a,s=i();Fr(e((a=s,new _e(function(o){return a.subscribe(o)})))).subscribe(n),n.add(r.subscribe(s))})}function Jv(e){return sr(function(t,i){try{t.subscribe(i)}finally{i.add(e)}})}function Zv(e,t,i,r){var n=ce(i)?i:void 0;return function(a){return(function(s,o){var l=ce(s)?s:function(){return s};return ce(o)?ZS(o,{connector:l}):function(h){return new OS(h,l)}})(new be(e,t,r),n)(a)}}function Da(e,t){return sr(function(i,r){var n=null,a=0,s=!1,o=function(){return s&&!n&&r.complete()};i.subscribe(Ni(r,function(l){n==null||n.unsubscribe();var h=0,c=a++;Fr(e(l,c)).subscribe(n=Ni(r,function(u){return r.next(t?t(l,u,c,h++):u)},function(){n=null,o()}))},function(){s=!0,o()}))})}var Zf,Mi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(e){(function(){var t=typeof Mi=="object"?Mi:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),i=r(e);function r(n,a){return function(s,o){typeof n[s]!="function"&&Object.defineProperty(n,s,{configurable:!0,writable:!0,value:o}),a&&a(s,o)}}t.Reflect===void 0?t.Reflect=e:i=r(t.Reflect,i),(function(n){var a=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",o=s&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",l=s&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",h=typeof Object.create=="function",c={__proto__:[]}instanceof Array,u=!h&&!c,d={create:h?function(){return Ga(Object.create(null))}:c?function(){return Ga({__proto__:null})}:function(){return Ga({})},has:u?function(st,ht){return a.call(st,ht)}:function(st,ht){return ht in st},get:u?function(st,ht){return a.call(st,ht)?st[ht]:void 0}:function(st,ht){return st[ht]}},f=Object.getPrototypeOf(Function),m=typeof process=="object"&&zf&&zf.REFLECT_METADATA_USE_MAP_POLYFILL==="true",p=m||typeof Map!="function"||typeof Map.prototype.entries!="function"?zt():Map,g=m||typeof Set!="function"||typeof Set.prototype.entries!="function"?qt():Set,y=m||typeof WeakMap!="function"?Ei():WeakMap,T=new y;function b(st,ht,at,yt){if(H(at)){if(!j(st))throw new TypeError;if(!nt(ht))throw new TypeError;return R(st,ht)}if(!j(st))throw new TypeError;if(!tt(ht))throw new TypeError;if(!tt(yt)&&!H(yt)&&!Q(yt))throw new TypeError;return Q(yt)&&(yt=void 0),M(st,ht,at=F(at),yt)}function S(st,ht){function at(yt,It){if(!tt(yt))throw new TypeError;if(!H(It)&&!mt(It))throw new TypeError;$(st,ht,yt,It)}return at}function I(st,ht,at,yt){if(!tt(at))throw new TypeError;return H(yt)||(yt=F(yt)),$(st,ht,at,yt)}function D(st,ht,at){if(!tt(ht))throw new TypeError;return H(at)||(at=F(at)),X(st,ht,at)}function O(st,ht,at){if(!tt(ht))throw new TypeError;return H(at)||(at=F(at)),et(st,ht,at)}function P(st,ht,at){if(!tt(ht))throw new TypeError;return H(at)||(at=F(at)),z(st,ht,at)}function q(st,ht,at){if(!tt(ht))throw new TypeError;return H(at)||(at=F(at)),W(st,ht,at)}function J(st,ht){if(!tt(st))throw new TypeError;return H(ht)||(ht=F(ht)),L(st,ht)}function A(st,ht){if(!tt(st))throw new TypeError;return H(ht)||(ht=F(ht)),N(st,ht)}function x(st,ht,at){if(!tt(ht))throw new TypeError;H(at)||(at=F(at));var yt=Y(ht,at,!1);if(H(yt)||!yt.delete(st))return!1;if(yt.size>0)return!0;var It=T.get(ht);return It.delete(at),It.size>0||T.delete(ht),!0}function R(st,ht){for(var at=st.length-1;at>=0;--at){var yt=(0,st[at])(ht);if(!H(yt)&&!Q(yt)){if(!nt(yt))throw new TypeError;ht=yt}}return ht}function M(st,ht,at,yt){for(var It=st.length-1;It>=0;--It){var pe=(0,st[It])(ht,at,yt);if(!H(pe)&&!Q(pe)){if(!tt(pe))throw new TypeError;yt=pe}}return yt}function Y(st,ht,at){var yt=T.get(st);if(H(yt)){if(!at)return;yt=new p,T.set(st,yt)}var It=yt.get(ht);if(H(It)){if(!at)return;It=new p,yt.set(ht,It)}return It}function X(st,ht,at){if(et(st,ht,at))return!0;var yt=he(ht);return!Q(yt)&&X(st,yt,at)}function et(st,ht,at){var yt=Y(ht,at,!1);return!H(yt)&&_(yt.has(st))}function z(st,ht,at){if(et(st,ht,at))return W(st,ht,at);var yt=he(ht);return Q(yt)?void 0:z(st,yt,at)}function W(st,ht,at){var yt=Y(ht,at,!1);if(!H(yt))return yt.get(st)}function $(st,ht,at,yt){Y(at,yt,!0).set(st,ht)}function L(st,ht){var at=N(st,ht),yt=he(st);if(yt===null)return at;var It=L(yt,ht);if(It.length<=0)return at;if(at.length<=0)return It;for(var pe=new g,Wt=[],Tt=0,Rt=at;Tt<Rt.length;Tt++){var Dt=Rt[Tt];pe.has(Dt)||(pe.add(Dt),Wt.push(Dt))}for(var Ot=0,qe=It;Ot<qe.length;Ot++)Dt=qe[Ot],pe.has(Dt)||(pe.add(Dt),Wt.push(Dt));return Wt}function N(st,ht){var at=[],yt=Y(st,ht,!1);if(H(yt))return at;for(var It=gt(yt.keys()),pe=0;;){var Wt=xe(It);if(!Wt)return at.length=pe,at;var Tt=xt(Wt);try{at[pe]=Tt}catch(Rt){try{we(It)}finally{throw Rt}}pe++}}function V(st){if(st===null)return 1;switch(typeof st){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return st===null?1:6;default:return 6}}function H(st){return st===void 0}function Q(st){return st===null}function rt(st){return typeof st=="symbol"}function tt(st){return typeof st=="object"?st!==null:typeof st=="function"}function it(st,ht){switch(V(st)){case 0:case 1:case 2:case 3:case 4:case 5:return st}var at="string",yt=ft(st,o);if(yt!==void 0){var It=yt.call(st,at);if(tt(It))throw new TypeError;return It}return w(st)}function w(st,ht){var at,yt;{var It=st.toString;if(K(It)&&!tt(yt=It.call(st))||K(at=st.valueOf)&&!tt(yt=at.call(st)))return yt}throw new TypeError}function _(st){return!!st}function C(st){return""+st}function F(st){var ht=it(st);return rt(ht)?ht:C(ht)}function j(st){return Array.isArray?Array.isArray(st):st instanceof Object?st instanceof Array:Object.prototype.toString.call(st)==="[object Array]"}function K(st){return typeof st=="function"}function nt(st){return typeof st=="function"}function mt(st){switch(V(st)){case 3:case 4:return!0;default:return!1}}function ft(st,ht){var at=st[ht];if(at!=null){if(!K(at))throw new TypeError;return at}}function gt(st){var ht=ft(st,l);if(!K(ht))throw new TypeError;var at=ht.call(st);if(!tt(at))throw new TypeError;return at}function xt(st){return st.value}function xe(st){var ht=st.next();return!ht.done&&ht}function we(st){var ht=st.return;ht&&ht.call(st)}function he(st){var ht=Object.getPrototypeOf(st);if(typeof st!="function"||st===f||ht!==f)return ht;var at=st.prototype,yt=at&&Object.getPrototypeOf(at);if(yt==null||yt===Object.prototype)return ht;var It=yt.constructor;return typeof It!="function"||It===st?ht:It}function zt(){var st={},ht=[],at=(function(){function Wt(Tt,Rt,Dt){this._index=0,this._keys=Tt,this._values=Rt,this._selector=Dt}return Wt.prototype["@@iterator"]=function(){return this},Wt.prototype[l]=function(){return this},Wt.prototype.next=function(){var Tt=this._index;if(Tt>=0&&Tt<this._keys.length){var Rt=this._selector(this._keys[Tt],this._values[Tt]);return Tt+1>=this._keys.length?(this._index=-1,this._keys=ht,this._values=ht):this._index++,{value:Rt,done:!1}}return{value:void 0,done:!0}},Wt.prototype.throw=function(Tt){throw this._index>=0&&(this._index=-1,this._keys=ht,this._values=ht),Tt},Wt.prototype.return=function(Tt){return this._index>=0&&(this._index=-1,this._keys=ht,this._values=ht),{value:Tt,done:!0}},Wt})();return(function(){function Wt(){this._keys=[],this._values=[],this._cacheKey=st,this._cacheIndex=-2}return Object.defineProperty(Wt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Wt.prototype.has=function(Tt){return this._find(Tt,!1)>=0},Wt.prototype.get=function(Tt){var Rt=this._find(Tt,!1);return Rt>=0?this._values[Rt]:void 0},Wt.prototype.set=function(Tt,Rt){var Dt=this._find(Tt,!0);return this._values[Dt]=Rt,this},Wt.prototype.delete=function(Tt){var Rt=this._find(Tt,!1);if(Rt>=0){for(var Dt=this._keys.length,Ot=Rt+1;Ot<Dt;Ot++)this._keys[Ot-1]=this._keys[Ot],this._values[Ot-1]=this._values[Ot];return this._keys.length--,this._values.length--,Tt===this._cacheKey&&(this._cacheKey=st,this._cacheIndex=-2),!0}return!1},Wt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=st,this._cacheIndex=-2},Wt.prototype.keys=function(){return new at(this._keys,this._values,yt)},Wt.prototype.values=function(){return new at(this._keys,this._values,It)},Wt.prototype.entries=function(){return new at(this._keys,this._values,pe)},Wt.prototype["@@iterator"]=function(){return this.entries()},Wt.prototype[l]=function(){return this.entries()},Wt.prototype._find=function(Tt,Rt){return this._cacheKey!==Tt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Tt)),this._cacheIndex<0&&Rt&&(this._cacheIndex=this._keys.length,this._keys.push(Tt),this._values.push(void 0)),this._cacheIndex},Wt})();function yt(Wt,Tt){return Wt}function It(Wt,Tt){return Tt}function pe(Wt,Tt){return[Wt,Tt]}}function qt(){return(function(){function st(){this._map=new p}return Object.defineProperty(st.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),st.prototype.has=function(ht){return this._map.has(ht)},st.prototype.add=function(ht){return this._map.set(ht,ht),this},st.prototype.delete=function(ht){return this._map.delete(ht)},st.prototype.clear=function(){this._map.clear()},st.prototype.keys=function(){return this._map.keys()},st.prototype.values=function(){return this._map.values()},st.prototype.entries=function(){return this._map.entries()},st.prototype["@@iterator"]=function(){return this.keys()},st.prototype[l]=function(){return this.keys()},st})()}function Ei(){var st=16,ht=d.create(),at=yt();return(function(){function Rt(){this._key=yt()}return Rt.prototype.has=function(Dt){var Ot=It(Dt,!1);return Ot!==void 0&&d.has(Ot,this._key)},Rt.prototype.get=function(Dt){var Ot=It(Dt,!1);return Ot!==void 0?d.get(Ot,this._key):void 0},Rt.prototype.set=function(Dt,Ot){return It(Dt,!0)[this._key]=Ot,this},Rt.prototype.delete=function(Dt){var Ot=It(Dt,!1);return Ot!==void 0&&delete Ot[this._key]},Rt.prototype.clear=function(){this._key=yt()},Rt})();function yt(){var Rt;do Rt="@@WeakMap@@"+Tt();while(d.has(ht,Rt));return ht[Rt]=!0,Rt}function It(Rt,Dt){if(!a.call(Rt,at)){if(!Dt)return;Object.defineProperty(Rt,at,{value:d.create()})}return Rt[at]}function pe(Rt,Dt){for(var Ot=0;Ot<Dt;++Ot)Rt[Ot]=255*Math.random()|0;return Rt}function Wt(Rt){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Rt)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Rt)):pe(new Uint8Array(Rt),Rt):pe(new Array(Rt),Rt)}function Tt(){var Rt=Wt(st);Rt[6]=79&Rt[6]|64,Rt[8]=191&Rt[8]|128;for(var Dt="",Ot=0;Ot<st;++Ot){var qe=Rt[Ot];Ot!==4&&Ot!==6&&Ot!==8||(Dt+="-"),qe<16&&(Dt+="0"),Dt+=qe.toString(16).toLowerCase()}return Dt}}function Ga(st){return st.__=void 0,delete st.__,st}n("decorate",b),n("metadata",S),n("defineMetadata",I),n("hasMetadata",D),n("hasOwnMetadata",O),n("getMetadata",P),n("getOwnMetadata",q),n("getMetadataKeys",J),n("getOwnMetadataKeys",A),n("deleteMetadata",x)})(i)})()})(Zf||(Zf={}));var Nt={TelemetryWebsocketService:Symbol.for("TelemetryWebsocketService"),Window:Symbol.for("Window"),NgZone:Symbol.for("ngZone"),AlarmDataService:Symbol.for("AlarmDataService"),EntityDataService:Symbol.for("EntityDataService"),DataSubscriptionService:Symbol.for("DataSubscriptionService"),UtilsService:Symbol.for("UtilsService"),UnitService:Symbol.for("UnitService"),TimeService:Symbol.for("TimeService"),RafService:Symbol.for("RafService"),TranslateService:Symbol.for("TranslateService"),DeviceService:Symbol.for("DeviceService"),AuthService:Symbol.for("AuthService"),LocalStorage:Symbol.for("LocalStorage"),NotificationWebsocketService:Symbol.for("NotificationWebsocketService"),HttpClient:Symbol.for("HttpClient")},Lh=function(e,t){return Lh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},Lh(e,t)};function Le(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Lh(e,t),e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var lr=function(){return lr=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},lr.apply(this,arguments)};function bi(e,t,i,r){var n,a=arguments.length,s=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(s=(a<3?n(s):a>3?n(t,i,s):n(t,i))||s);return a>3&&s&&Object.defineProperty(t,i,s),s}function ie(e,t){return function(i,r){t(i,r,e)}}function wi(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function t1(e,t,i,r){return new(i||(i=Promise))(function(n,a){function s(h){try{l(r.next(h))}catch(c){a(c)}}function o(h){try{l(r.throw(h))}catch(c){a(c)}}function l(h){h.done?n(h.value):(function(c){return c instanceof i?c:new i(function(u){u(c)})})(h.value).then(s,o)}l((r=r.apply(e,[])).next())})}function e1(e,t){var i,r,n,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(l){return function(h){return(function(c){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(a=0)),a;)try{if(i=1,r&&(n=2&c[0]?r.return:c[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,c[1])).done)return n;switch(r=0,n&&(c=[2&c[0],n.value]),c[0]){case 0:case 1:n=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!((n=n.length>0&&n[n.length-1])||c[0]!==6&&c[0]!==2)){a=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){a.label=c[1];break}if(c[0]===6&&a.label<n[1]){a.label=n[1],n=c;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(c);break}n[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(u){c=[6,u],r=0}finally{i=n=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}})([l,h])}}}function kt(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $e(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r,n,a=i.call(e),s=[];try{for(;(t===void 0||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(o){n={error:o}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}function on(e,t,i){if(arguments.length===2)for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}const $c=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");var bp,Gs;bp=$c;class i1{constructor(t){B(this,bp);pr(this,Gs);zi(this,Gs,t),this[$c]=!0}static is(t){return typeof t=="object"&&t!==null&&t[$c]===!0}unwrap(){return ae(this,Gs).call(this)}}Gs=new WeakMap;function Br(e,t){return Reflect.getMetadata(t,e)}function tm(e,t,i,r){const n=r(Br(e,t)??i);Reflect.defineMetadata(t,n,e)}const Sl="named",Au="name",xu="unmanaged",Ru="optional",ku="inject",Iu="multi_inject",ty="post_construct",ey="pre_destroy",r1=[ku,Iu,Au,xu,Sl,Ru],Xc=Symbol.for("@inversifyjs/core/InversifyCoreError");var wp,Tp;class jr extends(Tp=Error,wp=Xc,Tp){constructor(i,r,n){super(r,n);B(this,wp);B(this,"kind");this[Xc]=!0,this.kind=i}static is(i){return typeof i=="object"&&i!==null&&i[Xc]===!0}static isErrorOfKind(i,r){return jr.is(i)&&i.kind===r}}var Wr,li;function iy(e,t){const i=[];for(let r=0;r<t.length;++r)t[r]===void 0&&i.push(r);if(i.length>0)throw new jr(Wr.missingInjectionDecorator,`Found unexpected missing metadata on type "${e.name}" at constructor indexes "${i.join('", "')}".

Are you using @inject, @multiInject or @unmanaged decorators at those indexes?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}function ry(e){return{kind:li.singleInjection,name:void 0,optional:!1,tags:new Map,targetName:void 0,value:e}}function sc(e){const t=e.find(s=>s.key===ku),i=e.find(s=>s.key===Iu);if(e.find(s=>s.key===xu)!==void 0)return(function(s,o){if(o!==void 0||s!==void 0)throw new jr(Wr.missingInjectionDecorator,"Expected a single @inject, @multiInject or @unmanaged metadata");return{kind:li.unmanaged}})(t,i);if(i===void 0&&t===void 0)throw new jr(Wr.missingInjectionDecorator,"Expected @inject, @multiInject or @unmanaged metadata");const r=e.find(s=>s.key===Sl),n=e.find(s=>s.key===Ru),a=e.find(s=>s.key===Au);return{kind:t===void 0?li.multipleInjection:li.singleInjection,name:r==null?void 0:r.value,optional:n!==void 0,tags:new Map(e.filter(s=>r1.every(o=>s.key!==o)).map(s=>[s.key,s.value])),targetName:a==null?void 0:a.value,value:t===void 0?i==null?void 0:i.value:t.value}}function ny(e,t,i){try{return sc(i)}catch(r){throw jr.isErrorOfKind(r,Wr.missingInjectionDecorator)?new jr(Wr.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${e.name}" at constructor arguments at index "${t.toString()}"`,{cause:r}):r}}function n1(e){const t=Br(e,"design:paramtypes"),i=Br(e,"inversify:tagged"),r=[];if(i!==void 0)for(const[n,a]of Object.entries(i)){const s=parseInt(n);r[s]=ny(e,s,a)}if(t!==void 0){for(let n=0;n<t.length;++n)if(r[n]===void 0){const a=t[n];r[n]=ry(a)}}return iy(e,r),r}function ay(e,t,i){try{return sc(i)}catch(r){throw jr.isErrorOfKind(r,Wr.missingInjectionDecorator)?new jr(Wr.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${e.name}" at property "${t.toString()}"`,{cause:r}):r}}function sy(e){const t=Br(e,"inversify:tagged_props"),i=new Map;if(t!==void 0)for(const r of Reflect.ownKeys(t)){const n=t[r];i.set(r,ay(e,r,n))}return i}function a1(e){const t=Br(e,ty),i=Br(e,ey);return{constructorArguments:n1(e),lifecycle:{postConstructMethodName:t==null?void 0:t.value,preDestroyMethodName:i==null?void 0:i.value},properties:sy(e)}}function s1(e,t){const i=t.getConstructorMetadata(e),r=[];for(const[n,a]of Object.entries(i.userGeneratedMetadata)){const s=parseInt(n);r[s]=ny(e,s,a)}if(i.compilerGeneratedMetadata!==void 0){for(let n=0;n<i.compilerGeneratedMetadata.length;++n)if(r[n]===void 0){const a=i.compilerGeneratedMetadata[n];r[n]=ry(a)}}return iy(e,r),r}function oy(e,t){const i=t.getPropertiesMetadata(e),r=new Map;for(const n of Reflect.ownKeys(i)){const a=i[n];r.set(n,ay(e,n,a))}return r}function o1(e,t){const i=Br(e,ty),r=Br(e,ey);return{constructorArguments:s1(e,t),lifecycle:{postConstructMethodName:i==null?void 0:i.value,preDestroyMethodName:r==null?void 0:r.value},properties:oy(e,t)}}function em(e){const t=Object.getPrototypeOf(e.prototype);return t==null?void 0:t.constructor}function l1(e){let t;switch(e.kind){case li.multipleInjection:t={key:Iu,value:e.value};break;case li.singleInjection:t={key:ku,value:e.value}}return t}(function(e){e[e.injectionDecoratorConflict=0]="injectionDecoratorConflict",e[e.missingInjectionDecorator=1]="missingInjectionDecorator",e[e.planning=2]="planning",e[e.unknown=3]="unknown"})(Wr||(Wr={})),(function(e){e[e.multipleInjection=0]="multipleInjection",e[e.singleInjection=1]="singleInjection",e[e.unmanaged=2]="unmanaged"})(li||(li={}));var xr;class c1{constructor(t){pr(this,xr);zi(this,xr,t)}startsWith(t){return ae(this,xr).startsWith(t)}endsWith(t){return ae(this,xr).endsWith(t)}contains(t){return ae(this,xr).includes(t)}equals(t){return ae(this,xr)===t}value(){return ae(this,xr)}}xr=new WeakMap;const Qc="@inversifyjs/core/targetId";var Be,$s,Xs,Fn,Qs,Js;class Al{constructor(t,i,r){pr(this,Be);pr(this,$s);pr(this,Xs);pr(this,Fn);pr(this,Qs);pr(this,Js);zi(this,$s,(function(){const n=Br(Object,Qc)??0;return n===Number.MAX_SAFE_INTEGER?tm(Object,Qc,n,()=>Number.MIN_SAFE_INTEGER):tm(Object,Qc,n,a=>a+1),n})()),zi(this,Xs,t),zi(this,Fn,void 0),zi(this,Be,i),zi(this,Qs,new c1(typeof t=="string"?t:t.toString().slice(7,-1))),zi(this,Js,r)}get id(){return ae(this,$s)}get identifier(){return ae(this,Xs)}get metadata(){return ae(this,Fn)===void 0&&zi(this,Fn,(function(t){return t.kind===li.unmanaged?[{key:xu,value:!0}]:(function(i){const r=[l1(i)];i.name!==void 0&&r.push({key:Sl,value:i.name}),i.optional&&r.push({key:Ru,value:!0});for(const[n,a]of i.tags)r.push({key:n,value:a});return i.targetName!==void 0&&r.push({key:Au,value:i.targetName}),r})(t)})(ae(this,Be))),ae(this,Fn)}get name(){return ae(this,Qs)}get type(){return ae(this,Js)}get serviceIdentifier(){return i1.is(ae(this,Be).value)?ae(this,Be).value.unwrap():ae(this,Be).value}getCustomTags(){return[...ae(this,Be).tags.entries()].map(([t,i])=>({key:t,value:i}))}getNamedTag(){return ae(this,Be).name===void 0?null:{key:Sl,value:ae(this,Be).name}}hasTag(t){return this.metadata.some(i=>i.key===t)}isArray(){return ae(this,Be).kind===li.multipleInjection}isNamed(){return ae(this,Be).name!==void 0}isOptional(){return ae(this,Be).optional}isTagged(){return ae(this,Be).tags.size>0}matchesArray(t){return this.isArray()&&ae(this,Be).value===t}matchesNamedTag(t){return ae(this,Be).name===t}matchesTag(t){return i=>this.metadata.some(r=>r.key===t&&r.value===i)}}Be=new WeakMap,$s=new WeakMap,Xs=new WeakMap,Fn=new WeakMap,Qs=new WeakMap,Js=new WeakMap;const ly=e=>(function(t,i){return function(r){const n=t(r);let a=em(r);for(;a!==void 0&&a!==Object;){const o=i(a);for(const[l,h]of o)n.properties.has(l)||n.properties.set(l,h);a=em(a)}const s=[];for(const o of n.constructorArguments)if(o.kind!==li.unmanaged){const l=o.targetName??"";s.push(new Al(l,o,"ConstructorArgument"))}for(const[o,l]of n.properties)if(l.kind!==li.unmanaged){const h=l.targetName??o;s.push(new Al(h,l,"ClassProperty"))}return s}})(e===void 0?a1:t=>o1(t,e),e===void 0?sy:t=>oy(t,e)),Ri="named",h1="unmanaged",u1="optional",cy="inject",d1="multi_inject",hy="inversify:tagged",uy="inversify:tagged_props",im="inversify:paramtypes",dy="design:paramtypes",rm="post_construct",Uh="pre_destroy",Ys="Request",pi="Singleton",nl="Transient",Fh="ConstantValue",Bh="Constructor",xl="DynamicValue",Es="Factory",jh="Function",Rl="Instance",f1="Invalid",Wh="Provider",m1="ConstructorArgument",g1="Variable";let p1=0;function oc(){return p1++}class Cu{constructor(t,i){B(this,"id");B(this,"moduleId");B(this,"activated");B(this,"serviceIdentifier");B(this,"implementationType");B(this,"cache");B(this,"dynamicValue");B(this,"scope");B(this,"type");B(this,"factory");B(this,"provider");B(this,"constraint");B(this,"onActivation");B(this,"onDeactivation");this.id=oc(),this.activated=!1,this.serviceIdentifier=t,this.scope=i,this.type=f1,this.constraint=r=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}clone(){const t=new Cu(this.serviceIdentifier,this.scope);return t.activated=t.scope===pi&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.onDeactivation=this.onDeactivation,t.cache=this.cache,t}}const nm="Metadata key was used more than once in a parameter:",am="NULL argument",sm="Key Not Found",om="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",zh=(e,t)=>`onDeactivation() error in class ${e}: ${t}`;class v1{getConstructorMetadata(t){return{compilerGeneratedMetadata:Reflect.getMetadata(dy,t)??[],userGeneratedMetadata:Reflect.getMetadata(hy,t)??{}}}getPropertiesMetadata(t){return Reflect.getMetadata(uy,t)??{}}}var pa;function fy(e){return e instanceof RangeError||e.message==="Maximum call stack size exceeded"}function ln(e){return typeof e=="function"?e.name:typeof e=="symbol"?e.toString():e}function lm(e,t,i){let r="";const n=i(e,t);return n.length!==0&&(r=`
Registered bindings:`,n.forEach(a=>{let s="Object";a.implementationType!==null&&(s=py(a.implementationType)),r=`${r}
 ${s}`,a.constraint.metaData&&(r=`${r} - ${a.constraint.metaData}`)})),r}function my(e,t){return e.parentRequest!==null&&(e.parentRequest.serviceIdentifier===t||my(e.parentRequest,t))}function gy(e){e.childRequests.forEach(t=>{if(my(e,t.serviceIdentifier)){const i=(function(r){return(function a(s,o=[]){const l=ln(s.serviceIdentifier);return o.push(l),s.parentRequest!==null?a(s.parentRequest,o):o})(r).reverse().join(" --> ")})(t);throw new Error(`Circular dependency found: ${i}`)}gy(t)})}function py(e){if(e.name!=null&&e.name!=="")return e.name;{const t=e.toString(),i=t.match(/^function\s*([^\s(]+)/);return i===null?`Anonymous function: ${t}`:i[1]}}function cm(e){return`{"key":"${e.key.toString()}","value":"${e.value.toString()}"}`}(function(e){e[e.MultipleBindingsAvailable=2]="MultipleBindingsAvailable",e[e.NoBindingsAvailable=0]="NoBindingsAvailable",e[e.OnlyOneBindingAvailable=1]="OnlyOneBindingAvailable"})(pa||(pa={}));class vy{constructor(t){B(this,"id");B(this,"container");B(this,"plan");B(this,"currentRequest");this.id=oc(),this.container=t}addPlan(t){this.plan=t}setCurrentRequest(t){this.currentRequest=t}}class _s{constructor(t,i){B(this,"key");B(this,"value");this.key=t,this.value=i}toString(){return this.key===Ri?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}class y1{constructor(t,i){B(this,"parentContext");B(this,"rootRequest");this.parentContext=t,this.rootRequest=i}}function yy(e,t){const i=(function(o){const l=Object.getPrototypeOf(o.prototype);return l==null?void 0:l.constructor})(t);if(i===void 0||i===Object)return 0;const r=ly(e)(i),n=r.map(o=>o.metadata.filter(l=>l.key===h1)),a=[].concat.apply([],n).length,s=r.length-a;return s>0?s:yy(e,i)}class so{constructor(t,i,r,n,a){B(this,"id");B(this,"serviceIdentifier");B(this,"parentContext");B(this,"parentRequest");B(this,"bindings");B(this,"childRequests");B(this,"target");B(this,"requestScope");this.id=oc(),this.serviceIdentifier=t,this.parentContext=i,this.parentRequest=r,this.target=a,this.childRequests=[],this.bindings=Array.isArray(n)?n:[n],this.requestScope=r===null?new Map:null}addChildRequest(t,i,r){const n=new so(t,this.parentContext,this,i,r);return this.childRequests.push(n),n}}function kl(e){return e._bindingDictionary}function hm(e,t,i,r,n){let a=ms(i.container,n.serviceIdentifier),s=[];return a.length===pa.NoBindingsAvailable&&i.container.options.autoBindInjectable===!0&&typeof n.serviceIdentifier=="function"&&e.getConstructorMetadata(n.serviceIdentifier).compilerGeneratedMetadata&&(i.container.bind(n.serviceIdentifier).toSelf(),a=ms(i.container,n.serviceIdentifier)),s=t?a:a.filter(o=>{const l=new so(o.serviceIdentifier,i,r,o,n);return o.constraint(l)}),(function(o,l,h,c,u){switch(l.length){case pa.NoBindingsAvailable:if(c.isOptional())return l;{const d=ln(o);let f="No matching bindings found for serviceIdentifier:";throw f+=(function(m,p){if(p.isTagged()||p.isNamed()){let g="";const y=p.getNamedTag(),T=p.getCustomTags();return y!==null&&(g+=cm(y)+`
`),T!==null&&T.forEach(b=>{g+=cm(b)+`
`}),` ${m}
 ${m} - ${g}`}return` ${m}`})(d,c),f+=lm(u,d,ms),h!==null&&(f+=`
Trying to resolve bindings for "${ln(h.serviceIdentifier)}"`),new Error(f)}case pa.OnlyOneBindingAvailable:return l;case pa.MultipleBindingsAvailable:default:if(c.isArray())return l;{const d=ln(o);let f=`Ambiguous match found for serviceIdentifier: ${d}`;throw f+=lm(u,d,ms),new Error(f)}}})(n.serviceIdentifier,s,r,n,i.container),s}function by(e,t){const i=t.isMultiInject?d1:cy,r=[new _s(i,e)];return t.customTag!==void 0&&r.push(new _s(t.customTag.key,t.customTag.value)),t.isOptional===!0&&r.push(new _s(u1,!0)),r}function wy(e,t,i,r,n,a){let s,o;if(n===null){s=hm(e,t,r,null,a),o=new so(i,r,null,s,a);const l=new y1(r,o);r.addPlan(l)}else s=hm(e,t,r,n,a),o=n.addChildRequest(a.serviceIdentifier,s,a);s.forEach(l=>{let h=null;if(a.isArray())h=o.addChildRequest(l.serviceIdentifier,l,a);else{if(l.cache!==null)return;h=o}if(l.type===Rl&&l.implementationType!==null){const c=(function(u,d){return ly(u)(d)})(e,l.implementationType);if(r.container.options.skipBaseClassChecks!==!0){const u=yy(e,l.implementationType);if(c.length<u){const d=`The number of constructor arguments in the derived class ${py(l.implementationType)} must be >= than the number of constructor arguments of its base class.`;throw new Error(d)}}c.forEach(u=>{wy(e,!1,u.serviceIdentifier,r,h,u)})}})}function ms(e,t){let i=[];const r=kl(e);return r.hasKey(t)?i=r.get(t):e.parent!==null&&(i=ms(e.parent,t)),i}function b1(e,t,i,r,n,a=!1){const s=new vy(t),o=(function(l,h,c){const u=sc(by(h,c));if(u.kind===li.unmanaged)throw new Error("Unexpected metadata when creating target");return new Al("",u,l)})(i,r,n);try{return wy(e,a,r,s,null,o),s}catch(l){throw fy(l)&&gy(s.plan.rootRequest),l}}function ei(e){return(typeof e=="object"&&e!==null||typeof e=="function")&&typeof e.then=="function"}function Ty(e){return!!ei(e)||Array.isArray(e)&&e.some(ei)}const w1=async(e,t)=>{try{const i=await t;e.cache=i}catch(i){throw e.cache=null,e.activated=!1,i}};var Ss;function um(e){const t=new e.constr(...e.constructorInjections);return e.propertyRequests.forEach((i,r)=>{const n=i.target.identifier,a=e.propertyInjections[r];i.target.isOptional()&&a===void 0||(t[n]=a)}),t}async function dm(e){const t=[];for(const i of e)Array.isArray(i)?t.push(Promise.all(i)):t.push(i);return Promise.all(t)}function fm(e,t){const i=(function(r,n){var a;if(Reflect.hasMetadata(rm,r)){const s=Reflect.getMetadata(rm,r);try{return(a=n[s.value])==null?void 0:a.call(n)}catch(o){if(o instanceof Error)throw new Error(`@postConstruct error in class ${r.name}: ${o.message}`)}}})(e,t);return ei(i)?i.then(()=>t):t}(function(e){e.DynamicValue="toDynamicValue",e.Factory="toFactory",e.Provider="toProvider"})(Ss||(Ss={}));const Du=e=>t=>{t.parentContext.setCurrentRequest(t);const i=t.bindings,r=t.childRequests,n=t.target&&t.target.isArray(),a=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(n&&a)return r.map(s=>Du(e)(s));{if(t.target.isOptional()&&i.length===0)return;const s=i[0];return _1(e,t,s)}},T1=(e,t,i)=>{let r;const n=t.childRequests;switch((a=>{let s=null;switch(a.type){case Fh:case jh:s=a.cache;break;case Bh:case Rl:s=a.implementationType;break;case xl:s=a.dynamicValue;break;case Wh:s=a.provider;break;case Es:s=a.factory}if(s===null){const o=ln(a.serviceIdentifier);throw new Error(`Invalid binding type: ${o}`)}})(i),i.type){case Fh:case jh:r=i.cache;break;case Bh:r=i.implementationType;break;case Rl:r=(function(a,s,o,l){(function(c,u){c.scope!==pi&&(function(d,f){const m=`Class cannot be instantiated in ${d.scope===Ys?"request":"transient"} scope.`;if(typeof d.onDeactivation=="function")throw new Error(zh(f.name,m));if(Reflect.hasMetadata(Uh,f))throw new Error(`@preDestroy error in class ${f.name}: ${m}`)})(c,u)})(a,s);const h=(function(c,u,d){let f;if(u.length>0){const m=(function(g,y){return g.reduce((T,b)=>{const S=y(b);return b.target.type===m1?T.constructorInjections.push(S):(T.propertyRequests.push(b),T.propertyInjections.push(S)),T.isAsync||(T.isAsync=Ty(S)),T},{constructorInjections:[],isAsync:!1,propertyInjections:[],propertyRequests:[]})})(u,d),p={...m,constr:c};f=m.isAsync?(async function(g){const y=await dm(g.constructorInjections),T=await dm(g.propertyInjections);return um({...g,constructorInjections:y,propertyInjections:T})})(p):um(p)}else f=new c;return f})(s,o,l);return ei(h)?h.then(c=>fm(s,c)):fm(s,h)})(i,i.implementationType,n,Du(e));break;default:r=((a,s)=>{const o=(l=>{switch(l.type){case Es:return{factory:l.factory,factoryType:Ss.Factory};case Wh:return{factory:l.provider,factoryType:Ss.Provider};case xl:return{factory:l.dynamicValue,factoryType:Ss.DynamicValue};default:throw new Error(`Unexpected factory type ${l.type}`)}})(a);return((l,h)=>{try{return l()}catch(c){throw fy(c)?h():c}})(()=>o.factory.bind(a)(s),()=>new Error(`It looks like there is a circular dependency in one of the '${o.factoryType}' bindings. Please investigate bindings with service identifier '${s.currentRequest.serviceIdentifier.toString()}'.`))})(i,t.parentContext)}return r},E1=(e,t,i)=>{let r=((n,a)=>a.scope===pi&&a.activated?a.cache:a.scope===Ys&&n.has(a.id)?n.get(a.id):null)(e,t);return r!==null||(r=i(),((n,a,s)=>{a.scope===pi&&((o,l)=>{o.cache=l,o.activated=!0,ei(l)&&w1(o,l)})(a,s),a.scope===Ys&&((o,l,h)=>{o.has(l.id)||o.set(l.id,h)})(n,a,s)})(e,t,r)),r},_1=(e,t,i)=>E1(e,i,()=>{let r=T1(e,t,i);return r=ei(r)?r.then(n=>mm(t,i,n)):mm(t,i,r),r});function mm(e,t,i){let r=S1(e.parentContext,t,i);const n=R1(e.parentContext.container);let a,s=n.next();do{a=s.value;const o=e.parentContext,l=e.serviceIdentifier,h=x1(a,l);r=ei(r)?Ey(h,o,r):A1(h,o,r),s=n.next()}while(s.done!==!0&&!kl(a).hasKey(e.serviceIdentifier));return r}const S1=(e,t,i)=>{let r;return r=typeof t.onActivation=="function"?t.onActivation(e,i):i,r},A1=(e,t,i)=>{let r=e.next();for(;r.done!==!0;){if(ei(i=r.value(t,i)))return Ey(e,t,i);r=e.next()}return i},Ey=async(e,t,i)=>{let r=await i,n=e.next();for(;n.done!==!0;)r=await n.value(t,r),n=e.next();return r},x1=(e,t)=>{const i=e._activations;return i.hasKey(t)?i.get(t).values():[].values()},R1=e=>{const t=[e];let i=e.parent;for(;i!==null;)t.push(i),i=i.parent;return{next:()=>{const r=t.pop();return r!==void 0?{done:!1,value:r}:{done:!0,value:void 0}}}},br=(e,t)=>{const i=e.parentRequest;return i!==null&&(!!t(i)||br(i,t))},gs=e=>t=>{const i=r=>r!==null&&r.target!==null&&r.target.matchesTag(e)(t);return i.metaData=new _s(e,t),i},Wo=gs(Ri),Jc=e=>t=>{let i=null;if(t!==null){if(i=t.bindings[0],typeof e=="string")return i.serviceIdentifier===e;{const r=t.bindings[0].implementationType;return e===r}}return!1};class Il{constructor(t){B(this,"_binding");this._binding=t}when(t){return this._binding.constraint=t,new Fe(this._binding)}whenTargetNamed(t){return this._binding.constraint=Wo(t),new Fe(this._binding)}whenTargetIsDefault(){return this._binding.constraint=t=>t!==null&&t.target!==null&&!t.target.isNamed()&&!t.target.isTagged(),new Fe(this._binding)}whenTargetTagged(t,i){return this._binding.constraint=gs(t)(i),new Fe(this._binding)}whenInjectedInto(t){return this._binding.constraint=i=>i!==null&&Jc(t)(i.parentRequest),new Fe(this._binding)}whenParentNamed(t){return this._binding.constraint=i=>i!==null&&Wo(t)(i.parentRequest),new Fe(this._binding)}whenParentTagged(t,i){return this._binding.constraint=r=>r!==null&&gs(t)(i)(r.parentRequest),new Fe(this._binding)}whenAnyAncestorIs(t){return this._binding.constraint=i=>i!==null&&br(i,Jc(t)),new Fe(this._binding)}whenNoAncestorIs(t){return this._binding.constraint=i=>i!==null&&!br(i,Jc(t)),new Fe(this._binding)}whenAnyAncestorNamed(t){return this._binding.constraint=i=>i!==null&&br(i,Wo(t)),new Fe(this._binding)}whenNoAncestorNamed(t){return this._binding.constraint=i=>i!==null&&!br(i,Wo(t)),new Fe(this._binding)}whenAnyAncestorTagged(t,i){return this._binding.constraint=r=>r!==null&&br(r,gs(t)(i)),new Fe(this._binding)}whenNoAncestorTagged(t,i){return this._binding.constraint=r=>r!==null&&!br(r,gs(t)(i)),new Fe(this._binding)}whenAnyAncestorMatches(t){return this._binding.constraint=i=>i!==null&&br(i,t),new Fe(this._binding)}whenNoAncestorMatches(t){return this._binding.constraint=i=>i!==null&&!br(i,t),new Fe(this._binding)}}class Fe{constructor(t){B(this,"_binding");this._binding=t}onActivation(t){return this._binding.onActivation=t,new Il(this._binding)}onDeactivation(t){return this._binding.onDeactivation=t,new Il(this._binding)}}class Sr{constructor(t){B(this,"_bindingWhenSyntax");B(this,"_bindingOnSyntax");B(this,"_binding");this._binding=t,this._bindingWhenSyntax=new Il(this._binding),this._bindingOnSyntax=new Fe(this._binding)}when(t){return this._bindingWhenSyntax.when(t)}whenTargetNamed(t){return this._bindingWhenSyntax.whenTargetNamed(t)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(t,i){return this._bindingWhenSyntax.whenTargetTagged(t,i)}whenInjectedInto(t){return this._bindingWhenSyntax.whenInjectedInto(t)}whenParentNamed(t){return this._bindingWhenSyntax.whenParentNamed(t)}whenParentTagged(t,i){return this._bindingWhenSyntax.whenParentTagged(t,i)}whenAnyAncestorIs(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)}whenNoAncestorIs(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)}whenAnyAncestorNamed(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)}whenAnyAncestorTagged(t,i){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,i)}whenNoAncestorNamed(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)}whenNoAncestorTagged(t,i){return this._bindingWhenSyntax.whenNoAncestorTagged(t,i)}whenAnyAncestorMatches(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)}whenNoAncestorMatches(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)}onActivation(t){return this._bindingOnSyntax.onActivation(t)}onDeactivation(t){return this._bindingOnSyntax.onDeactivation(t)}}class k1{constructor(t){B(this,"_binding");this._binding=t}inRequestScope(){return this._binding.scope=Ys,new Sr(this._binding)}inSingletonScope(){return this._binding.scope=pi,new Sr(this._binding)}inTransientScope(){return this._binding.scope=nl,new Sr(this._binding)}}class gm{constructor(t){B(this,"_bindingInSyntax");B(this,"_bindingWhenSyntax");B(this,"_bindingOnSyntax");B(this,"_binding");this._binding=t,this._bindingWhenSyntax=new Il(this._binding),this._bindingOnSyntax=new Fe(this._binding),this._bindingInSyntax=new k1(t)}inRequestScope(){return this._bindingInSyntax.inRequestScope()}inSingletonScope(){return this._bindingInSyntax.inSingletonScope()}inTransientScope(){return this._bindingInSyntax.inTransientScope()}when(t){return this._bindingWhenSyntax.when(t)}whenTargetNamed(t){return this._bindingWhenSyntax.whenTargetNamed(t)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(t,i){return this._bindingWhenSyntax.whenTargetTagged(t,i)}whenInjectedInto(t){return this._bindingWhenSyntax.whenInjectedInto(t)}whenParentNamed(t){return this._bindingWhenSyntax.whenParentNamed(t)}whenParentTagged(t,i){return this._bindingWhenSyntax.whenParentTagged(t,i)}whenAnyAncestorIs(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)}whenNoAncestorIs(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)}whenAnyAncestorNamed(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)}whenAnyAncestorTagged(t,i){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,i)}whenNoAncestorNamed(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)}whenNoAncestorTagged(t,i){return this._bindingWhenSyntax.whenNoAncestorTagged(t,i)}whenAnyAncestorMatches(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)}whenNoAncestorMatches(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)}onActivation(t){return this._bindingOnSyntax.onActivation(t)}onDeactivation(t){return this._bindingOnSyntax.onDeactivation(t)}}class I1{constructor(t){B(this,"_binding");this._binding=t}to(t){return this._binding.type=Rl,this._binding.implementationType=t,new gm(this._binding)}toSelf(){if(typeof this._binding.serviceIdentifier!="function")throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");const t=this._binding.serviceIdentifier;return this.to(t)}toConstantValue(t){return this._binding.type=Fh,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=pi,new Sr(this._binding)}toDynamicValue(t){return this._binding.type=xl,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new gm(this._binding)}toConstructor(t){return this._binding.type=Bh,this._binding.implementationType=t,this._binding.scope=pi,new Sr(this._binding)}toFactory(t){return this._binding.type=Es,this._binding.factory=t,this._binding.scope=pi,new Sr(this._binding)}toFunction(t){if(typeof t!="function")throw new Error("Value provided to function binding must be a function!");const i=this.toConstantValue(t);return this._binding.type=jh,this._binding.scope=pi,i}toAutoFactory(t){return this._binding.type=Es,this._binding.factory=i=>()=>i.container.get(t),this._binding.scope=pi,new Sr(this._binding)}toAutoNamedFactory(t){return this._binding.type=Es,this._binding.factory=i=>r=>i.container.getNamed(t,r),new Sr(this._binding)}toProvider(t){return this._binding.type=Wh,this._binding.provider=t,this._binding.scope=pi,new Sr(this._binding)}toService(t){this._binding.type=xl,Object.defineProperty(this._binding,"cache",{configurable:!0,enumerable:!0,get:()=>null,set(i){}}),this._binding.dynamicValue=i=>{try{return i.container.get(t)}catch{return i.container.getAsync(t)}},this._binding.implementationType=null}}class Ou{constructor(){B(this,"bindings");B(this,"activations");B(this,"deactivations");B(this,"middleware");B(this,"moduleActivationStore")}static of(t,i,r,n,a){const s=new Ou;return s.bindings=t,s.middleware=i,s.deactivations=n,s.activations=r,s.moduleActivationStore=a,s}}class Ir{constructor(){B(this,"_map");this._map=new Map}getMap(){return this._map}add(t,i){if(this._checkNonNulish(t),i==null)throw new Error(am);const r=this._map.get(t);r!==void 0?r.push(i):this._map.set(t,[i])}get(t){this._checkNonNulish(t);const i=this._map.get(t);if(i!==void 0)return i;throw new Error(sm)}remove(t){if(this._checkNonNulish(t),!this._map.delete(t))throw new Error(sm)}removeIntersection(t){this.traverse((i,r)=>{const n=t.hasKey(i)?t.get(i):void 0;if(n!==void 0){const a=r.filter(s=>!n.some(o=>s===o));this._setValue(i,a)}})}removeByCondition(t){const i=[];return this._map.forEach((r,n)=>{const a=[];for(const s of r)t(s)?i.push(s):a.push(s);this._setValue(n,a)}),i}hasKey(t){return this._checkNonNulish(t),this._map.has(t)}clone(){const t=new Ir;return this._map.forEach((i,r)=>{i.forEach(n=>{var a;t.add(r,typeof(a=n)=="object"&&a!==null&&"clone"in a&&typeof a.clone=="function"?n.clone():n)})}),t}traverse(t){this._map.forEach((i,r)=>{t(r,i)})}_checkNonNulish(t){if(t==null)throw new Error(am)}_setValue(t,i){i.length>0?this._map.set(t,i):this._map.delete(t)}}class Mu{constructor(){B(this,"_map",new Map)}remove(t){const i=this._map.get(t);return i===void 0?this._getEmptyHandlersStore():(this._map.delete(t),i)}addDeactivation(t,i,r){this._getModuleActivationHandlers(t).onDeactivations.add(i,r)}addActivation(t,i,r){this._getModuleActivationHandlers(t).onActivations.add(i,r)}clone(){const t=new Mu;return this._map.forEach((i,r)=>{t._map.set(r,{onActivations:i.onActivations.clone(),onDeactivations:i.onDeactivations.clone()})}),t}_getModuleActivationHandlers(t){let i=this._map.get(t);return i===void 0&&(i=this._getEmptyHandlersStore(),this._map.set(t,i)),i}_getEmptyHandlersStore(){return{onActivations:new Ir,onDeactivations:new Ir}}}class Cl{constructor(t){B(this,"id");B(this,"parent");B(this,"options");B(this,"_middleware");B(this,"_bindingDictionary");B(this,"_activations");B(this,"_deactivations");B(this,"_snapshots");B(this,"_metadataReader");B(this,"_moduleActivationStore");const i=t||{};if(typeof i!="object")throw new Error("Invalid Container constructor argument. Container options must be an object.");if(i.defaultScope===void 0)i.defaultScope=nl;else if(i.defaultScope!==pi&&i.defaultScope!==nl&&i.defaultScope!==Ys)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(i.autoBindInjectable===void 0)i.autoBindInjectable=!1;else if(typeof i.autoBindInjectable!="boolean")throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(i.skipBaseClassChecks===void 0)i.skipBaseClassChecks=!1;else if(typeof i.skipBaseClassChecks!="boolean")throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:i.autoBindInjectable,defaultScope:i.defaultScope,skipBaseClassChecks:i.skipBaseClassChecks},this.id=oc(),this._bindingDictionary=new Ir,this._snapshots=[],this._middleware=null,this._activations=new Ir,this._deactivations=new Ir,this.parent=null,this._metadataReader=new v1,this._moduleActivationStore=new Mu}static merge(t,i,...r){const n=new Cl,a=[t,i,...r].map(o=>kl(o)),s=kl(n);return a.forEach(o=>{var l;l=s,o.traverse((h,c)=>{c.forEach(u=>{l.add(u.serviceIdentifier,u.clone())})})}),n}load(...t){const i=this._getContainerModuleHelpersFactory();for(const r of t){const n=i(r.id);r.registry(n.bindFunction,n.unbindFunction,n.isboundFunction,n.rebindFunction,n.unbindAsyncFunction,n.onActivationFunction,n.onDeactivationFunction)}}async loadAsync(...t){const i=this._getContainerModuleHelpersFactory();for(const r of t){const n=i(r.id);await r.registry(n.bindFunction,n.unbindFunction,n.isboundFunction,n.rebindFunction,n.unbindAsyncFunction,n.onActivationFunction,n.onDeactivationFunction)}}unload(...t){t.forEach(i=>{const r=this._removeModuleBindings(i.id);this._deactivateSingletons(r),this._removeModuleHandlers(i.id)})}async unloadAsync(...t){for(const i of t){const r=this._removeModuleBindings(i.id);await this._deactivateSingletonsAsync(r),this._removeModuleHandlers(i.id)}}bind(t){return this._bind(this._buildBinding(t))}rebind(t){return this.unbind(t),this.bind(t)}async rebindAsync(t){return await this.unbindAsync(t),this.bind(t)}unbind(t){if(this._bindingDictionary.hasKey(t)){const i=this._bindingDictionary.get(t);this._deactivateSingletons(i)}this._removeServiceFromDictionary(t)}async unbindAsync(t){if(this._bindingDictionary.hasKey(t)){const i=this._bindingDictionary.get(t);await this._deactivateSingletonsAsync(i)}this._removeServiceFromDictionary(t)}unbindAll(){this._bindingDictionary.traverse((t,i)=>{this._deactivateSingletons(i)}),this._bindingDictionary=new Ir}async unbindAllAsync(){const t=[];this._bindingDictionary.traverse((i,r)=>{t.push(this._deactivateSingletonsAsync(r))}),await Promise.all(t),this._bindingDictionary=new Ir}onActivation(t,i){this._activations.add(t,i)}onDeactivation(t,i){this._deactivations.add(t,i)}isBound(t){let i=this._bindingDictionary.hasKey(t);return!i&&this.parent&&(i=this.parent.isBound(t)),i}isCurrentBound(t){return this._bindingDictionary.hasKey(t)}isBoundNamed(t,i){return this.isBoundTagged(t,Ri,i)}isBoundTagged(t,i,r){let n=!1;if(this._bindingDictionary.hasKey(t)){const a=this._bindingDictionary.get(t),s=(function(o,l,h){const c=sc(by(l,h));if(c.kind===li.unmanaged)throw new Error("Unexpected metadata when creating target");const u=new Al("",c,"Variable"),d=new vy(o);return new so(l,d,null,[],u)})(this,t,{customTag:{key:i,value:r},isMultiInject:!1});n=a.some(o=>o.constraint(s))}return!n&&this.parent&&(n=this.parent.isBoundTagged(t,i,r)),n}snapshot(){this._snapshots.push(Ou.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))}restore(){const t=this._snapshots.pop();if(t===void 0)throw new Error("No snapshot available to restore.");this._bindingDictionary=t.bindings,this._activations=t.activations,this._deactivations=t.deactivations,this._middleware=t.middleware,this._moduleActivationStore=t.moduleActivationStore}createChild(t){const i=new Cl(t||this.options);return i.parent=this,i}applyMiddleware(...t){const i=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((r,n)=>n(r),i)}applyCustomMetadataReader(t){this._metadataReader=t}get(t){const i=this._getNotAllArgs(t,!1,!1);return this._getButThrowIfAsync(i)}async getAsync(t){const i=this._getNotAllArgs(t,!1,!1);return this._get(i)}getTagged(t,i,r){const n=this._getNotAllArgs(t,!1,!1,i,r);return this._getButThrowIfAsync(n)}async getTaggedAsync(t,i,r){const n=this._getNotAllArgs(t,!1,!1,i,r);return this._get(n)}getNamed(t,i){return this.getTagged(t,Ri,i)}async getNamedAsync(t,i){return this.getTaggedAsync(t,Ri,i)}getAll(t,i){const r=this._getAllArgs(t,i,!1);return this._getButThrowIfAsync(r)}async getAllAsync(t,i){const r=this._getAllArgs(t,i,!1);return this._getAll(r)}getAllTagged(t,i,r){const n=this._getNotAllArgs(t,!0,!1,i,r);return this._getButThrowIfAsync(n)}async getAllTaggedAsync(t,i,r){const n=this._getNotAllArgs(t,!0,!1,i,r);return this._getAll(n)}getAllNamed(t,i){return this.getAllTagged(t,Ri,i)}async getAllNamedAsync(t,i){return this.getAllTaggedAsync(t,Ri,i)}resolve(t){const i=this.isBound(t);i||this.bind(t).toSelf();const r=this.get(t);return i||this.unbind(t),r}tryGet(t){const i=this._getNotAllArgs(t,!1,!0);return this._getButThrowIfAsync(i)}async tryGetAsync(t){const i=this._getNotAllArgs(t,!1,!0);return this._get(i)}tryGetTagged(t,i,r){const n=this._getNotAllArgs(t,!1,!0,i,r);return this._getButThrowIfAsync(n)}async tryGetTaggedAsync(t,i,r){const n=this._getNotAllArgs(t,!1,!0,i,r);return this._get(n)}tryGetNamed(t,i){return this.tryGetTagged(t,Ri,i)}async tryGetNamedAsync(t,i){return this.tryGetTaggedAsync(t,Ri,i)}tryGetAll(t,i){const r=this._getAllArgs(t,i,!0);return this._getButThrowIfAsync(r)}async tryGetAllAsync(t,i){const r=this._getAllArgs(t,i,!0);return this._getAll(r)}tryGetAllTagged(t,i,r){const n=this._getNotAllArgs(t,!0,!0,i,r);return this._getButThrowIfAsync(n)}async tryGetAllTaggedAsync(t,i,r){const n=this._getNotAllArgs(t,!0,!0,i,r);return this._getAll(n)}tryGetAllNamed(t,i){return this.tryGetAllTagged(t,Ri,i)}async tryGetAllNamedAsync(t,i){return this.tryGetAllTaggedAsync(t,Ri,i)}_preDestroy(t,i){var r;if(t!==void 0&&Reflect.hasMetadata(Uh,t)){const n=Reflect.getMetadata(Uh,t);return(r=i[n.value])==null?void 0:r.call(i)}}_removeModuleHandlers(t){const i=this._moduleActivationStore.remove(t);this._activations.removeIntersection(i.onActivations),this._deactivations.removeIntersection(i.onDeactivations)}_removeModuleBindings(t){return this._bindingDictionary.removeByCondition(i=>i.moduleId===t)}_deactivate(t,i){const r=i==null?void 0:Object.getPrototypeOf(i).constructor;try{if(this._deactivations.hasKey(t.serviceIdentifier)){const a=this._deactivateContainer(i,this._deactivations.get(t.serviceIdentifier).values());if(ei(a))return this._handleDeactivationError(a.then(async()=>this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(t,i,r)),t.serviceIdentifier)}const n=this._propagateContainerDeactivationThenBindingAndPreDestroy(t,i,r);if(ei(n))return this._handleDeactivationError(n,t.serviceIdentifier)}catch(n){if(n instanceof Error)throw new Error(zh(ln(t.serviceIdentifier),n.message))}}async _handleDeactivationError(t,i){try{await t}catch(r){if(r instanceof Error)throw new Error(zh(ln(i),r.message))}}_deactivateContainer(t,i){let r=i.next();for(;typeof r.value=="function";){const n=r.value(t);if(ei(n))return n.then(async()=>this._deactivateContainerAsync(t,i));r=i.next()}}async _deactivateContainerAsync(t,i){let r=i.next();for(;typeof r.value=="function";)await r.value(t),r=i.next()}_getContainerModuleHelpersFactory(){const t=l=>h=>{const c=this._buildBinding(h);return c.moduleId=l,this._bind(c)},i=()=>l=>{this.unbind(l)},r=()=>async l=>this.unbindAsync(l),n=()=>l=>this.isBound(l),a=l=>{const h=t(l);return c=>(this.unbind(c),h(c))},s=l=>(h,c)=>{this._moduleActivationStore.addActivation(l,h,c),this.onActivation(h,c)},o=l=>(h,c)=>{this._moduleActivationStore.addDeactivation(l,h,c),this.onDeactivation(h,c)};return l=>({bindFunction:t(l),isboundFunction:n(),onActivationFunction:s(l),onDeactivationFunction:o(l),rebindFunction:a(l),unbindAsyncFunction:r(),unbindFunction:i()})}_bind(t){return this._bindingDictionary.add(t.serviceIdentifier,t),new I1(t)}_buildBinding(t){const i=this.options.defaultScope||nl;return new Cu(t,i)}async _getAll(t){return Promise.all(this._get(t))}_get(t){const i={...t,contextInterceptor:r=>r,targetType:g1};if(this._middleware){const r=this._middleware(i);if(r==null)throw new Error("Invalid return type in middleware. Middleware must return!");return r}return this._planAndResolve()(i)}_getButThrowIfAsync(t){const i=this._get(t);if(Ty(i))throw new Error(`You are attempting to construct ${(function(r){return typeof r=="function"?`[function/class ${r.name||"<anonymous>"}]`:typeof r=="symbol"?r.toString():`'${r}'`})(t.serviceIdentifier)} in a synchronous way but it has asynchronous dependencies.`);return i}_getAllArgs(t,i,r){return{avoidConstraints:!(i!=null&&i.enforceBindingConstraints),isMultiInject:!0,isOptional:r,serviceIdentifier:t}}_getNotAllArgs(t,i,r,n,a){return{avoidConstraints:!1,isMultiInject:i,isOptional:r,key:n,serviceIdentifier:t,value:a}}_getPlanMetadataFromNextArgs(t){const i={isMultiInject:t.isMultiInject};return t.key!==void 0&&(i.customTag={key:t.key,value:t.value}),t.isOptional===!0&&(i.isOptional=!0),i}_planAndResolve(){return t=>{let i=b1(this._metadataReader,this,t.targetType,t.serviceIdentifier,this._getPlanMetadataFromNextArgs(t),t.avoidConstraints);return i=t.contextInterceptor(i),(function(n){return Du(n.plan.rootRequest.requestScope)(n.plan.rootRequest)})(i)}}_deactivateIfSingleton(t){if(t.activated)return ei(t.cache)?t.cache.then(i=>this._deactivate(t,i)):this._deactivate(t,t.cache)}_deactivateSingletons(t){for(const i of t)if(ei(this._deactivateIfSingleton(i)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}async _deactivateSingletonsAsync(t){await Promise.all(t.map(async i=>this._deactivateIfSingleton(i)))}_propagateContainerDeactivationThenBindingAndPreDestroy(t,i,r){return this.parent?this._deactivate.bind(this.parent)(t,i):this._bindingDeactivationAndPreDestroy(t,i,r)}async _propagateContainerDeactivationThenBindingAndPreDestroyAsync(t,i,r){this.parent?await this._deactivate.bind(this.parent)(t,i):await this._bindingDeactivationAndPreDestroyAsync(t,i,r)}_removeServiceFromDictionary(t){try{this._bindingDictionary.remove(t)}catch{throw new Error(`Could not unbind serviceIdentifier: ${ln(t)}`)}}_bindingDeactivationAndPreDestroy(t,i,r){if(typeof t.onDeactivation=="function"){const n=t.onDeactivation(i);if(ei(n))return n.then(()=>this._preDestroy(r,i))}return this._preDestroy(r,i)}async _bindingDeactivationAndPreDestroyAsync(t,i,r){typeof t.onDeactivation=="function"&&await t.onDeactivation(i),await this._preDestroy(r,i)}}function pm(e,t,i,r){const n=(function(o){let l=[];if(Array.isArray(o)){l=o;const h=(function(c){const u=new Set;for(const d of c){if(u.has(d))return d;u.add(d)}})(l.map(c=>c.key));if(h!==void 0)throw new Error(`${nm} ${h.toString()}`)}else l=[o];return l})(r);let a={};Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));let s=a[i];if(s===void 0)s=[];else for(const o of s)if(n.some(l=>l.key===o.key))throw new Error(`${nm} ${o.key.toString()}`);s.push(...n),a[i]=s,Reflect.defineMetadata(e,a,t)}function C1(e){return(t,i,r)=>{typeof r=="number"?(function(n,a,s,o){(function(l){if(l!==void 0)throw new Error(om)})(a),pm(hy,n,s.toString(),o)})(t,i,r,e):(function(n,a,s){if(n.prototype!==void 0)throw new Error(om);pm(uy,n.constructor,a,s)})(t,i,e)}}function Ti(){return function(e){if(Reflect.hasOwnMetadata(im,e))throw new Error("Cannot apply @injectable decorator multiple times.");const t=Reflect.getMetadata(dy,e)||[];return Reflect.defineMetadata(im,t,e),e}}const re=(function(e){return t=>(i,r,n)=>{if(t===void 0){const a=typeof i=="function"?i.name:i.constructor.name;throw new Error(`@inject called with undefined this could mean that the class ${a} has a circular dependency problem. You can use a LazyServiceIdentifer to overcome this limitation.`)}C1(new _s(e,t))(i,r,n)}})(cy);var wt,va,oo=(function(){function e(){}return e.prototype.runOutsideAngular=function(t){return t()},e=bi([Ti(),wi("design:paramtypes",[])],e)})(),lc=(function(){function e(){}return e.prototype.instant=function(t,i){return t},e=bi([Ti(),wi("design:paramtypes",[])],e)})();(function(e){e.TENANT="TENANT",e.TENANT_PROFILE="TENANT_PROFILE",e.CUSTOMER="CUSTOMER",e.USER="USER",e.DASHBOARD="DASHBOARD",e.ASSET="ASSET",e.DEVICE="DEVICE",e.DEVICE_PROFILE="DEVICE_PROFILE",e.ASSET_PROFILE="ASSET_PROFILE",e.ALARM="ALARM",e.RULE_CHAIN="RULE_CHAIN",e.RULE_NODE="RULE_NODE",e.EDGE="EDGE",e.ENTITY_VIEW="ENTITY_VIEW",e.WIDGETS_BUNDLE="WIDGETS_BUNDLE",e.WIDGET_TYPE="WIDGET_TYPE",e.API_USAGE_STATE="API_USAGE_STATE",e.TB_RESOURCE="TB_RESOURCE",e.OTA_PACKAGE="OTA_PACKAGE",e.RPC="RPC",e.QUEUE="QUEUE",e.NOTIFICATION="NOTIFICATION",e.NOTIFICATION_REQUEST="NOTIFICATION_REQUEST",e.NOTIFICATION_RULE="NOTIFICATION_RULE",e.NOTIFICATION_TARGET="NOTIFICATION_TARGET",e.NOTIFICATION_TEMPLATE="NOTIFICATION_TEMPLATE",e.SchedulerEvent="SchedulerEvent",e.ROLE="ROLE",e.ENTITY_GROUP="ENTITY_GROUP"})(wt||(wt={})),(function(e){e.CURRENT_CUSTOMER="CURRENT_CUSTOMER",e.CURRENT_TENANT="CURRENT_TENANT",e.CURRENT_USER="CURRENT_USER",e.CURRENT_USER_OWNER="CURRENT_USER_OWNER"})(va||(va={}));var D1=new Map([[wt.TENANT,{type:"entity.type-tenant",typePlural:"entity.type-tenants",list:"entity.list-of-tenants",nameStartsWith:"entity.tenant-name-starts-with",details:"tenant.tenant-details",add:"tenant.add",noEntities:"tenant.no-tenants-text",search:"tenant.search",selectedEntities:"tenant.selected-tenants"}],[wt.TENANT_PROFILE,{type:"entity.type-tenant-profile",typePlural:"entity.type-tenant-profiles",list:"entity.list-of-tenant-profiles",nameStartsWith:"entity.tenant-profile-name-starts-with",details:"tenant-profile.tenant-profile-details",add:"tenant-profile.add",noEntities:"tenant-profile.no-tenant-profiles-text",search:"tenant-profile.search",selectedEntities:"tenant-profile.selected-tenant-profiles"}],[wt.CUSTOMER,{type:"entity.type-customer",typePlural:"entity.type-customers",list:"entity.list-of-customers",nameStartsWith:"entity.customer-name-starts-with",details:"customer.customer-details",add:"customer.add",noEntities:"customer.no-customers-text",search:"customer.search",selectedEntities:"customer.selected-customers"}],[wt.USER,{type:"entity.type-user",typePlural:"entity.type-users",list:"entity.list-of-users",nameStartsWith:"entity.user-name-starts-with",details:"user.user-details",add:"user.add",noEntities:"user.no-users-text",search:"user.search",selectedEntities:"user.selected-users"}],[wt.DEVICE,{type:"entity.type-device",typePlural:"entity.type-devices",list:"entity.list-of-devices",nameStartsWith:"entity.device-name-starts-with",details:"device.device-details",add:"device.add",noEntities:"device.no-devices-text",search:"device.search",selectedEntities:"device.selected-devices"}],[wt.DEVICE_PROFILE,{type:"entity.type-device-profile",typePlural:"entity.type-device-profiles",list:"entity.list-of-device-profiles",nameStartsWith:"entity.device-profile-name-starts-with",details:"device-profile.device-profile-details",add:"device-profile.add",noEntities:"device-profile.no-device-profiles-text",search:"device-profile.search",selectedEntities:"device-profile.selected-device-profiles"}],[wt.ASSET_PROFILE,{type:"entity.type-asset-profile",typePlural:"entity.type-asset-profiles",list:"entity.list-of-asset-profiles",nameStartsWith:"entity.asset-profile-name-starts-with",details:"asset-profile.asset-profile-details",add:"asset-profile.add",noEntities:"asset-profile.no-asset-profiles-text",search:"asset-profile.search",selectedEntities:"asset-profile.selected-asset-profiles"}],[wt.ASSET,{type:"entity.type-asset",typePlural:"entity.type-assets",list:"entity.list-of-assets",nameStartsWith:"entity.asset-name-starts-with",details:"asset.asset-details",add:"asset.add",noEntities:"asset.no-assets-text",search:"asset.search",selectedEntities:"asset.selected-assets"}],[wt.EDGE,{type:"entity.type-edge",typePlural:"entity.type-edges",list:"entity.list-of-edges",nameStartsWith:"entity.edge-name-starts-with",details:"edge.edge-details",add:"edge.add",noEntities:"edge.no-edges-text",search:"edge.search",selectedEntities:"edge.selected-edges"}],[wt.ENTITY_VIEW,{type:"entity.type-entity-view",typePlural:"entity.type-entity-views",list:"entity.list-of-entity-views",nameStartsWith:"entity.entity-view-name-starts-with",details:"entity-view.entity-view-details",add:"entity-view.add",noEntities:"entity-view.no-entity-views-text",search:"entity-view.search",selectedEntities:"entity-view.selected-entity-views"}],[wt.RULE_CHAIN,{type:"entity.type-rulechain",typePlural:"entity.type-rulechains",list:"entity.list-of-rulechains",nameStartsWith:"entity.rulechain-name-starts-with",details:"rulechain.rulechain-details",add:"rulechain.add",noEntities:"rulechain.no-rulechains-text",search:"rulechain.search",selectedEntities:"rulechain.selected-rulechains"}],[wt.RULE_NODE,{type:"entity.type-rulenode",typePlural:"entity.type-rulenodes",list:"entity.list-of-rulenodes",nameStartsWith:"entity.rulenode-name-starts-with"}],[wt.DASHBOARD,{type:"entity.type-dashboard",typePlural:"entity.type-dashboards",list:"entity.list-of-dashboards",nameStartsWith:"entity.dashboard-name-starts-with",details:"dashboard.dashboard-details",add:"dashboard.add",noEntities:"dashboard.no-dashboards-text",search:"dashboard.search",selectedEntities:"dashboard.selected-dashboards"}],[wt.ALARM,{type:"entity.type-alarm",typePlural:"entity.type-alarms",list:"entity.list-of-alarms",nameStartsWith:"entity.alarm-name-starts-with",details:"alarm.alarm-details",noEntities:"alarm.no-alarms-prompt",search:"alarm.search",selectedEntities:"alarm.selected-alarms"}],[wt.API_USAGE_STATE,{type:"entity.type-api-usage-state"}],[wt.WIDGET_TYPE,{type:"entity.type-widget",typePlural:"entity.type-widgets",list:"entity.list-of-widgets",details:"widget.details",add:"dashboard.add-widget",noEntities:"widget.no-widgets-text",search:"widget.search-widgets",selectedEntities:"widget.selected-widgets"}],[wt.WIDGETS_BUNDLE,{type:"entity.type-widgets-bundle",typePlural:"entity.type-widgets-bundles",list:"entity.list-of-widgets-bundles",details:"widgets-bundle.widgets-bundle-details",add:"widgets-bundle.add",noEntities:"widgets-bundle.no-widgets-bundles-text",search:"widgets-bundle.search",selectedEntities:"widgets-bundle.selected-widgets-bundles"}],[va.CURRENT_CUSTOMER,{type:"entity.type-current-customer",list:"entity.type-current-customer"}],[va.CURRENT_TENANT,{type:"entity.type-current-tenant",list:"entity.type-current-tenant"}],[va.CURRENT_USER,{type:"entity.type-current-user",list:"entity.type-current-user"}],[va.CURRENT_USER_OWNER,{type:"entity.type-current-user-owner",list:"entity.type-current-user-owner"}],[wt.TB_RESOURCE,{type:"entity.type-tb-resource",typePlural:"entity.type-tb-resources",list:"entity.list-of-tb-resources",details:"resource.resource-library-details",add:"resource.add",noEntities:"resource.no-resource-text",search:"resource.search",selectedEntities:"resource.selected-resources"}],[wt.OTA_PACKAGE,{type:"entity.type-ota-package",details:"ota-update.ota-update-details",add:"ota-update.add",noEntities:"ota-update.no-packages-text",search:"ota-update.search",selectedEntities:"ota-update.selected-package"}],[wt.RPC,{type:"entity.type-rpc"}],[wt.QUEUE,{type:"entity.type-queue",add:"queue.add",search:"queue.search",details:"queue.details",selectedEntities:"queue.selected-queues"}],[wt.NOTIFICATION,{type:"entity.type-notification",noEntities:"notification.no-inbox-notification",search:"notification.search-notification",selectedEntities:"notification.selected-notifications"}],[wt.NOTIFICATION_REQUEST,{type:"entity.type-notification-request",noEntities:"notification.no-notification-request",selectedEntities:"notification.selected-requests"}],[wt.NOTIFICATION_RULE,{type:"entity.type-notification-rule",typePlural:"entity.type-notification-rules",list:"entity.list-of-notification-rules",noEntities:"notification.no-rules-notification",search:"notification.search-rules",selectedEntities:"notification.selected-rules"}],[wt.NOTIFICATION_TARGET,{type:"entity.type-notification-target",typePlural:"entity.type-notification-targets",list:"entity.list-of-notification-targets",noEntities:"notification.no-recipients-notification",search:"notification.search-recipients",selectedEntities:"notification.selected-recipients"}],[wt.NOTIFICATION_TEMPLATE,{type:"entity.type-notification-template",typePlural:"entity.type-notification-templates",list:"entity.list-of-notification-templates",noEntities:"notification.no-notification-templates",search:"notification.search-templates",selectedEntities:"notification.selected-template"}]]);wt.TENANT,wt.TENANT_PROFILE,wt.CUSTOMER,wt.USER,wt.DEVICE,wt.DEVICE_PROFILE,wt.ASSET_PROFILE,wt.ASSET,wt.EDGE,wt.ENTITY_VIEW,wt.RULE_CHAIN,wt.DASHBOARD,wt.WIDGET_TYPE,wt.WIDGETS_BUNDLE,wt.TB_RESOURCE,wt.OTA_PACKAGE,wt.QUEUE;var vm=new Map([[wt.TENANT,"/tenants"],[wt.TENANT_PROFILE,"/tenantProfiles"],[wt.CUSTOMER,"/customers"],[wt.USER,"/users"],[wt.DASHBOARD,"/dashboards"],[wt.ASSET,"/entities/assets"],[wt.DEVICE,"/entities/devices"],[wt.DEVICE_PROFILE,"/profiles/deviceProfiles"],[wt.ASSET_PROFILE,"/profiles/assetProfiles"],[wt.RULE_CHAIN,"/ruleChains"],[wt.EDGE,"/edgeManagement/instances"],[wt.ENTITY_VIEW,"/entities/entityViews"],[wt.TB_RESOURCE,"/resources/resources-library"],[wt.OTA_PACKAGE,"/features/otaUpdates"],[wt.QUEUE,"/settings/queues"],[wt.WIDGETS_BUNDLE,"/resources/widgets-library/widgets-bundles/details"],[wt.WIDGET_TYPE,"/resources/widgets-library/widget-types/details"]]),O1=function(e){this.entityType=wt.TENANT,this.id=e},M1=function(e){this.entityType=wt.ALARM,this.id=e},Ln="13814000-1dd2-11b2-8080-808080808080",P1=function(e){this.entityType=wt.CUSTOMER,this.id=e},N1=function(e){this.entityType=wt.USER,this.id=e},L1=function(){this.__data__=[],this.size=0},lo=function(e,t){return e===t||e!=e&&t!=t},U1=lo,cc=function(e,t){for(var i=e.length;i--;)if(U1(e[i][0],t))return i;return-1},F1=cc,B1=Array.prototype.splice,j1=function(e){var t=this.__data__,i=F1(t,e);return!(i<0)&&(i==t.length-1?t.pop():B1.call(t,i,1),--this.size,!0)},W1=cc,z1=function(e){var t=this.__data__,i=W1(t,e);return i<0?void 0:t[i][1]},V1=cc,H1=function(e){return V1(this.__data__,e)>-1},Y1=cc,q1=function(e,t){var i=this.__data__,r=Y1(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this},K1=L1,G1=j1,$1=z1,X1=H1,Q1=q1;function oa(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}oa.prototype.clear=K1,oa.prototype.delete=G1,oa.prototype.get=$1,oa.prototype.has=X1,oa.prototype.set=Q1;var hc=oa,J1=hc,Z1=function(){this.__data__=new J1,this.size=0},tA=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},eA=function(e){return this.__data__.get(e)},iA=function(e){return this.__data__.has(e)},_y=typeof Mi=="object"&&Mi&&Mi.Object===Object&&Mi,rA=_y,nA=typeof self=="object"&&self&&self.Object===Object&&self,cr=rA||nA||Function("return this")(),zr=cr.Symbol,ym=zr,Sy=Object.prototype,aA=Sy.hasOwnProperty,sA=Sy.toString,ss=ym?ym.toStringTag:void 0,oA=function(e){var t=aA.call(e,ss),i=e[ss];try{e[ss]=void 0;var r=!0}catch{}var n=sA.call(e);return r&&(t?e[ss]=i:delete e[ss]),n},lA=Object.prototype.toString,cA=function(e){return lA.call(e)},hA=oA,uA=cA,bm=zr?zr.toStringTag:void 0,Ya=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":bm&&bm in Object(e)?hA(e):uA(e)},Hr=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},dA=Ya,fA=Hr,wm,Pu=function(e){if(!fA(e))return!1;var t=dA(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Zc=cr["__core-js_shared__"],Tm=(wm=/[^.]+$/.exec(Zc&&Zc.keys&&Zc.keys.IE_PROTO||""))?"Symbol(src)_1."+wm:"",mA=function(e){return!!Tm&&Tm in e},gA=Function.prototype.toString,Ay=function(e){if(e!=null){try{return gA.call(e)}catch{}try{return e+""}catch{}}return""},pA=Pu,vA=mA,yA=Hr,bA=Ay,wA=/^\[object .+?Constructor\]$/,TA=Function.prototype,EA=Object.prototype,_A=TA.toString,SA=EA.hasOwnProperty,AA=RegExp("^"+_A.call(SA).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xA=function(e){return!(!yA(e)||vA(e))&&(pA(e)?AA:wA).test(bA(e))},RA=function(e,t){return e==null?void 0:e[t]},kA=xA,IA=RA,Gn=function(e,t){var i=IA(e,t);return kA(i)?i:void 0},Nu=Gn(cr,"Map"),uc=Gn(Object,"create"),Em=uc,CA=function(){this.__data__=Em?Em(null):{},this.size=0},DA=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},OA=uc,MA=Object.prototype.hasOwnProperty,PA=function(e){var t=this.__data__;if(OA){var i=t[e];return i==="__lodash_hash_undefined__"?void 0:i}return MA.call(t,e)?t[e]:void 0},NA=uc,LA=Object.prototype.hasOwnProperty,UA=function(e){var t=this.__data__;return NA?t[e]!==void 0:LA.call(t,e)},FA=uc,BA=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=FA&&t===void 0?"__lodash_hash_undefined__":t,this},jA=CA,WA=DA,zA=PA,VA=UA,HA=BA;function la(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}la.prototype.clear=jA,la.prototype.delete=WA,la.prototype.get=zA,la.prototype.has=VA,la.prototype.set=HA;var _m=la,YA=hc,qA=Nu,KA=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},GA=KA,dc=function(e,t){var i=e.__data__;return GA(t)?i[typeof t=="string"?"string":"hash"]:i.map},$A=dc,XA=function(e){var t=$A(this,e).delete(e);return this.size-=t?1:0,t},QA=dc,JA=function(e){return QA(this,e).get(e)},ZA=dc,tx=function(e){return ZA(this,e).has(e)},ex=dc,ix=function(e,t){var i=ex(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this},rx=function(){this.size=0,this.__data__={hash:new _m,map:new(qA||YA),string:new _m}},nx=XA,ax=JA,sx=tx,ox=ix;function ca(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}ca.prototype.clear=rx,ca.prototype.delete=nx,ca.prototype.get=ax,ca.prototype.has=sx,ca.prototype.set=ox;var Lu=ca,lx=hc,cx=Nu,hx=Lu,ux=function(e,t){var i=this.__data__;if(i instanceof lx){var r=i.__data__;if(!cx||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new hx(r)}return i.set(e,t),this.size=i.size,this},dx=hc,fx=Z1,mx=tA,gx=eA,px=iA,vx=ux;function ha(e){var t=this.__data__=new dx(e);this.size=t.size}ha.prototype.clear=fx,ha.prototype.delete=mx,ha.prototype.get=gx,ha.prototype.has=px,ha.prototype.set=vx;var Uu=ha,yx=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},bx=function(e){return this.__data__.has(e)},Tx=Lu,Ex=yx,_x=bx;function al(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new Tx;++t<i;)this.add(e[t])}al.prototype.add=al.prototype.push=Ex,al.prototype.has=_x;var Sx=function(e,t){return e.has(t)},Ax=al,xx=function(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1},Rx=Sx,xy=function(e,t,i,r,n,a){var s=1&i,o=e.length,l=t.length;if(o!=l&&!(s&&l>o))return!1;var h=a.get(e),c=a.get(t);if(h&&c)return h==t&&c==e;var u=-1,d=!0,f=2&i?new Ax:void 0;for(a.set(e,t),a.set(t,e);++u<o;){var m=e[u],p=t[u];if(r)var g=s?r(p,m,u,t,e,a):r(m,p,u,e,t,a);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!xx(t,function(y,T){if(!Rx(f,T)&&(m===y||n(m,y,i,r,a)))return f.push(T)})){d=!1;break}}else if(m!==p&&!n(m,p,i,r,a)){d=!1;break}}return a.delete(e),a.delete(t),d},Ry=cr.Uint8Array,kx=function(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i},Ix=function(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i},Sm=Ry,Cx=lo,Dx=xy,Ox=kx,Mx=Ix,Am=zr?zr.prototype:void 0,th=Am?Am.valueOf:void 0,Px=function(e,t,i,r,n,a,s){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new Sm(e),new Sm(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Cx(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var o=Ox;case"[object Set]":var l=1&r;if(o||(o=Mx),e.size!=t.size&&!l)return!1;var h=s.get(e);if(h)return h==t;r|=2,s.set(e,t);var c=Dx(o(e),o(t),r,n,a,s);return s.delete(e),c;case"[object Symbol]":if(th)return th.call(e)==th.call(t)}return!1},ky=function(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e},Fi=Array.isArray,Nx=ky,Lx=Fi,Ux=function(e,t,i){var r=t(e);return Lx(e)?r:Nx(r,i(e))},Fx=function(e,t){for(var i=-1,r=e==null?0:e.length,n=0,a=[];++i<r;){var s=e[i];t(s,i,e)&&(a[n++]=s)}return a},Bx=Fx,jx=function(){return[]},Wx=Object.prototype.propertyIsEnumerable,xm=Object.getOwnPropertySymbols,zx=xm?function(e){return e==null?[]:(e=Object(e),Bx(xm(e),function(t){return Wx.call(e,t)}))}:jx,Vx=function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r},$n=function(e){return e!=null&&typeof e=="object"},Hx=Ya,Yx=$n,qx=function(e){return Yx(e)&&Hx(e)=="[object Arguments]"},Rm=qx,Kx=$n,Iy=Object.prototype,Gx=Iy.hasOwnProperty,$x=Iy.propertyIsEnumerable,Xx=Rm((function(){return arguments})())?Rm:function(e){return Kx(e)&&Gx.call(e,"callee")&&!$x.call(e,"callee")},fc=Xx,Fa={exports:{}},Qx=function(){return!1};(function(e,t){var i=cr,r=Qx,n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,s=a&&a.exports===n?i.Buffer:void 0,o=(s?s.isBuffer:void 0)||r;e.exports=o})(Fa,Fa.exports);var Jx=/^(?:0|[1-9]\d*)$/,mc=function(e,t){var i=typeof e;return!!(t=t??9007199254740991)&&(i=="number"||i!="symbol"&&Jx.test(e))&&e>-1&&e%1==0&&e<t},Fu=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991},Zx=Ya,tR=Fu,eR=$n,oe={};oe["[object Float32Array]"]=oe["[object Float64Array]"]=oe["[object Int8Array]"]=oe["[object Int16Array]"]=oe["[object Int32Array]"]=oe["[object Uint8Array]"]=oe["[object Uint8ClampedArray]"]=oe["[object Uint16Array]"]=oe["[object Uint32Array]"]=!0,oe["[object Arguments]"]=oe["[object Array]"]=oe["[object ArrayBuffer]"]=oe["[object Boolean]"]=oe["[object DataView]"]=oe["[object Date]"]=oe["[object Error]"]=oe["[object Function]"]=oe["[object Map]"]=oe["[object Number]"]=oe["[object Object]"]=oe["[object RegExp]"]=oe["[object Set]"]=oe["[object String]"]=oe["[object WeakMap]"]=!1;var iR=function(e){return eR(e)&&tR(e.length)&&!!oe[Zx(e)]},rR=function(e){return function(t){return e(t)}},Vh={exports:{}};(function(e,t){var i=_y,r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&i.process,s=(function(){try{var o=n&&n.require&&n.require("util").types;return o||a&&a.binding&&a.binding("util")}catch{}})();e.exports=s})(Vh,Vh.exports);var nR=iR,aR=rR,km=Vh.exports,Im=km&&km.isTypedArray,Bu=Im?aR(Im):nR,sR=Vx,oR=fc,lR=Fi,cR=Fa.exports,hR=mc,uR=Bu,dR=Object.prototype.hasOwnProperty,Cy=function(e,t){var i=lR(e),r=!i&&oR(e),n=!i&&!r&&cR(e),a=!i&&!r&&!n&&uR(e),s=i||r||n||a,o=s?sR(e.length,String):[],l=o.length;for(var h in e)!t&&!dR.call(e,h)||s&&(h=="length"||n&&(h=="offset"||h=="parent")||a&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||hR(h,l))||o.push(h);return o},fR=Object.prototype,ju=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||fR)},Dy=function(e,t){return function(i){return e(t(i))}},mR=Dy(Object.keys,Object),gR=ju,pR=mR,vR=Object.prototype.hasOwnProperty,yR=function(e){if(!gR(e))return pR(e);var t=[];for(var i in Object(e))vR.call(e,i)&&i!="constructor"&&t.push(i);return t},bR=Pu,wR=Fu,co=function(e){return e!=null&&wR(e.length)&&!bR(e)},TR=Cy,ER=yR,_R=co,Wu=function(e){return _R(e)?TR(e):ER(e)},SR=Ux,AR=zx,xR=Wu,Cm=function(e){return SR(e,xR,AR)},RR=Object.prototype.hasOwnProperty,kR=function(e,t,i,r,n,a){var s=1&i,o=Cm(e),l=o.length;if(l!=Cm(t).length&&!s)return!1;for(var h=l;h--;){var c=o[h];if(!(s?c in t:RR.call(t,c)))return!1}var u=a.get(e),d=a.get(t);if(u&&d)return u==t&&d==e;var f=!0;a.set(e,t),a.set(t,e);for(var m=s;++h<l;){var p=e[c=o[h]],g=t[c];if(r)var y=s?r(g,p,c,t,e,a):r(p,g,c,e,t,a);if(!(y===void 0?p===g||n(p,g,i,r,a):y)){f=!1;break}m||(m=c=="constructor")}if(f&&!m){var T=e.constructor,b=t.constructor;T==b||!("constructor"in e)||!("constructor"in t)||typeof T=="function"&&T instanceof T&&typeof b=="function"&&b instanceof b||(f=!1)}return a.delete(e),a.delete(t),f},Hh=Gn(cr,"DataView"),Yh=Nu,qh=Gn(cr,"Promise"),Kh=Gn(cr,"Set"),Gh=Gn(cr,"WeakMap"),Oy=Ya,qa=Ay,Dm="[object Map]",Om="[object Promise]",Mm="[object Set]",Pm="[object WeakMap]",Nm="[object DataView]",IR=qa(Hh),CR=qa(Yh),DR=qa(qh),OR=qa(Kh),MR=qa(Gh),An=Oy;(Hh&&An(new Hh(new ArrayBuffer(1)))!=Nm||Yh&&An(new Yh)!=Dm||qh&&An(qh.resolve())!=Om||Kh&&An(new Kh)!=Mm||Gh&&An(new Gh)!=Pm)&&(An=function(e){var t=Oy(e),i=t=="[object Object]"?e.constructor:void 0,r=i?qa(i):"";if(r)switch(r){case IR:return Nm;case CR:return Dm;case DR:return Om;case OR:return Mm;case MR:return Pm}return t});var PR=An,eh=Uu,NR=xy,LR=Px,UR=kR,Lm=PR,Um=Fi,Fm=Fa.exports,FR=Bu,Bm="[object Arguments]",jm="[object Array]",zo="[object Object]",Wm=Object.prototype.hasOwnProperty,BR=function(e,t,i,r,n,a){var s=Um(e),o=Um(t),l=s?jm:Lm(e),h=o?jm:Lm(t),c=(l=l==Bm?zo:l)==zo,u=(h=h==Bm?zo:h)==zo,d=l==h;if(d&&Fm(e)){if(!Fm(t))return!1;s=!0,c=!1}if(d&&!c)return a||(a=new eh),s||FR(e)?NR(e,t,i,r,n,a):LR(e,t,l,i,r,n,a);if(!(1&i)){var f=c&&Wm.call(e,"__wrapped__"),m=u&&Wm.call(t,"__wrapped__");if(f||m){var p=f?e.value():e,g=m?t.value():t;return a||(a=new eh),n(p,g,i,r,a)}}return!!d&&(a||(a=new eh),UR(e,t,i,r,n,a))},zm=$n,zu=function e(t,i,r,n,a){return t===i||(t==null||i==null||!zm(t)&&!zm(i)?t!=t&&i!=i:BR(t,i,r,n,e,a))},jR=zu,WR=function(e,t){return jR(e,t)},zR=Ya,VR=$n,Vu=function(e){return typeof e=="symbol"||VR(e)&&zR(e)=="[object Symbol]"},HR=Fi,YR=Vu,qR=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,KR=/^\w*$/,Hu=function(e,t){if(HR(e))return!1;var i=typeof e;return!(i!="number"&&i!="symbol"&&i!="boolean"&&e!=null&&!YR(e))||KR.test(e)||!qR.test(e)||t!=null&&e in Object(t)},My=Lu;function Yu(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],a=i.cache;if(a.has(n))return a.get(n);var s=e.apply(this,r);return i.cache=a.set(n,s)||a,s};return i.cache=new(Yu.Cache||My),i}Yu.Cache=My;var GR=Yu,$R=function(e){var t=GR(e,function(r){return i.size===500&&i.clear(),r}),i=t.cache;return t},XR=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,QR=/\\(\\)?/g,JR=$R(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(XR,function(i,r,n,a){t.push(n?a.replace(QR,"$1"):r||i)}),t}),ZR=function(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n},tk=Fi,ek=Vu,Vm=zr?zr.prototype:void 0,Hm=Vm?Vm.toString:void 0,ik=function e(t){if(typeof t=="string")return t;if(tk(t))return ZR(t,e)+"";if(ek(t))return Hm?Hm.call(t):"";var i=t+"";return i=="0"&&1/t==-1/0?"-0":i},rk=ik,nk=function(e){return e==null?"":rk(e)},ak=Fi,sk=Hu,ok=JR,lk=nk,gc=function(e,t){return ak(e)?e:sk(e,t)?[e]:ok(lk(e))},ck=Vu,ho=function(e){if(typeof e=="string"||ck(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},hk=gc,uk=ho,qu=function(e,t){for(var i=0,r=(t=hk(t,e)).length;e!=null&&i<r;)e=e[uk(t[i++])];return i&&i==r?e:void 0},dk=Gn,fk=(function(){try{var e=dk(Object,"defineProperty");return e({},"",{}),e}catch{}})(),Py=fk,Ym=Py,pc=function(e,t,i){t=="__proto__"&&Ym?Ym(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i},mk=pc,gk=lo,pk=Object.prototype.hasOwnProperty,Ny=function(e,t,i){var r=e[t];pk.call(e,t)&&gk(r,i)&&(i!==void 0||t in e)||mk(e,t,i)},vk=Ny,yk=gc,bk=mc,qm=Hr,wk=ho,Tk=function(e,t,i,r){if(!qm(e))return e;for(var n=-1,a=(t=yk(t,e)).length,s=a-1,o=e;o!=null&&++n<a;){var l=wk(t[n]),h=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=s){var c=o[l];(h=r?r(c,l,o):void 0)===void 0&&(h=qm(c)?c:bk(t[n+1])?[]:{})}vk(o,l,h),o=o[l]}return e},Ek=qu,_k=Tk,Sk=gc,Ak=function(e,t,i){for(var r=-1,n=t.length,a={};++r<n;){var s=t[r],o=Ek(e,s);i(o,s)&&_k(a,Sk(s,e),o)}return a},xk=function(e,t){return e!=null&&t in Object(e)},Rk=gc,kk=fc,Ik=Fi,Ck=mc,Dk=Fu,Ok=ho,Mk=function(e,t,i){for(var r=-1,n=(t=Rk(t,e)).length,a=!1;++r<n;){var s=Ok(t[r]);if(!(a=e!=null&&i(e,s)))break;e=e[s]}return a||++r!=n?a:!!(n=e==null?0:e.length)&&Dk(n)&&Ck(s,n)&&(Ik(e)||kk(e))},Pk=xk,Nk=Mk,Ly=function(e,t){return e!=null&&Nk(e,t,Pk)},Lk=Ak,Uk=Ly,Fk=function(e,t){return Lk(e,t,function(i,r){return Uk(e,r)})},Bk=fc,jk=Fi,Km=zr?zr.isConcatSpreadable:void 0,Wk=function(e){return jk(e)||Bk(e)||!!(Km&&e&&e[Km])},zk=ky,Vk=Wk,Hk=function e(t,i,r,n,a){var s=-1,o=t.length;for(r||(r=Vk),a||(a=[]);++s<o;){var l=t[s];i>0&&r(l)?i>1?e(l,i-1,r,n,a):zk(a,l):n||(a[a.length]=l)}return a},Yk=Hk,qk=function(e){return e!=null&&e.length?Yk(e,1):[]},Kk=function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)},Gk=Kk,Gm=Math.max,Uy=function(e,t,i){return t=Gm(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,a=Gm(r.length-t,0),s=Array(a);++n<a;)s[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(s),Gk(e,this,o)}},$k=function(e){return function(){return e}},Ku=function(e){return e},Xk=$k,$m=Py,Qk=$m?function(e,t){return $m(e,"toString",{configurable:!0,enumerable:!1,value:Xk(t),writable:!0})}:Ku,Jk=Qk,Zk=Date.now,tI=function(e){var t=0,i=0;return function(){var r=Zk(),n=16-(r-i);if(i=r,n>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}},Fy=tI(Jk),eI=qk,iI=Uy,rI=Fy,nI=function(e){return rI(iI(e,void 0,eI),e+"")},aI=Fk;nI(function(e,t){return e==null?{}:aI(e,t)});var sI=function(e,t,i,r){for(var n=-1,a=e==null?0:e.length;++n<a;){var s=e[n];t(r,s,i(s),e)}return r},oI=function(e){return function(t,i,r){for(var n=-1,a=Object(t),s=r(t),o=s.length;o--;){var l=s[++n];if(i(a[l],l,a)===!1)break}return t}},By=oI(),lI=By,cI=Wu,hI=co,uI=(function(e,t){return function(i,r){if(i==null)return i;if(!hI(i))return e(i,r);for(var n=i.length,a=-1,s=Object(i);++a<n&&r(s[a],a,s)!==!1;);return i}})(function(e,t){return e&&lI(e,t,cI)}),dI=function(e,t,i,r){return uI(e,function(n,a,s){t(r,n,i(n),s)}),r},fI=Uu,mI=zu,gI=function(e,t,i,r){var n=i.length,a=n,s=!r;if(e==null)return!a;for(e=Object(e);n--;){var o=i[n];if(s&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++n<a;){var l=(o=i[n])[0],h=e[l],c=o[1];if(s&&o[2]){if(h===void 0&&!(l in e))return!1}else{var u=new fI;if(r)var d=r(h,c,l,e,t,u);if(!(d===void 0?mI(c,h,3,r,u):d))return!1}}return!0},pI=Hr,jy=function(e){return e==e&&!pI(e)},vI=jy,yI=Wu,bI=function(e){for(var t=yI(e),i=t.length;i--;){var r=t[i],n=e[r];t[i]=[r,n,vI(n)]}return t},Wy=function(e,t){return function(i){return i!=null&&i[e]===t&&(t!==void 0||e in Object(i))}},wI=gI,TI=bI,EI=Wy,_I=qu,SI=zu,AI=function(e,t,i){var r=e==null?void 0:_I(e,t);return r===void 0?i:r},xI=Ly,RI=Hu,kI=jy,II=Wy,CI=ho,DI=function(e){return function(t){return t==null?void 0:t[e]}},OI=qu,MI=DI,PI=function(e){return function(t){return OI(t,e)}},NI=Hu,LI=ho,UI=function(e){var t=TI(e);return t.length==1&&t[0][2]?EI(t[0][0],t[0][1]):function(i){return i===e||wI(i,e,t)}},FI=function(e,t){return RI(e)&&kI(t)?II(CI(e),t):function(i){var r=AI(i,e);return r===void 0&&r===t?xI(i,e):SI(t,r,3)}},BI=Ku,jI=Fi,WI=function(e){return NI(e)?MI(LI(e)):PI(e)},zI=function(e){return typeof e=="function"?e:e==null?BI:typeof e=="object"?jI(e)?FI(e[0],e[1]):UI(e):WI(e)},VI=sI,HI=dI,YI=zI,qI=Fi,KI=function(e,t){return function(i,r){var n=qI(i)?VI:HI,a=t?t():{};return n(i,e,YI(r),a)}},GI=pc,$I=KI,XI=Object.prototype.hasOwnProperty,QI=$I(function(e,t,i){XI.call(e,i)?e[i].push(t):GI(e,i,[t])}),JI=QI,ZI=pc,tC=lo,zy=function(e,t,i){(i!==void 0&&!tC(e[t],i)||i===void 0&&!(t in e))&&ZI(e,t,i)},$h={exports:{}};(function(e,t){var i=cr,r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?i.Buffer:void 0,s=a?a.allocUnsafe:void 0;e.exports=function(o,l){if(l)return o.slice();var h=o.length,c=s?s(h):new o.constructor(h);return o.copy(c),c}})($h,$h.exports);var Xm=Ry,eC=function(e){var t=new e.constructor(e.byteLength);return new Xm(t).set(new Xm(e)),t},iC=function(e,t){var i=t?eC(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)},rC=function(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t},nC=Hr,Qm=Object.create,aC=(function(){function e(){}return function(t){if(!nC(t))return{};if(Qm)return Qm(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}})(),Vy=Dy(Object.getPrototypeOf,Object),sC=aC,oC=Vy,lC=ju,cC=function(e){return typeof e.constructor!="function"||lC(e)?{}:sC(oC(e))},hC=co,uC=$n,dC=function(e){return uC(e)&&hC(e)},fC=Ya,mC=Vy,gC=$n,pC=Function.prototype,vC=Object.prototype,Hy=pC.toString,yC=vC.hasOwnProperty,bC=Hy.call(Object),wC=function(e){if(!gC(e)||fC(e)!="[object Object]")return!1;var t=mC(e);if(t===null)return!0;var i=yC.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Hy.call(i)==bC},Yy=function(e,t){if((t!=="constructor"||typeof e[t]!="function")&&t!="__proto__")return e[t]},TC=Ny,EC=pc,_C=function(e,t,i,r){var n=!i;i||(i={});for(var a=-1,s=t.length;++a<s;){var o=t[a],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?EC(i,o,l):TC(i,o,l)}return i},SC=function(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t},AC=Hr,xC=ju,RC=SC,kC=Object.prototype.hasOwnProperty,IC=function(e){if(!AC(e))return RC(e);var t=xC(e),i=[];for(var r in e)(r!="constructor"||!t&&kC.call(e,r))&&i.push(r);return i},CC=Cy,DC=IC,OC=co,qy=function(e){return OC(e)?CC(e,!0):DC(e)},MC=_C,PC=qy,NC=function(e){return MC(e,PC(e))},Jm=zy,LC=$h.exports,UC=iC,FC=rC,BC=cC,Zm=fc,tg=Fi,jC=dC,WC=Fa.exports,zC=Pu,VC=Hr,HC=wC,YC=Bu,eg=Yy,qC=NC,KC=function(e,t,i,r,n,a,s){var o=eg(e,i),l=eg(t,i),h=s.get(l);if(h)Jm(e,i,h);else{var c=a?a(o,l,i+"",e,t,s):void 0,u=c===void 0;if(u){var d=tg(l),f=!d&&WC(l),m=!d&&!f&&YC(l);c=l,d||f||m?tg(o)?c=o:jC(o)?c=FC(o):f?(u=!1,c=LC(l,!0)):m?(u=!1,c=UC(l,!0)):c=[]:HC(l)||Zm(l)?(c=o,Zm(o)?c=qC(o):VC(o)&&!zC(o)||(c=BC(l))):u=!1}u&&(s.set(l,c),n(c,l,r,a,s),s.delete(l)),Jm(e,i,c)}},GC=Uu,$C=zy,XC=By,QC=KC,JC=Hr,ZC=qy,tD=Yy,Ky=function e(t,i,r,n,a){t!==i&&XC(i,function(s,o){if(a||(a=new GC),JC(s))QC(t,i,o,r,e,n,a);else{var l=n?n(tD(t,o),s,o+"",t,i,a):void 0;l===void 0&&(l=s),$C(t,o,l)}},ZC)},eD=Ku,iD=Uy,rD=Fy,nD=function(e,t){return rD(iD(e,t,eD),e+"")},aD=lo,sD=co,oD=mc,lD=Hr,cD=function(e,t,i){if(!lD(i))return!1;var r=typeof t;return!!(r=="number"?sD(i)&&oD(t,i.length):r=="string"&&t in i)&&aD(i[t],e)},hD=nD,uD=cD,Gy=function(e){return hD(function(t,i){var r=-1,n=i.length,a=n>1?i[n-1]:void 0,s=n>2?i[2]:void 0;for(a=e.length>3&&typeof a=="function"?(n--,a):void 0,s&&uD(i[0],i[1],s)&&(a=n<3?void 0:a,n=1),t=Object(t);++r<n;){var o=i[r];o&&e(t,o,r,a)}return t})},dD=Ky;Gy(function(e,t,i){dD(e,t,i)});Fa.exports;var fD=Ky;Gy(function(e,t,i,r){fD(e,t,i,r)});var ih,Gu={exports:{}};(ih=Gu).exports=(function(){var e;function t(){return e.apply(null,arguments)}function i(v){return v instanceof Array||Object.prototype.toString.call(v)==="[object Array]"}function r(v){return v!=null&&Object.prototype.toString.call(v)==="[object Object]"}function n(v,E){return Object.prototype.hasOwnProperty.call(v,E)}function a(v){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(v).length===0;for(var E in v)if(n(v,E))return;return 1}function s(v){return v===void 0}function o(v){return typeof v=="number"||Object.prototype.toString.call(v)==="[object Number]"}function l(v){return v instanceof Date||Object.prototype.toString.call(v)==="[object Date]"}function h(v,E){for(var k=[],U=v.length,G=0;G<U;++G)k.push(E(v[G],G));return k}function c(v,E){for(var k in E)n(E,k)&&(v[k]=E[k]);return n(E,"toString")&&(v.toString=E.toString),n(E,"valueOf")&&(v.valueOf=E.valueOf),v}function u(v,E,k,U){return Td(v,E,k,U,!0).utc()}function d(v){return v._pf==null&&(v._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),v._pf}function f(v){if(v._isValid==null){var E=d(v),k=p.call(E.parsedDateParts,function(U){return U!=null});if(k=!isNaN(v._d.getTime())&&E.overflow<0&&!E.empty&&!E.invalidEra&&!E.invalidMonth&&!E.invalidWeekday&&!E.weekdayMismatch&&!E.nullInput&&!E.invalidFormat&&!E.userInvalidated&&(!E.meridiem||E.meridiem&&k),v._strict&&(k=k&&E.charsLeftOver===0&&E.unusedTokens.length===0&&E.bigHour===void 0),Object.isFrozen!=null&&Object.isFrozen(v))return k;v._isValid=k}return v._isValid}function m(v){var E=u(NaN);return v!=null?c(d(E),v):d(E).userInvalidated=!0,E}var p=Array.prototype.some||function(v){for(var E=Object(this),k=E.length>>>0,U=0;U<k;U++)if(U in E&&v.call(this,E[U],U,E))return!0;return!1},g=t.momentProperties=[],y=!1;function T(v,E){var k,U,G,Z=g.length;if(s(E._isAMomentObject)||(v._isAMomentObject=E._isAMomentObject),s(E._i)||(v._i=E._i),s(E._f)||(v._f=E._f),s(E._l)||(v._l=E._l),s(E._strict)||(v._strict=E._strict),s(E._tzm)||(v._tzm=E._tzm),s(E._isUTC)||(v._isUTC=E._isUTC),s(E._offset)||(v._offset=E._offset),s(E._pf)||(v._pf=d(E)),s(E._locale)||(v._locale=E._locale),0<Z)for(k=0;k<Z;k++)s(G=E[U=g[k]])||(v[U]=G);return v}function b(v){T(this,v),this._d=new Date(v._d!=null?v._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),y===!1&&(y=!0,t.updateOffset(this),y=!1)}function S(v){return v instanceof b||v!=null&&v._isAMomentObject!=null}function I(v){t.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+v)}function D(v,E){var k=!0;return c(function(){if(t.deprecationHandler!=null&&t.deprecationHandler(null,v),k){for(var U,G,Z=[],ut=arguments.length,dt=0;dt<ut;dt++){if(U="",typeof arguments[dt]=="object"){for(G in U+=`
[`+dt+"] ",arguments[0])n(arguments[0],G)&&(U+=G+": "+arguments[0][G]+", ");U=U.slice(0,-2)}else U=arguments[dt];Z.push(U)}I(v+`
Arguments: `+Array.prototype.slice.call(Z).join("")+`
`+new Error().stack),k=!1}return E.apply(this,arguments)},E)}var O={};function P(v,E){t.deprecationHandler!=null&&t.deprecationHandler(v,E),O[v]||(I(E),O[v]=!0)}function q(v){return typeof Function<"u"&&v instanceof Function||Object.prototype.toString.call(v)==="[object Function]"}function J(v,E){var k,U=c({},v);for(k in E)n(E,k)&&(r(v[k])&&r(E[k])?(U[k]={},c(U[k],v[k]),c(U[k],E[k])):E[k]!=null?U[k]=E[k]:delete U[k]);for(k in v)n(v,k)&&!n(E,k)&&r(v[k])&&(U[k]=c({},U[k]));return U}function A(v){v!=null&&this.set(v)}t.suppressDeprecationWarnings=!1,t.deprecationHandler=null;var x=Object.keys||function(v){var E,k=[];for(E in v)n(v,E)&&k.push(E);return k};function R(v,E,k){var U=""+Math.abs(v);return(0<=v?k?"+":"":"-")+Math.pow(10,Math.max(0,E-U.length)).toString().substr(1)+U}var M=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Y=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,X={},et={};function z(v,E,k,U){var G=typeof U=="string"?function(){return this[U]()}:U;v&&(et[v]=G),E&&(et[E[0]]=function(){return R(G.apply(this,arguments),E[1],E[2])}),k&&(et[k]=function(){return this.localeData().ordinal(G.apply(this,arguments),v)})}function W(v,E){return v.isValid()?(E=$(E,v.localeData()),X[E]=X[E]||(function(k){for(var U,G=k.match(M),Z=0,ut=G.length;Z<ut;Z++)et[G[Z]]?G[Z]=et[G[Z]]:G[Z]=(U=G[Z]).match(/\[[\s\S]/)?U.replace(/^\[|\]$/g,""):U.replace(/\\/g,"");return function(dt){for(var vt="",pt=0;pt<ut;pt++)vt+=q(G[pt])?G[pt].call(dt,k):G[pt];return vt}})(E),X[E](v)):v.localeData().invalidDate()}function $(v,E){var k=5;function U(G){return E.longDateFormat(G)||G}for(Y.lastIndex=0;0<=k&&Y.test(v);)v=v.replace(Y,U),Y.lastIndex=0,--k;return v}var L={};function N(v,E){var k=v.toLowerCase();L[k]=L[k+"s"]=L[E]=v}function V(v){return typeof v=="string"?L[v]||L[v.toLowerCase()]:void 0}function H(v){var E,k,U={};for(k in v)n(v,k)&&(E=V(k))&&(U[E]=v[k]);return U}var Q={};function rt(v,E){Q[v]=E}function tt(v){return v%4==0&&v%100!=0||v%400==0}function it(v){return v<0?Math.ceil(v)||0:Math.floor(v)}function w(v){var E=0;return(v=+v)!=0&&isFinite(v)?it(v):E}function _(v,E){return function(k){return k!=null?(F(this,v,k),t.updateOffset(this,E),this):C(this,v)}}function C(v,E){return v.isValid()?v._d["get"+(v._isUTC?"UTC":"")+E]():NaN}function F(v,E,k){v.isValid()&&!isNaN(k)&&(E==="FullYear"&&tt(v.year())&&v.month()===1&&v.date()===29?(k=w(k),v._d["set"+(v._isUTC?"UTC":"")+E](k,v.month(),go(k,v.month()))):v._d["set"+(v._isUTC?"UTC":"")+E](k))}var j=/\d/,K=/\d\d/,nt=/\d{3}/,mt=/\d{4}/,ft=/[+-]?\d{6}/,gt=/\d\d?/,xt=/\d\d\d\d?/,xe=/\d\d\d\d\d\d?/,we=/\d{1,3}/,he=/\d{1,4}/,zt=/[+-]?\d{1,6}/,qt=/\d+/,Ei=/[+-]?\d+/,Ga=/Z|[+-]\d\d:?\d\d/gi,st=/Z|[+-]\d\d(?::?\d\d)?/gi,ht=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function at(v,E,k){pe[v]=q(E)?E:function(U,G){return U&&k?k:E}}function yt(v,E){return n(pe,v)?pe[v](E._strict,E._locale):new RegExp(It(v.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(k,U,G,Z,ut){return U||G||Z||ut})))}function It(v){return v.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var pe={},Wt={};function Tt(v,E){var k,U,G=E;for(typeof v=="string"&&(v=[v]),o(E)&&(G=function(Z,ut){ut[E]=w(Z)}),U=v.length,k=0;k<U;k++)Wt[v[k]]=G}function Rt(v,E){Tt(v,function(k,U,G,Z){G._w=G._w||{},E(k,G._w,G,Z)})}var Dt,Ot=0,qe=1,ji=2,Ce=3,_i=4,hr=5,yn=6,K0=7,G0=8;function go(v,E){if(isNaN(v)||isNaN(E))return NaN;var k=(E%(k=12)+k)%k;return v+=(E-k)/12,k==1?tt(v)?29:28:31-k%7%2}Dt=Array.prototype.indexOf||function(v){for(var E=0;E<this.length;++E)if(this[E]===v)return E;return-1},z("M",["MM",2],"Mo",function(){return this.month()+1}),z("MMM",0,0,function(v){return this.localeData().monthsShort(this,v)}),z("MMMM",0,0,function(v){return this.localeData().months(this,v)}),N("month","M"),rt("month",8),at("M",gt),at("MM",gt,K),at("MMM",function(v,E){return E.monthsShortRegex(v)}),at("MMMM",function(v,E){return E.monthsRegex(v)}),Tt(["M","MM"],function(v,E){E[qe]=w(v)-1}),Tt(["MMM","MMMM"],function(v,E,k,U){(U=k._locale.monthsParse(v,U,k._strict))!=null?E[qe]=U:d(k).invalidMonth=v});var $a="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),od="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),ld=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,$0=ht,X0=ht;function cd(v,E){var k;if(v.isValid()){if(typeof E=="string"){if(/^\d+$/.test(E))E=w(E);else if(!o(E=v.localeData().monthsParse(E)))return}k=Math.min(v.date(),go(v.year(),E)),v._d["set"+(v._isUTC?"UTC":"")+"Month"](E,k)}}function hd(v){return v!=null?(cd(this,v),t.updateOffset(this,!0),this):C(this,"Month")}function ud(){function v(ut,dt){return dt.length-ut.length}for(var E,k=[],U=[],G=[],Z=0;Z<12;Z++)E=u([2e3,Z]),k.push(this.monthsShort(E,"")),U.push(this.months(E,"")),G.push(this.months(E,"")),G.push(this.monthsShort(E,""));for(k.sort(v),U.sort(v),G.sort(v),Z=0;Z<12;Z++)k[Z]=It(k[Z]),U[Z]=It(U[Z]);for(Z=0;Z<24;Z++)G[Z]=It(G[Z]);this._monthsRegex=new RegExp("^("+G.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+U.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+k.join("|")+")","i")}function Xa(v){return tt(v)?366:365}z("Y",0,0,function(){var v=this.year();return v<=9999?R(v,4):"+"+v}),z(0,["YY",2],0,function(){return this.year()%100}),z(0,["YYYY",4],0,"year"),z(0,["YYYYY",5],0,"year"),z(0,["YYYYYY",6,!0],0,"year"),N("year","y"),rt("year",1),at("Y",Ei),at("YY",gt,K),at("YYYY",he,mt),at("YYYYY",zt,ft),at("YYYYYY",zt,ft),Tt(["YYYYY","YYYYYY"],Ot),Tt("YYYY",function(v,E){E[Ot]=v.length===2?t.parseTwoDigitYear(v):w(v)}),Tt("YY",function(v,E){E[Ot]=t.parseTwoDigitYear(v)}),Tt("Y",function(v,E){E[Ot]=parseInt(v,10)}),t.parseTwoDigitYear=function(v){return w(v)+(68<w(v)?1900:2e3)};var po=_("FullYear",!0);function Q0(v,E,k,U,G,Z,ut){var dt;return v<100&&0<=v?(dt=new Date(v+400,E,k,U,G,Z,ut),isFinite(dt.getFullYear())&&dt.setFullYear(v)):dt=new Date(v,E,k,U,G,Z,ut),dt}function Qa(v){var E;return v<100&&0<=v?((E=Array.prototype.slice.call(arguments))[0]=v+400,E=new Date(Date.UTC.apply(null,E)),isFinite(E.getUTCFullYear())&&E.setUTCFullYear(v)):E=new Date(Date.UTC.apply(null,arguments)),E}function vo(v,E,k){return(k=7+E-k)-(7+Qa(v,0,k).getUTCDay()-E)%7-1}function dd(v,E,k,U,G){var Z;return k=(E=1+7*(E-1)+(7+k-U)%7+vo(v,U,G))<=0?Xa(Z=v-1)+E:E>Xa(v)?(Z=v+1,E-Xa(v)):(Z=v,E),{year:Z,dayOfYear:k}}function Ja(v,E,k){var U,G,Z=vo(v.year(),E,k);return(Z=Math.floor((v.dayOfYear()-Z-1)/7)+1)<1?U=Z+ur(G=v.year()-1,E,k):Z>ur(v.year(),E,k)?(U=Z-ur(v.year(),E,k),G=v.year()+1):(G=v.year(),U=Z),{week:U,year:G}}function ur(v,E,k){var U=vo(v,E,k);return E=vo(v+1,E,k),(Xa(v)-U+E)/7}function yc(v,E){return v.slice(E,7).concat(v.slice(0,E))}z("w",["ww",2],"wo","week"),z("W",["WW",2],"Wo","isoWeek"),N("week","w"),N("isoWeek","W"),rt("week",5),rt("isoWeek",5),at("w",gt),at("ww",gt,K),at("W",gt),at("WW",gt,K),Rt(["w","ww","W","WW"],function(v,E,k,U){E[U.substr(0,1)]=w(v)}),z("d",0,"do","day"),z("dd",0,0,function(v){return this.localeData().weekdaysMin(this,v)}),z("ddd",0,0,function(v){return this.localeData().weekdaysShort(this,v)}),z("dddd",0,0,function(v){return this.localeData().weekdays(this,v)}),z("e",0,0,"weekday"),z("E",0,0,"isoWeekday"),N("day","d"),N("weekday","e"),N("isoWeekday","E"),rt("day",11),rt("weekday",11),rt("isoWeekday",11),at("d",gt),at("e",gt),at("E",gt),at("dd",function(v,E){return E.weekdaysMinRegex(v)}),at("ddd",function(v,E){return E.weekdaysShortRegex(v)}),at("dddd",function(v,E){return E.weekdaysRegex(v)}),Rt(["dd","ddd","dddd"],function(v,E,k,U){(U=k._locale.weekdaysParse(v,U,k._strict))!=null?E.d=U:d(k).invalidWeekday=v}),Rt(["d","e","E"],function(v,E,k,U){E[U]=w(v)});var Za="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),fd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),yo="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),J0=ht,Z0=ht,tb=ht;function bc(){function v(pt,Ut){return Ut.length-pt.length}for(var E,k,U,G=[],Z=[],ut=[],dt=[],vt=0;vt<7;vt++)U=u([2e3,1]).day(vt),E=It(this.weekdaysMin(U,"")),k=It(this.weekdaysShort(U,"")),U=It(this.weekdays(U,"")),G.push(E),Z.push(k),ut.push(U),dt.push(E),dt.push(k),dt.push(U);G.sort(v),Z.sort(v),ut.sort(v),dt.sort(v),this._weekdaysRegex=new RegExp("^("+dt.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+ut.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+Z.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+G.join("|")+")","i")}function wc(){return this.hours()%12||12}function md(v,E){z(v,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),E)})}function gd(v,E){return E._meridiemParse}z("H",["HH",2],0,"hour"),z("h",["hh",2],0,wc),z("k",["kk",2],0,function(){return this.hours()||24}),z("hmm",0,0,function(){return""+wc.apply(this)+R(this.minutes(),2)}),z("hmmss",0,0,function(){return""+wc.apply(this)+R(this.minutes(),2)+R(this.seconds(),2)}),z("Hmm",0,0,function(){return""+this.hours()+R(this.minutes(),2)}),z("Hmmss",0,0,function(){return""+this.hours()+R(this.minutes(),2)+R(this.seconds(),2)}),md("a",!0),md("A",!1),N("hour","h"),rt("hour",13),at("a",gd),at("A",gd),at("H",gt),at("h",gt),at("k",gt),at("HH",gt,K),at("hh",gt,K),at("kk",gt,K),at("hmm",xt),at("hmmss",xe),at("Hmm",xt),at("Hmmss",xe),Tt(["H","HH"],Ce),Tt(["k","kk"],function(v,E,k){v=w(v),E[Ce]=v===24?0:v}),Tt(["a","A"],function(v,E,k){k._isPm=k._locale.isPM(v),k._meridiem=v}),Tt(["h","hh"],function(v,E,k){E[Ce]=w(v),d(k).bigHour=!0}),Tt("hmm",function(v,E,k){var U=v.length-2;E[Ce]=w(v.substr(0,U)),E[_i]=w(v.substr(U)),d(k).bigHour=!0}),Tt("hmmss",function(v,E,k){var U=v.length-4,G=v.length-2;E[Ce]=w(v.substr(0,U)),E[_i]=w(v.substr(U,2)),E[hr]=w(v.substr(G)),d(k).bigHour=!0}),Tt("Hmm",function(v,E,k){var U=v.length-2;E[Ce]=w(v.substr(0,U)),E[_i]=w(v.substr(U))}),Tt("Hmmss",function(v,E,k){var U=v.length-4,G=v.length-2;E[Ce]=w(v.substr(0,U)),E[_i]=w(v.substr(U,2)),E[hr]=w(v.substr(G))}),ht=_("Hours",!0);var ts,pd={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:$a,monthsShort:od,week:{dow:0,doy:6},weekdays:Za,weekdaysMin:yo,weekdaysShort:fd,meridiemParse:/[ap]\.?m?\.?/i},ue={},es={};function vd(v){return v&&v.toLowerCase().replace("_","-")}function eb(v){for(var E,k,U,G,Z=0;Z<v.length;){for(E=(G=vd(v[Z]).split("-")).length,k=(k=vd(v[Z+1]))?k.split("-"):null;0<E;){if(U=bo(G.slice(0,E).join("-")))return U;if(k&&k.length>=E&&(function(ut,dt){for(var vt=Math.min(ut.length,dt.length),pt=0;pt<vt;pt+=1)if(ut[pt]!==dt[pt])return pt;return vt})(G,k)>=E-1)break;E--}Z++}return ts}function bo(v){var E;if(ue[v]===void 0&&ih&&ih.exports&&v.match("^[^/\\\\]*$")!=null)try{E=ts._abbr,(function(k){throw new Error('Could not dynamically require "'+k+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')})("./locale/"+v),Yr(E)}catch{ue[v]=null}return ue[v]}function Yr(v,E){return v&&((E=s(E)?dr(v):Tc(v,E))?ts=E:typeof console<"u"&&console.warn&&console.warn("Locale "+v+" not found. Did you forget to load it?")),ts._abbr}function Tc(v,E){if(E===null)return delete ue[v],null;var k,U=pd;if(E.abbr=v,ue[v]!=null)P("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),U=ue[v]._config;else if(E.parentLocale!=null)if(ue[E.parentLocale]!=null)U=ue[E.parentLocale]._config;else{if((k=bo(E.parentLocale))==null)return es[E.parentLocale]||(es[E.parentLocale]=[]),es[E.parentLocale].push({name:v,config:E}),null;U=k._config}return ue[v]=new A(J(U,E)),es[v]&&es[v].forEach(function(G){Tc(G.name,G.config)}),Yr(v),ue[v]}function dr(v){var E;if(!(v=v&&v._locale&&v._locale._abbr?v._locale._abbr:v))return ts;if(!i(v)){if(E=bo(v))return E;v=[v]}return eb(v)}function Ec(v){var E=v._a;return E&&d(v).overflow===-2&&(E=E[qe]<0||11<E[qe]?qe:E[ji]<1||E[ji]>go(E[Ot],E[qe])?ji:E[Ce]<0||24<E[Ce]||E[Ce]===24&&(E[_i]!==0||E[hr]!==0||E[yn]!==0)?Ce:E[_i]<0||59<E[_i]?_i:E[hr]<0||59<E[hr]?hr:E[yn]<0||999<E[yn]?yn:-1,d(v)._overflowDayOfYear&&(E<Ot||ji<E)&&(E=ji),d(v)._overflowWeeks&&E===-1&&(E=K0),d(v)._overflowWeekday&&E===-1&&(E=G0),d(v).overflow=E),v}var ib=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,rb=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,nb=/Z|[+-]\d\d(?::?\d\d)?/,wo=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],_c=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],ab=/^\/?Date\((-?\d+)/i,sb=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,ob={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function yd(v){var E,k,U,G,Z,ut,dt=v._i,vt=ib.exec(dt)||rb.exec(dt),pt=(dt=wo.length,_c.length);if(vt){for(d(v).iso=!0,E=0,k=dt;E<k;E++)if(wo[E][1].exec(vt[1])){G=wo[E][0],U=wo[E][2]!==!1;break}if(G==null)v._isValid=!1;else{if(vt[3]){for(E=0,k=pt;E<k;E++)if(_c[E][1].exec(vt[3])){Z=(vt[2]||" ")+_c[E][0];break}if(Z==null)return void(v._isValid=!1)}if(U||Z==null){if(vt[4]){if(!nb.exec(vt[4]))return void(v._isValid=!1);ut="Z"}v._f=G+(Z||"")+(ut||""),Ac(v)}else v._isValid=!1}}else v._isValid=!1}function lb(v,E,k,U,G,Z){return v=[(function(ut){return(ut=parseInt(ut,10))<=49?2e3+ut:ut<=999?1900+ut:ut})(v),od.indexOf(E),parseInt(k,10),parseInt(U,10),parseInt(G,10)],Z&&v.push(parseInt(Z,10)),v}function bd(v){var E,k,U,G,Z=sb.exec(v._i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));Z?(U=E=lb(Z[4],Z[3],Z[2],Z[5],Z[6],Z[7]),G=v,(k=Z[1])&&fd.indexOf(k)!==new Date(U[0],U[1],U[2]).getDay()?(d(G).weekdayMismatch=!0,G._isValid=!1):(v._a=E,v._tzm=(k=Z[8],U=Z[9],G=Z[10],k?ob[k]:U?0:((k=parseInt(G,10))-(U=k%100))/100*60+U),v._d=Qa.apply(null,v._a),v._d.setUTCMinutes(v._d.getUTCMinutes()-v._tzm),d(v).rfc2822=!0)):v._isValid=!1}function Qn(v,E,k){return v??E??k}function Sc(v){var E,k,U,G,Z,ut,dt,vt,pt,Ut,te,de=[];if(!v._d){for(U=v,G=new Date(t.now()),k=U._useUTC?[G.getUTCFullYear(),G.getUTCMonth(),G.getUTCDate()]:[G.getFullYear(),G.getMonth(),G.getDate()],v._w&&v._a[ji]==null&&v._a[qe]==null&&((G=(U=v)._w).GG!=null||G.W!=null||G.E!=null?(vt=1,pt=4,Z=Qn(G.GG,U._a[Ot],Ja(se(),1,4).year),ut=Qn(G.W,1),((dt=Qn(G.E,1))<1||7<dt)&&(Ut=!0)):(vt=U._locale._week.dow,pt=U._locale._week.doy,te=Ja(se(),vt,pt),Z=Qn(G.gg,U._a[Ot],te.year),ut=Qn(G.w,te.week),G.d!=null?((dt=G.d)<0||6<dt)&&(Ut=!0):G.e!=null?(dt=G.e+vt,(G.e<0||6<G.e)&&(Ut=!0)):dt=vt),ut<1||ut>ur(Z,vt,pt)?d(U)._overflowWeeks=!0:Ut!=null?d(U)._overflowWeekday=!0:(te=dd(Z,ut,dt,vt,pt),U._a[Ot]=te.year,U._dayOfYear=te.dayOfYear)),v._dayOfYear!=null&&(G=Qn(v._a[Ot],k[Ot]),(v._dayOfYear>Xa(G)||v._dayOfYear===0)&&(d(v)._overflowDayOfYear=!0),Ut=Qa(G,0,v._dayOfYear),v._a[qe]=Ut.getUTCMonth(),v._a[ji]=Ut.getUTCDate()),E=0;E<3&&v._a[E]==null;++E)v._a[E]=de[E]=k[E];for(;E<7;E++)v._a[E]=de[E]=v._a[E]==null?E===2?1:0:v._a[E];v._a[Ce]===24&&v._a[_i]===0&&v._a[hr]===0&&v._a[yn]===0&&(v._nextDay=!0,v._a[Ce]=0),v._d=(v._useUTC?Qa:Q0).apply(null,de),Z=v._useUTC?v._d.getUTCDay():v._d.getDay(),v._tzm!=null&&v._d.setUTCMinutes(v._d.getUTCMinutes()-v._tzm),v._nextDay&&(v._a[Ce]=24),v._w&&v._w.d!==void 0&&v._w.d!==Z&&(d(v).weekdayMismatch=!0)}}function Ac(v){if(v._f===t.ISO_8601)yd(v);else if(v._f===t.RFC_2822)bd(v);else{v._a=[],d(v).empty=!0;for(var E,k,U,G,Z,ut=""+v._i,dt=ut.length,vt=0,pt=$(v._f,v._locale).match(M)||[],Ut=pt.length,te=0;te<Ut;te++)k=pt[te],(E=(ut.match(yt(k,v))||[])[0])&&(0<(U=ut.substr(0,ut.indexOf(E))).length&&d(v).unusedInput.push(U),ut=ut.slice(ut.indexOf(E)+E.length),vt+=E.length),et[k]?(E?d(v).empty=!1:d(v).unusedTokens.push(k),U=k,Z=v,(G=E)!=null&&n(Wt,U)&&Wt[U](G,Z._a,Z,U)):v._strict&&!E&&d(v).unusedTokens.push(k);d(v).charsLeftOver=dt-vt,0<ut.length&&d(v).unusedInput.push(ut),v._a[Ce]<=12&&d(v).bigHour===!0&&0<v._a[Ce]&&(d(v).bigHour=void 0),d(v).parsedDateParts=v._a.slice(0),d(v).meridiem=v._meridiem,v._a[Ce]=(function(de,Ve,Wi){return Wi==null?Ve:de.meridiemHour!=null?de.meridiemHour(Ve,Wi):de.isPM!=null?((de=de.isPM(Wi))&&Ve<12&&(Ve+=12),Ve=de||Ve!==12?Ve:0):Ve})(v._locale,v._a[Ce],v._meridiem),(dt=d(v).era)!==null&&(v._a[Ot]=v._locale.erasConvertYear(dt,v._a[Ot])),Sc(v),Ec(v)}}function wd(v){var E,k,U,G=v._i,Z=v._f;return v._locale=v._locale||dr(v._l),G===null||Z===void 0&&G===""?m({nullInput:!0}):(typeof G=="string"&&(v._i=G=v._locale.preparse(G)),S(G)?new b(Ec(G)):(l(G)?v._d=G:i(Z)?(function(ut){var dt,vt,pt,Ut,te,de,Ve=!1,Wi=ut._f.length;if(Wi===0)return d(ut).invalidFormat=!0,ut._d=new Date(NaN);for(Ut=0;Ut<Wi;Ut++)te=0,de=!1,dt=T({},ut),ut._useUTC!=null&&(dt._useUTC=ut._useUTC),dt._f=ut._f[Ut],Ac(dt),f(dt)&&(de=!0),te=(te+=d(dt).charsLeftOver)+10*d(dt).unusedTokens.length,d(dt).score=te,Ve?te<pt&&(pt=te,vt=dt):(pt==null||te<pt||de)&&(pt=te,vt=dt,de&&(Ve=!0));c(ut,vt||dt)})(v):Z?Ac(v):s(Z=(G=v)._i)?G._d=new Date(t.now()):l(Z)?G._d=new Date(Z.valueOf()):typeof Z=="string"?(k=G,(E=ab.exec(k._i))!==null?k._d=new Date(+E[1]):(yd(k),k._isValid===!1&&(delete k._isValid,bd(k),k._isValid===!1&&(delete k._isValid,k._strict?k._isValid=!1:t.createFromInputFallback(k))))):i(Z)?(G._a=h(Z.slice(0),function(ut){return parseInt(ut,10)}),Sc(G)):r(Z)?(E=G)._d||(U=(k=H(E._i)).day===void 0?k.date:k.day,E._a=h([k.year,k.month,U,k.hour,k.minute,k.second,k.millisecond],function(ut){return ut&&parseInt(ut,10)}),Sc(E)):o(Z)?G._d=new Date(Z):t.createFromInputFallback(G),f(v)||(v._d=null),v))}function Td(v,E,k,U,G){var Z={};return E!==!0&&E!==!1||(U=E,E=void 0),k!==!0&&k!==!1||(U=k,k=void 0),(r(v)&&a(v)||i(v)&&v.length===0)&&(v=void 0),Z._isAMomentObject=!0,Z._useUTC=Z._isUTC=G,Z._l=k,Z._i=v,Z._f=E,Z._strict=U,(G=new b(Ec(wd(G=Z))))._nextDay&&(G.add(1,"d"),G._nextDay=void 0),G}function se(v,E,k,U){return Td(v,E,k,U,!1)}function Ed(v,E){var k,U;if(!(E=E.length===1&&i(E[0])?E[0]:E).length)return se();for(k=E[0],U=1;U<E.length;++U)E[U].isValid()&&!E[U][v](k)||(k=E[U]);return k}t.createFromInputFallback=D("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(v){v._d=new Date(v._i+(v._useUTC?" UTC":""))}),t.ISO_8601=function(){},t.RFC_2822=function(){},xt=D("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var v=se.apply(null,arguments);return this.isValid()&&v.isValid()?v<this?this:v:m()}),xe=D("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var v=se.apply(null,arguments);return this.isValid()&&v.isValid()?this<v?this:v:m()});var is=["year","quarter","month","week","day","hour","minute","second","millisecond"];function To(v){var E=(v=H(v)).year||0,k=v.quarter||0,U=v.month||0,G=v.week||v.isoWeek||0,Z=v.day||0,ut=v.hour||0,dt=v.minute||0,vt=v.second||0,pt=v.millisecond||0;this._isValid=(function(Ut){var te,de,Ve=!1,Wi=is.length;for(te in Ut)if(n(Ut,te)&&(Dt.call(is,te)===-1||Ut[te]!=null&&isNaN(Ut[te])))return!1;for(de=0;de<Wi;++de)if(Ut[is[de]]){if(Ve)return!1;parseFloat(Ut[is[de]])!==w(Ut[is[de]])&&(Ve=!0)}return!0})(v),this._milliseconds=+pt+1e3*vt+6e4*dt+1e3*ut*60*60,this._days=+Z+7*G,this._months=+U+3*k+12*E,this._data={},this._locale=dr(),this._bubble()}function Eo(v){return v instanceof To}function xc(v){return v<0?-1*Math.round(-1*v):Math.round(v)}function _d(v,E){z(v,0,0,function(){var k=this.utcOffset(),U="+";return k<0&&(k=-k,U="-"),U+R(~~(k/60),2)+E+R(~~k%60,2)})}_d("Z",":"),_d("ZZ",""),at("Z",st),at("ZZ",st),Tt(["Z","ZZ"],function(v,E,k){k._useUTC=!0,k._tzm=Rc(st,v)});var cb=/([\+\-]|\d\d)/gi;function Rc(v,E){return(E=(E||"").match(v))===null?null:(E=60*(v=((E[E.length-1]||[])+"").match(cb)||["-",0,0])[1]+w(v[2]))===0?0:v[0]==="+"?E:-E}function kc(v,E){var k;return E._isUTC?(E=E.clone(),k=(S(v)||l(v)?v:se(v)).valueOf()-E.valueOf(),E._d.setTime(E._d.valueOf()+k),t.updateOffset(E,!1),E):se(v).local()}function Ic(v){return-Math.round(v._d.getTimezoneOffset())}function Sd(){return!!this.isValid()&&this._isUTC&&this._offset===0}t.updateOffset=function(){};var hb=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,ub=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Si(v,E){var k,U=v,G=null;return Eo(v)?U={ms:v._milliseconds,d:v._days,M:v._months}:o(v)||!isNaN(+v)?(U={},E?U[E]=+v:U.milliseconds=+v):(G=hb.exec(v))?(k=G[1]==="-"?-1:1,U={y:0,d:w(G[ji])*k,h:w(G[Ce])*k,m:w(G[_i])*k,s:w(G[hr])*k,ms:w(xc(1e3*G[yn]))*k}):(G=ub.exec(v))?(k=G[1]==="-"?-1:1,U={y:bn(G[2],k),M:bn(G[3],k),w:bn(G[4],k),d:bn(G[5],k),h:bn(G[6],k),m:bn(G[7],k),s:bn(G[8],k)}):U==null?U={}:typeof U=="object"&&("from"in U||"to"in U)&&(E=(function(Z,ut){var dt;return Z.isValid()&&ut.isValid()?(ut=kc(ut,Z),Z.isBefore(ut)?dt=Ad(Z,ut):((dt=Ad(ut,Z)).milliseconds=-dt.milliseconds,dt.months=-dt.months),dt):{milliseconds:0,months:0}})(se(U.from),se(U.to)),(U={}).ms=E.milliseconds,U.M=E.months),G=new To(U),Eo(v)&&n(v,"_locale")&&(G._locale=v._locale),Eo(v)&&n(v,"_isValid")&&(G._isValid=v._isValid),G}function bn(v,E){return v=v&&parseFloat(v.replace(",",".")),(isNaN(v)?0:v)*E}function Ad(v,E){var k={};return k.months=E.month()-v.month()+12*(E.year()-v.year()),v.clone().add(k.months,"M").isAfter(E)&&--k.months,k.milliseconds=+E-+v.clone().add(k.months,"M"),k}function xd(v,E){return function(k,U){var G;return U===null||isNaN(+U)||(P(E,"moment()."+E+"(period, number) is deprecated. Please use moment()."+E+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),G=k,k=U,U=G),Rd(this,Si(k,U),v),this}}function Rd(v,E,k,U){var G=E._milliseconds,Z=xc(E._days);E=xc(E._months),v.isValid()&&(U=U==null||U,E&&cd(v,C(v,"Month")+E*k),Z&&F(v,"Date",C(v,"Date")+Z*k),G&&v._d.setTime(v._d.valueOf()+G*k),U&&t.updateOffset(v,Z||E))}function kd(v){return typeof v=="string"||v instanceof String}function db(v){return S(v)||l(v)||kd(v)||o(v)||(function(E){var k=i(E),U=!1;return k&&(U=E.filter(function(G){return!o(G)&&kd(E)}).length===0),k&&U})(v)||(function(E){var k,U,G=r(E)&&!a(E),Z=!1,ut=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],dt=ut.length;for(k=0;k<dt;k+=1)U=ut[k],Z=Z||n(E,U);return G&&Z})(v)||v==null}function _o(v,E){if(v.date()<E.date())return-_o(E,v);var k=12*(E.year()-v.year())+(E.month()-v.month()),U=v.clone().add(k,"months");return-(k+(E=E-U<0?(E-U)/(U-v.clone().add(k-1,"months")):(E-U)/(v.clone().add(1+k,"months")-U)))||0}function Id(v){return v===void 0?this._locale._abbr:((v=dr(v))!=null&&(this._locale=v),this)}function Cd(){return this._locale}Si.fn=To.prototype,Si.invalid=function(){return Si(NaN)},$a=xd(1,"add"),Za=xd(-1,"subtract"),t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]",yo=D("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(v){return v===void 0?this.localeData():this.locale(v)});var qr,Dd=126227808e5;function Jn(v,E){return(v%E+E)%E}function Od(v,E,k){return v<100&&0<=v?new Date(v+400,E,k)-Dd:new Date(v,E,k).valueOf()}function Md(v,E,k){return v<100&&0<=v?Date.UTC(v+400,E,k)-Dd:Date.UTC(v,E,k)}function Cc(v,E){return E.erasAbbrRegex(v)}function Dc(){for(var v=[],E=[],k=[],U=[],G=this.eras(),Z=0,ut=G.length;Z<ut;++Z)E.push(It(G[Z].name)),v.push(It(G[Z].abbr)),k.push(It(G[Z].narrow)),U.push(It(G[Z].name)),U.push(It(G[Z].abbr)),U.push(It(G[Z].narrow));this._erasRegex=new RegExp("^("+U.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+E.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+v.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+k.join("|")+")","i")}function So(v,E){z(0,[v,v.length],0,E)}function Pd(v,E,k,U,G){var Z;return v==null?Ja(this,U,G).year:(Z=ur(v,U,G),(function(ut,dt,vt,pt,Ut){return dt=Qa((ut=dd(ut,dt,vt,pt,Ut)).year,0,ut.dayOfYear),this.year(dt.getUTCFullYear()),this.month(dt.getUTCMonth()),this.date(dt.getUTCDate()),this}).call(this,v,E=Z<E?Z:E,k,U,G))}for(z("N",0,0,"eraAbbr"),z("NN",0,0,"eraAbbr"),z("NNN",0,0,"eraAbbr"),z("NNNN",0,0,"eraName"),z("NNNNN",0,0,"eraNarrow"),z("y",["y",1],"yo","eraYear"),z("y",["yy",2],0,"eraYear"),z("y",["yyy",3],0,"eraYear"),z("y",["yyyy",4],0,"eraYear"),at("N",Cc),at("NN",Cc),at("NNN",Cc),at("NNNN",function(v,E){return E.erasNameRegex(v)}),at("NNNNN",function(v,E){return E.erasNarrowRegex(v)}),Tt(["N","NN","NNN","NNNN","NNNNN"],function(v,E,k,U){(U=k._locale.erasParse(v,U,k._strict))?d(k).era=U:d(k).invalidEra=v}),at("y",qt),at("yy",qt),at("yyy",qt),at("yyyy",qt),at("yo",function(v,E){return E._eraYearOrdinalRegex||qt}),Tt(["y","yy","yyy","yyyy"],Ot),Tt(["yo"],function(v,E,k,U){var G;k._locale._eraYearOrdinalRegex&&(G=v.match(k._locale._eraYearOrdinalRegex)),k._locale.eraYearOrdinalParse?E[Ot]=k._locale.eraYearOrdinalParse(v,G):E[Ot]=parseInt(v,10)}),z(0,["gg",2],0,function(){return this.weekYear()%100}),z(0,["GG",2],0,function(){return this.isoWeekYear()%100}),So("gggg","weekYear"),So("ggggg","weekYear"),So("GGGG","isoWeekYear"),So("GGGGG","isoWeekYear"),N("weekYear","gg"),N("isoWeekYear","GG"),rt("weekYear",1),rt("isoWeekYear",1),at("G",Ei),at("g",Ei),at("GG",gt,K),at("gg",gt,K),at("GGGG",he,mt),at("gggg",he,mt),at("GGGGG",zt,ft),at("ggggg",zt,ft),Rt(["gggg","ggggg","GGGG","GGGGG"],function(v,E,k,U){E[U.substr(0,2)]=w(v)}),Rt(["gg","GG"],function(v,E,k,U){E[U]=t.parseTwoDigitYear(v)}),z("Q",0,"Qo","quarter"),N("quarter","Q"),rt("quarter",7),at("Q",j),Tt("Q",function(v,E){E[qe]=3*(w(v)-1)}),z("D",["DD",2],"Do","date"),N("date","D"),rt("date",9),at("D",gt),at("DD",gt,K),at("Do",function(v,E){return v?E._dayOfMonthOrdinalParse||E._ordinalParse:E._dayOfMonthOrdinalParseLenient}),Tt(["D","DD"],ji),Tt("Do",function(v,E){E[ji]=w(v.match(gt)[0])}),he=_("Date",!0),z("DDD",["DDDD",3],"DDDo","dayOfYear"),N("dayOfYear","DDD"),rt("dayOfYear",4),at("DDD",we),at("DDDD",nt),Tt(["DDD","DDDD"],function(v,E,k){k._dayOfYear=w(v)}),z("m",["mm",2],0,"minute"),N("minute","m"),rt("minute",14),at("m",gt),at("mm",gt,K),Tt(["m","mm"],_i),mt=_("Minutes",!1),z("s",["ss",2],0,"second"),N("second","s"),rt("second",15),at("s",gt),at("ss",gt,K),Tt(["s","ss"],hr),zt=_("Seconds",!1),z("S",0,0,function(){return~~(this.millisecond()/100)}),z(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),z(0,["SSS",3],0,"millisecond"),z(0,["SSSS",4],0,function(){return 10*this.millisecond()}),z(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),z(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),z(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),z(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),z(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),N("millisecond","ms"),rt("millisecond",16),at("S",we,j),at("SS",we,K),at("SSS",we,nt),qr="SSSS";qr.length<=9;qr+="S")at(qr,qt);function fb(v,E){E[yn]=w(1e3*("0."+v))}for(qr="S";qr.length<=9;qr+="S")Tt(qr,fb);function Nd(v){return v}function Ao(v,E,k,U){var G=dr();return U=u().set(U,E),G[k](U,v)}function Ld(v,E,k){if(o(v)&&(E=v,v=void 0),v=v||"",E!=null)return Ao(v,E,k,"month");for(var U=[],G=0;G<12;G++)U[G]=Ao(v,G,k,"month");return U}function Oc(v,E,k,U){typeof v=="boolean"?o(E)&&(k=E,E=void 0):(E=v,v=!1,o(k=E)&&(k=E,E=void 0)),E=E||"";var G,Z=dr(),ut=v?Z._week.dow:0,dt=[];if(k!=null)return Ao(E,(k+ut)%7,U,"day");for(G=0;G<7;G++)dt[G]=Ao(E,(G+ut)%7,U,"day");return dt}ft=_("Milliseconds",!1),z("z",0,0,"zoneAbbr"),z("zz",0,0,"zoneName"),(j=b.prototype).add=$a,j.calendar=function(v,E){arguments.length===1&&(arguments[0]?db(arguments[0])?(v=arguments[0],E=void 0):(function(U){for(var G=r(U)&&!a(U),Z=!1,ut=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],dt=0;dt<ut.length;dt+=1)Z=Z||n(U,ut[dt]);return G&&Z})(arguments[0])&&(E=arguments[0],v=void 0):E=v=void 0);var k=kc(v=v||se(),this).startOf("day");return k=t.calendarFormat(this,k)||"sameElse",E=E&&(q(E[k])?E[k].call(this,v):E[k]),this.format(E||this.localeData().calendar(k,this,se(v)))},j.clone=function(){return new b(this)},j.diff=function(v,E,k){var U,G,Z;if(!this.isValid())return NaN;if(!(U=kc(v,this)).isValid())return NaN;switch(G=6e4*(U.utcOffset()-this.utcOffset()),E=V(E)){case"year":Z=_o(this,U)/12;break;case"month":Z=_o(this,U);break;case"quarter":Z=_o(this,U)/3;break;case"second":Z=(this-U)/1e3;break;case"minute":Z=(this-U)/6e4;break;case"hour":Z=(this-U)/36e5;break;case"day":Z=(this-U-G)/864e5;break;case"week":Z=(this-U-G)/6048e5;break;default:Z=this-U}return k?Z:it(Z)},j.endOf=function(v){var E,k;if((v=V(v))===void 0||v==="millisecond"||!this.isValid())return this;switch(k=this._isUTC?Md:Od,v){case"year":E=k(this.year()+1,0,1)-1;break;case"quarter":E=k(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":E=k(this.year(),this.month()+1,1)-1;break;case"week":E=k(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":E=k(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":E=k(this.year(),this.month(),this.date()+1)-1;break;case"hour":E=this._d.valueOf(),E+=36e5-Jn(E+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":E=this._d.valueOf(),E+=6e4-Jn(E,6e4)-1;break;case"second":E=this._d.valueOf(),E+=1e3-Jn(E,1e3)-1}return this._d.setTime(E),t.updateOffset(this,!0),this},j.format=function(v){return v=W(this,v=v||(this.isUtc()?t.defaultFormatUtc:t.defaultFormat)),this.localeData().postformat(v)},j.from=function(v,E){return this.isValid()&&(S(v)&&v.isValid()||se(v).isValid())?Si({to:this,from:v}).locale(this.locale()).humanize(!E):this.localeData().invalidDate()},j.fromNow=function(v){return this.from(se(),v)},j.to=function(v,E){return this.isValid()&&(S(v)&&v.isValid()||se(v).isValid())?Si({from:this,to:v}).locale(this.locale()).humanize(!E):this.localeData().invalidDate()},j.toNow=function(v){return this.to(se(),v)},j.get=function(v){return q(this[v=V(v)])?this[v]():this},j.invalidAt=function(){return d(this).overflow},j.isAfter=function(v,E){return v=S(v)?v:se(v),!(!this.isValid()||!v.isValid())&&((E=V(E)||"millisecond")==="millisecond"?this.valueOf()>v.valueOf():v.valueOf()<this.clone().startOf(E).valueOf())},j.isBefore=function(v,E){return v=S(v)?v:se(v),!(!this.isValid()||!v.isValid())&&((E=V(E)||"millisecond")==="millisecond"?this.valueOf()<v.valueOf():this.clone().endOf(E).valueOf()<v.valueOf())},j.isBetween=function(v,E,k,U){return v=S(v)?v:se(v),E=S(E)?E:se(E),!!(this.isValid()&&v.isValid()&&E.isValid())&&((U=U||"()")[0]==="("?this.isAfter(v,k):!this.isBefore(v,k))&&(U[1]===")"?this.isBefore(E,k):!this.isAfter(E,k))},j.isSame=function(v,E){return v=S(v)?v:se(v),!(!this.isValid()||!v.isValid())&&((E=V(E)||"millisecond")==="millisecond"?this.valueOf()===v.valueOf():(v=v.valueOf(),this.clone().startOf(E).valueOf()<=v&&v<=this.clone().endOf(E).valueOf()))},j.isSameOrAfter=function(v,E){return this.isSame(v,E)||this.isAfter(v,E)},j.isSameOrBefore=function(v,E){return this.isSame(v,E)||this.isBefore(v,E)},j.isValid=function(){return f(this)},j.lang=yo,j.locale=Id,j.localeData=Cd,j.max=xe,j.min=xt,j.parsingFlags=function(){return c({},d(this))},j.set=function(v,E){if(typeof v=="object")for(var k=(function(Z){var ut,dt=[];for(ut in Z)n(Z,ut)&&dt.push({unit:ut,priority:Q[ut]});return dt.sort(function(vt,pt){return vt.priority-pt.priority}),dt})(v=H(v)),U=k.length,G=0;G<U;G++)this[k[G].unit](v[k[G].unit]);else if(q(this[v=V(v)]))return this[v](E);return this},j.startOf=function(v){var E,k;if((v=V(v))===void 0||v==="millisecond"||!this.isValid())return this;switch(k=this._isUTC?Md:Od,v){case"year":E=k(this.year(),0,1);break;case"quarter":E=k(this.year(),this.month()-this.month()%3,1);break;case"month":E=k(this.year(),this.month(),1);break;case"week":E=k(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":E=k(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":E=k(this.year(),this.month(),this.date());break;case"hour":E=this._d.valueOf(),E-=Jn(E+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":E=this._d.valueOf(),E-=Jn(E,6e4);break;case"second":E=this._d.valueOf(),E-=Jn(E,1e3)}return this._d.setTime(E),t.updateOffset(this,!0),this},j.subtract=Za,j.toArray=function(){var v=this;return[v.year(),v.month(),v.date(),v.hour(),v.minute(),v.second(),v.millisecond()]},j.toObject=function(){var v=this;return{years:v.year(),months:v.month(),date:v.date(),hours:v.hours(),minutes:v.minutes(),seconds:v.seconds(),milliseconds:v.milliseconds()}},j.toDate=function(){return new Date(this.valueOf())},j.toISOString=function(v){if(!this.isValid())return null;var E=(v=v!==!0)?this.clone().utc():this;return E.year()<0||9999<E.year()?W(E,v?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):q(Date.prototype.toISOString)?v?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",W(E,"Z")):W(E,v?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},j.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var v,E="moment",k="";return this.isLocal()||(E=this.utcOffset()===0?"moment.utc":"moment.parseZone",k="Z"),E="["+E+'("]',v=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",this.format(E+v+"-MM-DD[T]HH:mm:ss.SSS"+k+'[")]')},typeof Symbol<"u"&&Symbol.for!=null&&(j[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),j.toJSON=function(){return this.isValid()?this.toISOString():null},j.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},j.unix=function(){return Math.floor(this.valueOf()/1e3)},j.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},j.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},j.eraName=function(){for(var v,E=this.localeData().eras(),k=0,U=E.length;k<U;++k)if(v=this.clone().startOf("day").valueOf(),E[k].since<=v&&v<=E[k].until||E[k].until<=v&&v<=E[k].since)return E[k].name;return""},j.eraNarrow=function(){for(var v,E=this.localeData().eras(),k=0,U=E.length;k<U;++k)if(v=this.clone().startOf("day").valueOf(),E[k].since<=v&&v<=E[k].until||E[k].until<=v&&v<=E[k].since)return E[k].narrow;return""},j.eraAbbr=function(){for(var v,E=this.localeData().eras(),k=0,U=E.length;k<U;++k)if(v=this.clone().startOf("day").valueOf(),E[k].since<=v&&v<=E[k].until||E[k].until<=v&&v<=E[k].since)return E[k].abbr;return""},j.eraYear=function(){for(var v,E,k=this.localeData().eras(),U=0,G=k.length;U<G;++U)if(v=k[U].since<=k[U].until?1:-1,E=this.clone().startOf("day").valueOf(),k[U].since<=E&&E<=k[U].until||k[U].until<=E&&E<=k[U].since)return(this.year()-t(k[U].since).year())*v+k[U].offset;return this.year()},j.year=po,j.isLeapYear=function(){return tt(this.year())},j.weekYear=function(v){return Pd.call(this,v,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},j.isoWeekYear=function(v){return Pd.call(this,v,this.isoWeek(),this.isoWeekday(),1,4)},j.quarter=j.quarters=function(v){return v==null?Math.ceil((this.month()+1)/3):this.month(3*(v-1)+this.month()%3)},j.month=hd,j.daysInMonth=function(){return go(this.year(),this.month())},j.week=j.weeks=function(v){var E=this.localeData().week(this);return v==null?E:this.add(7*(v-E),"d")},j.isoWeek=j.isoWeeks=function(v){var E=Ja(this,1,4).week;return v==null?E:this.add(7*(v-E),"d")},j.weeksInYear=function(){var v=this.localeData()._week;return ur(this.year(),v.dow,v.doy)},j.weeksInWeekYear=function(){var v=this.localeData()._week;return ur(this.weekYear(),v.dow,v.doy)},j.isoWeeksInYear=function(){return ur(this.year(),1,4)},j.isoWeeksInISOWeekYear=function(){return ur(this.isoWeekYear(),1,4)},j.date=he,j.day=j.days=function(v){if(!this.isValid())return v!=null?this:NaN;var E,k,U=this._isUTC?this._d.getUTCDay():this._d.getDay();return v!=null?(E=v,k=this.localeData(),v=typeof E!="string"?E:isNaN(E)?typeof(E=k.weekdaysParse(E))=="number"?E:null:parseInt(E,10),this.add(v-U,"d")):U},j.weekday=function(v){if(!this.isValid())return v!=null?this:NaN;var E=(this.day()+7-this.localeData()._week.dow)%7;return v==null?E:this.add(v-E,"d")},j.isoWeekday=function(v){return this.isValid()?v!=null?(E=v,k=this.localeData(),k=typeof E=="string"?k.weekdaysParse(E)%7||7:isNaN(E)?null:E,this.day(this.day()%7?k:k-7)):this.day()||7:v!=null?this:NaN;var E,k},j.dayOfYear=function(v){var E=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return v==null?E:this.add(v-E,"d")},j.hour=j.hours=ht,j.minute=j.minutes=mt,j.second=j.seconds=zt,j.millisecond=j.milliseconds=ft,j.utcOffset=function(v,E,k){var U,G=this._offset||0;if(!this.isValid())return v!=null?this:NaN;if(v==null)return this._isUTC?G:Ic(this);if(typeof v=="string"){if((v=Rc(st,v))===null)return this}else Math.abs(v)<16&&!k&&(v*=60);return!this._isUTC&&E&&(U=Ic(this)),this._offset=v,this._isUTC=!0,U!=null&&this.add(U,"m"),G!==v&&(!E||this._changeInProgress?Rd(this,Si(v-G,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,t.updateOffset(this,!0),this._changeInProgress=null)),this},j.utc=function(v){return this.utcOffset(0,v)},j.local=function(v){return this._isUTC&&(this.utcOffset(0,v),this._isUTC=!1,v&&this.subtract(Ic(this),"m")),this},j.parseZone=function(){var v;return this._tzm!=null?this.utcOffset(this._tzm,!1,!0):typeof this._i=="string"&&((v=Rc(Ga,this._i))!=null?this.utcOffset(v):this.utcOffset(0,!0)),this},j.hasAlignedHourOffset=function(v){return!!this.isValid()&&(v=v?se(v).utcOffset():0,(this.utcOffset()-v)%60==0)},j.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},j.isLocal=function(){return!!this.isValid()&&!this._isUTC},j.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},j.isUtc=Sd,j.isUTC=Sd,j.zoneAbbr=function(){return this._isUTC?"UTC":""},j.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},j.dates=D("dates accessor is deprecated. Use date instead.",he),j.months=D("months accessor is deprecated. Use month instead",hd),j.years=D("years accessor is deprecated. Use year instead",po),j.zone=D("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(v,E){return v!=null?(this.utcOffset(v=typeof v!="string"?-v:v,E),this):-this.utcOffset()}),j.isDSTShifted=D("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!s(this._isDSTShifted))return this._isDSTShifted;var v,E={};return T(E,this),(E=wd(E))._a?(v=(E._isUTC?u:se)(E._a),this._isDSTShifted=this.isValid()&&0<(function(k,U,G){for(var Z=Math.min(k.length,U.length),ut=Math.abs(k.length-U.length),dt=0,vt=0;vt<Z;vt++)w(k[vt])!==w(U[vt])&&dt++;return dt+ut})(E._a,v.toArray())):this._isDSTShifted=!1,this._isDSTShifted}),(K=A.prototype).calendar=function(v,E,k){return q(v=this._calendar[v]||this._calendar.sameElse)?v.call(E,k):v},K.longDateFormat=function(v){var E=this._longDateFormat[v],k=this._longDateFormat[v.toUpperCase()];return E||!k?E:(this._longDateFormat[v]=k.match(M).map(function(U){return U==="MMMM"||U==="MM"||U==="DD"||U==="dddd"?U.slice(1):U}).join(""),this._longDateFormat[v])},K.invalidDate=function(){return this._invalidDate},K.ordinal=function(v){return this._ordinal.replace("%d",v)},K.preparse=Nd,K.postformat=Nd,K.relativeTime=function(v,E,k,U){var G=this._relativeTime[k];return q(G)?G(v,E,k,U):G.replace(/%d/i,v)},K.pastFuture=function(v,E){return q(v=this._relativeTime[0<v?"future":"past"])?v(E):v.replace(/%s/i,E)},K.set=function(v){var E,k;for(k in v)n(v,k)&&(q(E=v[k])?this[k]=E:this["_"+k]=E);this._config=v,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},K.eras=function(v,E){for(var k,U=this._eras||dr("en")._eras,G=0,Z=U.length;G<Z;++G)switch(typeof U[G].since=="string"&&(k=t(U[G].since).startOf("day"),U[G].since=k.valueOf()),typeof U[G].until){case"undefined":U[G].until=1/0;break;case"string":k=t(U[G].until).startOf("day").valueOf(),U[G].until=k.valueOf()}return U},K.erasParse=function(v,E,k){var U,G,Z,ut,dt,vt=this.eras();for(v=v.toUpperCase(),U=0,G=vt.length;U<G;++U)if(Z=vt[U].name.toUpperCase(),ut=vt[U].abbr.toUpperCase(),dt=vt[U].narrow.toUpperCase(),k)switch(E){case"N":case"NN":case"NNN":if(ut===v)return vt[U];break;case"NNNN":if(Z===v)return vt[U];break;case"NNNNN":if(dt===v)return vt[U]}else if(0<=[Z,ut,dt].indexOf(v))return vt[U]},K.erasConvertYear=function(v,E){var k=v.since<=v.until?1:-1;return E===void 0?t(v.since).year():t(v.since).year()+(E-v.offset)*k},K.erasAbbrRegex=function(v){return n(this,"_erasAbbrRegex")||Dc.call(this),v?this._erasAbbrRegex:this._erasRegex},K.erasNameRegex=function(v){return n(this,"_erasNameRegex")||Dc.call(this),v?this._erasNameRegex:this._erasRegex},K.erasNarrowRegex=function(v){return n(this,"_erasNarrowRegex")||Dc.call(this),v?this._erasNarrowRegex:this._erasRegex},K.months=function(v,E){return v?(i(this._months)?this._months:this._months[(this._months.isFormat||ld).test(E)?"format":"standalone"])[v.month()]:i(this._months)?this._months:this._months.standalone},K.monthsShort=function(v,E){return v?(i(this._monthsShort)?this._monthsShort:this._monthsShort[ld.test(E)?"format":"standalone"])[v.month()]:i(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},K.monthsParse=function(v,E,k){var U,G;if(this._monthsParseExact)return(function(Z,ut,dt){var vt,pt,Ut;if(Z=Z.toLocaleLowerCase(),!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],vt=0;vt<12;++vt)Ut=u([2e3,vt]),this._shortMonthsParse[vt]=this.monthsShort(Ut,"").toLocaleLowerCase(),this._longMonthsParse[vt]=this.months(Ut,"").toLocaleLowerCase();return dt?ut==="MMM"?(pt=Dt.call(this._shortMonthsParse,Z))!==-1?pt:null:(pt=Dt.call(this._longMonthsParse,Z))!==-1?pt:null:ut==="MMM"?(pt=Dt.call(this._shortMonthsParse,Z))!==-1||(pt=Dt.call(this._longMonthsParse,Z))!==-1?pt:null:(pt=Dt.call(this._longMonthsParse,Z))!==-1||(pt=Dt.call(this._shortMonthsParse,Z))!==-1?pt:null}).call(this,v,E,k);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),U=0;U<12;U++)if(G=u([2e3,U]),k&&!this._longMonthsParse[U]&&(this._longMonthsParse[U]=new RegExp("^"+this.months(G,"").replace(".","")+"$","i"),this._shortMonthsParse[U]=new RegExp("^"+this.monthsShort(G,"").replace(".","")+"$","i")),k||this._monthsParse[U]||(G="^"+this.months(G,"")+"|^"+this.monthsShort(G,""),this._monthsParse[U]=new RegExp(G.replace(".",""),"i")),k&&E==="MMMM"&&this._longMonthsParse[U].test(v)||k&&E==="MMM"&&this._shortMonthsParse[U].test(v)||!k&&this._monthsParse[U].test(v))return U},K.monthsRegex=function(v){return this._monthsParseExact?(n(this,"_monthsRegex")||ud.call(this),v?this._monthsStrictRegex:this._monthsRegex):(n(this,"_monthsRegex")||(this._monthsRegex=X0),this._monthsStrictRegex&&v?this._monthsStrictRegex:this._monthsRegex)},K.monthsShortRegex=function(v){return this._monthsParseExact?(n(this,"_monthsRegex")||ud.call(this),v?this._monthsShortStrictRegex:this._monthsShortRegex):(n(this,"_monthsShortRegex")||(this._monthsShortRegex=$0),this._monthsShortStrictRegex&&v?this._monthsShortStrictRegex:this._monthsShortRegex)},K.week=function(v){return Ja(v,this._week.dow,this._week.doy).week},K.firstDayOfYear=function(){return this._week.doy},K.firstDayOfWeek=function(){return this._week.dow},K.weekdays=function(v,E){return E=i(this._weekdays)?this._weekdays:this._weekdays[v&&v!==!0&&this._weekdays.isFormat.test(E)?"format":"standalone"],v===!0?yc(E,this._week.dow):v?E[v.day()]:E},K.weekdaysMin=function(v){return v===!0?yc(this._weekdaysMin,this._week.dow):v?this._weekdaysMin[v.day()]:this._weekdaysMin},K.weekdaysShort=function(v){return v===!0?yc(this._weekdaysShort,this._week.dow):v?this._weekdaysShort[v.day()]:this._weekdaysShort},K.weekdaysParse=function(v,E,k){var U,G;if(this._weekdaysParseExact)return(function(Z,ut,dt){var vt,pt,Ut;if(Z=Z.toLocaleLowerCase(),!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],vt=0;vt<7;++vt)Ut=u([2e3,1]).day(vt),this._minWeekdaysParse[vt]=this.weekdaysMin(Ut,"").toLocaleLowerCase(),this._shortWeekdaysParse[vt]=this.weekdaysShort(Ut,"").toLocaleLowerCase(),this._weekdaysParse[vt]=this.weekdays(Ut,"").toLocaleLowerCase();return dt?ut==="dddd"?(pt=Dt.call(this._weekdaysParse,Z))!==-1?pt:null:ut==="ddd"?(pt=Dt.call(this._shortWeekdaysParse,Z))!==-1?pt:null:(pt=Dt.call(this._minWeekdaysParse,Z))!==-1?pt:null:ut==="dddd"?(pt=Dt.call(this._weekdaysParse,Z))!==-1||(pt=Dt.call(this._shortWeekdaysParse,Z))!==-1||(pt=Dt.call(this._minWeekdaysParse,Z))!==-1?pt:null:ut==="ddd"?(pt=Dt.call(this._shortWeekdaysParse,Z))!==-1||(pt=Dt.call(this._weekdaysParse,Z))!==-1||(pt=Dt.call(this._minWeekdaysParse,Z))!==-1?pt:null:(pt=Dt.call(this._minWeekdaysParse,Z))!==-1||(pt=Dt.call(this._weekdaysParse,Z))!==-1||(pt=Dt.call(this._shortWeekdaysParse,Z))!==-1?pt:null}).call(this,v,E,k);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),U=0;U<7;U++)if(G=u([2e3,1]).day(U),k&&!this._fullWeekdaysParse[U]&&(this._fullWeekdaysParse[U]=new RegExp("^"+this.weekdays(G,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[U]=new RegExp("^"+this.weekdaysShort(G,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[U]=new RegExp("^"+this.weekdaysMin(G,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[U]||(G="^"+this.weekdays(G,"")+"|^"+this.weekdaysShort(G,"")+"|^"+this.weekdaysMin(G,""),this._weekdaysParse[U]=new RegExp(G.replace(".",""),"i")),k&&E==="dddd"&&this._fullWeekdaysParse[U].test(v)||k&&E==="ddd"&&this._shortWeekdaysParse[U].test(v)||k&&E==="dd"&&this._minWeekdaysParse[U].test(v)||!k&&this._weekdaysParse[U].test(v))return U},K.weekdaysRegex=function(v){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||bc.call(this),v?this._weekdaysStrictRegex:this._weekdaysRegex):(n(this,"_weekdaysRegex")||(this._weekdaysRegex=J0),this._weekdaysStrictRegex&&v?this._weekdaysStrictRegex:this._weekdaysRegex)},K.weekdaysShortRegex=function(v){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||bc.call(this),v?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(n(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Z0),this._weekdaysShortStrictRegex&&v?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},K.weekdaysMinRegex=function(v){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||bc.call(this),v?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(n(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=tb),this._weekdaysMinStrictRegex&&v?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},K.isPM=function(v){return(v+"").toLowerCase().charAt(0)==="p"},K.meridiem=function(v,E,k){return 11<v?k?"pm":"PM":k?"am":"AM"},Yr("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(v){var E=v%10;return v+(w(v%100/10)===1?"th":E==1?"st":E==2?"nd":E==3?"rd":"th")}}),t.lang=D("moment.lang is deprecated. Use moment.locale instead.",Yr),t.langData=D("moment.langData is deprecated. Use moment.localeData instead.",dr);var fr=Math.abs;function Ud(v,E,k,U){return E=Si(E,k),v._milliseconds+=U*E._milliseconds,v._days+=U*E._days,v._months+=U*E._months,v._bubble()}function Fd(v){return v<0?Math.floor(v):Math.ceil(v)}function Bd(v){return 4800*v/146097}function Mc(v){return 146097*v/4800}function mr(v){return function(){return this.as(v)}}function wn(v){return function(){return this.isValid()?this._data[v]:NaN}}we=mr("ms"),nt=mr("s"),$a=mr("m"),xe=mr("h"),xt=mr("d"),Za=mr("w"),ht=mr("M"),mt=mr("Q"),zt=mr("y"),ft=wn("milliseconds"),he=wn("seconds"),po=wn("minutes"),K=wn("hours");var mb=wn("days"),gb=wn("months"),pb=wn("years"),gr=Math.round,Zn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function vb(v,E,k,U){var G=Si(v).abs(),Z=gr(G.as("s")),ut=gr(G.as("m")),dt=gr(G.as("h")),vt=gr(G.as("d")),pt=gr(G.as("M")),Ut=gr(G.as("w"));return G=gr(G.as("y")),Z=(Z<=k.ss?["s",Z]:Z<k.s&&["ss",Z])||ut<=1&&["m"]||ut<k.m&&["mm",ut]||dt<=1&&["h"]||dt<k.h&&["hh",dt]||vt<=1&&["d"]||vt<k.d&&["dd",vt],(Z=(Z=k.w!=null?Z||Ut<=1&&["w"]||Ut<k.w&&["ww",Ut]:Z)||pt<=1&&["M"]||pt<k.M&&["MM",pt]||G<=1&&["y"]||["yy",G])[2]=E,Z[3]=0<+v,Z[4]=U,(function(te,de,Ve,Wi,yb){return yb.relativeTime(de||1,!!Ve,te,Wi)}).apply(null,Z)}var Pc=Math.abs;function ta(v){return(0<v)-(v<0)||+v}function xo(){if(!this.isValid())return this.localeData().invalidDate();var v,E,k,U,G,Z,ut,dt=Pc(this._milliseconds)/1e3,vt=Pc(this._days),pt=Pc(this._months),Ut=this.asSeconds();return Ut?(v=it(dt/60),E=it(v/60),dt%=60,v%=60,k=it(pt/12),pt%=12,U=dt?dt.toFixed(3).replace(/\.?0+$/,""):"",G=ta(this._months)!==ta(Ut)?"-":"",Z=ta(this._days)!==ta(Ut)?"-":"",ut=ta(this._milliseconds)!==ta(Ut)?"-":"",(Ut<0?"-":"")+"P"+(k?G+k+"Y":"")+(pt?G+pt+"M":"")+(vt?Z+vt+"D":"")+(E||v||dt?"T":"")+(E?ut+E+"H":"")+(v?ut+v+"M":"")+(dt?ut+U+"S":"")):"P0D"}var Yt=To.prototype;return Yt.isValid=function(){return this._isValid},Yt.abs=function(){var v=this._data;return this._milliseconds=fr(this._milliseconds),this._days=fr(this._days),this._months=fr(this._months),v.milliseconds=fr(v.milliseconds),v.seconds=fr(v.seconds),v.minutes=fr(v.minutes),v.hours=fr(v.hours),v.months=fr(v.months),v.years=fr(v.years),this},Yt.add=function(v,E){return Ud(this,v,E,1)},Yt.subtract=function(v,E){return Ud(this,v,E,-1)},Yt.as=function(v){if(!this.isValid())return NaN;var E,k,U=this._milliseconds;if((v=V(v))==="month"||v==="quarter"||v==="year")switch(E=this._days+U/864e5,k=this._months+Bd(E),v){case"month":return k;case"quarter":return k/3;case"year":return k/12}else switch(E=this._days+Math.round(Mc(this._months)),v){case"week":return E/7+U/6048e5;case"day":return E+U/864e5;case"hour":return 24*E+U/36e5;case"minute":return 1440*E+U/6e4;case"second":return 86400*E+U/1e3;case"millisecond":return Math.floor(864e5*E)+U;default:throw new Error("Unknown unit "+v)}},Yt.asMilliseconds=we,Yt.asSeconds=nt,Yt.asMinutes=$a,Yt.asHours=xe,Yt.asDays=xt,Yt.asWeeks=Za,Yt.asMonths=ht,Yt.asQuarters=mt,Yt.asYears=zt,Yt.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*w(this._months/12):NaN},Yt._bubble=function(){var v=this._milliseconds,E=this._days,k=this._months,U=this._data;return 0<=v&&0<=E&&0<=k||v<=0&&E<=0&&k<=0||(v+=864e5*Fd(Mc(k)+E),k=E=0),U.milliseconds=v%1e3,v=it(v/1e3),U.seconds=v%60,v=it(v/60),U.minutes=v%60,v=it(v/60),U.hours=v%24,E+=it(v/24),k+=v=it(Bd(E)),E-=Fd(Mc(v)),v=it(k/12),k%=12,U.days=E,U.months=k,U.years=v,this},Yt.clone=function(){return Si(this)},Yt.get=function(v){return v=V(v),this.isValid()?this[v+"s"]():NaN},Yt.milliseconds=ft,Yt.seconds=he,Yt.minutes=po,Yt.hours=K,Yt.days=mb,Yt.weeks=function(){return it(this.days()/7)},Yt.months=gb,Yt.years=pb,Yt.humanize=function(v,E){if(!this.isValid())return this.localeData().invalidDate();var k=!1,U=Zn;return typeof v=="object"&&(E=v,v=!1),typeof v=="boolean"&&(k=v),typeof E=="object"&&(U=Object.assign({},Zn,E),E.s!=null&&E.ss==null&&(U.ss=E.s-1)),E=vb(this,!k,U,v=this.localeData()),k&&(E=v.pastFuture(+this,E)),v.postformat(E)},Yt.toISOString=xo,Yt.toString=xo,Yt.toJSON=xo,Yt.locale=Id,Yt.localeData=Cd,Yt.toIsoString=D("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",xo),Yt.lang=yo,z("X",0,0,"unix"),z("x",0,0,"valueOf"),at("x",Ei),at("X",/[+-]?\d+(\.\d{1,3})?/),Tt("X",function(v,E,k){k._d=new Date(1e3*parseFloat(v))}),Tt("x",function(v,E,k){k._d=new Date(w(v))}),t.version="2.29.4",e=se,t.fn=j,t.min=function(){return Ed("isBefore",[].slice.call(arguments,0))},t.max=function(){return Ed("isAfter",[].slice.call(arguments,0))},t.now=function(){return Date.now?Date.now():+new Date},t.utc=u,t.unix=function(v){return se(1e3*v)},t.months=function(v,E){return Ld(v,E,"months")},t.isDate=l,t.locale=Yr,t.invalid=m,t.duration=Si,t.isMoment=S,t.weekdays=function(v,E,k){return Oc(v,E,k,"weekdays")},t.parseZone=function(){return se.apply(null,arguments).parseZone()},t.localeData=dr,t.isDuration=Eo,t.monthsShort=function(v,E){return Ld(v,E,"monthsShort")},t.weekdaysMin=function(v,E,k){return Oc(v,E,k,"weekdaysMin")},t.defineLocale=Tc,t.updateLocale=function(v,E){var k,U;return E!=null?(U=pd,ue[v]!=null&&ue[v].parentLocale!=null?ue[v].set(J(ue[v]._config,E)):(E=J(U=(k=bo(v))!=null?k._config:U,E),k==null&&(E.abbr=v),(U=new A(E)).parentLocale=ue[v],ue[v]=U),Yr(v)):ue[v]!=null&&(ue[v].parentLocale!=null?(ue[v]=ue[v].parentLocale,v===Yr()&&Yr(v)):ue[v]!=null&&delete ue[v]),ue[v]},t.locales=function(){return x(ue)},t.weekdaysShort=function(v,E,k){return Oc(v,E,k,"weekdaysShort")},t.normalizeUnits=V,t.relativeTimeRounding=function(v){return v===void 0?gr:typeof v=="function"&&(gr=v,!0)},t.relativeTimeThreshold=function(v,E){return Zn[v]!==void 0&&(E===void 0?Zn[v]:(Zn[v]=E,v==="s"&&(Zn.ss=E-1),!0))},t.calendarFormat=function(v,E){return(v=v.diff(E,"days",!0))<-6?"sameElse":v<-1?"lastWeek":v<0?"lastDay":v<1?"sameDay":v<2?"nextDay":v<7?"nextWeek":"sameElse"},t.prototype=j,t.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},t})();var $y=Gu.exports,$u={exports:{}},Xy={exports:{}};(function(e){//! moment-timezone.js
//! version : 0.5.48
//! Copyright (c) JS Foundation and other contributors
//! license : MIT
//! github.com/moment/moment-timezone
(function(t,i){e.exports?e.exports=i(Gu.exports):i(t.moment)})(Mi,function(t){t.version===void 0&&t.default&&(t=t.default);var i,r={},n={},a={},s={},o={};t&&typeof t.version=="string"||M("Moment Timezone requires Moment.js. See https://momentjs.com/timezone/docs/#/use-it/browser/");var l=t.version.split("."),h=+l[0],c=+l[1];function u(L){return L>96?L-87:L>64?L-29:L-48}function d(L){var N=0,V=L.split("."),H=V[0],Q=V[1]||"",rt=1,tt=0,it=1;for(L.charCodeAt(0)===45&&(N=1,it=-1);N<H.length;N++)tt=60*tt+u(H.charCodeAt(N));for(N=0;N<Q.length;N++)rt/=60,tt+=u(Q.charCodeAt(N))*rt;return tt*it}function f(L){for(var N=0;N<L.length;N++)L[N]=d(L[N])}function m(L,N){var V,H=[];for(V=0;V<N.length;V++)H[V]=L[N[V]];return H}function p(L){var N=L.split("|"),V=N[2].split(" "),H=N[3].split(""),Q=N[4].split(" ");return f(V),f(H),f(Q),(function(rt,tt){for(var it=0;it<tt;it++)rt[it]=Math.round((rt[it-1]||0)+6e4*rt[it]);rt[tt-1]=1/0})(Q,H.length),{name:N[0],abbrs:m(N[1].split(" "),H),offsets:m(V,H),untils:Q,population:0|N[5]}}function g(L){L&&this._set(p(L))}function y(L,N){this.name=L,this.zones=N}function T(L){var N=L.toTimeString(),V=N.match(/\([a-z ]+\)/i);(V=V&&V[0]?(V=V[0].match(/[A-Z]/g))?V.join(""):void 0:(V=N.match(/[A-Z]{3,5}/g))?V[0]:void 0)==="GMT"&&(V=void 0),this.at=+L,this.abbr=V,this.offset=L.getTimezoneOffset()}function b(L){this.zone=L,this.offsetScore=0,this.abbrScore=0}function S(L,N){for(var V,H;H=6e4*((N.at-L.at)/12e4|0);)(V=new T(new Date(L.at+H))).offset===L.offset?L=V:N=V;return L}function I(L,N){return L.offsetScore!==N.offsetScore?L.offsetScore-N.offsetScore:L.abbrScore!==N.abbrScore?L.abbrScore-N.abbrScore:L.zone.population!==N.zone.population?N.zone.population-L.zone.population:N.zone.name.localeCompare(L.zone.name)}function D(L,N){var V,H;for(f(N),V=0;V<N.length;V++)H=N[V],o[H]=o[H]||{},o[H][L]=!0}function O(L){var N,V,H,Q,rt=L.length,tt={},it=[],w={};for(N=0;N<rt;N++)if(H=L[N].offset,!w.hasOwnProperty(H)){for(V in Q=o[H]||{})Q.hasOwnProperty(V)&&(tt[V]=!0);w[H]=!0}for(N in tt)tt.hasOwnProperty(N)&&it.push(s[N]);return it}function P(){try{var L=Intl.DateTimeFormat().resolvedOptions().timeZone;if(L&&L.length>3){var N=s[q(L)];if(N)return N;M("Moment Timezone found "+L+" from the Intl api, but did not have that data loaded.")}}catch{}var V,H,Q,rt=(function(){var _,C,F,j,K=new Date().getFullYear()-2,nt=new T(new Date(K,0,1)),mt=nt.offset,ft=[nt];for(j=1;j<48;j++)(F=new Date(K,j,1).getTimezoneOffset())!==mt&&(_=S(nt,C=new T(new Date(K,j,1))),ft.push(_),ft.push(new T(new Date(_.at+6e4))),nt=C,mt=F);for(j=0;j<4;j++)ft.push(new T(new Date(K+j,0,1))),ft.push(new T(new Date(K+j,6,1)));return ft})(),tt=rt.length,it=O(rt),w=[];for(H=0;H<it.length;H++){for(V=new b(A(it[H])),Q=0;Q<tt;Q++)V.scoreOffsetAt(rt[Q]);w.push(V)}return w.sort(I),w.length>0?w[0].zone.name:void 0}function q(L){return(L||"").toLowerCase().replace(/\//g,"_")}function J(L){var N,V,H,Q;for(typeof L=="string"&&(L=[L]),N=0;N<L.length;N++)Q=q(V=(H=L[N].split("|"))[0]),r[Q]=L[N],s[Q]=V,D(Q,H[2].split(" "))}function A(L,N){L=q(L);var V,H=r[L];return H instanceof g?H:typeof H=="string"?(H=new g(H),r[L]=H,H):n[L]&&N!==A&&(V=A(n[L],A))?((H=r[L]=new g)._set(V),H.name=s[L],H):null}function x(L){var N,V,H,Q;for(typeof L=="string"&&(L=[L]),N=0;N<L.length;N++)H=q((V=L[N].split("|"))[0]),Q=q(V[1]),n[H]=Q,s[H]=V[0],n[Q]=H,s[Q]=V[1]}function R(L){var N=L._f==="X"||L._f==="x";return!(!L._a||L._tzm!==void 0||N)}function M(L){typeof console<"u"&&typeof console.error=="function"&&console.error(L)}function Y(L){var N,V=Array.prototype.slice.call(arguments,0,-1),H=arguments[arguments.length-1],Q=t.utc.apply(null,V);return!t.isMoment(L)&&R(Q)&&(N=A(H))&&Q.add(N.parse(Q),"minutes"),Q.tz(H),Q}(h<2||h===2&&c<6)&&M("Moment Timezone requires Moment.js >= 2.6.0. You are using Moment.js "+t.version+". See momentjs.com"),g.prototype={_set:function(L){this.name=L.name,this.abbrs=L.abbrs,this.untils=L.untils,this.offsets=L.offsets,this.population=L.population},_index:function(L){var N;if((N=(function(V,H){var Q,rt=H.length;if(V<H[0])return 0;if(rt>1&&H[rt-1]===1/0&&V>=H[rt-2])return rt-1;if(V>=H[rt-1])return-1;for(var tt=0,it=rt-1;it-tt>1;)H[Q=Math.floor((tt+it)/2)]<=V?tt=Q:it=Q;return it})(+L,this.untils))>=0)return N},countries:function(){var L=this.name;return Object.keys(a).filter(function(N){return a[N].zones.indexOf(L)!==-1})},parse:function(L){var N,V,H,Q,rt=+L,tt=this.offsets,it=this.untils,w=it.length-1;for(Q=0;Q<w;Q++)if(N=tt[Q],V=tt[Q+1],H=tt[Q&&Q-1],N<V&&Y.moveAmbiguousForward?N=V:N>H&&Y.moveInvalidForward&&(N=H),rt<it[Q]-6e4*N)return tt[Q];return tt[w]},abbr:function(L){return this.abbrs[this._index(L)]},offset:function(L){return M("zone.offset has been deprecated in favor of zone.utcOffset"),this.offsets[this._index(L)]},utcOffset:function(L){return this.offsets[this._index(L)]}},b.prototype.scoreOffsetAt=function(L){this.offsetScore+=Math.abs(this.zone.utcOffset(L.at)-L.offset),this.zone.abbr(L.at).replace(/[^A-Z]/g,"")!==L.abbr&&this.abbrScore++},Y.version="0.5.48",Y.dataVersion="",Y._zones=r,Y._links=n,Y._names=s,Y._countries=a,Y.add=J,Y.link=x,Y.load=function(L){J(L.zones),x(L.links),(function(N){var V,H,Q,rt;if(N&&N.length)for(V=0;V<N.length;V++)H=(rt=N[V].split("|"))[0].toUpperCase(),Q=rt[1].split(" "),a[H]=new y(H,Q)})(L.countries),Y.dataVersion=L.version},Y.zone=A,Y.zoneExists=function L(N){return L.didShowError||(L.didShowError=!0,M("moment.tz.zoneExists('"+N+"') has been deprecated in favor of !moment.tz.zone('"+N+"')")),!!A(N)},Y.guess=function(L){return i&&!L||(i=P()),i},Y.names=function(){var L,N=[];for(L in s)s.hasOwnProperty(L)&&(r[L]||r[n[L]])&&s[L]&&N.push(s[L]);return N.sort()},Y.Zone=g,Y.unpack=p,Y.unpackBase60=d,Y.needsOffset=R,Y.moveInvalidForward=!0,Y.moveAmbiguousForward=!1,Y.countries=function(){return Object.keys(a)},Y.zonesForCountry=function(L,N){var V;if(V=(V=L).toUpperCase(),!(L=a[V]||null))return null;var H=L.zones.sort();return N?H.map(function(Q){return{name:Q,offset:A(Q).utcOffset(new Date)}}):H};var X,et=t.fn;function z(L){return function(){return this._z?this._z.abbr(this):L.call(this)}}function W(L){return function(){return this._z=null,L.apply(this,arguments)}}t.tz=Y,t.defaultZone=null,t.updateOffset=function(L,N){var V,H=t.defaultZone;if(L._z===void 0&&(H&&R(L)&&!L._isUTC&&L.isValid()&&(L._d=t.utc(L._a)._d,L.utc().add(H.parse(L),"minutes")),L._z=H),L._z)if(V=L._z.utcOffset(L),Math.abs(V)<16&&(V/=60),L.utcOffset!==void 0){var Q=L._z;L.utcOffset(-V,N),L._z=Q}else L.zone(V,N)},et.tz=function(L,N){if(L){if(typeof L!="string")throw new Error("Time zone name must be a string, got "+L+" ["+typeof L+"]");return this._z=A(L),this._z?t.updateOffset(this,N):M("Moment Timezone has no data for "+L+". See http://momentjs.com/timezone/docs/#/data-loading/."),this}if(this._z)return this._z.name},et.zoneName=z(et.zoneName),et.zoneAbbr=z(et.zoneAbbr),et.utc=W(et.utc),et.local=W(et.local),et.utcOffset=(X=et.utcOffset,function(){return arguments.length>0&&(this._z=null),X.apply(this,arguments)}),t.tz.setDefault=function(L){return(h<2||h===2&&c<9)&&M("Moment Timezone setDefault() requires Moment.js >= 2.9.0. You are using Moment.js "+t.version+"."),t.defaultZone=L?A(L):null,t};var $=t.momentProperties;return Object.prototype.toString.call($)==="[object Array]"?($.push("_z"),$.push("_a")):$&&($._z=null),t})})(Xy);var mD={version:"2021e",zones:["Asia/Shanghai|CST CDT|-80 -90|01010101010101010101010101010|-23uw0 18n0 OjB0 Rz0 11d0 1wL0 A10 8HX0 1G10 Tz0 1ip0 1jX0 1cN0 11b0 1oN0 aL0 1tU30 Rb0 1o10 11z0 1qN0 WL0 1qN0 11z0 1o10 11z0 1o10 11z0|23e6"],links:["Asia/Shanghai|Asia/Chongqing","Asia/Shanghai|Asia/Chungking","Asia/Shanghai|Asia/Harbin","Asia/Shanghai|PRC"],countries:["CN|Asia/Shanghai Asia/Urumqi"]};($u.exports=Xy.exports).tz.load(mD);var Pe,rh=$u.exports;(function(e){e.MILLISECONDS="MILLISECONDS",e.WEEK="WEEK",e.WEEK_ISO="WEEK_ISO",e.MONTH="MONTH",e.QUARTER="QUARTER",e.CUSTOM="CUSTOM"})(Pe||(Pe={}));var gn,cn,mi,nr=$y,hn=1e3,Xh=6e4,Rn=36e5,un=24*Rn,Qh=7*un,gD=Math.floor(30.44*un),pD=Math.floor(7889238e3);(function(e){e[e.REALTIME=0]="REALTIME",e[e.HISTORY=1]="HISTORY"})(gn||(gn={})),(function(e){e[e.LAST_INTERVAL=0]="LAST_INTERVAL",e[e.INTERVAL=1]="INTERVAL"})(cn||(cn={})),(function(e){e[e.LAST_INTERVAL=0]="LAST_INTERVAL",e[e.FIXED=1]="FIXED",e[e.INTERVAL=2]="INTERVAL",e[e.FOR_ALL_TIME=3]="FOR_ALL_TIME"})(mi||(mi={}));var Lt;cn.LAST_INTERVAL,cn.INTERVAL;mi.LAST_INTERVAL,mi.FIXED,mi.INTERVAL,mi.FOR_ALL_TIME;var Ar=(function(){function e(){}return e.max=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=t.map(function(n){return e.numberValue(n)});return t[r.indexOf(Math.max.apply(Math,on([],$e(r),!1)))]},e.min=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=t.map(function(n){return e.numberValue(n)});return t[r.indexOf(Math.min.apply(Math,on([],$e(r),!1)))]},e.numberValue=function(t){return typeof t=="number"?t:vD.get(t)},e})();(function(e){e.MIN="MIN",e.MAX="MAX",e.AVG="AVG",e.SUM="SUM",e.COUNT="COUNT",e.NONE="NONE"})(Lt||(Lt={}));var ct;Lt.MIN,Lt.MAX,Lt.AVG,Lt.SUM,Lt.COUNT,Lt.NONE;(function(e){e.YESTERDAY="YESTERDAY",e.DAY_BEFORE_YESTERDAY="DAY_BEFORE_YESTERDAY",e.THIS_DAY_LAST_WEEK="THIS_DAY_LAST_WEEK",e.PREVIOUS_WEEK="PREVIOUS_WEEK",e.PREVIOUS_WEEK_ISO="PREVIOUS_WEEK_ISO",e.PREVIOUS_MONTH="PREVIOUS_MONTH",e.PREVIOUS_QUARTER="PREVIOUS_QUARTER",e.PREVIOUS_HALF_YEAR="PREVIOUS_HALF_YEAR",e.PREVIOUS_YEAR="PREVIOUS_YEAR",e.CURRENT_HOUR="CURRENT_HOUR",e.CURRENT_DAY="CURRENT_DAY",e.CURRENT_DAY_SO_FAR="CURRENT_DAY_SO_FAR",e.CURRENT_WEEK="CURRENT_WEEK",e.CURRENT_WEEK_ISO="CURRENT_WEEK_ISO",e.CURRENT_WEEK_SO_FAR="CURRENT_WEEK_SO_FAR",e.CURRENT_WEEK_ISO_SO_FAR="CURRENT_WEEK_ISO_SO_FAR",e.CURRENT_MONTH="CURRENT_MONTH",e.CURRENT_MONTH_SO_FAR="CURRENT_MONTH_SO_FAR",e.CURRENT_QUARTER="CURRENT_QUARTER",e.CURRENT_QUARTER_SO_FAR="CURRENT_QUARTER_SO_FAR",e.CURRENT_HALF_YEAR="CURRENT_HALF_YEAR",e.CURRENT_HALF_YEAR_SO_FAR="CURRENT_HALF_YEAR_SO_FAR",e.CURRENT_YEAR="CURRENT_YEAR",e.CURRENT_YEAR_SO_FAR="CURRENT_YEAR_SO_FAR"})(ct||(ct={}));var ya,Jh;ct.YESTERDAY,ct.DAY_BEFORE_YESTERDAY,ct.THIS_DAY_LAST_WEEK,ct.PREVIOUS_WEEK,ct.PREVIOUS_WEEK_ISO,ct.PREVIOUS_MONTH,ct.PREVIOUS_QUARTER,ct.PREVIOUS_HALF_YEAR,ct.PREVIOUS_YEAR,ct.CURRENT_HOUR,ct.CURRENT_DAY,ct.CURRENT_DAY_SO_FAR,ct.CURRENT_WEEK,ct.CURRENT_WEEK_ISO,ct.CURRENT_WEEK_SO_FAR,ct.CURRENT_WEEK_ISO_SO_FAR,ct.CURRENT_MONTH,ct.CURRENT_MONTH_SO_FAR,ct.CURRENT_QUARTER,ct.CURRENT_QUARTER_SO_FAR,ct.CURRENT_HALF_YEAR,ct.CURRENT_HALF_YEAR_SO_FAR,ct.CURRENT_YEAR,ct.CURRENT_YEAR_SO_FAR;var vD=new Map([[Pe.WEEK,Qh],[Pe.WEEK_ISO,Qh],[Pe.MONTH,gD],[Pe.QUARTER,pD]]),yD=function(e){var t=nr().valueOf();return{displayValue:"",hideAggregation:!1,hideAggInterval:!1,hideTimezone:!1,selectedTab:gn.REALTIME,realtime:{realtimeType:cn.LAST_INTERVAL,interval:hn,timewindowMs:Xh,quickInterval:ct.CURRENT_DAY,hideInterval:!1,hideLastInterval:!1,hideQuickInterval:!1},history:{historyType:mi.LAST_INTERVAL,interval:hn,timewindowMs:Xh,fixedTimewindow:{startTimeMs:t-un,endTimeMs:t},quickInterval:ct.CURRENT_DAY,hideInterval:!1,hideLastInterval:!1,hideFixedInterval:!1,hideQuickInterval:!1},aggregation:{type:Lt.AVG,limit:Math.floor(e.getMaxDatapointsLimit()/2)}}},Dl=function(e){return pn(e.selectedTab)?Ye(e.realtime)?gn.REALTIME:gn.HISTORY:e.selectedTab},bD=function(e,t,i,r,n){var a,s,o,l,h,c,u,d,f;r=e.history?Ye(r)?r:e.history.interval:e.realtime?e.realtime.interval:0,e.aggregation?(d=e.aggregation.type||Lt.AVG,f=e.aggregation.limit||n.getMaxDatapointsLimit()):(d=Lt.AVG,f=n.getMaxDatapointsLimit());var m={hideAggregation:e.hideAggregation||!1,hideAggInterval:e.hideAggInterval||!1,hideTimezone:e.hideTimezone||!1,selectedTab:gn.HISTORY,history:{historyType:mi.FIXED,fixedTimewindow:{startTimeMs:t,endTimeMs:i},interval:n.boundIntervalToTimewindow(i-t,r,Lt.AVG),hideInterval:((a=e.history)===null||a===void 0?void 0:a.hideInterval)||!1,hideLastInterval:((s=e.history)===null||s===void 0?void 0:s.hideLastInterval)||!1,hideQuickInterval:((o=e.history)===null||o===void 0?void 0:o.hideQuickInterval)||!1},aggregation:{type:d,limit:f},timezone:e.timezone};return!((l=e.history)===null||l===void 0)&&l.disableCustomInterval&&(m.history.disableCustomInterval=e.history.disableCustomInterval),!((h=e.history)===null||h===void 0)&&h.disableCustomGroupInterval&&(m.history.disableCustomGroupInterval=e.history.disableCustomGroupInterval),!((c=e.history)===null||c===void 0)&&c.advancedParams&&(m.history.advancedParams=e.history.advancedParams),!((u=e.allowedAggTypes)===null||u===void 0)&&u.length&&(m.allowedAggTypes=e.allowedAggTypes),m},Vo=function(e,t){return!(!e||!t)&&Dl(e)!==Dl(t)},wD=function(e){return nr.tz(e)},Ol=function(e){if(e){var t=wD(e),i=nr().utcOffset();return 60*(t.utcOffset()-i)*1e3}return 0},TD=function(e){return Dl(e)===gn.HISTORY},Ci=function(e){return e?nr().tz(e):nr()},Qy=function(e,t){switch(e){case ct.YESTERDAY:return t.subtract(1,"days"),t.startOf("day");case ct.DAY_BEFORE_YESTERDAY:return t.subtract(2,"days"),t.startOf("day");case ct.THIS_DAY_LAST_WEEK:return t.subtract(1,"weeks"),t.startOf("day");case ct.PREVIOUS_WEEK:return t.subtract(1,"weeks"),t.startOf("week");case ct.PREVIOUS_WEEK_ISO:return t.subtract(1,"weeks"),t.startOf("isoWeek");case ct.PREVIOUS_MONTH:return t.subtract(1,"months"),t.startOf("month");case ct.PREVIOUS_QUARTER:return t.subtract(1,"quarter"),t.startOf("quarter");case ct.PREVIOUS_HALF_YEAR:return t.get("quarter")<3?t.startOf("year").subtract(2,"quarters"):t.startOf("year");case ct.PREVIOUS_YEAR:return t.subtract(1,"years"),t.startOf("year");case ct.CURRENT_HOUR:return t.startOf("hour");case ct.CURRENT_DAY:case ct.CURRENT_DAY_SO_FAR:return t.startOf("day");case ct.CURRENT_WEEK:case ct.CURRENT_WEEK_SO_FAR:return t.startOf("week");case ct.CURRENT_WEEK_ISO:case ct.CURRENT_WEEK_ISO_SO_FAR:return t.startOf("isoWeek");case ct.CURRENT_MONTH:case ct.CURRENT_MONTH_SO_FAR:return t.startOf("month");case ct.CURRENT_QUARTER:case ct.CURRENT_QUARTER_SO_FAR:return t.startOf("quarter");case ct.CURRENT_HALF_YEAR:case ct.CURRENT_HALF_YEAR_SO_FAR:return t.get("quarter")<3?t.startOf("year"):t.clone().set("quarter",3).startOf("quarter");case ct.CURRENT_YEAR:case ct.CURRENT_YEAR_SO_FAR:return t.startOf("year")}},Xu=function(e,t,i){switch(e){case ct.YESTERDAY:case ct.DAY_BEFORE_YESTERDAY:case ct.THIS_DAY_LAST_WEEK:case ct.CURRENT_DAY:return t.add(1,"day").valueOf();case ct.PREVIOUS_WEEK:case ct.PREVIOUS_WEEK_ISO:case ct.CURRENT_WEEK:case ct.CURRENT_WEEK_ISO:return t.add(1,"week").valueOf();case ct.PREVIOUS_MONTH:case ct.CURRENT_MONTH:return t.add(1,"month").valueOf();case ct.PREVIOUS_QUARTER:case ct.CURRENT_QUARTER:return t.add(1,"quarter").valueOf();case ct.PREVIOUS_HALF_YEAR:case ct.CURRENT_HALF_YEAR:return t.add(2,"quarters").valueOf();case ct.PREVIOUS_YEAR:case ct.CURRENT_YEAR:return t.add(1,"year").valueOf();case ct.CURRENT_HOUR:return t.add(1,"hour").valueOf();case ct.CURRENT_DAY_SO_FAR:case ct.CURRENT_WEEK_SO_FAR:case ct.CURRENT_WEEK_ISO_SO_FAR:case ct.CURRENT_MONTH_SO_FAR:case ct.CURRENT_QUARTER_SO_FAR:case ct.CURRENT_HALF_YEAR_SO_FAR:case ct.CURRENT_YEAR_SO_FAR:return Ci(i).valueOf()}},Qu=function(e,t){var i=[0,0],r=Ci(t),n=Qy(e,r);i[0]=n.valueOf();var a=Xu(e,n,t);return i[1]=a.valueOf(),i},ED=function(e,t,i,r){var n,a={fixedWindow:null,realtimeWindowMs:null,aggregation:{interval:hn,limit:r.getMaxDatapointsLimit(),type:Lt.AVG},timezone:e.timezone||AD(),tsOffset:Ol(e.timezone)};if(i&&(a.aggregation.type=Lt.NONE,a.aggregation.stateData=!0),Ye(e.aggregation)&&!i&&(a.aggregation={type:e.aggregation.type||Lt.AVG,limit:e.aggregation.limit||r.getMaxDatapointsLimit()}),Dl(e)===gn.REALTIME){var s=e.realtime.realtimeType;if(pn(s)&&(s=Ye(e.realtime.quickInterval)?cn.INTERVAL:cn.LAST_INTERVAL),s===cn.INTERVAL){a.realtimeWindowMs=(function(d,f){var m;switch(d){case ct.CURRENT_HOUR:return Rn;case ct.CURRENT_DAY:case ct.CURRENT_DAY_SO_FAR:return un;case ct.CURRENT_WEEK:case ct.CURRENT_WEEK_ISO:case ct.CURRENT_WEEK_SO_FAR:case ct.CURRENT_WEEK_ISO_SO_FAR:return Qh;case ct.CURRENT_MONTH:case ct.CURRENT_MONTH_SO_FAR:return(m=Ci(f)).clone().endOf("month").add(1,"milliseconds").diff(m.clone().startOf("month"));case ct.CURRENT_QUARTER:case ct.CURRENT_QUARTER_SO_FAR:return(m=Ci(f)).clone().endOf("quarter").add(1,"milliseconds").diff(m.clone().startOf("quarter"));case ct.CURRENT_HALF_YEAR:case ct.CURRENT_HALF_YEAR_SO_FAR:return(m=Ci(f)).get("quarter")<3?m.clone().set("quarter",2).endOf("quarter").add(1,"milliseconds").diff(m.clone().startOf("year")):m.clone().endOf("year").add(1,"milliseconds").diff(m.clone().set("quarter",3).startOf("quarter"));case ct.CURRENT_YEAR:case ct.CURRENT_YEAR_SO_FAR:return(m=Ci(f)).clone().endOf("year").add(1,"milliseconds").diff(m.clone().startOf("year"))}})(e.realtime.quickInterval,e.timezone),a.quickInterval=e.realtime.quickInterval;var o=Ci(e.timezone);a.startTs=Qy(e.realtime.quickInterval,o).valueOf()}else a.realtimeWindowMs=e.realtime.timewindowMs,o=Ci(e.timezone),a.startTs=o.valueOf()+t-a.realtimeWindowMs;a.aggregation.interval=a.aggregation.type===Lt.NONE?hn:e.realtime.interval?e.realtime.interval:r.boundIntervalToTimewindow(a.realtimeWindowMs,e.realtime.interval,a.aggregation.type),n=a.realtimeWindowMs}else{var l=e.history.historyType;if(pn(l)&&(l=Ye(e.history.timewindowMs)?mi.LAST_INTERVAL:Ye(e.history.quickInterval)?mi.INTERVAL:mi.FIXED),l===mi.LAST_INTERVAL){var h=(o=Ci(e.timezone)).valueOf();a.fixedWindow={startTimeMs:h-e.history.timewindowMs,endTimeMs:h},n=e.history.timewindowMs}else if(l===mi.INTERVAL){var c=Qu(e.history.quickInterval,e.timezone);a.fixedWindow={startTimeMs:c[0],endTimeMs:c[1]},n=a.fixedWindow.endTimeMs-a.fixedWindow.startTimeMs,a.quickInterval=e.history.quickInterval}else a.fixedWindow={startTimeMs:e.history.fixedTimewindow.startTimeMs-a.tsOffset,endTimeMs:e.history.fixedTimewindow.endTimeMs-a.tsOffset},n=a.fixedWindow.endTimeMs-a.fixedWindow.startTimeMs;a.startTs=a.fixedWindow.startTimeMs,a.aggregation.interval=a.aggregation.type===Lt.NONE?hn:e.history.interval?e.history.interval:r.boundIntervalToTimewindow(n,e.history.interval,a.aggregation.type)}var u=a.aggregation;return u.timeWindow=n,u.type!==Lt.NONE&&(u.limit=xD(a.startTs,n,a.aggregation.interval,e.timezone)),a},_D=function(e,t){switch(e){case ct.YESTERDAY:case ct.DAY_BEFORE_YESTERDAY:case ct.CURRENT_DAY:case ct.CURRENT_DAY_SO_FAR:return t.subtract(1,"days"),t.startOf("day");case ct.THIS_DAY_LAST_WEEK:return t.subtract(1,"weeks"),t.startOf("day");case ct.PREVIOUS_WEEK:case ct.CURRENT_WEEK:case ct.CURRENT_WEEK_SO_FAR:return t.subtract(1,"weeks"),t.startOf("week");case ct.PREVIOUS_WEEK_ISO:case ct.CURRENT_WEEK_ISO:case ct.CURRENT_WEEK_ISO_SO_FAR:return t.subtract(1,"weeks"),t.startOf("isoWeek");case ct.PREVIOUS_MONTH:case ct.CURRENT_MONTH:case ct.CURRENT_MONTH_SO_FAR:return t.subtract(1,"months"),t.startOf("month");case ct.PREVIOUS_QUARTER:case ct.CURRENT_QUARTER:case ct.CURRENT_QUARTER_SO_FAR:return t.subtract(1,"quarters"),t.startOf("quarter");case ct.PREVIOUS_HALF_YEAR:case ct.CURRENT_HALF_YEAR:case ct.CURRENT_HALF_YEAR_SO_FAR:return t.subtract(2,"quarters"),t.get("quarter")<3?t.startOf("year"):t.clone().set("quarter",3).startOf("quarter");case ct.PREVIOUS_YEAR:case ct.CURRENT_YEAR:case ct.CURRENT_YEAR_SO_FAR:return t.subtract(1,"years"),t.startOf("year");case ct.CURRENT_HOUR:return t.subtract(1,"hour"),t.startOf("hour")}},Jy=function(e,t,i){switch(e){case ct.CURRENT_DAY_SO_FAR:return i.subtract(1,"days").valueOf();case ct.CURRENT_WEEK_SO_FAR:case ct.CURRENT_WEEK_ISO_SO_FAR:return i.subtract(1,"week").valueOf();case ct.CURRENT_MONTH_SO_FAR:return i.subtract(1,"month").valueOf();case ct.CURRENT_QUARTER_SO_FAR:return i.subtract(1,"quarter").valueOf();case ct.CURRENT_HALF_YEAR_SO_FAR:return i.subtract(2,"quarters").valueOf();case ct.CURRENT_YEAR_SO_FAR:return i.subtract(1,"year").valueOf();default:return Xu(e,t)}},Zy=function(e,t,i){var r={fixedWindow:null,realtimeWindowMs:null,aggregation:e.aggregation,tsOffset:e.tsOffset,timezone:e.timezone};if(e.fixedWindow){var n=void 0,a=void 0;if(t==="previousInterval")if(e.quickInterval){var s=nr(e.fixedWindow.startTimeMs),o=nr(e.fixedWindow.endTimeMs);e.timezone&&(s.tz(e.timezone),o.tz(e.timezone));var l=_D(e.quickInterval,s);n=l.valueOf(),a=Jy(e.quickInterval,l,o)}else{var h=e.fixedWindow.endTimeMs-e.fixedWindow.startTimeMs;n=(a=e.fixedWindow.startTimeMs)-h}else t==="customInterval"?dn(i)&&isFinite(i)&&i>0?(h=e.fixedWindow.endTimeMs-e.fixedWindow.startTimeMs,n=(a=e.fixedWindow.endTimeMs-Math.round(i))-h):(a=e.fixedWindow.endTimeMs,n=e.fixedWindow.startTimeMs):(h=e.fixedWindow.endTimeMs-e.fixedWindow.startTimeMs,n=(a=nr(e.fixedWindow.endTimeMs).subtract(1,t).valueOf())-h);r.startTs=n,r.fixedWindow={startTimeMs:r.startTs,endTimeMs:a}}return r},SD=new Array({name:"timeinterval.seconds-interval",translateParams:{seconds:1},value:hn},{name:"timeinterval.seconds-interval",translateParams:{seconds:5},value:5e3},{name:"timeinterval.seconds-interval",translateParams:{seconds:10},value:1e4},{name:"timeinterval.seconds-interval",translateParams:{seconds:15},value:15e3},{name:"timeinterval.seconds-interval",translateParams:{seconds:30},value:3e4},{name:"timeinterval.minutes-interval",translateParams:{minutes:1},value:Xh},{name:"timeinterval.minutes-interval",translateParams:{minutes:2},value:12e4},{name:"timeinterval.minutes-interval",translateParams:{minutes:5},value:3e5},{name:"timeinterval.minutes-interval",translateParams:{minutes:10},value:6e5},{name:"timeinterval.minutes-interval",translateParams:{minutes:15},value:9e5},{name:"timeinterval.minutes-interval",translateParams:{minutes:30},value:18e5},{name:"timeinterval.hours-interval",translateParams:{hours:1},value:Rn},{name:"timeinterval.hours-interval",translateParams:{hours:2},value:2*Rn},{name:"timeinterval.hours-interval",translateParams:{hours:5},value:5*Rn},{name:"timeinterval.hours-interval",translateParams:{hours:10},value:10*Rn},{name:"timeinterval.hours-interval",translateParams:{hours:12},value:12*Rn},{name:"timeinterval.days-interval",translateParams:{days:1},value:un},{name:"timeinterval.days-interval",translateParams:{days:7},value:7*un},{name:"timeinterval.type.week",translateParams:{},value:Pe.WEEK},{name:"timeinterval.type.week-iso",translateParams:{},value:Pe.WEEK_ISO},{name:"timeinterval.days-interval",translateParams:{days:30},value:30*un},{name:"timeinterval.type.month",translateParams:{},value:Pe.MONTH},{name:"timeinterval.type.quarter",translateParams:{},value:Pe.QUARTER});(function(e){e.SECONDS="SECONDS",e.MINUTES="MINUTES",e.HOURS="HOURS",e.DAYS="DAYS"})(ya||(ya={})),(function(e){e.MILLISECONDS="MILLISECONDS"})(Jh||(Jh={}));var bt;Jh.MILLISECONDS,ya.SECONDS,ya.MINUTES,ya.HOURS,ya.DAYS;var nh=null,AD=function(){return nh||(nh=$u.exports.tz.guess()),nh},Ba=function(e,t){return t?nr(e).tz(t):nr(e)},xD=function(e,t,i,r){if(typeof i=="number")return Math.ceil(t/i);for(var n=Ba(e,r),a=Ba(e+t,r),s=Zh(n,i),o=tu(n,i),l=0;s.isBefore(a);)l++,o.add(1,"milliseconds"),s=Zh(o,i),o=tu(o,i);return l},Zh=function(e,t){switch(t){case Pe.WEEK:return e.clone().startOf("week");case Pe.WEEK_ISO:return e.clone().startOf("isoWeek");case Pe.MONTH:return e.clone().startOf("month");case Pe.QUARTER:return e.clone().startOf("quarter")}},tu=function(e,t){switch(t){case Pe.WEEK:return e.clone().endOf("week");case Pe.WEEK_ISO:return e.clone().endOf("isoWeek");case Pe.MONTH:return e.clone().endOf("month");case Pe.QUARTER:return e.clone().endOf("quarter")}},ig=function(e,t,i,r){return(r||e.aggregation.type)===Lt.NONE?[i,i]:RD(e.startTs,t,e.aggregation.interval,e.tsOffset,e.timezone,i)},RD=function(e,t,i,r,n,a){var s,o;if(typeof i=="number"){var l=e+r;o=(s=l+Math.floor((a-l)/i)*i)+i}else{var h=Ba(a,n),c=Zh(h,i),u=Ba(e,n);u.isAfter(c)&&(c=u);var d=tu(h,i).add(1,"milliseconds");s=c.valueOf()+r,o=d.valueOf()+r}return[s,o=Math.min(o,t)]};(function(e){e.timeseries="timeseries",e.latest="latest",e.rpc="rpc",e.alarm="alarm",e.static="static"})(bt||(bt={}));var rg,Ml;bt.timeseries,bt.latest,bt.rpc,bt.alarm,bt.static;(function(e){e.ALL="ALL",e.ACTUAL="ACTUAL",e.DEPRECATED="DEPRECATED"})(rg||(rg={})),(function(e){e.column="column",e.row="row"})(Ml||(Ml={}));var ba;Ml.column,Ml.row;(function(e){e.top="top",e.bottom="bottom",e.left="left",e.right="right"})(ba||(ba={}));var tr;ba.top,ba.bottom,ba.left,ba.right;(function(e){e.PREVIOUS_VALUE="PREVIOUS_VALUE",e.DELTA_ABSOLUTE="DELTA_ABSOLUTE",e.DELTA_PERCENT="DELTA_PERCENT"})(tr||(tr={}));var ng,Ct;tr.PREVIOUS_VALUE,tr.DELTA_ABSOLUTE,tr.DELTA_PERCENT;Lt.MIN,Lt.MAX,Lt.AVG,Lt.SUM,Lt.COUNT,Lt.NONE;(function(e){e.general="general",e.advanced="advanced"})(ng||(ng={})),(function(e){e.function="function",e.device="device",e.entity="entity",e.entityCount="entityCount",e.alarmCount="alarmCount"})(Ct||(Ct={}));var Lr;Ct.function,Ct.device,Ct.entity,Ct.entityCount,Ct.alarmCount;(function(e){e.device="device",e.entity="entity"})(Lr||(Lr={}));var tn,kD=function(e){return!!e&&!!e.type&&(e.type===Lr.device&&!!e.deviceId||e.type===Lr.entity&&!!e.entityAliasId)},ID=function(e){if(e){var t=e.find(function(i){var r=i.dataKeys&&i.dataKeys.find(function(n){return(n==null?void 0:n.type)===Qt.timeseries&&(n==null?void 0:n.aggregationType)&&n.aggregationType!==Lt.NONE});return!!r});if(t)return!0}return!1};(function(e){e.basic="basic",e.raised="raised",e.stroked="stroked",e.flat="flat",e.icon="icon",e.miniFab="miniFab"})(tn||(tn={}));var ki,Ii,wa;tn.basic,tn.raised,tn.stroked,tn.flat,tn.icon,tn.miniFab;(function(e){e.doNothing="doNothing",e.openDashboardState="openDashboardState",e.updateDashboardState="updateDashboardState",e.openDashboard="openDashboard",e.custom="custom",e.customPretty="customPretty",e.mobileAction="mobileAction",e.openURL="openURL",e.placeMapItem="placeMapItem"})(ki||(ki={})),(function(e){e.takePictureFromGallery="takePictureFromGallery",e.takePhoto="takePhoto",e.mapDirection="mapDirection",e.mapLocation="mapLocation",e.scanQrCode="scanQrCode",e.makePhoneCall="makePhoneCall",e.getLocation="getLocation",e.takeScreenshot="takeScreenshot",e.deviceProvision="deviceProvision"})(Ii||(Ii={})),(function(e){e.marker="marker",e.polygon="polygon",e.rectangle="rectangle",e.circle="circle"})(wa||(wa={}));var ag;ki.doNothing,ki.openDashboardState,ki.updateDashboardState,ki.openDashboard,ki.custom,ki.customPretty,ki.mobileAction,ki.openURL,ki.placeMapItem;Ii.takePictureFromGallery,Ii.takePhoto,Ii.mapDirection,Ii.mapLocation,Ii.scanQrCode,Ii.makePhoneCall,Ii.getLocation,Ii.takeScreenshot,Ii.deviceProvision;wa.marker,wa.polygon,wa.rectangle,wa.circle;var sg=function(e){return"comparisonSettings"in e};(function(e){e.basic="basic",e.advanced="advanced"})(ag||(ag={}));var kn,In,Ai={serverErrorCode:{general:2,authentication:10,jwtTokenExpired:11,tenantTrialExpired:12,credentialsExpired:15,permissionDenied:20,invalidArguments:30,badRequestParams:31,itemNotFound:32,tooManyRequests:33,tooManyUpdates:34}},CD=new Map([[Ai.serverErrorCode.general,"server-error.general"],[Ai.serverErrorCode.authentication,"server-error.authentication"],[Ai.serverErrorCode.jwtTokenExpired,"server-error.jwt-token-expired"],[Ai.serverErrorCode.tenantTrialExpired,"server-error.tenant-trial-expired"],[Ai.serverErrorCode.credentialsExpired,"server-error.credentials-expired"],[Ai.serverErrorCode.permissionDenied,"server-error.permission-denied"],[Ai.serverErrorCode.invalidArguments,"server-error.invalid-arguments"],[Ai.serverErrorCode.badRequestParams,"server-error.bad-request-params"],[Ai.serverErrorCode.itemNotFound,"server-error.item-not-found"],[Ai.serverErrorCode.tooManyRequests,"server-error.too-many-requests"],[Ai.serverErrorCode.tooManyUpdates,"server-error.too-many-updates"]]);(function(e){e.STRING="STRING",e.INTEGER="INTEGER",e.DOUBLE="DOUBLE",e.BOOLEAN="BOOLEAN",e.JSON="JSON"})(kn||(kn={})),(function(e){e.STRING="STRING",e.LONG="LONG",e.BOOLEAN="BOOLEAN",e.DOUBLE="DOUBLE",e.JSON="JSON"})(In||(In={}));var As;In.STRING,In.LONG,In.BOOLEAN,In.DOUBLE,In.JSON;kn.STRING,kn.INTEGER,kn.DOUBLE,kn.BOOLEAN,kn.JSON;(function(e){e.JSON="JSON",e.TEXT="TEXT",e.BINARY="BINARY"})(As||(As={}));As.JSON,As.TEXT,As.BINARY;var DD="custom.",t0="i18n",og=/\${([^}]*)}/g;function pn(e){return e===void 0}function Ye(e){return e!==void 0}function ze(e){return e!=null}function rr(e){return typeof e=="string"&&e.trim().length>0}function uo(e){return e!==null&&typeof e=="object"}function fo(e){return typeof e=="number"}function dn(e){return e-parseFloat(e)+1>=0}var OD=function(e){return Object.prototype.toString.call(e)==="[object Date]"},MD=function(e,t,i,r){if(ze(e)&&dn(e)&&(ze(t)||rr(i)||Number(e).toString()===e)){var n=e;return ze(t)&&(n=Number(n).toFixed(t)),r||(n=Number(n)),n=n.toString(),rr(i)&&(n+=" "+i),n}return e!==null?e:""};function lg(e){var t=JSON.stringify(e);return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(i,r){return String.fromCharCode(+("0x"+r))}))}function e0(e){var t,i=0;if(e.length===0)return i;for(t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i&=i;return i}function PD(e){var t=0;return e&&(t=e0(JSON.stringify(e))),t}function Kt(e,t){if(e===null||(i=e)&&(i instanceof _e||ce(i.lift)&&ce(i.subscribe)))return e;var i;if(OD(e))return new Date(e.getTime());if(Array.isArray(e))return e.map(function(n){return Kt(n)});if(typeof e=="object"){var r=lr({},e);return Object.keys(r).forEach(function(n){t&&t.indexOf(n)!==-1||(r[n]=Kt(r[n]))}),r}return e}var i0=function(e,t){return WR(e,t)};function ND(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function cg(e,t){return e.hasOwnProperty(t)?e[t]:t.split(".").reduce(function(i,r){return i&&i[r]},e)}var hg,Me,Un,Cn,r0=function(e,t){var i=t;if(!e)return i;for(var r=og.exec(t);r!==null;){var n=r[0],a=r[1];a==="dsName"?i=i.replace(n,e.name):a==="entityName"||a==="deviceName"?i=i.replace(n,e.entityName):a==="entityLabel"?i=i.replace(n,e.entityLabel||e.entityName):a==="aliasName"?i=i.replace(n,e.aliasName):a==="entityDescription"&&(i=i.replace(n,e.entityDescription)),r=og.exec(t)}return i};function ug(e,t){var i=(function(r,n){var a=[];try{for(var s=/\${([^}]*)}/g,o=s.exec(r);o!==null;){var l={dataKeyName:"",valDec:2,variable:""},h=o[0],c=o[1],u=2,d=c.split(":");if(d.length>1&&(c=d[0],u=parseFloat(d[1])),l.variable=h,l.valDec=u,c.startsWith("#")){var f=c.substring(1),m=Math.floor(Number(f));String(m)===f&&m>=0&&(l.dataKeyName=n.$datasource.dataKeys[m].label)}else l.dataKeyName=c;a.push(l),o=s.exec(r)}}catch(p){console.log(p,r)}return a})(e,t);return(function(r,n,a){var s,o,l=r0(a.$datasource,r);if(n)try{for(var h=kt(n),c=h.next();!c.done;c=h.next()){var u=c.value,d="";if(u.dataKeyName&&ze(a[u.dataKeyName])){var f=a[u.dataKeyName];d=fo(f)?LD(f,u.valDec):f}l=l.replace(u.variable,d)}}catch(m){s={error:m}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(s)throw s.error}}return l})(e,i,t)}function LD(e,t){var i;return i=(e=parseFloat(e))<0,e=Math.abs(e),(i?"-":"")+(t>0?e.toFixed(t):Math.round(e).toString())}function ah(){var e=window.location.protocol+"//"+window.location.hostname,t=window.location.port;return t&&t.length>0&&t!=="80"&&t!=="443"&&(e+=":"+t),e}function UD(e,t){return vm.has(t)?"".concat(vm.get(t),"/").concat(e):""}function FD(e,t,i){var r,n=null,a=0;if(n=e.error,n&&!n.message?r=(function(l){if(typeof l!="object"||l.constructor!==ArrayBuffer)return l;var h=String.fromCharCode.apply(null,new Uint8Array(l));try{var c=JSON.parse(h);return c.message?c.message:h}catch{return h}})(n):n&&n.message?(r=n.message,a=n.timeout?n.timeout:0):r="Unhandled error code ".concat(n?n.status:"'Unknown'"),uo(r)){var s="".concat(e.status,": "),o=null;r.errorCode&&(o=CD.get(r.errorCode)),r=s+=o?t.instant(o):e.statusText}return{message:r,timeout:a}}function Ho(){return window&&window.performance&&window.performance.now?window.performance.now():Date.now()}function dg(e){return e||(e=[]),e.forEach(function(t){t.deviceAliasId&&(t.type=Ct.entity,t.entityAliasId=t.deviceAliasId,delete t.deviceAliasId),t.deviceName&&(t.entityName=t.deviceName,delete t.deviceName),t.type===Ct.entity&&t.entityId&&(t.name=t.entityName),t.dataKeys||(t.dataKeys=[]),t.dataKeys.forEach(function(i){pn(i.label)&&(i.label=i.name)})}),e}(function(e){e[e.ALL=0]="ALL",e[e.ENTITY=1]="ENTITY"})(hg||(hg={})),(function(e){e.CRITICAL="CRITICAL",e.MAJOR="MAJOR",e.MINOR="MINOR",e.WARNING="WARNING",e.INDETERMINATE="INDETERMINATE"})(Me||(Me={})),(function(e){e.ACTIVE_UNACK="ACTIVE_UNACK",e.ACTIVE_ACK="ACTIVE_ACK",e.CLEARED_UNACK="CLEARED_UNACK",e.CLEARED_ACK="CLEARED_ACK"})(Un||(Un={})),(function(e){e.ANY="ANY",e.ACTIVE="ACTIVE",e.CLEARED="CLEARED",e.ACK="ACK",e.UNACK="UNACK"})(Cn||(Cn={}));var fg,mg;Me.CRITICAL,Me.MAJOR,Me.MINOR,Me.WARNING,Me.INDETERMINATE;Un.ACTIVE_UNACK,Un.ACTIVE_ACK,Un.CLEARED_UNACK,Un.CLEARED_ACK;Cn.ANY,Cn.ACTIVE,Cn.CLEARED,Cn.ACK,Cn.UNACK;Me.CRITICAL,Me.MAJOR,Me.MINOR,Me.WARNING,Me.INDETERMINATE;(function(e){e.SYSTEM="SYSTEM",e.OTHER="OTHER"})(fg||(fg={})),(function(e){e.noAssignee="noAssignee",e.currentUser="currentUser"})(mg||(mg={}));var Qt,vn,yi,Ta,BD={id:new M1(Ln),tenantId:new O1(Ln),customerId:new P1(Ln),assigneeId:new N1(Ln),createdTime:new Date().getTime(),startTs:new Date().getTime(),endTs:0,ackTs:0,clearTs:0,assignTs:0,originatorName:"Simulated",originatorLabel:"Simulated",assignee:{firstName:"",lastName:"",email:"test@example.com"},originator:{entityType:wt.DEVICE,id:"1"},type:"TEMPERATURE",severity:Me.MAJOR,status:Un.ACTIVE_UNACK,acknowledged:!1,cleared:!1,details:{message:"Temperature is high!"},propagate:!1},Oi={createdTime:{keyName:"createdTime",value:"createdTime",name:"alarm.created-time",time:!0},startTime:{keyName:"startTime",value:"startTs",name:"alarm.start-time",time:!0},endTime:{keyName:"endTime",value:"endTs",name:"alarm.end-time",time:!0},ackTime:{keyName:"ackTime",value:"ackTs",name:"alarm.ack-time",time:!0},clearTime:{keyName:"clearTime",value:"clearTs",name:"alarm.clear-time",time:!0},assignTime:{keyName:"assignTime",value:"assignTs",name:"alarm.assign-time",time:!0},originator:{keyName:"originator",value:"originatorName",name:"alarm.originator"},originatorLabel:{keyName:"originatorLabel",value:"originatorLabel",name:"alarm.originator-label"},originatorType:{keyName:"originatorType",value:"originator.entityType",name:"alarm.originator-type"},type:{keyName:"type",value:"type",name:"alarm.type"},severity:{keyName:"severity",value:"severity",name:"alarm.severity"},status:{keyName:"status",value:"status",name:"alarm.status"},assignee:{keyName:"assignee",value:"assignee",name:"alarm.assignee"}},n0={createdTime:{keyName:"createdTime",name:"entity-field.created-time",value:"createdTime",time:!0},name:{keyName:"name",name:"entity-field.name",value:"name"},type:{keyName:"type",name:"entity-field.type",value:"type"},firstName:{keyName:"firstName",name:"entity-field.first-name",value:"firstName"},lastName:{keyName:"lastName",name:"entity-field.last-name",value:"lastName"},email:{keyName:"email",name:"entity-field.email",value:"email"},title:{keyName:"title",name:"entity-field.title",value:"title"},country:{keyName:"country",name:"entity-field.country",value:"country"},state:{keyName:"state",name:"entity-field.state",value:"state"},city:{keyName:"city",name:"entity-field.city",value:"city"},address:{keyName:"address",name:"entity-field.address",value:"address"},address2:{keyName:"address2",name:"entity-field.address2",value:"address2"},zip:{keyName:"zip",name:"entity-field.zip",value:"zip"},phone:{keyName:"phone",name:"entity-field.phone",value:"phone"},label:{keyName:"label",name:"entity-field.label",value:"label"},queueName:{keyName:"queueName",name:"entity-field.queue-name",value:"queueName"},serviceId:{keyName:"serviceId",name:"entity-field.service-id",value:"serviceId"},ownerName:{keyName:"ownerName",name:"entity-field.owner-name",value:"ownerName"},ownerType:{keyName:"ownerType",name:"entity-field.owner-type",value:"ownerType"}},a0=(function(){function e(t,i){this.wsService=t,this.zone=i,this.reconnectSubject=new or,this.reconnect$=this.reconnectSubject.asObservable(),this.subscriptionCommands=[]}return e.prototype.subscribe=function(){this.wsService.subscribe(this)},e.prototype.update=function(){this.wsService.update(this)},e.prototype.unsubscribe=function(){this.wsService.unsubscribe(this),this.complete()},e.prototype.complete=function(){this.reconnectSubject.complete()},e.prototype.onReconnected=function(){this.reconnectSubject.next()},e})(),s0="Not supported!";(function(e){e.timeseries="timeseries",e.attribute="attribute",e.function="function",e.alarm="alarm",e.entityField="entityField",e.count="count"})(Qt||(Qt={})),(function(e){e.LATEST_TELEMETRY="LATEST_TELEMETRY"})(vn||(vn={})),(function(e){e.CLIENT_SCOPE="CLIENT_SCOPE",e.SERVER_SCOPE="SERVER_SCOPE",e.SHARED_SCOPE="SHARED_SCOPE"})(yi||(yi={})),(function(e){e.DELETE_ALL_DATA="DELETE_ALL_DATA",e.DELETE_ALL_DATA_EXCEPT_LATEST_VALUE="DELETE_ALL_DATA_EXCEPT_LATEST_VALUE",e.DELETE_LATEST_VALUE="DELETE_LATEST_VALUE",e.DELETE_ALL_DATA_FOR_TIME_PERIOD="DELETE_ALL_DATA_FOR_TIME_PERIOD"})(Ta||(Ta={}));var gg,De;vn.LATEST_TELEMETRY,yi.CLIENT_SCOPE,yi.SERVER_SCOPE,yi.SHARED_SCOPE;vn.LATEST_TELEMETRY,yi.CLIENT_SCOPE,yi.SERVER_SCOPE,yi.SHARED_SCOPE;vn.LATEST_TELEMETRY,yi.CLIENT_SCOPE,yi.SERVER_SCOPE,yi.SHARED_SCOPE;Ta.DELETE_ALL_DATA,Ta.DELETE_ALL_DATA_EXCEPT_LATEST_VALUE,Ta.DELETE_LATEST_VALUE,Ta.DELETE_ALL_DATA_FOR_TIME_PERIOD;(function(e){e.ASC="ASC",e.DESC="DESC"})(gg||(gg={})),(function(e){e.AUTH="AUTH",e.ATTRIBUTES="ATTRIBUTES",e.TIMESERIES="TIMESERIES",e.TIMESERIES_HISTORY="TIMESERIES_HISTORY",e.ENTITY_DATA="ENTITY_DATA",e.ENTITY_COUNT="ENTITY_COUNT",e.ALARM_DATA="ALARM_DATA",e.ALARM_COUNT="ALARM_COUNT",e.ALARM_STATUS="ALARM_STATUS",e.NOTIFICATIONS="NOTIFICATIONS",e.NOTIFICATIONS_COUNT="NOTIFICATIONS_COUNT",e.MARK_NOTIFICATIONS_AS_READ="MARK_NOTIFICATIONS_AS_READ",e.MARK_ALL_NOTIFICATIONS_AS_READ="MARK_ALL_NOTIFICATIONS_AS_READ",e.ALARM_DATA_UNSUBSCRIBE="ALARM_DATA_UNSUBSCRIBE",e.ALARM_COUNT_UNSUBSCRIBE="ALARM_COUNT_UNSUBSCRIBE",e.ALARM_STATUS_UNSUBSCRIBE="ALARM_STATUS_UNSUBSCRIBE",e.ENTITY_DATA_UNSUBSCRIBE="ENTITY_DATA_UNSUBSCRIBE",e.ENTITY_COUNT_UNSUBSCRIBE="ENTITY_COUNT_UNSUBSCRIBE",e.NOTIFICATIONS_UNSUBSCRIBE="NOTIFICATIONS_UNSUBSCRIBE"})(De||(De={}));var xs,Ju=function(){},jD=(function(e){function t(){var i=e!==null&&e.apply(this,arguments)||this;return i.type=De.ATTRIBUTES,i}return Le(t,e),t})(Ju);(function(e){e.MILLISECONDS="MILLISECONDS",e.WEEK="WEEK",e.WEEK_ISO="WEEK_ISO",e.MONTH="MONTH",e.QUARTER="QUARTER",e.CUSTOM="CUSTOM"})(xs||(xs={}));var Vr,WD=(function(e){function t(){var i=e!==null&&e.apply(this,arguments)||this;return i.type=De.TIMESERIES,i}return Le(t,e),t})(Ju),qs=(function(){function e(){this.type=De.ENTITY_DATA}return e.prototype.isEmpty=function(){return!(this.query||this.historyCmd||this.latestCmd||this.tsCmd||this.aggTsCmd||this.aggHistoryCmd)},e})(),o0=function(){this.type=De.ENTITY_COUNT},l0=(function(){function e(){this.type=De.ALARM_DATA}return e.prototype.isEmpty=function(){return!this.query},e})(),c0=function(){this.type=De.ALARM_COUNT},h0=function(){this.type=De.ALARM_STATUS},u0=function(){this.type=De.NOTIFICATIONS_COUNT},eu=function(e,t){e===void 0&&(e=10),t===void 0&&(t=[]),this.type=De.NOTIFICATIONS,this.limit=e,this.types=t},d0=function(e){this.type=De.MARK_NOTIFICATIONS_AS_READ,this.notifications=e},f0=function(){this.type=De.MARK_ALL_NOTIFICATIONS_AS_READ},zD=function(){this.type=De.ENTITY_DATA_UNSUBSCRIBE},VD=function(){this.type=De.ENTITY_COUNT_UNSUBSCRIBE},HD=function(){this.type=De.ALARM_DATA_UNSUBSCRIBE},YD=function(){this.type=De.ALARM_COUNT_UNSUBSCRIBE},qD=function(){this.type=De.ALARM_STATUS_UNSUBSCRIBE},KD=function(){this.type=De.NOTIFICATIONS_UNSUBSCRIBE},GD=function(e){this.cmdId=0,this.token=e},m0=(function(){function e(){this.cmds=[]}return e.popCmds=function(t,i){var r=Math.min(t.length,i);return r>0?t.splice(0,r):[]},e.prototype.setAuth=function(t){this.authCmd=new GD(t)},e.prototype.hasCommands=function(){return this.cmds.length>0},e.prototype.clear=function(){this.cmds.length=0},e.prototype.preparePublishCommands=function(t){var i=new e;return this.authCmd&&(i.authCmd=this.authCmd,this.authCmd=null),i.cmds=e.popCmds(this.cmds,t),i},e})();(function(e){e.ENTITY_DATA="ENTITY_DATA",e.ALARM_DATA="ALARM_DATA",e.ALARM_COUNT_DATA="ALARM_COUNT_DATA",e.ALARM_STATUS="ALARM_STATUS",e.COUNT_DATA="COUNT_DATA",e.NOTIFICATIONS_COUNT="NOTIFICATIONS_COUNT",e.NOTIFICATIONS="NOTIFICATIONS"})(Vr||(Vr={}));var $D=function(e){var t=e;return t.cmdId!==void 0&&t.cmdUpdateType===Vr.ENTITY_DATA},XD=function(e){var t=e;return t.cmdId!==void 0&&t.cmdUpdateType===Vr.ALARM_DATA},QD=function(e){var t=e;return t.cmdId!==void 0&&t.cmdUpdateType===Vr.COUNT_DATA},JD=function(e){var t=e;return t.cmdId!==void 0&&t.cmdUpdateType===Vr.ALARM_COUNT_DATA},ZD=function(e){var t=e;return t.cmdId!==void 0&&t.cmdUpdateType===Vr.ALARM_STATUS},tO=function(e){var t=e;return t.cmdId!==void 0&&t.cmdUpdateType===Vr.NOTIFICATIONS_COUNT},eO=function(e){var t=e;return t.cmdId!==void 0&&t.cmdUpdateType===Vr.NOTIFICATIONS},iO=(function(){function e(t){this.subscriptionId=t.subscriptionId,this.errorCode=t.errorCode,this.errorMsg=t.errorMsg,this.data=t.data}return e.prototype.prepareData=function(t){var i=this;this.data||(this.data={}),t&&t.forEach(function(r){i.data[r]||(i.data[r]=[])})},e.prototype.updateAttributeData=function(t){var i,r,n=function(l){var h=a.data[l];if(h.length){var c=t.find(function(u){return u.key===l});c?(c.lastUpdateTs=h[0][0],c.value=h[0][1]):t.push({key:l,lastUpdateTs:h[0][0],value:h[0][1]})}},a=this;try{for(var s=kt(Object.keys(this.data)),o=s.next();!o.done;o=s.next())n(o.value)}catch(l){i={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return t},e})(),Ka=function(e){this.cmdId=e.cmdId,this.errorCode=e.errorCode,this.errorMsg=e.errorMsg,this.cmdUpdateType=e.cmdUpdateType},g0=(function(e){function t(i){var r=e.call(this,i)||this;return r.data=i.data,r.update=i.update,r}return Le(t,e),t})(Ka),rO=(function(e){function t(i){return e.call(this,i)||this}return Le(t,e),t.processEntityData=function(i,r){var n,a,s,o,l,h,c,u,d,f;try{for(var m=kt(i),p=m.next();!p.done;p=m.next()){var g=p.value;if(g.timeseries)try{for(var y=(s=void 0,kt(Object.keys(g.timeseries))),T=y.next();!T.done;T=y.next()){var b=T.value,S=g.timeseries[b];try{for(var I=(l=void 0,kt(S)),D=I.next();!D.done;D=I.next())(R=D.value).ts&&(R.ts+=r)}catch(M){l={error:M}}finally{try{D&&!D.done&&(h=I.return)&&h.call(I)}finally{if(l)throw l.error}}}}catch(M){s={error:M}}finally{try{T&&!T.done&&(o=y.return)&&o.call(y)}finally{if(s)throw s.error}}if(g.latest)try{for(var O=(c=void 0,kt(Object.keys(g.latest))),P=O.next();!P.done;P=O.next()){var q=P.value,J=g.latest[q];try{for(var A=(d=void 0,kt(Object.keys(J))),x=A.next();!x.done;x=A.next()){var R;(R=J[b=x.value]).ts&&(R.ts+=r),b===n0.createdTime.keyName&&R.value&&(R.value=Number(R.value)+r+"")}}catch(M){d={error:M}}finally{try{x&&!x.done&&(f=A.return)&&f.call(A)}finally{if(d)throw d.error}}}}catch(M){c={error:M}}finally{try{P&&!P.done&&(u=O.return)&&u.call(O)}finally{if(c)throw c.error}}}}catch(M){n={error:M}}finally{try{p&&!p.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}},t.prototype.prepareData=function(i){this.data&&t.processEntityData(this.data.data,i),this.update&&t.processEntityData(this.update,i)},t})(g0),nO=(function(e){function t(i){var r=e.call(this,i)||this;return r.allowedEntities=i.allowedEntities,r.totalEntities=i.totalEntities,r}return Le(t,e),t.processAlarmData=function(i,r){var n,a,s,o,l,h;try{for(var c=kt(i),u=c.next();!u.done;u=c.next()){var d=u.value;if(d.createdTime+=r,d.ackTs&&(d.ackTs+=r),d.clearTs&&(d.clearTs+=r),d.endTs&&(d.endTs+=r),d.latest)try{for(var f=(s=void 0,kt(Object.keys(d.latest))),m=f.next();!m.done;m=f.next()){var p=m.value,g=d.latest[p];try{for(var y=(l=void 0,kt(Object.keys(g))),T=y.next();!T.done;T=y.next()){var b=T.value,S=g[b];S.ts&&(S.ts+=r),b in[n0.createdTime.keyName,Oi.startTime.keyName,Oi.endTime.keyName,Oi.ackTime.keyName,Oi.clearTime.keyName]&&S.value&&(S.value=Number(S.value)+r+"")}}catch(I){l={error:I}}finally{try{T&&!T.done&&(h=y.return)&&h.call(y)}finally{if(l)throw l.error}}}}catch(I){s={error:I}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(s)throw s.error}}}}catch(I){n={error:I}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}},t.prototype.prepareData=function(i){this.data&&t.processAlarmData(this.data.data,i),this.update&&t.processAlarmData(this.update,i)},t})(g0),aO=(function(e){function t(i){var r=e.call(this,i)||this;return r.count=i.count,r}return Le(t,e),t})(Ka),sO=(function(e){function t(i){var r=e.call(this,i)||this;return r.count=i.count,r}return Le(t,e),t})(Ka),oO=(function(e){function t(i){var r=e.call(this,i)||this;return r.active=i.active,r}return Le(t,e),t})(Ka),lO=(function(e){function t(i){var r=e.call(this,i)||this;return r.totalUnreadCount=i.totalUnreadCount,r.sequenceNumber=i.sequenceNumber,r}return Le(t,e),t})(Ka),cO=(function(e){function t(i){var r=e.call(this,i)||this;return r.totalUnreadCount=i.totalUnreadCount,r.sequenceNumber=i.sequenceNumber,r.update=i.update,r.notifications=i.notifications,r}return Le(t,e),t})(Ka),hO=(function(){function e(t){this.sharedSubscriptionInfo=t,this.subscribed=!1,this.attributeDataSubject=Qf(this.sharedSubscriptionInfo.subscriber.attributeData$(),{connector:function(){return new be(1)}}),this.alarmStatusSubject=Qf(this.sharedSubscriptionInfo.subscriber.alarmStatus$,{connector:function(){return new be}}),this.subscriptions=new Array,this.attributeData$=this.attributeDataSubject,this.alarmStatus$=this.alarmStatusSubject}return e.createTelemetrySubscriberKey=function(t,i,r){r===void 0&&(r=null);var n=t.entityType+"_"+t.id+"_"+i;return r&&(n+="_"+r.sort().join("_")),n},e.createAlarmStatusSubscriberKey=function(t,i,r){i===void 0&&(i=null),r===void 0&&(r=null);var n=t.entityType+"_"+t.id;return i&&(n+="_"+i.sort().join("_")),r&&(n+="_"+r.sort().join("_")),n},e.createEntityAttributesSubscription=function(t,i,r,n,a){a===void 0&&(a=null);var s=e.createTelemetrySubscriberKey(i,r,a),o=e.subscribersCache[s];o||(o={key:s,subscriber:fn.createEntityAttributesSubscription(t,i,r,n,a),subscribed:!1,sharedSubscribers:new Set},e.subscribersCache[s]=o);var l=new e(o);return o.sharedSubscribers.add(l),l},e.createAlarmStatusSubscription=function(t,i,r,n,a){n===void 0&&(n=null),a===void 0&&(a=null);var s=e.createAlarmStatusSubscriberKey(i,n,a),o=e.subscribersCache[s];o||(o={key:s,subscriber:fn.createAlarmStatusSubscription(t,i,r,n,a),subscribed:!1,sharedSubscribers:new Set},e.subscribersCache[s]=o);var l=new e(o);return o.sharedSubscribers.add(l),l},e.prototype.subscribe=function(){this.subscribed||(this.subscribed=!0,this.subscriptions.push(this.attributeDataSubject.connect()),this.subscriptions.push(this.alarmStatusSubject.connect()),this.sharedSubscriptionInfo.subscribed||(this.sharedSubscriptionInfo.subscriber.subscribe(),this.sharedSubscriptionInfo.subscribed=!0))},e.prototype.unsubscribe=function(){this.subscribed&&this.complete(),this.sharedSubscriptionInfo.sharedSubscribers.delete(this),this.sharedSubscriptionInfo.sharedSubscribers.size||(this.sharedSubscriptionInfo.subscribed&&(this.sharedSubscriptionInfo.subscriber.unsubscribe(),this.sharedSubscriptionInfo.subscribed=!1),delete e.subscribersCache[this.sharedSubscriptionInfo.key])},e.prototype.complete=function(){this.subscriptions.forEach(function(t){return t.unsubscribe()}),this.subscriptions.length=0},e.subscribersCache={},e})(),fn=(function(e){function t(i,r){var n=e.call(this,i,r)||this;return n.telemetryService=i,n.zone=r,n.dataSubject=new be(1),n.entityDataSubject=new be(1),n.alarmDataSubject=new be(1),n.entityCountSubject=new be(1),n.alarmCountSubject=new be(1),n.alarmStatusSubject=new be(1),n.tsOffset=void 0,n.data$=n.dataSubject.asObservable(),n.entityData$=n.entityDataSubject.asObservable(),n.alarmData$=n.alarmDataSubject.asObservable(),n.entityCount$=n.entityCountSubject.asObservable(),n.alarmCount$=n.alarmCountSubject.asObservable(),n.alarmStatus$=n.alarmStatusSubject.asObservable(),n}return Le(t,e),t.createEntityAttributesSubscription=function(i,r,n,a,s){var o;s===void 0&&(s=null),(o=n===vn.LATEST_TELEMETRY?new WD:new jD).entityType=r.entityType,o.entityId=r.id,o.scope=n,s&&(o.keys=s.join(","));var l=new t(i,a);return l.subscriptionCommands.push(o),l},t.createAlarmStatusSubscription=function(i,r,n,a,s){a===void 0&&(a=null),s===void 0&&(s=null);var o=new h0;o.originatorId=Kt(r),o.severityList=a,o.typeList=s;var l=new t(i,n);return l.subscriptionCommands.push(o),l},t.createEntityFilterLatestSubscription=function(i,r,n,a){a===void 0&&(a=null);var s={entityFilter:r,pageLink:{pageSize:1,page:0},latestValues:a||[]},o=new qs;o.query=s,o.latestCmd={keys:a||[]};var l=new t(i,n);return l.subscriptionCommands.push(o),l},t.prototype.complete=function(){this.dataSubject.complete(),this.entityDataSubject.complete(),this.alarmDataSubject.complete(),this.entityCountSubject.complete(),this.alarmCountSubject.complete(),this.alarmStatusSubject.complete(),e.prototype.complete.call(this)},t.prototype.setTsOffset=function(i){if(this.tsOffset!==i){var r=!pn(this.tsOffset);return this.tsOffset=i,r}return!1},t.prototype.onData=function(i){var r,n=this,a=i.subscriptionId,s=this.subscriptionCommands.find(function(l){return l.cmdId===a});if(s){var o=s;o.keys&&o.keys.length&&(r=o.keys.split(","))}i.prepareData(r),this.zone?this.zone.run(function(){n.dataSubject.next(i)}):this.dataSubject.next(i)},t.prototype.onEntityData=function(i){var r=this;this.tsOffset&&i.prepareData(this.tsOffset),this.zone?this.zone.run(function(){r.entityDataSubject.next(i)}):this.entityDataSubject.next(i)},t.prototype.onAlarmData=function(i){var r=this;this.tsOffset&&i.prepareData(this.tsOffset),this.zone?this.zone.run(function(){r.alarmDataSubject.next(i)}):this.alarmDataSubject.next(i)},t.prototype.onEntityCount=function(i){var r=this;this.zone?this.zone.run(function(){r.entityCountSubject.next(i)}):this.entityCountSubject.next(i)},t.prototype.onAlarmCount=function(i){var r=this;this.zone?this.zone.run(function(){r.alarmCountSubject.next(i)}):this.alarmCountSubject.next(i)},t.prototype.onAlarmStatus=function(i){var r=this;this.zone?this.zone.run(function(){r.alarmStatusSubject.next(i)}):this.alarmStatusSubject.next(i)},t.prototype.attributeData$=function(){var i=new Array;return this.data$.pipe(Ua(function(r){return r.updateAttributeData(i)}))},t})(a0),ps=(function(e){function t(i,r){var n=e.call(this,i,r)||this;return n.websocketService=i,n.zone=r,n.notificationCountSubject=new Yf({cmdId:0,cmdUpdateType:void 0,errorCode:0,errorMsg:"",totalUnreadCount:0,sequenceNumber:0}),n.notificationsSubject=new Yf({cmdId:0,cmdUpdateType:void 0,errorCode:0,errorMsg:"",notifications:null,totalUnreadCount:0,sequenceNumber:0}),n.messageLimit=10,n.notificationType=[],n.notificationCount$=n.notificationCountSubject.asObservable().pipe(Ua(function(a){return a.totalUnreadCount})),n.notifications$=n.notificationsSubject.asObservable().pipe(Ua(function(a){return a.notifications})),n}return Le(t,e),t.createNotificationCountSubscription=function(i,r){var n=new u0,a=new t(i,r);return a.subscriptionCommands.push(n),a},t.createNotificationsSubscription=function(i,r,n,a){n===void 0&&(n=10),a===void 0&&(a=[]);var s=new eu(n,a),o=new t(i,r);return o.messageLimit=n,o.subscriptionCommands.push(s),o},t.createMarkAsReadCommand=function(i,r){var n=new d0(r),a=new t(i);return a.subscriptionCommands.push(n),a},t.createMarkAllAsReadCommand=function(i){var r=new f0,n=new t(i);return n.subscriptionCommands.push(r),n},t.prototype.onNotificationCountUpdate=function(i){var r=this,n=this.notificationCountSubject.value;i.sequenceNumber<=n.sequenceNumber||(this.zone?this.zone.run(function(){r.notificationCountSubject.next(i)}):this.notificationCountSubject.next(i))},t.prototype.complete=function(){this.notificationCountSubject.complete(),this.notificationsSubject.complete(),e.prototype.complete.call(this)},t.prototype.onNotificationsUpdate=function(i){var r=this,n=this.notificationsSubject.value;i.sequenceNumber<=n.sequenceNumber&&(i.totalUnreadCount=n.totalUnreadCount);var a=i;ze(n)&&i.update&&(n.notifications.unshift(i.update),n.notifications.length>this.messageLimit&&n.notifications.pop(),(a=n).totalUnreadCount=i.totalUnreadCount),this.zone?this.zone.run(function(){r.notificationsSubject.next(a),r.notificationCountSubject.next(a)}):(this.notificationsSubject.next(a),this.notificationCountSubject.next(a))},t})(a0),uO={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},dO=(function(){function e(t,i){var r=this;this.socketOpen=!1,this.readyState=0,this.onopen=function(){},this.onerror=function(){},this.onclose=function(n){},this.onmessage=function(){},console.log("socketTask.url",this.socketTask),this.socketTask=wx.connectSocket({url:t,complete:function(){},fail:function(){console.log("connectSocket fail")}}),console.log("socketTask",this.socketTask),this.socketTask.onOpen(function(){console.log("socketTask.onOpen"),r.openTimer&&clearTimeout(r.openTimer),r.socketOpen=!0,r.readyState=1,r.onopen&&r.onopen(),r.socketTask.onMessage(r.onmessage),r.socketTask.onError(function(n){try{r.socketTask.close()}catch{}console.log("socketTask.onError"),r.readyState=3,r.onclose&&r.onclose(n)}),r.socketTask.onClose(function(n){console.log("socketTask.onClose"),r.readyState=3,r.onclose&&r.onclose(n)})}),this.openTimer=setTimeout(function(){try{console.log("openTimer"),r.socketTask.close(),r.readyState=3,r.onclose&&r.onclose({code:60001,reason:"连接超时"})}catch(n){console.log(n)}},2e3)}return e.prototype.close=function(){this.socketOpen=!1,this.readyState=2,this.socketTask.close()},e.prototype.send=function(t){this.socketOpen&&this.socketTask.send({data:t})},e})(),fO=(function(e){function t(i,r){var n=e.call(this)||this;if(n._socket=null,i instanceof _e)n.destination=r,n.source=i;else{var a=n._config=lr({},uO);if(n._output=new or,typeof i=="string")a.url=i;else for(var s in i)i.hasOwnProperty(s)&&(a[s]=i[s]);if(!a.WebSocketCtor&&WebSocket)a.WebSocketCtor=WebSocket;else if(!a.WebSocketCtor&&wx)a.WebSocketCtor=dO;else if(!a.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new be}return n}return Le(t,e),t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new be),this._output=new or},t.prototype.multiplex=function(i,r,n){var a=this;return new _e(function(s){try{a.next(i())}catch(l){s.error(l)}var o=a.subscribe(function(l){try{n(l)&&s.next(l)}catch(h){s.error(h)}},function(l){return s.error(l)},function(){return s.complete()});return function(){try{a.next(r())}catch(l){s.error(l)}o.unsubscribe()}})},t.prototype._connectSocket=function(){var i=this,r=this._config,n=r.WebSocketCtor,a=r.protocol,s=r.url,o=r.binaryType,l=this._output,h=null;try{h=a?new n(s,a):new n(s),this._socket=h,o&&(this._socket.binaryType=o)}catch(u){return void l.error(u)}var c=new mn(function(){i._socket=null,h&&h.readyState===1&&h.close()});h.onopen=function(u){if(!i._socket)return h.close(),void i._resetState();var d=i._config.openObserver;d&&d.next(u);var f=i.destination;i.destination=ac.create(function(m){if(h.readyState===1)try{var p=i._config.serializer;h.send(p(m))}catch(g){i.destination.error(g)}},function(m){var p=i._config.closingObserver;p&&p.next(void 0),m&&m.code?h.close(m.code,m.reason):l.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),i._resetState()},function(){var m=i._config.closingObserver;m&&m.next(void 0),h.close(),i._resetState()}),f&&f instanceof be&&c.add(f.subscribe(i.destination))},h.onerror=function(u){console.log("socketTask.onerror"),i._resetState(),l.error(u)},h.onclose=function(u){h===i._socket&&i._resetState();var d=i._config.closeObserver;d&&d.next(u),u&&u.wasClean?l.complete():l.error(u)},h.onmessage=function(u){try{var d=i._config.deserializer;l.next(d(u))}catch(f){l.error(f)}}},t.prototype._subscribe=function(i){var r=this,n=this.source;return n?n.subscribe(i):(this._socket||this._connectSocket(),this._output.subscribe(i),i.add(function(){var a=r._socket;r._output.observers.length===0&&(!a||a.readyState!==1&&a.readyState!==0||a.close(),r._resetState())}),i)},t.prototype.unsubscribe=function(){var i=this._socket;!i||i.readyState!==1&&i.readyState!==0||i.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t})(Ph),Re,p0=(function(){function e(t,i,r,n,a){var s=this;this.authService=t,this.ngZone=i,this.apiEndpoint=r,this.cmdWrapper=n,this.window=a,this.isActive=!1,this.isOpening=!1,this.isOpened=!1,this.isReconnect=!1,this.lastCmdId=0,this.subscribersCount=0,this.subscribersMap=new Map,this.reconnectSubscribers=new Set,this.errorName="WebSocket Error",t.authenticationChange(function(){s.init(r),s.reset(!0)}),this.init(r)}return e.prototype.init=function(t){var i=this.window.location.port;this.window.location.protocol==="https:"?(i||(i="443"),this.wsUri="wss:"):(i||(i="80"),this.wsUri="ws:"),this.wsUri+="//".concat(this.window.location.hostname,":").concat(i,"/").concat(t)},e.prototype.nextCmdId=function(){return this.lastCmdId++,this.lastCmdId},e.prototype.publishCommands=function(){for(;this.isOpened&&this.cmdWrapper.hasCommands();)this.dataStream.next(this.cmdWrapper.preparePublishCommands(10)),this.checkToClose();this.subscribersCount>0&&this.tryOpenSocket()},e.prototype.checkToClose=function(){var t=this;this.subscribersCount===0&&this.isOpened&&(this.socketCloseTimer||(this.socketCloseTimer=setTimeout(function(){return t.closeSocket()},9e4)))},e.prototype.reset=function(t){this.socketCloseTimer&&(clearTimeout(this.socketCloseTimer),this.socketCloseTimer=null),this.lastCmdId=0,this.subscribersMap.clear(),this.subscribersCount=0,this.cmdWrapper.clear(),t&&this.closeSocket()},e.prototype.closeSocket=function(){this.isActive=!1,this.isOpened&&this.dataStream.unsubscribe()},e.prototype.tryOpenSocket=function(){var t=this;console.log("tryOpenSocket"),this.isActive&&(console.log("isActive"),this.isOpened||this.isOpening||(console.log("!this.isOpened && !this.isOpening"),this.isOpening=!0,this.authService.isJwtTokenValid()?(console.log("isJwtTokenValid"),this.openSocket(this.authService.getJwtToken())):this.authService.refreshJwtToken().subscribe({next:function(){console.log("refreshJwtToken"),t.openSocket(t.authService.getJwtToken())},error:function(){console.log("isOpeningFalse"),t.isOpening=!1,t.authService.onRefreshJwtTokenError()}})),this.socketCloseTimer&&(clearTimeout(this.socketCloseTimer),this.socketCloseTimer=null))},e.prototype.openSocket=function(t){var i,r=this,n="".concat(this.wsUri);this.dataStream=(i={url:n,openObserver:{next:function(){r.onOpen(t)}},closeObserver:{next:function(a){r.onClose(a)}}},new fO(i)),this.dataStream.subscribe({next:function(a){r.ngZone.runOutsideAngular(function(){r.onMessage(a)})},error:function(a){console.log("ws错误",a),r.onError(a)}})},e.prototype.onOpen=function(t){var i=this;this.isOpening=!1,this.isOpened=!0,this.cmdWrapper.setAuth(t),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.isReconnect?(this.isReconnect=!1,this.reconnectSubscribers.forEach(function(r){r.onReconnected(),i.subscribe(r)}),this.reconnectSubscribers.clear()):this.publishCommands()},e.prototype.onMessage=function(t){t.errorCode?this.showWsError(t.errorCode,t.errorMsg):this.processOnMessage(t),this.checkToClose()},e.prototype.onError=function(t){t&&console.warn("WebSocket error event",t),this.isOpening=!1},e.prototype.onClose=function(t){var i=this;t&&t.code>1001&&t.code!==1006&&t.code!==1011&&t.code!==1012&&t.code!==4500&&this.showWsError(t.code,t.reason),this.isOpening=!1,this.isOpened=!1,this.isActive&&(this.isReconnect||(this.reconnectSubscribers.clear(),this.subscribersMap.forEach(function(r){i.reconnectSubscribers.add(r)}),this.reset(!1),this.isReconnect=!0),this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(function(){return i.tryOpenSocket()},2e3))},e.prototype.showWsError=function(t,i){var r=i;r||(r+="".concat(this.errorName,": error code - ").concat(t,"."))},e})(),mo=(function(e){function t(i,r,n){var a=e.call(this,n,i,"api/ws",new m0,r)||this;return a.ngZone=i,a.window=r,a.authService=n,a}return Le(t,e),t.prototype.subscribe=function(i){var r=this;this.isActive=!0,i.subscriptionCommands.forEach(function(n){var a=r.nextCmdId();n instanceof d0||n instanceof f0||r.subscribersMap.set(a,i),n.cmdId=a,r.cmdWrapper.cmds.push(n)}),this.subscribersCount++,this.publishCommands()},t.prototype.update=function(i){var r=this;this.isReconnect||(i.subscriptionCommands.forEach(function(n){n.cmdId&&(n instanceof qs||n instanceof eu)&&r.cmdWrapper.cmds.push(n)}),this.publishCommands())},t.prototype.unsubscribe=function(i){var r=this;this.isActive&&(i.subscriptionCommands.forEach(function(n){if(n instanceof Ju)n.unsubscribe=!0,r.cmdWrapper.cmds.push(n);else if(n instanceof qs){var a=new zD;a.cmdId=n.cmdId,r.cmdWrapper.cmds.push(a)}else if(n instanceof l0){var s=new HD;s.cmdId=n.cmdId,r.cmdWrapper.cmds.push(s)}else if(n instanceof o0){var o=new VD;o.cmdId=n.cmdId,r.cmdWrapper.cmds.push(o)}else if(n instanceof c0)(l=new YD).cmdId=n.cmdId,r.cmdWrapper.cmds.push(l);else if(n instanceof h0){var l;(l=new qD).cmdId=n.cmdId,r.cmdWrapper.cmds.push(l)}else if(n instanceof u0||n instanceof eu){var h=new KD;h.cmdId=n.cmdId,r.cmdWrapper.cmds.push(h)}var c=n.cmdId;c&&r.subscribersMap.delete(c)}),this.reconnectSubscribers.delete(i),this.subscribersCount--,this.publishCommands())},t.prototype.processOnMessage=function(i){var r;"cmdId"in i&&i.cmdId?(r=this.subscribersMap.get(i.cmdId))instanceof ps?tO(i)?r.onNotificationCountUpdate(new lO(i)):eO(i)&&r.onNotificationsUpdate(new cO(i)):r instanceof fn&&($D(i)?r.onEntityData(new rO(i)):XD(i)?r.onAlarmData(new nO(i)):QD(i)?r.onEntityCount(new aO(i)):JD(i)?r.onAlarmCount(new sO(i)):ZD(i)&&r.onAlarmStatus(new oO(i))):"subscriptionId"in i&&i.subscriptionId&&(r=this.subscribersMap.get(i.subscriptionId))&&r.onData(new iO(i))},t=bi([Ti(),ie(0,re(Nt.NgZone)),ie(1,re(Nt.Window)),ie(2,re(Nt.AuthService)),wi("design:paramtypes",[oo,Object,Object])],t)})(p0);(function(e){e.singleEntity="singleEntity",e.entityList="entityList",e.entityName="entityName",e.entityType="entityType",e.stateEntity="stateEntity",e.assetType="assetType",e.deviceType="deviceType",e.edgeType="edgeType",e.entityViewType="entityViewType",e.apiUsageState="apiUsageState",e.relationsQuery="relationsQuery",e.assetSearchQuery="assetSearchQuery",e.deviceSearchQuery="deviceSearchQuery",e.edgeSearchQuery="edgeSearchQuery",e.entityViewSearchQuery="entityViewSearchQuery"})(Re||(Re={}));var Ks,Pt;new Array(Re.edgeType,Re.edgeSearchQuery);Re.singleEntity,Re.entityList,Re.entityName,Re.entityType,Re.stateEntity,Re.assetType,Re.deviceType,Re.edgeType,Re.entityViewType,Re.apiUsageState,Re.relationsQuery,Re.assetSearchQuery,Re.deviceSearchQuery,Re.edgeSearchQuery,Re.entityViewSearchQuery;(function(e){e.ASC="ASC",e.DESC="DESC"})(Ks||(Ks={})),(function(e){e.ATTRIBUTE="ATTRIBUTE",e.CLIENT_ATTRIBUTE="CLIENT_ATTRIBUTE",e.SHARED_ATTRIBUTE="SHARED_ATTRIBUTE",e.SERVER_ATTRIBUTE="SERVER_ATTRIBUTE",e.TIME_SERIES="TIME_SERIES",e.ENTITY_FIELD="ENTITY_FIELD",e.ALARM_FIELD="ALARM_FIELD",e.CONSTANT="CONSTANT",e.COUNT="COUNT"})(Pt||(Pt={}));var Ea;Pt.ATTRIBUTE,Pt.TIME_SERIES,Pt.ENTITY_FIELD,Pt.CONSTANT,Pt.CLIENT_ATTRIBUTE,Pt.SERVER_ATTRIBUTE,Pt.SHARED_ATTRIBUTE;function mO(e){switch(e){case Pt.ATTRIBUTE:case Pt.CLIENT_ATTRIBUTE:case Pt.SHARED_ATTRIBUTE:case Pt.SERVER_ATTRIBUTE:return Qt.attribute;case Pt.TIME_SERIES:return Qt.timeseries;case Pt.ENTITY_FIELD:return Qt.entityField;case Pt.ALARM_FIELD:return Qt.alarm;case Pt.COUNT:return Qt.count}}(function(e){e.STRING="STRING",e.NUMERIC="NUMERIC",e.BOOLEAN="BOOLEAN",e.DATE_TIME="DATE_TIME"})(Ea||(Ea={}));var pg,qi;Ea.STRING,Ea.NUMERIC,Ea.BOOLEAN,Ea.DATE_TIME;(function(e){e.STRING="STRING",e.NUMERIC="NUMERIC",e.BOOLEAN="BOOLEAN",e.COMPLEX="COMPLEX"})(pg||(pg={})),(function(e){e.EQUAL="EQUAL",e.NOT_EQUAL="NOT_EQUAL",e.STARTS_WITH="STARTS_WITH",e.ENDS_WITH="ENDS_WITH",e.CONTAINS="CONTAINS",e.NOT_CONTAINS="NOT_CONTAINS",e.IN="IN",e.NOT_IN="NOT_IN"})(qi||(qi={}));var en;qi.EQUAL,qi.NOT_EQUAL,qi.STARTS_WITH,qi.ENDS_WITH,qi.CONTAINS,qi.NOT_CONTAINS,qi.IN,qi.NOT_IN;(function(e){e.EQUAL="EQUAL",e.NOT_EQUAL="NOT_EQUAL",e.GREATER="GREATER",e.LESS="LESS",e.GREATER_OR_EQUAL="GREATER_OR_EQUAL",e.LESS_OR_EQUAL="LESS_OR_EQUAL"})(en||(en={}));var Pl;en.EQUAL,en.NOT_EQUAL,en.GREATER,en.LESS,en.GREATER_OR_EQUAL,en.LESS_OR_EQUAL;(function(e){e.EQUAL="EQUAL",e.NOT_EQUAL="NOT_EQUAL"})(Pl||(Pl={}));var Nl;Pl.EQUAL,Pl.NOT_EQUAL;(function(e){e.AND="AND",e.OR="OR"})(Nl||(Nl={}));var _a;Nl.AND,Nl.OR;(function(e){e.CURRENT_TENANT="CURRENT_TENANT",e.CURRENT_CUSTOMER="CURRENT_CUSTOMER",e.CURRENT_USER="CURRENT_USER",e.CURRENT_DEVICE="CURRENT_DEVICE"})(_a||(_a={}));_a.CURRENT_TENANT,_a.CURRENT_CUSTOMER,_a.CURRENT_USER,_a.CURRENT_DEVICE;function gO(e){return{pageSize:e,page:0,sortOrder:{key:{type:Pt.ENTITY_FIELD,key:"createdTime"},direction:Ks.DESC}}}gO(1);function pO(e,t){var i=e.data.map(function(n){return n.entityId.id}),r=t.data.map(function(n){return n.entityId.id});return!i0(i,r)}Pt.ENTITY_FIELD,Pt.ENTITY_FIELD,Pt.ENTITY_FIELD;function vO(e){var t={id:e.entityId.id,entityType:e.entityId.entityType};if(e.latest&&e.latest[Pt.ENTITY_FIELD]){var i=e.latest[Pt.ENTITY_FIELD];if(i.name?t.name=i.name.value:t.name="",i.label?t.label=i.label.value:t.label="",t.entityDescription="",i.additionalInfo){var r=i.additionalInfo.value;if(r&&r.length)try{var n=JSON.parse(r);n&&n.description&&(t.entityDescription=n.description)}catch{}}}return t}function yO(e,t,i){i===void 0&&(i=!1),e.entity={id:{entityType:t.entityType,id:t.id}},e.entityId=t.id,e.entityType=t.entityType,e.type!==Ct.entity&&e.type!==Ct.entityCount&&e.type!==Ct.alarmCount||(e.entityName=t.name,e.entityLabel=t.label,e.name=t.name,e.entityDescription=t.entityDescription,e.entity.label=t.label,e.entity.name=t.name,i&&(e.entityFilter={type:Re.singleEntity,singleEntity:{id:t.id,entityType:t.entityType}}))}var bO=(function(){function e(t,i){this.listener=t,this.telemetryService=i,this.alarmDataSubscriptionOptions=this.listener.alarmDataSubscriptionOptions,this.datasourceType=this.alarmDataSubscriptionOptions.datasourceType}return e.prototype.unsubscribe=function(){this.datasourceType===Ct.entity&&this.subscriber&&(this.subscriber.unsubscribe(),this.subscriber=null)},e.prototype.subscribe=function(){var t=this;if(this.subsTw=this.alarmDataSubscriptionOptions.subscriptionTimewindow,this.history=this.alarmDataSubscriptionOptions.subscriptionTimewindow&&uo(this.alarmDataSubscriptionOptions.subscriptionTimewindow.fixedWindow),this.realtime=this.alarmDataSubscriptionOptions.subscriptionTimewindow&&ze(this.alarmDataSubscriptionOptions.subscriptionTimewindow.realtimeWindowMs),this.datasourceType===Ct.entity){this.subscriber=new fn(this.telemetryService),this.alarmDataCommand=new l0;var i=this.alarmDataSubscriptionOptions.dataKeys.filter(function(c){return c.type===Qt.alarm}).map(function(c){return{type:Pt.ALARM_FIELD,key:c.name}}),r=this.alarmDataSubscriptionOptions.dataKeys.filter(function(c){return c.type===Qt.entityField}).map(function(c){return{type:Pt.ENTITY_FIELD,key:c.name}}),n=this.alarmDataSubscriptionOptions.dataKeys.filter(function(c){return c.type===Qt.attribute}).map(function(c){return{type:Pt.ATTRIBUTE,key:c.name}}),a=this.alarmDataSubscriptionOptions.dataKeys.filter(function(c){return c.type===Qt.timeseries}).map(function(c){return{type:Pt.TIME_SERIES,key:c.name}}),s=n.concat(a),o=this.alarmDataSubscriptionOptions.keyFilters;this.alarmDataSubscriptionOptions.additionalKeyFilters&&(o=o?o.concat(this.alarmDataSubscriptionOptions.additionalKeyFilters):this.alarmDataSubscriptionOptions.additionalKeyFilters),this.alarmDataCommand.query={entityFilter:this.alarmDataSubscriptionOptions.entityFilter,pageLink:Kt(this.alarmDataSubscriptionOptions.pageLink),keyFilters:o,alarmFields:i,entityFields:r,latestValues:s},this.history?(this.alarmDataCommand.query.pageLink.startTs=this.subsTw.fixedWindow.startTimeMs,this.alarmDataCommand.query.pageLink.endTs=this.subsTw.fixedWindow.endTimeMs):this.alarmDataCommand.query.pageLink.timeWindow=this.subsTw.realtimeWindowMs,this.subscriber.setTsOffset(this.subsTw.tsOffset),this.subscriber.subscriptionCommands.push(this.alarmDataCommand),this.subscriber.alarmData$.subscribe(function(c){var u,d;if(c.data){if(t.onPageData(c.data,c.allowedEntities,c.totalEntities),t.prematureUpdates){try{for(var f=kt(t.prematureUpdates),m=f.next();!m.done;m=f.next()){var p=m.value;t.onDataUpdate(p)}}catch(g){u={error:g}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(u)throw u.error}}t.prematureUpdates=null}}else c.update&&(t.pageData?t.onDataUpdate(c.update):(t.prematureUpdates||(t.prematureUpdates=[]),t.prematureUpdates.push(c.update)))}),this.subscriber.subscribe()}else if(this.datasourceType===Ct.function){var l=Kt(BD);l.createdTime+=this.subsTw.tsOffset,l.startTs+=this.subsTw.tsOffset;var h={data:[lr(lr({},l),{entityId:"1",latest:{}})],hasNext:!1,totalElements:1,totalPages:1};this.onPageData(h,1024,1)}},e.prototype.resetData=function(){this.alarmIdToDataIndex={};for(var t=0;t<this.pageData.data.length;t++){var i=this.pageData.data[t];this.alarmIdToDataIndex[i.id.id]=t}},e.prototype.onPageData=function(t,i,r){this.pageData=t,this.resetData(),this.listener.alarmsLoaded(t,i,r)},e.prototype.onDataUpdate=function(t){var i,r;try{for(var n=kt(t),a=n.next();!a.done;a=n.next()){var s=a.value,o=this.alarmIdToDataIndex[s.id.id];Ye(o)&&o>=0&&(this.pageData.data[o]=s)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}this.listener.alarmsUpdated(t,this.pageData)},e})(),v0=(function(){function e(t){this.telemetryService=t}return e.prototype.subscribeForAlarms=function(t,i,r){var n=t.alarmSource;if(t.alarmDataSubscriptionOptions=this.createAlarmSubscriptionOptions(t,i,r),n.type!==Ct.entity||n.entityFilter&&i)return t.subscription=new bO(t,this.telemetryService),t.subscription.subscribe();t.alarmsLoaded({data:[],totalPages:0,totalElements:0,hasNext:!1},0,0)},e.prototype.stopSubscription=function(t){t.subscription&&t.subscription.unsubscribe()},e.prototype.createAlarmSubscriptionOptions=function(t,i,r){var n=t.alarmSource,a=[];n.dataKeys.forEach(function(o){var l={name:o.name,type:o.type};a.push(l)});var s={datasourceType:n.type,dataKeys:a,subscriptionTimewindow:Kt(t.subscriptionTimewindow)};return s.datasourceType===Ct.entity&&(s.entityFilter=n.entityFilter,s.pageLink=i,s.keyFilters=n.keyFilters,s.additionalKeyFilters=r),s},e=bi([Ti(),ie(0,re(Nt.TelemetryWebsocketService)),wi("design:paramtypes",[mo])],e)})(),y0=function(e){return!!e&&(typeof e=="string"?e.trim().length>0:e.body&&e.body.trim().length>0)};function Ll(e){return Ll=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ll(e)}var wO=/^\s+/,TO=/\s+$/;function At(e,t){if(t=t||{},(e=e||"")instanceof At)return e;if(!(this instanceof At))return new At(e,t);var i=(function(r){var n={r:0,g:0,b:0},a=1,s=null,o=null,l=null,h=!1,c=!1;return typeof r=="string"&&(r=(function(u){u=u.replace(wO,"").replace(TO,"").toLowerCase();var d,f=!1;if(iu[u])u=iu[u],f=!0;else if(u=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(d=xi.rgb.exec(u))?{r:d[1],g:d[2],b:d[3]}:(d=xi.rgba.exec(u))?{r:d[1],g:d[2],b:d[3],a:d[4]}:(d=xi.hsl.exec(u))?{h:d[1],s:d[2],l:d[3]}:(d=xi.hsla.exec(u))?{h:d[1],s:d[2],l:d[3],a:d[4]}:(d=xi.hsv.exec(u))?{h:d[1],s:d[2],v:d[3]}:(d=xi.hsva.exec(u))?{h:d[1],s:d[2],v:d[3],a:d[4]}:(d=xi.hex8.exec(u))?{r:hi(d[1]),g:hi(d[2]),b:hi(d[3]),a:Eg(d[4]),format:f?"name":"hex8"}:(d=xi.hex6.exec(u))?{r:hi(d[1]),g:hi(d[2]),b:hi(d[3]),format:f?"name":"hex"}:(d=xi.hex4.exec(u))?{r:hi(d[1]+""+d[1]),g:hi(d[2]+""+d[2]),b:hi(d[3]+""+d[3]),a:Eg(d[4]+""+d[4]),format:f?"name":"hex8"}:(d=xi.hex3.exec(u))?{r:hi(d[1]+""+d[1]),g:hi(d[2]+""+d[2]),b:hi(d[3]+""+d[3]),format:f?"name":"hex"}:!1})(r)),Ll(r)=="object"&&(vr(r.r)&&vr(r.g)&&vr(r.b)?(n=(function(u,d,f){return{r:255*me(u,255),g:255*me(d,255),b:255*me(f,255)}})(r.r,r.g,r.b),h=!0,c=String(r.r).substr(-1)==="%"?"prgb":"rgb"):vr(r.h)&&vr(r.s)&&vr(r.v)?(s=vs(r.s),o=vs(r.v),n=(function(u,d,f){u=6*me(u,360),d=me(d,100),f=me(f,100);var m=Math.floor(u),p=u-m,g=f*(1-d),y=f*(1-p*d),T=f*(1-(1-p)*d),b=m%6,S=[f,y,g,g,T,f][b],I=[T,f,f,y,g,g][b],D=[g,g,T,f,f,y][b];return{r:255*S,g:255*I,b:255*D}})(r.h,s,o),h=!0,c="hsv"):vr(r.h)&&vr(r.s)&&vr(r.l)&&(s=vs(r.s),l=vs(r.l),n=(function(u,d,f){var m,p,g;function y(S,I,D){return D<0&&(D+=1),D>1&&(D-=1),D<1/6?S+6*(I-S)*D:D<.5?I:D<2/3?S+(I-S)*(2/3-D)*6:S}if(u=me(u,360),d=me(d,100),f=me(f,100),d===0)m=p=g=f;else{var T=f<.5?f*(1+d):f+d-f*d,b=2*f-T;m=y(b,T,u+1/3),p=y(b,T,u),g=y(b,T,u-1/3)}return{r:255*m,g:255*p,b:255*g}})(r.h,s,l),h=!0,c="hsl"),r.hasOwnProperty("a")&&(a=r.a)),a=b0(a),{ok:h,format:r.format||c,r:Math.min(255,Math.max(n.r,0)),g:Math.min(255,Math.max(n.g,0)),b:Math.min(255,Math.max(n.b,0)),a}})(e);this._originalInput=e,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||i.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}function vg(e,t,i){e=me(e,255),t=me(t,255),i=me(i,255);var r,n,a=Math.max(e,t,i),s=Math.min(e,t,i),o=(a+s)/2;if(a==s)r=n=0;else{var l=a-s;switch(n=o>.5?l/(2-a-s):l/(a+s),a){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:r,s:n,l:o}}function yg(e,t,i){e=me(e,255),t=me(t,255),i=me(i,255);var r,n,a=Math.max(e,t,i),s=Math.min(e,t,i),o=a,l=a-s;if(n=a===0?0:l/a,a==s)r=0;else{switch(a){case e:r=(t-i)/l+(t<i?6:0);break;case t:r=(i-e)/l+2;break;case i:r=(e-t)/l+4}r/=6}return{h:r,s:n,v:o}}function bg(e,t,i,r){var n=[Pi(Math.round(e).toString(16)),Pi(Math.round(t).toString(16)),Pi(Math.round(i).toString(16))];return r&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function wg(e,t,i,r){return[Pi(w0(r)),Pi(Math.round(e).toString(16)),Pi(Math.round(t).toString(16)),Pi(Math.round(i).toString(16))].join("")}function EO(e,t){t=t===0?0:t||10;var i=At(e).toHsl();return i.s-=t/100,i.s=vc(i.s),At(i)}function _O(e,t){t=t===0?0:t||10;var i=At(e).toHsl();return i.s+=t/100,i.s=vc(i.s),At(i)}function SO(e){return At(e).desaturate(100)}function AO(e,t){t=t===0?0:t||10;var i=At(e).toHsl();return i.l+=t/100,i.l=vc(i.l),At(i)}function xO(e,t){t=t===0?0:t||10;var i=At(e).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-t/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-t/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-t/100*255))),At(i)}function RO(e,t){t=t===0?0:t||10;var i=At(e).toHsl();return i.l-=t/100,i.l=vc(i.l),At(i)}function kO(e,t){var i=At(e).toHsl(),r=(i.h+t)%360;return i.h=r<0?360+r:r,At(i)}function IO(e){var t=At(e).toHsl();return t.h=(t.h+180)%360,At(t)}function Tg(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var i=At(e).toHsl(),r=[At(e)],n=360/t,a=1;a<t;a++)r.push(At({h:(i.h+a*n)%360,s:i.s,l:i.l}));return r}function CO(e){var t=At(e).toHsl(),i=t.h;return[At(e),At({h:(i+72)%360,s:t.s,l:t.l}),At({h:(i+216)%360,s:t.s,l:t.l})]}function DO(e,t,i){t=t||6,i=i||30;var r=At(e).toHsl(),n=360/i,a=[At(e)];for(r.h=(r.h-(n*t>>1)+720)%360;--t;)r.h=(r.h+n)%360,a.push(At(r));return a}function OO(e,t){t=t||6;for(var i=At(e).toHsv(),r=i.h,n=i.s,a=i.v,s=[],o=1/t;t--;)s.push(At({h:r,s:n,v:a})),a=(a+o)%1;return s}At.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,i,r=this.toRgb();return e=r.r/255,t=r.g/255,i=r.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))},setAlpha:function(e){return this._a=b0(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=yg(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=yg(this._r,this._g,this._b),t=Math.round(360*e.h),i=Math.round(100*e.s),r=Math.round(100*e.v);return this._a==1?"hsv("+t+", "+i+"%, "+r+"%)":"hsva("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=vg(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=vg(this._r,this._g,this._b),t=Math.round(360*e.h),i=Math.round(100*e.s),r=Math.round(100*e.l);return this._a==1?"hsl("+t+", "+i+"%, "+r+"%)":"hsla("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return bg(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return(function(t,i,r,n,a){var s=[Pi(Math.round(t).toString(16)),Pi(Math.round(i).toString(16)),Pi(Math.round(r).toString(16)),Pi(w0(n))];return a&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")})(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*me(this._r,255))+"%",g:Math.round(100*me(this._g,255))+"%",b:Math.round(100*me(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*me(this._r,255))+"%, "+Math.round(100*me(this._g,255))+"%, "+Math.round(100*me(this._b,255))+"%)":"rgba("+Math.round(100*me(this._r,255))+"%, "+Math.round(100*me(this._g,255))+"%, "+Math.round(100*me(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(MO[bg(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+wg(this._r,this._g,this._b,this._a),i=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var n=At(e);i="#"+wg(n._r,n._g,n._b,n._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,r=this._a<1&&this._a>=0;return t||!r||e!=="hex"&&e!=="hex6"&&e!=="hex3"&&e!=="hex4"&&e!=="hex8"&&e!=="name"?(e==="rgb"&&(i=this.toRgbString()),e==="prgb"&&(i=this.toPercentageRgbString()),e!=="hex"&&e!=="hex6"||(i=this.toHexString()),e==="hex3"&&(i=this.toHexString(!0)),e==="hex4"&&(i=this.toHex8String(!0)),e==="hex8"&&(i=this.toHex8String()),e==="name"&&(i=this.toName()),e==="hsl"&&(i=this.toHslString()),e==="hsv"&&(i=this.toHsvString()),i||this.toHexString()):e==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return At(this.toString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(AO,arguments)},brighten:function(){return this._applyModification(xO,arguments)},darken:function(){return this._applyModification(RO,arguments)},desaturate:function(){return this._applyModification(EO,arguments)},saturate:function(){return this._applyModification(_O,arguments)},greyscale:function(){return this._applyModification(SO,arguments)},spin:function(){return this._applyModification(kO,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(DO,arguments)},complement:function(){return this._applyCombination(IO,arguments)},monochromatic:function(){return this._applyCombination(OO,arguments)},splitcomplement:function(){return this._applyCombination(CO,arguments)},triad:function(){return this._applyCombination(Tg,[3])},tetrad:function(){return this._applyCombination(Tg,[4])}},At.fromRatio=function(e,t){if(Ll(e)=="object"){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=r==="a"?e[r]:vs(e[r]));e=i}return At(e,t)},At.equals=function(e,t){return!(!e||!t)&&At(e).toRgbString()==At(t).toRgbString()},At.random=function(){return At.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},At.mix=function(e,t,i){i=i===0?0:i||50;var r=At(e).toRgb(),n=At(t).toRgb(),a=i/100;return At({r:(n.r-r.r)*a+r.r,g:(n.g-r.g)*a+r.g,b:(n.b-r.b)*a+r.b,a:(n.a-r.a)*a+r.a})},At.readability=function(e,t){var i=At(e),r=At(t);return(Math.max(i.getLuminance(),r.getLuminance())+.05)/(Math.min(i.getLuminance(),r.getLuminance())+.05)},At.isReadable=function(e,t,i){var r,n,a=At.readability(e,t);switch(n=!1,(r=(function(s){var o,l;return o=((s=s||{level:"AA",size:"small"}).level||"AA").toUpperCase(),l=(s.size||"small").toLowerCase(),o!=="AA"&&o!=="AAA"&&(o="AA"),l!=="small"&&l!=="large"&&(l="small"),{level:o,size:l}})(i)).level+r.size){case"AAsmall":case"AAAlarge":n=a>=4.5;break;case"AAlarge":n=a>=3;break;case"AAAsmall":n=a>=7}return n},At.mostReadable=function(e,t,i){var r,n,a,s,o=null,l=0;n=(i=i||{}).includeFallbackColors,a=i.level,s=i.size;for(var h=0;h<t.length;h++)(r=At.readability(e,t[h]))>l&&(l=r,o=At(t[h]));return At.isReadable(e,o,{level:a,size:s})||!n?o:(i.includeFallbackColors=!1,At.mostReadable(e,["#fff","#000"],i))};var iu=At.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},MO=At.hexNames=(function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t})(iu);function b0(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function me(e,t){(function(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1})(e)&&(e="100%");var i=(function(r){return typeof r=="string"&&r.indexOf("%")!=-1})(e);return e=Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function vc(e){return Math.min(1,Math.max(0,e))}function hi(e){return parseInt(e,16)}function Pi(e){return e.length==1?"0"+e:""+e}function vs(e){return e<=1&&(e=100*e+"%"),e}function w0(e){return Math.round(255*parseFloat(e)).toString(16)}function Eg(e){return hi(e)/255}var Xr,Yo,qo,sh,_g,Ko,Sg,xi=(Yo="[\\s|\\(]+("+(Xr="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Xr+")[,|\\s]+("+Xr+")\\s*\\)?",qo="[\\s|\\(]+("+Xr+")[,|\\s]+("+Xr+")[,|\\s]+("+Xr+")[,|\\s]+("+Xr+")\\s*\\)?",{CSS_UNIT:new RegExp(Xr),rgb:new RegExp("rgb"+Yo),rgba:new RegExp("rgba"+qo),hsl:new RegExp("hsl"+Yo),hsla:new RegExp("hsla"+qo),hsv:new RegExp("hsv"+Yo),hsva:new RegExp("hsva"+qo),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function vr(e){return!!xi.CSS_UNIT.exec(e)}var Ag={red:{50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},pink:{50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",A100:"#ff80ab",A200:"#ff4081",A400:"#f50057",A700:"#c51162"},purple:{50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},"deep-purple":{50:"#ede7f6",100:"#d1c4e9",200:"#b39ddb",300:"#9575cd",400:"#7e57c2",500:"#673ab7",600:"#5e35b1",700:"#512da8",800:"#4527a0",900:"#311b92",A100:"#b388ff",A200:"#7c4dff",A400:"#651fff",A700:"#6200ea"},indigo:{50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe"},blue:{50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},"light-blue":{50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},cyan:{50:"#e0f7fa",100:"#b2ebf2",200:"#80deea",300:"#4dd0e1",400:"#26c6da",500:"#00bcd4",600:"#00acc1",700:"#0097a7",800:"#00838f",900:"#006064",A100:"#84ffff",A200:"#18ffff",A400:"#00e5ff",A700:"#00b8d4"},teal:{50:"#e0f2f1",100:"#b2dfdb",200:"#80cbc4",300:"#4db6ac",400:"#26a69a",500:"#009688",600:"#00897b",700:"#00796b",800:"#00695c",900:"#004d40",A100:"#a7ffeb",A200:"#64ffda",A400:"#1de9b6",A700:"#00bfa5"},green:{50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},"light-green":{50:"#f1f8e9",100:"#dcedc8",200:"#c5e1a5",300:"#aed581",400:"#9ccc65",500:"#8bc34a",600:"#7cb342",700:"#689f38",800:"#558b2f",900:"#33691e",A100:"#ccff90",A200:"#b2ff59",A400:"#76ff03",A700:"#64dd17"},lime:{50:"#f9fbe7",100:"#f0f4c3",200:"#e6ee9c",300:"#dce775",400:"#d4e157",500:"#cddc39",600:"#c0ca33",700:"#afb42b",800:"#9e9d24",900:"#827717",A100:"#f4ff81",A200:"#eeff41",A400:"#c6ff00",A700:"#aeea00"},yellow:{50:"#fffde7",100:"#fff9c4",200:"#fff59d",300:"#fff176",400:"#ffee58",500:"#ffeb3b",600:"#fdd835",700:"#fbc02d",800:"#f9a825",900:"#f57f17",A100:"#ffff8d",A200:"#ffff00",A400:"#ffea00",A700:"#ffd600"},amber:{50:"#fff8e1",100:"#ffecb3",200:"#ffe082",300:"#ffd54f",400:"#ffca28",500:"#ffc107",600:"#ffb300",700:"#ffa000",800:"#ff8f00",900:"#ff6f00",A100:"#ffe57f",A200:"#ffd740",A400:"#ffc400",A700:"#ffab00"},orange:{50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},"deep-orange":{50:"#fbe9e7",100:"#ffccbc",200:"#ffab91",300:"#ff8a65",400:"#ff7043",500:"#ff5722",600:"#f4511e",700:"#e64a19",800:"#d84315",900:"#bf360c",A100:"#ff9e80",A200:"#ff6e40",A400:"#ff3d00",A700:"#dd2c00"},brown:{50:"#efebe9",100:"#d7ccc8",200:"#bcaaa4",300:"#a1887f",400:"#8d6e63",500:"#795548",600:"#6d4c41",700:"#5d4037",800:"#4e342e",900:"#3e2723",A100:"#d7ccc8",A200:"#bcaaa4",A400:"#8d6e63",A700:"#5d4037"},grey:{50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#ffffff",A200:"#000000",A400:"#303030",A700:"#616161"},"blue-grey":{50:"#eceff1",100:"#cfd8dc",200:"#b0bec5",300:"#90a4ae",400:"#78909c",500:"#607d8b",600:"#546e7a",700:"#455a64",800:"#37474f",900:"#263238",A100:"#cfd8dc",A200:"#b0bec5",A400:"#78909c",A700:"#455a64"}},Ul=new Array,xg=["blue","green","red","amber","blue-grey","purple","light-green","indigo","pink","yellow","light-blue","orange","deep-purple","lime","teal","brown","cyan","deep-orange","grey"],ru=["500","A700","600","700","800","900","300","400","A200","A400"];try{for(var Go=kt(Object.keys(Ag)),os=Go.next();!os.done;os=Go.next()){var Rg=os.value,kg=Ag[Rg];try{for(var $o=(Ko=void 0,kt(Object.keys(kg))),ls=$o.next();!ls.done;ls=$o.next()){var oh=ls.value;if(ru.indexOf(oh)>-1){var Ig=At(kg[oh]),PO=Ig.isDark(),NO={value:Ig.toHexString(),group:Rg,label:oh,isDark:PO};Ul.push(NO)}}}catch(e){Ko={error:e}}finally{try{ls&&!ls.done&&(Sg=$o.return)&&Sg.call($o)}finally{if(Ko)throw Ko.error}}}}catch(e){sh={error:e}}finally{try{os&&!os.done&&(_g=Go.return)&&_g.call(Go)}finally{if(sh)throw sh.error}}Ul.sort(function(e,t){var i=ru.indexOf(e.label)-ru.indexOf(t.label);return i===0&&(i=xg.indexOf(e.group)-xg.indexOf(t.group)),i});var LO=function(e,t){var i={};if(e){if(typeof e=="string")i.message=e;else if(e instanceof String)i.message=e.toString();else if(e.name?i.name=e.name:i.name="UnknownError",e.message&&(i.message=e.message),e.lineNumber)i.lineNumber=e.lineNumber,e.columnNumber&&(i.columnNumber=e.columnNumber);else if(e.stack){var r=/(.*<anonymous>):(\d*)(:)?(\d*)?/g.exec(e.stack);r!=null&&r.length>=3&&(pn(t)&&(t=-2),i.lineNumber=Number(r[2])+t,r.length>=5&&(i.columnNumber=Number(r[4])))}}return i};function UO(e){return function(t,i){return T0(t,i)}}var T0=function(e,t,i){var r,n;if(t===null||!t.length)return!0;var a=(""+t).toLowerCase();try{for(var s=kt(Object.keys(e)),o=s.next();!o.done;o=s.next()){var l;if((l=e[o.value])!==null){if(l!==Object(l)){if((""+l).toLowerCase().indexOf(a)!==-1)return!0}else if(uo(l)&&T0(l,t))return!0}}}catch(h){r={error:h}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return!1};function Cg(e,t,i,r){var n=cg(e,i),a=cg(t,i),s=0;if(n!==a){var o=typeof n,l=typeof a;o==="number"&&l==="number"?s=n-a:o==="string"&&l==="string"?s=n.localeCompare(a):(o==="boolean"&&l==="boolean"||o!==l)&&(n&&!a?s=1:!n&&a&&(s=-1))}return r?s:-1*s}var Rs,FO=(function(){function e(t,i,r,n){i===void 0&&(i=0),r===void 0&&(r=null),n===void 0&&(n=null),this.textSearch=r,this.pageSize=t,this.page=i,this.sortOrder=n}return e.prototype.nextPageLink=function(){return new e(this.pageSize,this.page+1,this.textSearch,this.sortOrder)},e.prototype.toQuery=function(){var t,i="?pageSize=".concat(this.pageSize,"&page=").concat(this.page),r=(t=this.textSearch)===null||t===void 0?void 0:t.trim();if(r!=null&&r.length){var n=encodeURIComponent(r);i+="&textSearch=".concat(n)}return this.sortOrder&&(i+="&sortProperty=".concat(this.sortOrder.property,"&sortOrder=").concat(this.sortOrder.direction)),i},e.prototype.sort=function(t,i){return this.sortOrder?Cg(t,i,this.sortOrder.property,this.sortOrder.direction===Ks.ASC):0},e.prototype.filterData=function(t,i){var r=this;i===void 0&&(i=UO());var n={data:[],totalPages:0,totalElements:0,hasNext:!1};if(n.data=on([],$e(t),!1),this.textSearch&&this.textSearch.length&&(n.data=n.data.filter(function(l){return i(l,r.textSearch)})),n.totalElements=n.data.length,n.totalPages=this.pageSize===Number.POSITIVE_INFINITY?1:Math.ceil(n.totalElements/this.pageSize),this.sortOrder){var a=this.sortOrder.property,s=this.sortOrder.direction===Ks.ASC;n.data=n.data.sort(function(l,h){return Cg(l,h,a,s)})}if(this.pageSize!==Number.POSITIVE_INFINITY){var o=this.pageSize*this.page;n.data=n.data.slice(o,o+this.pageSize),n.hasNext=n.totalElements>o+n.data.length}return n},e.prototype.sortDirection=function(){return this.sortOrder?(this.sortOrder.direction+"").toLowerCase():""},e})();(function(e){function t(i,r,n,a,s,o){r===void 0&&(r=0),n===void 0&&(n=null),a===void 0&&(a=null),s===void 0&&(s=null),o===void 0&&(o=null);var l=e.call(this,i,r,n,a)||this;return l.startTime=s,l.endTime=o,l}return Le(t,e),t.prototype.nextPageLink=function(){return new t(this.pageSize,this.page+1,this.textSearch,this.sortOrder,this.startTime,this.endTime)},t.prototype.toQuery=function(){var i=e.prototype.toQuery.call(this);return this.startTime&&(i+="&startTime=".concat(this.startTime)),this.endTime&&(i+="&endTime=".concat(this.endTime)),i},t})(FO);(function(e){e.ENABLED="ENABLED",e.WARNING="WARNING",e.DISABLED="DISABLED"})(Rs||(Rs={}));var Ki;Rs.ENABLED,Rs.WARNING,Rs.DISABLED;(function(e){e.TRANSPORT="TRANSPORT",e.DB="DB",e.RE="RE",e.JS="JS",e.TBEL="TBEL",e.EMAIL="EMAIL",e.SMS="SMS",e.ALARM="ALARM"})(Ki||(Ki={}));var Dg,Vt,Fl;Ki.TRANSPORT,Ki.DB,Ki.RE,Ki.JS,Ki.TBEL,Ki.EMAIL,Ki.SMS,Ki.ALARM;(function(e){e[e.TENANT=0]="TENANT",e[e.ENTITY=1]="ENTITY",e[e.USER=2]="USER",e[e.CUSTOMER=3]="CUSTOMER"})(Dg||(Dg={})),(function(e){e.ADDED="ADDED",e.DELETED="DELETED",e.UPDATED="UPDATED",e.ATTRIBUTES_UPDATED="ATTRIBUTES_UPDATED",e.ATTRIBUTES_DELETED="ATTRIBUTES_DELETED",e.RPC_CALL="RPC_CALL",e.CREDENTIALS_UPDATED="CREDENTIALS_UPDATED",e.ASSIGNED_TO_CUSTOMER="ASSIGNED_TO_CUSTOMER",e.UNASSIGNED_FROM_CUSTOMER="UNASSIGNED_FROM_CUSTOMER",e.ACTIVATED="ACTIVATED",e.SUSPENDED="SUSPENDED",e.CREDENTIALS_READ="CREDENTIALS_READ",e.ATTRIBUTES_READ="ATTRIBUTES_READ",e.RELATION_ADD_OR_UPDATE="RELATION_ADD_OR_UPDATE",e.RELATION_DELETED="RELATION_DELETED",e.RELATIONS_DELETED="RELATIONS_DELETED",e.ALARM_ACK="ALARM_ACK",e.ALARM_CLEAR="ALARM_CLEAR",e.ALARM_ASSIGNED="ALARM_ASSIGNED",e.ALARM_UNASSIGNED="ALARM_UNASSIGNED",e.ADDED_COMMENT="ADDED_COMMENT",e.UPDATED_COMMENT="UPDATED_COMMENT",e.DELETED_COMMENT="DELETED_COMMENT",e.LOGIN="LOGIN",e.LOGOUT="LOGOUT",e.LOCKOUT="LOCKOUT",e.ASSIGNED_FROM_TENANT="ASSIGNED_FROM_TENANT",e.ASSIGNED_TO_TENANT="ASSIGNED_TO_TENANT",e.PROVISION_SUCCESS="PROVISION_SUCCESS",e.PROVISION_FAILURE="PROVISION_FAILURE",e.TIMESERIES_UPDATED="TIMESERIES_UPDATED",e.TIMESERIES_DELETED="TIMESERIES_DELETED",e.ASSIGNED_TO_EDGE="ASSIGNED_TO_EDGE",e.UNASSIGNED_FROM_EDGE="UNASSIGNED_FROM_EDGE",e.SMS_SENT="SMS_SENT"})(Vt||(Vt={})),(function(e){e.SUCCESS="SUCCESS",e.FAILURE="FAILURE"})(Fl||(Fl={}));var Og;Vt.ADDED,Vt.DELETED,Vt.UPDATED,Vt.ATTRIBUTES_UPDATED,Vt.ATTRIBUTES_DELETED,Vt.RPC_CALL,Vt.CREDENTIALS_UPDATED,Vt.ASSIGNED_TO_CUSTOMER,Vt.UNASSIGNED_FROM_CUSTOMER,Vt.ACTIVATED,Vt.SUSPENDED,Vt.CREDENTIALS_READ,Vt.ATTRIBUTES_READ,Vt.RELATION_ADD_OR_UPDATE,Vt.RELATION_DELETED,Vt.RELATIONS_DELETED,Vt.ALARM_ACK,Vt.ALARM_CLEAR,Vt.ALARM_ASSIGNED,Vt.ALARM_UNASSIGNED,Vt.ADDED_COMMENT,Vt.UPDATED_COMMENT,Vt.DELETED_COMMENT,Vt.LOGIN,Vt.LOGOUT,Vt.LOCKOUT,Vt.ASSIGNED_FROM_TENANT,Vt.ASSIGNED_TO_TENANT,Vt.PROVISION_SUCCESS,Vt.PROVISION_FAILURE,Vt.TIMESERIES_UPDATED,Vt.TIMESERIES_DELETED,Vt.ASSIGNED_TO_EDGE,Vt.UNASSIGNED_FROM_EDGE,Vt.SMS_SENT;Fl.SUCCESS,Fl.FAILURE;(function(e){e.SYS_ADMIN="SYS_ADMIN",e.TENANT_ADMIN="TENANT_ADMIN",e.CUSTOMER_USER="CUSTOMER_USER",e.REFRESH_TOKEN="REFRESH_TOKEN",e.ANONYMOUS="ANONYMOUS",e.PRE_VERIFICATION_TOKEN="PRE_VERIFICATION_TOKEN"})(Og||(Og={}));var Mg,Bl,Xe,jl,Wl,zl,Sa;(function(e){e.PSM="PSM",e.DRX="DRX",e.E_DRX="E_DRX"})(Mg||(Mg={})),(function(e){e.DEFAULT="DEFAULT",e.SNMP="SNMP"})(Bl||(Bl={})),(function(e){e.DEFAULT="DEFAULT",e.MQTT="MQTT",e.COAP="COAP",e.LWM2M="LWM2M",e.SNMP="SNMP"})(Xe||(Xe={})),(function(e){e.HTTP="HTTP"})(jl||(jl={})),(function(e){e.JSON="JSON",e.PROTOBUF="PROTOBUF"})(Wl||(Wl={})),(function(e){e.DEFAULT="DEFAULT",e.EFENTO="EFENTO"})(zl||(zl={})),(function(e){e.DISABLED="DISABLED",e.ALLOW_CREATE_NEW_DEVICES="ALLOW_CREATE_NEW_DEVICES",e.CHECK_PRE_PROVISIONED_DEVICES="CHECK_PRE_PROVISIONED_DEVICES",e.X509_CERTIFICATE_CHAIN="X509_CERTIFICATE_CHAIN"})(Sa||(Sa={}));var Dn;Bl.DEFAULT;Bl.DEFAULT;Xe.DEFAULT,Xe.MQTT,Xe.COAP,Xe.LWM2M,Xe.SNMP,jl.HTTP;Sa.DISABLED,Sa.ALLOW_CREATE_NEW_DEVICES,Sa.CHECK_PRE_PROVISIONED_DEVICES,Sa.X509_CERTIFICATE_CHAIN;Xe.DEFAULT,Xe.MQTT,Xe.COAP,Xe.LWM2M,Xe.SNMP,jl.HTTP;Wl.JSON,Wl.PROTOBUF;zl.DEFAULT,zl.EFENTO;Xe.DEFAULT,Xe.MQTT,Xe.COAP;(function(e){e.TELEMETRY_QUERYING="TELEMETRY_QUERYING",e.CLIENT_ATTRIBUTES_QUERYING="CLIENT_ATTRIBUTES_QUERYING",e.SHARED_ATTRIBUTES_SETTING="SHARED_ATTRIBUTES_SETTING",e.TO_DEVICE_RPC_REQUEST="TO_DEVICE_RPC_REQUEST",e.TO_SERVER_RPC_REQUEST="TO_SERVER_RPC_REQUEST"})(Dn||(Dn={}));Dn.TELEMETRY_QUERYING,Dn.CLIENT_ATTRIBUTES_QUERYING,Dn.SHARED_ATTRIBUTES_SETTING,Dn.TO_DEVICE_RPC_REQUEST,Dn.TO_SERVER_RPC_REQUEST;var ks;(function(e){e.SIMPLE="SIMPLE",e.DURATION="DURATION",e.REPEATING="REPEATING"})(ks||(ks={}));var Is;ks.SIMPLE,ks.DURATION,ks.REPEATING;(function(e){e.ANY_TIME="ANY_TIME",e.SPECIFIC_TIME="SPECIFIC_TIME",e.CUSTOM="CUSTOM"})(Is||(Is={}));var Pg,rn;Is.ANY_TIME,Is.SPECIFIC_TIME,Is.CUSTOM;(function(e){e.V1="V1",e.V2C="V2C",e.V3="V3"})(Pg||(Pg={})),(function(e){e.SHA_1="SHA_1",e.SHA_224="SHA_224",e.SHA_256="SHA_256",e.SHA_384="SHA_384",e.SHA_512="SHA_512",e.MD5="MD%"})(rn||(rn={}));var Aa;rn.SHA_1,rn.SHA_224,rn.SHA_256,rn.SHA_384,rn.SHA_512,rn.MD5;(function(e){e.DES="DES",e.AES_128="AES_128",e.AES_192="AES_192",e.AES_256="AES_256"})(Aa||(Aa={}));var Cs;Aa.DES,Aa.AES_128,Aa.AES_192,Aa.AES_256;(function(e){e.ACCESS_TOKEN="ACCESS_TOKEN",e.X509_CERTIFICATE="X509_CERTIFICATE",e.MQTT_BASIC="MQTT_BASIC",e.LWM2M_CREDENTIALS="LWM2M_CREDENTIALS"})(Cs||(Cs={}));var Ng;Cs.ACCESS_TOKEN,Cs.X509_CERTIFICATE,Cs.MQTT_BASIC;(function(e){e.SUCCESS="SUCCESS",e.FAILURE="FAILURE",e.CLAIMED="CLAIMED"})(Ng||(Ng={}));var ye,Jt,Vl;new Array("device-profile.schedule-day.monday","device-profile.schedule-day.tuesday","device-profile.schedule-day.wednesday","device-profile.schedule-day.thursday","device-profile.schedule-day.friday","device-profile.schedule-day.saturday","device-profile.schedule-day.sunday");(function(e){e.DASHBOARD="DASHBOARD",e.ASSET="ASSET",e.DEVICE="DEVICE",e.DEVICE_PROFILE="DEVICE_PROFILE",e.ASSET_PROFILE="ASSET_PROFILE",e.ENTITY_VIEW="ENTITY_VIEW",e.ALARM="ALARM",e.RULE_CHAIN="RULE_CHAIN",e.RULE_CHAIN_METADATA="RULE_CHAIN_METADATA",e.EDGE="EDGE",e.USER="USER",e.CUSTOMER="CUSTOMER",e.RELATION="RELATION",e.TENANT="TENANT",e.TENANT_PROFILE="TENANT_PROFILE",e.WIDGETS_BUNDLE="WIDGETS_BUNDLE",e.WIDGET_TYPE="WIDGET_TYPE",e.ADMIN_SETTINGS="ADMIN_SETTINGS",e.OTA_PACKAGE="OTA_PACKAGE",e.QUEUE="QUEUE"})(ye||(ye={})),(function(e){e.ADDED="ADDED",e.DELETED="DELETED",e.UPDATED="UPDATED",e.POST_ATTRIBUTES="POST_ATTRIBUTES",e.ATTRIBUTES_UPDATED="ATTRIBUTES_UPDATED",e.ATTRIBUTES_DELETED="ATTRIBUTES_DELETED",e.TIMESERIES_UPDATED="TIMESERIES_UPDATED",e.CREDENTIALS_UPDATED="CREDENTIALS_UPDATED",e.ASSIGNED_TO_CUSTOMER="ASSIGNED_TO_CUSTOMER",e.UNASSIGNED_FROM_CUSTOMER="UNASSIGNED_FROM_CUSTOMER",e.RELATION_ADD_OR_UPDATE="RELATION_ADD_OR_UPDATE",e.RELATION_DELETED="RELATION_DELETED",e.RPC_CALL="RPC_CALL",e.ALARM_ACK="ALARM_ACK",e.ALARM_CLEAR="ALARM_CLEAR",e.ALARM_ASSIGNED="ALARM_ASSIGNED",e.ALARM_UNASSIGNED="ALARM_UNASSIGNED",e.ASSIGNED_TO_EDGE="ASSIGNED_TO_EDGE",e.UNASSIGNED_FROM_EDGE="UNASSIGNED_FROM_EDGE",e.CREDENTIALS_REQUEST="CREDENTIALS_REQUEST",e.ENTITY_MERGE_REQUEST="ENTITY_MERGE_REQUEST"})(Jt||(Jt={})),(function(e){e.DEPLOYED="DEPLOYED",e.PENDING="PENDING"})(Vl||(Vl={}));var Lg;ye.DASHBOARD,ye.ASSET,ye.DEVICE,ye.DEVICE_PROFILE,ye.ASSET_PROFILE,ye.ENTITY_VIEW,ye.ALARM,ye.RULE_CHAIN,ye.RULE_CHAIN_METADATA,ye.EDGE,ye.USER,ye.CUSTOMER,ye.RELATION,ye.TENANT,ye.TENANT_PROFILE,ye.WIDGETS_BUNDLE,ye.WIDGET_TYPE,ye.ADMIN_SETTINGS,ye.OTA_PACKAGE,ye.QUEUE;Jt.ADDED,Jt.DELETED,Jt.UPDATED,Jt.POST_ATTRIBUTES,Jt.ATTRIBUTES_UPDATED,Jt.ATTRIBUTES_DELETED,Jt.TIMESERIES_UPDATED,Jt.CREDENTIALS_UPDATED,Jt.ASSIGNED_TO_CUSTOMER,Jt.UNASSIGNED_FROM_CUSTOMER,Jt.RELATION_ADD_OR_UPDATE,Jt.RELATION_DELETED,Jt.RPC_CALL,Jt.ALARM_ACK,Jt.ALARM_CLEAR,Jt.ALARM_ASSIGNED,Jt.ALARM_UNASSIGNED,Jt.ASSIGNED_TO_EDGE,Jt.UNASSIGNED_FROM_EDGE,Jt.CREDENTIALS_REQUEST,Jt.ENTITY_MERGE_REQUEST;Jt.POST_ATTRIBUTES,Jt.ATTRIBUTES_UPDATED,Jt.ATTRIBUTES_DELETED,Jt.TIMESERIES_UPDATED,Jt.RPC_CALL;Vl.DEPLOYED,Vl.PENDING;(function(e){e[e.ubuntu=0]="ubuntu",e[e.centos=1]="centos",e[e.docker=2]="docker"})(Lg||(Lg={}));var Ds,Hl;(function(e){e.ERROR="ERROR",e.LC_EVENT="LC_EVENT",e.STATS="STATS"})(Ds||(Ds={})),(function(e){e.DEBUG_RULE_NODE="DEBUG_RULE_NODE",e.DEBUG_RULE_CHAIN="DEBUG_RULE_CHAIN"})(Hl||(Hl={}));var Je;Ds.ERROR,Ds.LC_EVENT,Ds.STATS,Hl.DEBUG_RULE_NODE,Hl.DEBUG_RULE_CHAIN;(function(e){e.ENTITY_EXPORT="ENTITY_EXPORT",e.ENTITY_IMPORT="ENTITY_IMPORT",e.NOTIFICATION_REQUESTS="NOTIFICATION_REQUESTS",e.NOTIFICATION_REQUESTS_PER_RULE="NOTIFICATION_REQUESTS_PER_RULE",e.REST_REQUESTS_PER_TENANT="REST_REQUESTS_PER_TENANT",e.REST_REQUESTS_PER_CUSTOMER="REST_REQUESTS_PER_CUSTOMER",e.WS_UPDATES_PER_SESSION="WS_UPDATES_PER_SESSION",e.CASSANDRA_QUERIES="CASSANDRA_QUERIES",e.TRANSPORT_MESSAGES_PER_TENANT="TRANSPORT_MESSAGES_PER_TENANT",e.TRANSPORT_MESSAGES_PER_DEVICE="TRANSPORT_MESSAGES_PER_DEVICE",e.EDGE_EVENTS="EDGE_EVENTS",e.EDGE_EVENTS_PER_EDGE="EDGE_EVENTS_PER_EDGE"})(Je||(Je={}));var Os;Je.ENTITY_EXPORT,Je.ENTITY_IMPORT,Je.NOTIFICATION_REQUESTS,Je.NOTIFICATION_REQUESTS_PER_RULE,Je.REST_REQUESTS_PER_TENANT,Je.REST_REQUESTS_PER_CUSTOMER,Je.WS_UPDATES_PER_SESSION,Je.CASSANDRA_QUERIES,Je.TRANSPORT_MESSAGES_PER_TENANT,Je.TRANSPORT_MESSAGES_PER_DEVICE,Je.EDGE_EVENTS,Je.EDGE_EVENTS_PER_EDGE;(function(e){e.STARTED="STARTED",e.UPDATED="UPDATED",e.STOPPED="STOPPED"})(Os||(Os={}));var xa;Os.STARTED,Os.UPDATED,Os.STOPPED;(function(e){e.CREATED="CREATED",e.SEVERITY_CHANGED="SEVERITY_CHANGED",e.ACKNOWLEDGED="ACKNOWLEDGED",e.CLEARED="CLEARED"})(xa||(xa={}));var Yl;xa.CREATED,xa.SEVERITY_CHANGED,xa.ACKNOWLEDGED,xa.CLEARED;(function(e){e.ASSIGNED="ASSIGNED",e.UNASSIGNED="UNASSIGNED"})(Yl||(Yl={}));var ql;Yl.ASSIGNED,Yl.UNASSIGNED;(function(e){e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE"})(ql||(ql={}));var Ms;ql.ACTIVE,ql.INACTIVE;(function(e){e.PLATFORM_USERS="PLATFORM_USERS",e.SLACK="SLACK",e.MICROSOFT_TEAMS="MICROSOFT_TEAMS"})(Ms||(Ms={}));var Ug,nn;Ms.PLATFORM_USERS,Ms.SLACK,Ms.MICROSOFT_TEAMS;(function(e){e.SENT="SENT",e.READ="READ"})(Ug||(Ug={})),(function(e){e.WEB="WEB",e.MOBILE_APP="MOBILE_APP",e.SMS="SMS",e.EMAIL="EMAIL",e.SLACK="SLACK",e.MICROSOFT_TEAMS="MICROSOFT_TEAMS"})(nn||(nn={}));var Ps;nn.WEB,nn.SMS,nn.EMAIL,nn.SLACK,nn.MOBILE_APP,nn.MICROSOFT_TEAMS;(function(e){e.PROCESSING="PROCESSING",e.SCHEDULED="SCHEDULED",e.SENT="SENT"})(Ps||(Ps={}));var Ns;Ps.PROCESSING,Ps.SCHEDULED,Ps.SENT;(function(e){e.PUBLIC_CHANNEL="PUBLIC_CHANNEL",e.PRIVATE_CHANNEL="PRIVATE_CHANNEL",e.DIRECT="DIRECT"})(Ns||(Ns={}));var Gi;Ns.DIRECT,Ns.PUBLIC_CHANNEL,Ns.PRIVATE_CHANNEL;(function(e){e.ALL_USERS="ALL_USERS",e.TENANT_ADMINISTRATORS="TENANT_ADMINISTRATORS",e.CUSTOMER_USERS="CUSTOMER_USERS",e.USER_LIST="USER_LIST",e.ORIGINATOR_ENTITY_OWNER_USERS="ORIGINATOR_ENTITY_OWNER_USERS",e.AFFECTED_USER="AFFECTED_USER",e.SYSTEM_ADMINISTRATORS="SYSTEM_ADMINISTRATORS",e.AFFECTED_TENANT_ADMINISTRATORS="AFFECTED_TENANT_ADMINISTRATORS",e.USER_GROUP_LIST="USER_GROUP_LIST",e.USER_ROLE="USER_ROLE"})(Gi||(Gi={}));var fe;Gi.ALL_USERS,Gi.TENANT_ADMINISTRATORS,Gi.CUSTOMER_USERS,Gi.USER_LIST,Gi.ORIGINATOR_ENTITY_OWNER_USERS,Gi.AFFECTED_USER,Gi.SYSTEM_ADMINISTRATORS,Gi.AFFECTED_TENANT_ADMINISTRATORS;(function(e){e.GENERAL="GENERAL",e.ALARM="ALARM",e.DEVICE_ACTIVITY="DEVICE_ACTIVITY",e.ENTITY_ACTION="ENTITY_ACTION",e.ALARM_COMMENT="ALARM_COMMENT",e.ALARM_ASSIGNMENT="ALARM_ASSIGNMENT",e.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT="RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT",e.ENTITIES_LIMIT="ENTITIES_LIMIT",e.API_USAGE_LIMIT="API_USAGE_LIMIT",e.NEW_PLATFORM_VERSION="NEW_PLATFORM_VERSION",e.RULE_NODE="RULE_NODE",e.RATE_LIMITS="RATE_LIMITS",e.EDGE_CONNECTION="EDGE_CONNECTION",e.EDGE_COMMUNICATION_FAILURE="EDGE_COMMUNICATION_FAILURE"})(fe||(fe={}));var Kl;fe.ALARM,fe.DEVICE_ACTIVITY,fe.ENTITY_ACTION,fe.ALARM_COMMENT,fe.ALARM_ASSIGNMENT,fe.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT,fe.ENTITIES_LIMIT,fe.API_USAGE_LIMIT;Me.CRITICAL,Me.MAJOR,Me.MINOR,Me.WARNING,Me.INDETERMINATE;(function(e){e.LINK="LINK",e.DASHBOARD="DASHBOARD"})(Kl||(Kl={}));var Ze;Kl.LINK,Kl.DASHBOARD;fe.GENERAL,fe.ALARM,fe.DEVICE_ACTIVITY,fe.ENTITY_ACTION,fe.ALARM_COMMENT,fe.ALARM_ASSIGNMENT,fe.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT,fe.ENTITIES_LIMIT,fe.API_USAGE_LIMIT,fe.NEW_PLATFORM_VERSION,fe.RULE_NODE,fe.RATE_LIMITS,fe.EDGE_CONNECTION,fe.EDGE_COMMUNICATION_FAILURE;(function(e){e.ALARM="ALARM",e.DEVICE_ACTIVITY="DEVICE_ACTIVITY",e.ENTITY_ACTION="ENTITY_ACTION",e.ALARM_COMMENT="ALARM_COMMENT",e.ALARM_ASSIGNMENT="ALARM_ASSIGNMENT",e.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT="RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT",e.ENTITIES_LIMIT="ENTITIES_LIMIT",e.API_USAGE_LIMIT="API_USAGE_LIMIT",e.NEW_PLATFORM_VERSION="NEW_PLATFORM_VERSION",e.RATE_LIMITS="RATE_LIMITS",e.EDGE_CONNECTION="EDGE_CONNECTION",e.EDGE_COMMUNICATION_FAILURE="EDGE_COMMUNICATION_FAILURE"})(Ze||(Ze={}));var Ls;Ze.ALARM,Ze.DEVICE_ACTIVITY,Ze.ENTITY_ACTION,Ze.ALARM_COMMENT,Ze.ALARM_ASSIGNMENT,Ze.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT,Ze.ENTITIES_LIMIT,Ze.API_USAGE_LIMIT,Ze.NEW_PLATFORM_VERSION,Ze.RATE_LIMITS,Ze.EDGE_CONNECTION,Ze.EDGE_COMMUNICATION_FAILURE;(function(e){e.HTTP="HTTP",e.HTTPS="HTTPS",e.MIXED="MIXED"})(Ls||(Ls={}));var Fg,Bg,Us;Ls.HTTP,Ls.HTTPS,Ls.MIXED;(function(e){e.BASIC="BASIC",e.CUSTOM="CUSTOM",e.GITHUB="GITHUB",e.APPLE="APPLE"})(Fg||(Fg={})),(function(e){e.DOMAIN="DOMAIN",e.EMAIL="EMAIL",e.CUSTOM="CUSTOM"})(Bg||(Bg={})),(function(e){e.WEB="WEB",e.ANDROID="ANDROID",e.IOS="IOS"})(Us||(Us={}));var jg,Er;Us.WEB,Us.ANDROID,Us.IOS;(function(e){e.BASIC="BASIC",e.POST="POST"})(jg||(jg={})),(function(e){e.MD5="MD5",e.SHA256="SHA256",e.SHA384="SHA384",e.SHA512="SHA512",e.CRC32="CRC32",e.MURMUR3_32="MURMUR3_32",e.MURMUR3_128="MURMUR3_128"})(Er||(Er={}));var ja;Er.MD5,Er.SHA256,Er.SHA384,Er.SHA512,Er.CRC32,Er.MURMUR3_32,Er.MURMUR3_128;(function(e){e.FIRMWARE="FIRMWARE",e.SOFTWARE="SOFTWARE"})(ja||(ja={}));var Wg,On;ja.FIRMWARE,ja.SOFTWARE;ja.FIRMWARE,ja.SOFTWARE;(function(e){e.TB_CORE="TB_CORE",e.TB_RULE_ENGINE="TB_RULE_ENGINE",e.TB_TRANSPORT="TB_TRANSPORT",e.JS_EXECUTOR="JS_EXECUTOR"})(Wg||(Wg={})),(function(e){e.SEQUENTIAL_BY_ORIGINATOR="SEQUENTIAL_BY_ORIGINATOR",e.SEQUENTIAL_BY_TENANT="SEQUENTIAL_BY_TENANT",e.SEQUENTIAL="SEQUENTIAL",e.BURST="BURST",e.BATCH="BATCH"})(On||(On={}));var an;On.SEQUENTIAL_BY_ORIGINATOR,On.SEQUENTIAL_BY_TENANT,On.SEQUENTIAL,On.BURST,On.BATCH;(function(e){e.RETRY_FAILED_AND_TIMED_OUT="RETRY_FAILED_AND_TIMED_OUT",e.SKIP_ALL_FAILURES="SKIP_ALL_FAILURES",e.SKIP_ALL_FAILURES_AND_TIMED_OUT="SKIP_ALL_FAILURES_AND_TIMED_OUT",e.RETRY_ALL="RETRY_ALL",e.RETRY_FAILED="RETRY_FAILED",e.RETRY_TIMED_OUT="RETRY_TIMED_OUT"})(an||(an={}));var zg,Wa;an.RETRY_FAILED_AND_TIMED_OUT,an.SKIP_ALL_FAILURES,an.SKIP_ALL_FAILURES_AND_TIMED_OUT,an.RETRY_ALL,an.RETRY_FAILED,an.RETRY_TIMED_OUT;var nU="Contains",aU="Manages";(function(e){e.COMMON="COMMON",e.ALARM="ALARM",e.DASHBOARD="DASHBOARD",e.RULE_CHAIN="RULE_CHAIN",e.RULE_NODE="RULE_NODE"})(zg||(zg={})),(function(e){e.FROM="FROM",e.TO="TO"})(Wa||(Wa={}));var Ee;Wa.FROM,Wa.TO;Wa.FROM,Wa.TO;(function(e){e.QUEUED="QUEUED",e.DELIVERED="DELIVERED",e.SUCCESSFUL="SUCCESSFUL",e.TIMEOUT="TIMEOUT",e.FAILED="FAILED",e.SENT="SENT",e.EXPIRED="EXPIRED"})(Ee||(Ee={}));var Vg,Hg;Ee.QUEUED,Ee.DELIVERED,Ee.SUCCESSFUL,Ee.TIMEOUT,Ee.FAILED,Ee.SENT,Ee.EXPIRED;Ee.QUEUED,Ee.DELIVERED,Ee.SUCCESSFUL,Ee.TIMEOUT,Ee.FAILED,Ee.SENT,Ee.EXPIRED;(function(e){e.SMTP="smtp",e.SMTPS="smtps"})(Vg||(Vg={})),(function(e){e.OFFICE_365="OFFICE_365",e.CUSTOM="CUSTOM"})(Hg||(Hg={}));var Fs;(function(e){e.AWS_SNS="AWS_SNS",e.TWILIO="TWILIO",e.SMPP="SMPP"})(Fs||(Fs={}));var Bs;Fs.AWS_SNS,Fs.TWILIO,Fs.SMPP;(function(e){e.TX="TX",e.RX="RX",e.TRX="TRX"})(Bs||(Bs={}));var _r;Bs.TX,Bs.RX,Bs.TRX;(function(e){e.Unknown="Unknown",e.International="International",e.National="National",e.NetworkSpecific="NetworkSpecific",e.SubscriberNumber="SubscriberNumber",e.Alphanumeric="Alphanumeric",e.Abbreviated="Abbreviated"})(_r||(_r={}));var gi;_r.Unknown,_r.International,_r.National,_r.NetworkSpecific,_r.SubscriberNumber,_r.Alphanumeric,_r.Abbreviated;(function(e){e.Unknown="Unknown",e.ISDN="ISDN",e.DataNumberingPlan="DataNumberingPlan",e.TelexNumberingPlan="TelexNumberingPlan",e.LandMobile="LandMobile",e.NationalNumberingPlan="NationalNumberingPlan",e.PrivateNumberingPlan="PrivateNumberingPlan",e.ERMESNumberingPlan="ERMESNumberingPlan",e.Internet="Internet",e.WAPClientId="WAPClientId"})(gi||(gi={}));var Ke;gi.Unknown,gi.ISDN,gi.DataNumberingPlan,gi.TelexNumberingPlan,gi.LandMobile,gi.NationalNumberingPlan,gi.PrivateNumberingPlan,gi.ERMESNumberingPlan,gi.Internet,gi.WAPClientId;(function(e){e.SMSC="SMSC",e.IA5="IA5",e.OctetUnspecified2="OctetUnspecified2",e.Latin1="Latin1",e.OctetUnspecified4="OctetUnspecified4",e.JIS="JIS",e.Cyrillic="Cyrillic",e.LatinHebrew="LatinHebrew",e.UCS2UTF16="UCS2UTF16",e.PictogramEncoding="PictogramEncoding",e.MusicCodes="MusicCodes",e.ExtendedKanjiJIS="ExtendedKanjiJIS",e.KoreanGraphicCharacterSet="KoreanGraphicCharacterSet"})(Ke||(Ke={}));var Gl;Ke.SMSC,Ke.IA5,Ke.OctetUnspecified2,Ke.Latin1,Ke.OctetUnspecified4,Ke.JIS,Ke.Cyrillic,Ke.LatinHebrew,Ke.UCS2UTF16,Ke.PictogramEncoding,Ke.MusicCodes,Ke.ExtendedKanjiJIS,Ke.KoreanGraphicCharacterSet;(function(e){e.USERNAME_PASSWORD="USERNAME_PASSWORD",e.PRIVATE_KEY="PRIVATE_KEY"})(Gl||(Gl={}));var Yg,$l;Gl.USERNAME_PASSWORD,Gl.PRIVATE_KEY;(function(e){e.DEFAULT="DEFAULT"})(Yg||(Yg={})),(function(e){e.DISPLAY_ACTIVATION_LINK="DISPLAY_ACTIVATION_LINK",e.SEND_ACTIVATION_MAIL="SEND_ACTIVATION_MAIL"})($l||($l={}));var lh,qg;$l.DISPLAY_ACTIVATION_LINK,$l.SEND_ACTIVATION_MAIL;var BO=new RegExp("{".concat(t0,":([^{}]+)}"),"g"),E0={Sin:"return Math.round(1000*Math.sin(time/5000));",Cos:"return Math.round(1000*Math.cos(time/5000));",Random:`var value = prevValue + Math.random() * 100 - 50;
var multiplier = Math.pow(10, 2 || 0);
var value = Math.round(value * multiplier) / multiplier;
if (value < -1000) {
	value = -1000;
} else if (value > 1000) {
	value = 1000;
}
return value;`},_0=[];try{for(var Xo=kt(Object.keys(E0)),cs=Xo.next();!cs.done;cs=Xo.next()){var jO=cs.value;_0.push(jO)}}catch(e){lh={error:e}}finally{try{cs&&!cs.done&&(qg=Xo.return)&&qg.call(Xo)}finally{if(lh)throw lh.error}}var Kg=[Oi.createdTime.keyName,Oi.originator.keyName,Oi.type.keyName,Oi.severity.keyName,Oi.status.keyName],Zu=(function(){function e(t,i){this.translate=t,this.window=i,this.iframeMode=!1,this.widgetEditMode=!1,this.editWidgetInfo=null,this.defaultDataKey={name:"f(x)",type:Qt.function,label:"Sin",color:this.getMaterialColor(0),funcBody:this.getPredefinedFunctionBody("Sin"),settings:{},_hash:Math.random()},this.defaultDatasource={type:Ct.function,name:Ct.function,dataKeys:[Kt(this.defaultDataKey)]},this.defaultAlarmDataKeys=[];var r=null;try{r=i.frameElement}catch{}if(r){this.iframeMode=!0;var n=r.getAttribute("data-widget");n&&n.length&&(this.editWidgetInfo=JSON.parse(n),this.widgetEditMode=!0)}}return e.prototype.getPredefinedFunctionsList=function(){return _0},e.prototype.getPredefinedFunctionBody=function(t){return E0[t]},e.prototype.initDefaultAlarmDataKeys=function(){for(var t=0;t<Kg.length;t++){var i=Kg[t],r={name:i,type:Qt.alarm,label:this.translate.instant(Oi[i].name),color:this.getMaterialColor(t),settings:{},_hash:Math.random()};this.defaultAlarmDataKeys.push(r)}},e.prototype.getDefaultAlarmDataKeys=function(){return this.defaultAlarmDataKeys.length||this.initDefaultAlarmDataKeys(),Kt(this.defaultAlarmDataKeys)},e.prototype.processWidgetException=function(t){var i,r=this.parseException(t,-6);if(!((i=r.message)===null||i===void 0)&&i.startsWith("NG0")&&(r.message="".concat(this.translate.instant("widget.widget-template-error"),`<br/>
                       <br/><i>`).concat(this.translate.instant("dialog.error-message-title"),"</i><br/><br/>").concat(r.message)),this.widgetEditMode){var n={type:"widgetException",data:r};this.window.parent.postMessage(JSON.stringify(n),"*")}return r},e.prototype.parseException=function(t,i){return LO(t,i)},e.prototype.customTranslation=function(t,i){var r,n;if(i===void 0&&(i=t),!t||!(function(d){return typeof d=="string"})(t))return t;if(!t.includes("{".concat(t0,":")))return this.doTranslate(t,i,DD);var a=t.matchAll(BO),s=t;try{for(var o=kt(a),l=o.next();!l.done;l=o.next()){var h=$e(l.value,2),c=h[0],u=h[1];u&&(s=s.replace(c,this.doTranslate(u,c)))}}catch(d){r={error:d}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s},e.prototype.doTranslate=function(t,i,r){var n;n=r?r+t:t;var a=this.translate.instant(n);return a!==n?a+"":i},e.prototype.guid=function(){return ND()},e.prototype.getMaterialColor=function(t){var i=t%Ul.length;return Ul[i].value},e.prototype.createKey=function(t,i,r){var n;if(r===void 0&&(r=-1),i===Qt.alarm&&!t.label){var a=Oi[t.name];a&&(n=this.translate.instant(a.name))}n||(n=t.label||t.name);var s={name:t.name,type:i,label:n,funcBody:t.funcBody,settings:{},_hash:Math.random()};return t.units&&(s.units=t.units),Ye(t.decimals)&&(s.decimals=t.decimals),t.color?s.color=t.color:r>-1&&(s.color=this.getMaterialColor(r)),y0(t.postFuncBody)&&(s.usePostProcessing=!0,s.postFuncBody=t.postFuncBody),s},e.prototype.createLabelFromDatasource=function(t,i){return r0(t,i)},e.prototype.generateColors=function(t){var i=this,r=0;t.forEach(function(n){n.dataKeys.forEach(function(a){a.color||(a.color=i.getMaterialColor(r)),r++})})},e.prototype.stringToHslColor=function(t,i,r){if(t&&t.length){var n=e0(t)%360;return"hsl(".concat(n,", ").concat(i,"%, ").concat(r,"%)")}},e.prototype.currentPerfTime=function(){return this.window.performance&&this.window.performance.now?this.window.performance.now():Date.now()},e.prototype.getQueryParam=function(t,i){i===void 0&&(i=this.window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(i);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},e.prototype.removeQueryParams=function(t){var i,r,n=this.window.location.search;try{for(var a=kt(t),s=a.next();!s.done;s=a.next()){var o=s.value;n=this.updateUrlQueryString(n,o,null)}}catch(h){i={error:h}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}var l=[ah(),this.window.location.pathname].join("");this.window.history.replaceState({},"",l+n)},e.prototype.updateQueryParam=function(t,i){var r=[ah(),this.window.location.pathname].join(""),n=this.window.location.search,a=this.updateUrlQueryString(n,t,i);this.window.history.replaceState({},"",r+a)},e.prototype.updateUrlQueryString=function(t,i,r){var n="",a="";if(r!==null&&(n=i+"="+r),t){var s=new RegExp("([?&])"+i+"[^&]*");t.match(s)!==null?(n&&(n="$1"+n),(a=t.replace(s,n)).startsWith("&")&&(a="?"+a.substring(1))):n&&(a=t+"&"+n)}else n&&(a="?"+n);return a},e.prototype.baseUrl=function(){return ah()},e.prototype.deepClone=function(t,i){return Kt(t,i)},e.prototype.isUndefined=function(t){return pn(t)},e.prototype.isDefined=function(t){return Ye(t)},e.prototype.isDefinedAndNotNull=function(t){return ze(t)},e.prototype.defaultValue=function(t,i){return ze(t)?t:i},e.prototype.getEntityIdFromDatasource=function(t){return{id:t.entityId,entityType:t.entityType}},e.prototype.subscribeToEntityTelemetry=function(t,i,r,n){r===void 0&&(r=vn.LATEST_TELEMETRY),n===void 0&&(n=null),!i&&t.datasources.length>0&&(i=this.getEntityIdFromDatasource(t.datasources[0]));var a=hO.createEntityAttributesSubscription(t.telemetryWsService,i,r,t.ngZone,n);return t.telemetrySubscribers||(t.telemetrySubscribers=[]),t.telemetrySubscribers.push(a),a.subscribe(),a.attributeData$.pipe(Zv(1),_u())},e.prototype.objToBase64=function(t){return lg(t)},e.prototype.base64toString=function(t){return(function(i){return decodeURIComponent(atob(i).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""))})(t)},e.prototype.objToBase64URI=function(t){return(function(i){return encodeURIComponent(lg(i))})(t)},e.prototype.base64toObj=function(t){return(function(i){var r=decodeURIComponent(atob(i).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)})(t)},e=bi([Ti(),ie(0,re(Nt.TranslateService)),ie(1,re(Nt.Window)),wi("design:paramtypes",[lc,Object])],e)})(),Qi={},WO=Mi&&Mi.__extends||(function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])},e(t,i)};return function(t,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}})();function S0(e,t){if(Number.isFinite(e)&&Number.isFinite(t))return e-t;var i=typeof e,r=typeof t;if(i!==r)return i<r?-1:1;if(i==="object"){if(e===null)return t===null?0:-1;if(t===null)return 1;if((i=typeof(e=e.valueOf()))!=(r=typeof(t=t.valueOf())))return i<r?-1:1}return e<t?-1:e>t?1:e===t?0:Number.isNaN(e)?Number.isNaN(t)?0:-1:Number.isNaN(t)?1:Array.isArray(e)?0:Number.NaN}Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.EmptyBTree=Qi.asSet=Qi.simpleComparator=Qi.defaultComparator=void 0,Qi.defaultComparator=S0,Qi.simpleComparator=function(e,t){return e>t?1:e<t?-1:0};var $i=(function(){function e(t,i,r){this._root=ch,this._size=0,this._maxNodeSize=r>=4?Math.min(r,256):32,this._compare=i||S0,t&&this.setPairs(t)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._size===0},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this._root=ch,this._size=0},e.prototype.forEach=function(t,i){var r=this;return i!==void 0&&(t=t.bind(i)),this.forEachPair(function(n,a){return t(a,n,r)})},e.prototype.forEachPair=function(t,i){var r=this.minKey(),n=this.maxKey();return this.forRange(r,n,!0,t,i)},e.prototype.get=function(t,i){return this._root.get(t,i,this)},e.prototype.set=function(t,i,r){this._root.isShared&&(this._root=this._root.clone());var n=this._root.set(t,i,r,this);return n===!0||n===!1?n:(this._root=new VO([this._root,n]),!0)},e.prototype.has=function(t){return this.forRange(t,t,!0,void 0)!==0},e.prototype.delete=function(t){return this.editRange(t,t,!0,$g)!==0},e.prototype.with=function(t,i,r){var n=this.clone();return n.set(t,i,r)||r?n:this},e.prototype.withPairs=function(t,i){var r=this.clone();return r.setPairs(t,i)!==0||i?r:this},e.prototype.withKeys=function(t,i){for(var r=this.clone(),n=!1,a=0;a<t.length;a++)n=r.set(t[a],void 0,!1)||n;return i&&!n?this:r},e.prototype.without=function(t,i){return this.withoutRange(t,t,!0,i)},e.prototype.withoutKeys=function(t,i){var r=this.clone();return r.deleteKeys(t)||!i?r:this},e.prototype.withoutRange=function(t,i,r,n){var a=this.clone();return a.deleteRange(t,i,r)===0&&n?this:a},e.prototype.filter=function(t,i){var r,n=this.greedyClone();return n.editAll(function(a,s,o){if(!t(a,s,o))return r=x0}),!r&&i?this:n},e.prototype.mapValues=function(t){var i={},r=this.greedyClone();return r.editAll(function(n,a,s){return i.value=t(a,n,s),i}),r},e.prototype.reduce=function(t,i){for(var r,n=0,a=i,s=this.entries(this.minKey(),hs);!(r=s.next()).done;)a=t(a,r.value,n++,this);return a},e.prototype.entries=function(t,i){var r=this.findPath(t);if(r===void 0)return na();var n=r.nodequeue,a=r.nodeindex,s=r.leaf,o=i!==void 0?1:0,l=t===void 0?-1:s.indexOf(t,0,this._compare)-1;return na(function(){t:for(;;)switch(o){case 0:if(++l<s.keys.length)return{done:!1,value:[s.keys[l],s.values[l]]};o=2;continue;case 1:if(++l<s.keys.length)return i[0]=s.keys[l],i[1]=s.values[l],{done:!1,value:i};o=2;case 2:for(var h=-1;;){if(++h>=n.length){o=3;continue t}if(++a[h]<n[h].length)break}for(;h>0;h--)n[h-1]=n[h][a[h]].children,a[h-1]=0;s=n[0][a[0]],l=-1,o=i!==void 0?1:0;continue;case 3:return{done:!0,value:void 0}}})},e.prototype.entriesReversed=function(t,i,r){if(t===void 0&&(r=void 0,(t=this.maxKey())===void 0))return na();var n=this.findPath(t)||this.findPath(this.maxKey()),a=n.nodequeue,s=n.nodeindex,o=n.leaf;fi(!a[0]||o===a[0][s[0]],"wat!");var l=o.indexOf(t,0,this._compare);!r&&l<o.keys.length&&this._compare(o.keys[l],t)<=0&&l++;var h=i!==void 0?1:0;return na(function(){t:for(;;)switch(h){case 0:if(--l>=0)return{done:!1,value:[o.keys[l],o.values[l]]};h=2;continue;case 1:if(--l>=0)return i[0]=o.keys[l],i[1]=o.values[l],{done:!1,value:i};h=2;case 2:for(var c=-1;;){if(++c>=a.length){h=3;continue t}if(--s[c]>=0)break}for(;c>0;c--)a[c-1]=a[c][s[c]].children,s[c-1]=a[c-1].length-1;o=a[0][s[0]],l=o.keys.length,h=i!==void 0?1:0;continue;case 3:return{done:!0,value:void 0}}})},e.prototype.findPath=function(t){var i,r,n=this._root;if(n.isLeaf)i=Xg,r=Xg;else{i=[],r=[];for(var a=0;!n.isLeaf;a++){if(i[a]=n.children,r[a]=t===void 0?0:n.indexOf(t,0,this._compare),r[a]>=i[a].length)return;n=i[a][r[a]]}i.reverse(),r.reverse()}return{nodequeue:i,nodeindex:r,leaf:n}},e.prototype.diffAgainst=function(t,i,r,n){if(t._compare!==this._compare)throw new Error("Tree comparators are not the same.");if(this.isEmpty||t.isEmpty)return this.isEmpty&&t.isEmpty?void 0:this.isEmpty?r===void 0?void 0:e.stepToEnd(e.makeDiffCursor(t),r):i===void 0?void 0:e.stepToEnd(e.makeDiffCursor(this),i);for(var a=this._compare,s=e.makeDiffCursor(this),o=e.makeDiffCursor(t),l=!0,h=!0,c=e.compare(s,o,a);l&&h;){var u=e.compare(s,o,a),d=s.leaf,f=s.internalSpine,m=s.levelIndices,p=o.leaf,g=o.internalSpine,y=o.levelIndices;if(d||p){if(c!==0){if(u===0){if(d&&p&&n){var T=d.values[m[m.length-1]],b=p.values[y[y.length-1]];if(!Object.is(T,b)&&(I=n(s.currentKey,T,b))&&I.break)return I.break}}else if(u>0){if(p&&r){var S=p.values[y[y.length-1]];if((I=r(o.currentKey,S))&&I.break)return I.break}}else if(i&&d&&c!==0){var I;if(T=d.values[m[m.length-1]],(I=i(s.currentKey,T))&&I.break)return I.break}}}else if(!d&&!p&&u===0){var D=f.length-1,O=g.length-1,P=f[D][m[D]];if(g[O][y[O]]===P){c=0,l=e.step(s,!0),h=e.step(o,!0);continue}}c=u,u<0?l=e.step(s):h=e.step(o)}return l&&i?e.finishCursorWalk(s,o,a,i):h&&r?e.finishCursorWalk(o,s,a,r):void 0},e.finishCursorWalk=function(t,i,r,n){var a=e.compare(t,i,r);if(a===0){if(!e.step(t))return}else a<0&&fi(!1,"cursor walk terminated early");return e.stepToEnd(t,n)},e.stepToEnd=function(t,i){for(var r=!0;r;){var n=t.leaf,a=t.levelIndices,s=t.currentKey;if(n){var o=i(s,n.values[a[a.length-1]]);if(o&&o.break)return o.break}r=e.step(t)}},e.makeDiffCursor=function(t){var i=t._root;return{height:t.height,internalSpine:[[i]],levelIndices:[0],leaf:void 0,currentKey:i.maxKey()}},e.step=function(t,i){var r=t.internalSpine,n=t.levelIndices,a=t.leaf;if(i===!0||a){var s=n.length;if(i===!0||n[s-1]===0){var o=r.length;if(o===0)return!1;for(var l=o-1,h=l;h>=0;){if(n[h]>0)return h<s-1&&(t.leaf=void 0,n.pop()),h<l&&(t.internalSpine=r.slice(0,h+1)),t.currentKey=r[h][--n[h]].maxKey(),!0;h--}return!1}var c=--n[s-1];return t.currentKey=a.keys[c],!0}var u=r.length,d=u-1,f=r[d][n[d]];if(f.isLeaf)t.leaf=f,c=n[u]=f.values.length-1,t.currentKey=f.keys[c];else{var m=f.children;r[u]=m;var p=m.length-1;n[u]=p,t.currentKey=m[p].maxKey()}return!0},e.compare=function(t,i,r){var n=t.height,a=t.currentKey,s=t.levelIndices,o=i.height,l=i.currentKey,h=i.levelIndices,c=r(l,a);if(c!==0)return c;var u=n<o?n:o;return s.length-(n-u)-(h.length-(o-u))},e.prototype.keys=function(t){var i=this.entries(t,hs);return na(function(){var r=i.next();return r.value&&(r.value=r.value[0]),r})},e.prototype.values=function(t){var i=this.entries(t,hs);return na(function(){var r=i.next();return r.value&&(r.value=r.value[1]),r})},Object.defineProperty(e.prototype,"maxNodeSize",{get:function(){return this._maxNodeSize},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this._root.minKey()},e.prototype.maxKey=function(){return this._root.maxKey()},e.prototype.clone=function(){this._root.isShared=!0;var t=new e(void 0,this._compare,this._maxNodeSize);return t._root=this._root,t._size=this._size,t},e.prototype.greedyClone=function(t){var i=new e(void 0,this._compare,this._maxNodeSize);return i._root=this._root.greedyClone(t),i._size=this._size,i},e.prototype.toArray=function(t){t===void 0&&(t=2147483647);var i=this.minKey(),r=this.maxKey();return i!==void 0?this.getRange(i,r,!0,t):[]},e.prototype.keysArray=function(){var t=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,function(i,r){t.push(i)}),t},e.prototype.valuesArray=function(){var t=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,function(i,r){t.push(r)}),t},e.prototype.toString=function(){return this.toArray().toString()},e.prototype.setIfNotPresent=function(t,i){return this.set(t,i,!1)},e.prototype.nextHigherPair=function(t,i){return i=i||[],t===void 0?this._root.minPair(i):this._root.getPairOrNextHigher(t,this._compare,!1,i)},e.prototype.nextHigherKey=function(t){var i=this.nextHigherPair(t,hs);return i&&i[0]},e.prototype.nextLowerPair=function(t,i){return i=i||[],t===void 0?this._root.maxPair(i):this._root.getPairOrNextLower(t,this._compare,!1,i)},e.prototype.nextLowerKey=function(t){var i=this.nextLowerPair(t,hs);return i&&i[0]},e.prototype.getPairOrNextLower=function(t,i){return this._root.getPairOrNextLower(t,this._compare,!0,i||[])},e.prototype.getPairOrNextHigher=function(t,i){return this._root.getPairOrNextHigher(t,this._compare,!0,i||[])},e.prototype.changeIfPresent=function(t,i){return this.editRange(t,t,!0,function(r,n){return{value:i}})!==0},e.prototype.getRange=function(t,i,r,n){n===void 0&&(n=67108863);var a=[];return this._root.forRange(t,i,r,!1,this,0,function(s,o){return a.push([s,o]),a.length>n?HO:void 0}),a},e.prototype.setPairs=function(t,i){for(var r=0,n=0;n<t.length;n++)this.set(t[n][0],t[n][1],i)&&r++;return r},e.prototype.forRange=function(t,i,r,n,a){var s=this._root.forRange(t,i,r,!1,this,a||0,n);return typeof s=="number"?s:s.break},e.prototype.editRange=function(t,i,r,n,a){var s=this._root;s.isShared&&(this._root=s=s.clone());try{var o=s.forRange(t,i,r,!0,this,a||0,n);return typeof o=="number"?o:o.break}finally{for(var l=void 0;s.keys.length<=1&&!s.isLeaf;)l||(l=s.isShared),this._root=s=s.keys.length===0?ch:s.children[0];l&&(s.isShared=!0)}},e.prototype.editAll=function(t,i){return this.editRange(this.minKey(),this.maxKey(),!0,t,i)},e.prototype.deleteRange=function(t,i,r){return this.editRange(t,i,r,$g)},e.prototype.deleteKeys=function(t){for(var i=0,r=0;i<t.length;i++)this.delete(t[i])&&r++;return r},Object.defineProperty(e.prototype,"height",{get:function(){for(var t=this._root,i=-1;t;)i++,t=t.isLeaf?void 0:t.children[0];return i},enumerable:!1,configurable:!0}),e.prototype.freeze=function(){var t=this;t.clear=t.set=t.editRange=function(){throw new Error("Attempted to modify a frozen BTree")}},e.prototype.unfreeze=function(){delete this.clear,delete this.set,delete this.editRange},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.hasOwnProperty("editRange")},enumerable:!1,configurable:!0}),e.prototype.checkValid=function(){var t=this._root.checkValid(0,this,0);fi(t===this.size,"size mismatch: counted ",t,"but stored",this.size)},e})(),zO=Qi.default=$i;function na(e){e===void 0&&(e=function(){return{done:!0,value:void 0}});var t={next:e};return Symbol&&Symbol.iterator&&(t[Symbol.iterator]=function(){return this}),t}Qi.asSet=function(e){return e},Symbol&&Symbol.iterator&&($i.prototype[Symbol.iterator]=$i.prototype.entries),$i.prototype.where=$i.prototype.filter,$i.prototype.setRange=$i.prototype.setPairs,$i.prototype.add=$i.prototype.set;var Gg,A0=(function(){function e(t,i){t===void 0&&(t=[]),this.keys=t,this.values=i||Ue,this.isShared=void 0}return Object.defineProperty(e.prototype,"isLeaf",{get:function(){return this.children===void 0},enumerable:!1,configurable:!0}),e.prototype.maxKey=function(){return this.keys[this.keys.length-1]},e.prototype.indexOf=function(t,i,r){for(var n=this.keys,a=0,s=n.length,o=s>>1;a<s;){var l=r(n[o],t);if(l<0)a=o+1;else{if(!(l>0)){if(l===0)return o;if(t==t)return n.length;throw new Error("BTree: NaN was used as a key")}s=o}o=a+s>>1}return o^i},e.prototype.minKey=function(){return this.keys[0]},e.prototype.minPair=function(t){if(this.keys.length!==0)return t[0]=this.keys[0],t[1]=this.values[0],t},e.prototype.maxPair=function(t){if(this.keys.length!==0){var i=this.keys.length-1;return t[0]=this.keys[i],t[1]=this.values[i],t}},e.prototype.clone=function(){var t=this.values;return new e(this.keys.slice(0),t===Ue?t:t.slice(0))},e.prototype.greedyClone=function(t){return this.isShared&&!t?this:this.clone()},e.prototype.get=function(t,i,r){var n=this.indexOf(t,-1,r._compare);return n<0?i:this.values[n]},e.prototype.getPairOrNextLower=function(t,i,r,n){var a=this.indexOf(t,-1,i),s=a<0?~a-1:r?a:a-1;if(s>=0)return n[0]=this.keys[s],n[1]=this.values[s],n},e.prototype.getPairOrNextHigher=function(t,i,r,n){var a=this.indexOf(t,-1,i),s=a<0?~a:r?a:a+1,o=this.keys;if(s<o.length)return n[0]=o[s],n[1]=this.values[s],n},e.prototype.checkValid=function(t,i,r){var n=this.keys.length,a=this.values.length;return fi(this.values===Ue?n<=a:n===a,"keys/values length mismatch: depth",t,"with lengths",n,a,"and baseIndex",r),fi(t==0||n>0,"empty leaf at depth",t,"and baseIndex",r),n},e.prototype.set=function(t,i,r,n){var a=this.indexOf(t,-1,n._compare);if(a<0){if(a=~a,n._size++,this.keys.length<n._maxNodeSize)return this.insertInLeaf(a,t,i,n);var s=this.splitOffRightSide(),o=this;return a>this.keys.length&&(a-=this.keys.length,o=s),o.insertInLeaf(a,t,i,n),s}return r!==!1&&(i!==void 0&&this.reifyValues(),this.keys[a]=t,this.values[a]=i),!1},e.prototype.reifyValues=function(){return this.values===Ue?this.values=this.values.slice(0,this.keys.length):this.values},e.prototype.insertInLeaf=function(t,i,r,n){if(this.keys.splice(t,0,i),this.values===Ue){for(;Ue.length<n._maxNodeSize;)Ue.push(void 0);if(r===void 0)return!0;this.values=Ue.slice(0,this.keys.length-1)}return this.values.splice(t,0,r),!0},e.prototype.takeFromRight=function(t){var i=this.values;t.values===Ue?i!==Ue&&i.push(void 0):(i=this.reifyValues()).push(t.values.shift()),this.keys.push(t.keys.shift())},e.prototype.takeFromLeft=function(t){var i=this.values;t.values===Ue?i!==Ue&&i.unshift(void 0):(i=this.reifyValues()).unshift(t.values.pop()),this.keys.unshift(t.keys.pop())},e.prototype.splitOffRightSide=function(){var t=this.keys.length>>1;return new e(this.keys.splice(t),this.values===Ue?Ue:this.values.splice(t))},e.prototype.forRange=function(t,i,r,n,a,s,o){var l,h,c=a._compare;if(i===t){if(!r||(h=(l=this.indexOf(t,-1,c))+1,l<0))return s}else l=this.indexOf(t,0,c),(h=this.indexOf(i,-1,c))<0?h=~h:r===!0&&h++;var u=this.keys,d=this.values;if(o!==void 0)for(var f=l;f<h;f++){var m=u[f],p=o(m,d[f],s++);if(p!==void 0){if(n===!0){if(m!==u[f]||this.isShared===!0)throw new Error("BTree illegally changed or cloned in editRange");p.delete?(this.keys.splice(f,1),this.values!==Ue&&this.values.splice(f,1),a._size--,f--,h--):p.hasOwnProperty("value")&&(d[f]=p.value)}if(p.break!==void 0)return p}}else s+=h-l;return s},e.prototype.mergeSibling=function(t,i){if(this.keys.push.apply(this.keys,t.keys),this.values===Ue){if(t.values===Ue)return;this.values=this.values.slice(0,this.keys.length)}this.values.push.apply(this.values,t.reifyValues())},e})(),VO=(function(e){function t(i,r){var n=this;if(!r){r=[];for(var a=0;a<i.length;a++)r[a]=i[a].maxKey()}return(n=e.call(this,r)||this).children=i,n}return WO(t,e),t.prototype.clone=function(){for(var i=this.children.slice(0),r=0;r<i.length;r++)i[r].isShared=!0;return new t(i,this.keys.slice(0))},t.prototype.greedyClone=function(i){if(this.isShared&&!i)return this;for(var r=new t(this.children.slice(0),this.keys.slice(0)),n=0;n<r.children.length;n++)r.children[n]=r.children[n].greedyClone(i);return r},t.prototype.minKey=function(){return this.children[0].minKey()},t.prototype.minPair=function(i){return this.children[0].minPair(i)},t.prototype.maxPair=function(i){return this.children[this.children.length-1].maxPair(i)},t.prototype.get=function(i,r,n){var a=this.indexOf(i,0,n._compare),s=this.children;return a<s.length?s[a].get(i,r,n):void 0},t.prototype.getPairOrNextLower=function(i,r,n,a){var s=this.indexOf(i,0,r),o=this.children;if(s>=o.length)return this.maxPair(a);var l=o[s].getPairOrNextLower(i,r,n,a);return l===void 0&&s>0?o[s-1].maxPair(a):l},t.prototype.getPairOrNextHigher=function(i,r,n,a){var s=this.indexOf(i,0,r),o=this.children,l=o.length;if(!(s>=l)){var h=o[s].getPairOrNextHigher(i,r,n,a);return h===void 0&&s<l-1?o[s+1].minPair(a):h}},t.prototype.checkValid=function(i,r,n){var a=this.keys.length,s=this.children.length;fi(a===s,"keys/children length mismatch: depth",i,"lengths",a,s,"baseIndex",n),fi(a>1||i>0,"internal node has length",a,"at depth",i,"baseIndex",n);for(var o=0,l=this.children,h=this.keys,c=0,u=0;u<s;u++)fi((o+=l[u].checkValid(i+1,r,n+o))>=(c+=l[u].keys.length),"wtf",n),fi(u===0||l[u-1].constructor===l[u].constructor,"type mismatch, baseIndex:",n),l[u].maxKey()!=h[u]&&fi(!1,"keys[",u,"] =",h[u],"is wrong, should be ",l[u].maxKey(),"at depth",i,"baseIndex",n),u===0||r._compare(h[u-1],h[u])<0||fi(!1,"sort violation at depth",i,"index",u,"keys",h[u-1],h[u]);var d=c===0;return(d||c>r.maxNodeSize*s)&&fi(!1,d?"too few":"too many","children (",c,o,") at depth",i,"maxNodeSize:",r.maxNodeSize,"children.length:",s,"baseIndex:",n),o},t.prototype.set=function(i,r,n,a){var s,o=this.children,l=a._maxNodeSize,h=a._compare,c=Math.min(this.indexOf(i,0,h),o.length-1),u=o[c];u.isShared&&(o[c]=u=u.clone()),u.keys.length>=l&&(c>0&&(s=o[c-1]).keys.length<l&&h(u.keys[0],i)<0?(s.isShared&&(o[c-1]=s=s.clone()),s.takeFromRight(u),this.keys[c-1]=s.maxKey()):(s=o[c+1])!==void 0&&s.keys.length<l&&h(u.maxKey(),i)<0&&(s.isShared&&(o[c+1]=s=s.clone()),s.takeFromLeft(u),this.keys[c]=o[c].maxKey()));var d=u.set(i,r,n,a);if(d===!1)return!1;if(this.keys[c]=u.maxKey(),d===!0)return!0;if(this.keys.length<l)return this.insert(c+1,d),!0;var f=this.splitOffRightSide(),m=this;return h(d.maxKey(),this.maxKey())>0&&(m=f,c-=this.keys.length),m.insert(c+1,d),f},t.prototype.insert=function(i,r){this.children.splice(i,0,r),this.keys.splice(i,0,r.maxKey())},t.prototype.splitOffRightSide=function(){var i=this.children.length>>1;return new t(this.children.splice(i),this.keys.splice(i))},t.prototype.takeFromRight=function(i){this.keys.push(i.keys.shift()),this.children.push(i.children.shift())},t.prototype.takeFromLeft=function(i){this.keys.unshift(i.keys.pop()),this.children.unshift(i.children.pop())},t.prototype.forRange=function(i,r,n,a,s,o,l){var h=s._compare,c=this.keys,u=this.children,d=this.indexOf(i,0,h),f=d,m=Math.min(r===i?d:this.indexOf(r,0,h),c.length-1);if(a){if(f<=m)try{for(;f<=m;f++){if(u[f].isShared&&(u[f]=u[f].clone()),g=u[f].forRange(i,r,n,a,s,o,l),c[f]=u[f].maxKey(),typeof g!="number")return g;o=g}}finally{var p=s._maxNodeSize>>1;for(d>0&&d--,f=m;f>=d;f--)u[f].keys.length<=p&&(u[f].keys.length!==0?this.tryMerge(f,s._maxNodeSize):(c.splice(f,1),u.splice(f,1)));u.length!==0&&u[0].keys.length===0&&fi(!1,"emptiness bug")}}else for(;f<=m;f++){var g;if(typeof(g=u[f].forRange(i,r,n,a,s,o,l))!="number")return g;o=g}return o},t.prototype.tryMerge=function(i,r){var n=this.children;return i>=0&&i+1<n.length&&n[i].keys.length+n[i+1].keys.length<=r&&(n[i].isShared&&(n[i]=n[i].clone()),n[i].mergeSibling(n[i+1],r),n.splice(i+1,1),this.keys.splice(i+1,1),this.keys[i]=n[i].maxKey(),!0)},t.prototype.mergeSibling=function(i,r){var n=this.keys.length;this.keys.push.apply(this.keys,i.keys);var a=i.children;if(this.children.push.apply(this.children,a),i.isShared&&!this.isShared)for(var s=0;s<a.length;s++)a[s].isShared=!0;this.tryMerge(n-1,r)},t})(A0),Ue=[],x0={delete:!0},$g=function(){return x0},HO={break:!0},ch=((Gg=new A0).isShared=!0,Gg),Xg=[],hs=[];function fi(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(!e)throw t.unshift("B+ tree"),new Error(t.join(" "))}Qi.EmptyBTree=(function(){var e=new $i;return e.freeze(),e})();var Or,Qg=(function(){function e(t,i,r){this.subsTw=t,this.endTs=i,this.aggType=r,this.map=new zO,this.reusePair=[void 0,void 0]}return e.prototype.set=function(t,i){this.map.set(t,i)},e.prototype.get=function(t){return this.map.get(t)},e.prototype.delete=function(t){this.map.delete(t)},e.prototype.findDataForTs=function(t){t>=this.endTs&&this.updateLastInterval(t+1);var i=this.map.getPairOrNextLower(t,this.reusePair);if(i){var r=i[1];if(t<r.interval[1])return r}},e.prototype.calculateAggInterval=function(t){return ig(this.subsTw,this.endTs,t,this.aggType)},e.prototype.updateLastInterval=function(t){if(t>this.endTs){this.endTs=t;var i=this.map.maxKey();if(i){var r=this.map.get(i),n=ig(this.subsTw,t,r.ts,this.aggType);r.interval=n,r.ts=n[0]+Math.floor((n[1]-n[0])/2)}}},e.prototype.forEach=function(t,i){this.map.forEach(t,i)},e.prototype.size=function(){return this.map.size},e})(),Jg=function(){this.aggMap={}},Zg=function(e,t){e.count++,fo(t)?(e.sum=e.aggValue*(e.count-1)+t,e.aggValue=e.sum/e.count):e.aggValue=t},YO=function(e,t){fo(t)?e.aggValue=Math.min(e.aggValue,t):e.aggValue=t},qO=function(e,t){fo(t)?e.aggValue=Math.max(e.aggValue,t):e.aggValue=t},KO=function(e,t){fo(t)?e.aggValue=e.aggValue+t:e.aggValue=t},GO=function(e){e.count++,e.aggValue=e.count},$O=function(e,t){e.aggValue=t},tp=Math.pow(2,31)-1,XO=(function(){function e(t,i,r,n,a,s){var o=this;this.onDataCb=t,this.tsKeys=i,this.isLatestDataAgg=r,this.subsTw=n,this.utils=a,this.ignoreDataUpdateOnIntervalTick=s,this.dataBuffer=[],this.dataReceived=!1,this.resetPending=!1,this.updatedData=!1,this.aggregationTimeout=this.isLatestDataAgg?1e3:Math.max(Ar.numberValue(this.subsTw.aggregation.interval),1e3),this.tsKeys.forEach(function(l){o.dataBuffer[l.id]||(o.dataBuffer[l.id]=[])}),this.subsTw.aggregation.stateData&&(this.lastPrevKvPairData={})}return e.convertValue=function(t,i){return t&&dn(t)&&(!i||i&&Number(t).toString()===t)?Number(t):t},e.getAggFunction=function(t){switch(t){case Lt.MIN:return YO;case Lt.MAX:return qO;case Lt.AVG:return Zg;case Lt.SUM:return KO;case Lt.COUNT:return GO;case Lt.NONE:return $O;default:return Zg}},e.prototype.updateOnDataCb=function(t){var i=this.onDataCb;return this.onDataCb=t,i},e.prototype.reset=function(t){this.intervalTimeoutHandle&&(clearTimeout(this.intervalTimeoutHandle),this.intervalTimeoutHandle=null),this.subsTw=t,this.intervalScheduledTime=Ho(),this.calculateStartEndTs(),this.elapsed=0,this.aggregationTimeout=this.isLatestDataAgg?1e3:Math.max(Ar.numberValue(this.subsTw.aggregation.interval),1e3),this.resetPending=!0,this.updatedData=!1,this.intervalTimeoutHandle=setTimeout(this.onInterval.bind(this),Math.min(this.aggregationTimeout,tp))},e.prototype.destroy=function(){this.intervalTimeoutHandle&&(clearTimeout(this.intervalTimeoutHandle),this.intervalTimeoutHandle=null),this.aggregationMap=null},e.prototype.onData=function(t,i,r,n){if(this.updatedData=!0,!this.dataReceived||this.resetPending){var a=!0;this.dataReceived||(this.elapsed=0,this.dataReceived=!0,this.calculateStartEndTs()),this.resetPending&&(this.resetPending=!1,a=!1),i?(this.aggregationMap=new Jg,this.updateAggregatedData(t)):this.aggregationMap=this.processAggregatedData(t),a&&(this.intervalScheduledTime=Ho()),this.onInterval(r,n)}else this.updateAggregatedData(t),r?(this.intervalScheduledTime=Ho(),this.onInterval(r,n)):this.onInterval(!1,n,!0)},e.prototype.calculateStartEndTs=function(){if(this.startTs=this.subsTw.startTs+this.subsTw.tsOffset,this.subsTw.quickInterval)if(this.subsTw.timeForComparison==="previousInterval"){var t=Ba(this.subsTw.startTs,this.subsTw.timezone),i=Ci(this.subsTw.timezone);this.endTs=Jy(this.subsTw.quickInterval,t,i)+this.subsTw.tsOffset}else t=Ba(this.subsTw.startTs,this.subsTw.timezone),this.endTs=Xu(this.subsTw.quickInterval,t,this.subsTw.timezone)+this.subsTw.tsOffset;else this.endTs=this.startTs+this.subsTw.aggregation.timeWindow},e.prototype.onInterval=function(t,i,r){var n=Ho();this.elapsed+=n-this.intervalScheduledTime,this.intervalScheduledTime=n,this.intervalTimeoutHandle&&(clearTimeout(this.intervalTimeoutHandle),this.intervalTimeoutHandle=null);var a=r?this.aggregationTimeout-this.elapsed:this.aggregationTimeout;if(t)this.data=this.updateData();else{var s=Math.floor(this.elapsed/this.aggregationTimeout);if(s||!this.data||r){var o=s*this.aggregationTimeout;if(this.subsTw.quickInterval){var l=Qu(this.subsTw.quickInterval,this.subsTw.timezone);this.startTs=l[0]+this.subsTw.tsOffset,this.endTs=l[1]+this.subsTw.tsOffset}else this.startTs+=o,this.endTs+=o;this.subsTw.aggregation.type!==Lt.NONE&&this.updateLastInterval(),this.data=this.updateData(),this.elapsed=this.elapsed-s*this.aggregationTimeout}}!this.onDataCb||this.ignoreDataUpdateOnIntervalTick&&!this.updatedData||(this.onDataCb(this.data,i),this.updatedData=!1),t||(this.intervalTimeoutHandle=setTimeout(this.onInterval.bind(this),Math.min(a,tp)))},e.prototype.updateData=function(){var t,i,r=this;this.dataBuffer=[],this.tsKeys.forEach(function(l){r.dataBuffer[l.id]||(r.dataBuffer[l.id]=[])});var n=function(l){var h=Number(l),c=a.aggregationMap.aggMap[h],u=a.aggKeyById(h).agg===Lt.NONE,d=a.dataBuffer[h],f=[];c.forEach(function(m,p){if(p<r.startTs)r.subsTw.aggregation.stateData&&(!r.lastPrevKvPairData[h]||r.lastPrevKvPairData[h][0]<m.ts)&&(r.lastPrevKvPairData[h]=[m.ts,m.aggValue,m.interval]),f.push(p),r.updatedData=!0;else if(m.ts<r.endTs||u){var g=[m.ts,m.aggValue,m.interval];d.push(g)}}),f.forEach(function(m){return c.delete(m)}),d.sort(function(m,p){return m[0]-p[0]}),a.subsTw.aggregation.stateData&&a.updateStateBounds(d,Kt(a.lastPrevKvPairData[h])),d.length>a.subsTw.aggregation.limit&&(d=d.slice(d.length-a.subsTw.aggregation.limit)),a.dataBuffer[h]=d},a=this;try{for(var s=kt(Object.keys(this.aggregationMap.aggMap)),o=s.next();!o.done;o=s.next())n(o.value)}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return this.dataBuffer},e.prototype.updateStateBounds=function(t,i){var r;if(i&&(i[0]=this.startTs,i[2]=[this.startTs,this.startTs]),t.length?r=t[0]:i&&(r=i,t.push(r)),r&&r[0]>this.startTs&&i&&t.unshift(i),t.length){var n=t[t.length-1];n[0]<this.endTs&&((n=Kt(n))[0]=this.endTs,n[2]=[this.endTs,this.endTs],t.push(n))}},e.prototype.processAggregatedData=function(t){var i,r,n=new Jg,a=function(h){var c=Number(h),u=s.aggKeyById(c).agg,d=u===Lt.COUNT,f=u===Lt.NONE,m=n.aggMap[c];m||(m=new Qg(s.subsTw,s.endTs,u),n.aggMap[c]=m),t[c].forEach(function(p){var g=p[0],y=e.convertValue(p[1],f),T=[g,g];f||(T=m.calculateAggInterval(g));var b=T[0]+Math.floor((T[1]-T[0])/2),S={count:d?y:ze(p[2])?p[2]:1,sum:y,aggValue:y,ts:b,interval:T};m.set(T[0],S)})},s=this;try{for(var o=kt(Object.keys(t)),l=o.next();!l.done;l=o.next())a(l.value)}catch(h){i={error:h}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return n},e.prototype.updateAggregatedData=function(t){var i,r,n=function(l){var h=Number(l),c=a.aggKeyById(h).agg,u=c===Lt.COUNT,d=c===Lt.NONE,f=a.aggregationMap.aggMap[h];f||(f=new Qg(a.subsTw,a.endTs,c),a.aggregationMap.aggMap[h]=f),t[h].forEach(function(m){var p=m[0],g=e.convertValue(m[1],d),y=f.findDataForTs(p);if(y)e.getAggFunction(c)(y,g);else{var T=[p,p];d||(T=f.calculateAggInterval(p));var b=T[0]+Math.floor((T[1]-T[0])/2);y={count:ze(m[2])?m[2]:1,sum:g,aggValue:u?1:g,ts:b,interval:T},f.set(T[0],y)}})},a=this;try{for(var s=kt(Object.keys(t)),o=s.next();!o.done;o=s.next())n(o.value)}catch(l){i={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}},e.prototype.updateLastInterval=function(){var t,i;try{for(var r=kt(Object.keys(this.aggregationMap.aggMap)),n=r.next();!n.done;n=r.next()){var a=n.value,s=Number(a);this.aggregationMap.aggMap[s].updateLastInterval(this.endTs)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.aggKeyById=function(t){return this.tsKeys.find(function(i){return i.id===t})},e})(),ep=(function(){function e(t,i,r){this.listener=t,this.telemetryService=i,this.utils=r,this.entityDataSubscriptionOptions=this.listener.subscriptionOptions,this.datasourceType=this.entityDataSubscriptionOptions.datasourceType,this.dataKeys={},this.dataKeysList=[],this.tickScheduledTime=0,this.tickElapsed=0,this.dataResolved=!1,this.started=!1}return e.convertValue=function(t){return t&&dn(t)&&Number(t).toString()===t?Number(t):t},e.calculateComparisonValue=function(t,i){var r,n;switch(t.comparisonResultType){case tr.PREVIOUS_VALUE:r=i.previous.ts,n=i.previous.value;break;case tr.DELTA_ABSOLUTE:case tr.DELTA_PERCENT:r=i.previous.ts;var a=e.convertValue(i.current.value),s=e.convertValue(i.previous.value);n=dn(a)&&dn(s)?t.comparisonResultType===tr.DELTA_ABSOLUTE?a-s:s===0?100:(a-s)/s*100:""}return[[r,n]]},e.prototype.initializeSubscription=function(){return t1(this,void 0,void 0,function(){var t,i,r,n,a;return e1(this,function(s){for(t=0;t<this.entityDataSubscriptionOptions.dataKeys.length;t++)i=Kt(this.entityDataSubscriptionOptions.dataKeys[t]),this.dataKeysList.push(i),i.index=t,this.datasourceType===Ct.function?i.func:y0(i.postFuncBody)&&i.postFunc,r=void 0,this.datasourceType===Ct.entity||this.datasourceType===Ct.entityCount||this.datasourceType===Ct.alarmCount||this.entityDataSubscriptionOptions.type===bt.timeseries?(this.datasourceType===Ct.function?r="".concat(i.name,"_").concat(i.index,"_").concat(i.type).concat(i.latest?"_latest":""):(n=i.aggregationType&&i.aggregationType!==Lt.NONE?"_".concat(i.index):"",r="".concat(i.name,"_").concat(i.type).concat(n).concat(i.latest?"_latest":"")),(a=this.dataKeys[r])||(a=[],this.dataKeys[r]=a),a.push(i),i.listIndex=a.length-1):(r=String(PD(i)),this.dataKeys[r]=i),i.key=r;return[2]})})},e.prototype.unsubscribe=function(){this.subscribeSubscription&&(this.subscribeSubscription.unsubscribe(),this.subscribeSubscription=null),this.timeseriesTimer&&(clearTimeout(this.timeseriesTimer),this.timeseriesTimer=null),this.latestTimer&&(clearTimeout(this.latestTimer),this.latestTimer=null),this.datasourceType!==Ct.entity&&this.datasourceType!==Ct.entityCount&&this.datasourceType!==Ct.alarmCount||this.subscriber&&(this.subscriber.unsubscribe(),this.subscriber=null),this.tsLatestDataAggregators&&(this.tsLatestDataAggregators.forEach(function(t){t.destroy()}),this.tsLatestDataAggregators=null),this.pageData=null},e.prototype.subscribe=function(){var t=this;this.entityDataResolveSubject=new be(1);var i=new be(1);return this.subscribeSubscription=xn(this.initializeSubscription()).pipe(Jv(function(){i.next(),i.complete()})).subscribe(function(){if(t.entityDataSubscriptionOptions.isPaginatedDataSubscription&&(t.started=!0,t.dataResolved=!0,t.prepareSubscriptionTimewindow()),t.datasourceType===Ct.entity){var r=t.dataKeysList.filter(function(g){return g.type===Qt.entityField}).map(function(g){return{type:Pt.ENTITY_FIELD,key:g.name}});if(r.find(function(g){return g.key==="name"})||r.push({type:Pt.ENTITY_FIELD,key:"name"}),r.find(function(g){return g.key==="label"})||r.push({type:Pt.ENTITY_FIELD,key:"label"}),r.find(function(g){return g.key==="additionalInfo"})||r.push({type:Pt.ENTITY_FIELD,key:"additionalInfo"}),t.attrFields=t.dataKeysList.filter(function(g){return g.type===Qt.attribute}).map(function(g){return{type:Pt.ATTRIBUTE,key:g.name}}),t.tsFields=t.dataKeysList.filter(function(g){return!(g.type!==Qt.timeseries||g.aggregationType&&g.aggregationType!==Lt.NONE||g.latest)}).map(function(g){return{type:Pt.TIME_SERIES,key:g.name}}),t.entityDataSubscriptionOptions.type===bt.timeseries){var n=t.dataKeysList.filter(function(g){return g.type===Qt.timeseries&&g.latest&&(!g.aggregationType||g.aggregationType===Lt.NONE)}).map(function(g){return{type:Pt.TIME_SERIES,key:g.name}});t.latestValues=t.attrFields.concat(n)}else t.latestValues=t.attrFields.concat(t.tsFields);t.aggTsValues=t.dataKeysList.filter(function(g){return g.type===Qt.timeseries&&g.aggregationType&&g.aggregationType!==Lt.NONE&&!g.comparisonEnabled}).map(function(g){return{id:g.index,key:g.name,agg:g.aggregationType}}),t.aggTsComparisonValues=t.dataKeysList.filter(function(g){return g.type===Qt.timeseries&&g.aggregationType&&g.aggregationType!==Lt.NONE&&g.comparisonEnabled}).map(function(g){return{id:g.index,key:g.name,agg:g.aggregationType,previousValueOnly:g.comparisonResultType===tr.PREVIOUS_VALUE}}),t.subscriber=new fn(t.telemetryService),t.dataCommand=new qs;var a=t.entityDataSubscriptionOptions.keyFilters;t.entityDataSubscriptionOptions.additionalKeyFilters&&(a=a?a.concat(t.entityDataSubscriptionOptions.additionalKeyFilters):t.entityDataSubscriptionOptions.additionalKeyFilters),t.dataCommand.query={entityFilter:t.entityDataSubscriptionOptions.entityFilter,pageLink:t.entityDataSubscriptionOptions.pageLink,keyFilters:a,entityFields:r,latestValues:t.latestValues},t.entityDataSubscriptionOptions.isPaginatedDataSubscription&&(t.prepareSubscriptionCommands(t.dataCommand),t.entityDataSubscriptionOptions.type===bt.timeseries?t.subscriber.setTsOffset(t.subsTw.tsOffset):t.subscriber.setTsOffset(t.latestTsOffset)),t.subscriber.subscriptionCommands.push(t.dataCommand),t.subscriber.entityData$.subscribe(function(g){var y,T;if(g.data){if(t.onPageData(g.data),t.prematureUpdates){try{for(var b=kt(t.prematureUpdates),S=b.next();!S.done;S=b.next()){var I=S.value;t.onDataUpdate(I)}}catch(D){y={error:D}}finally{try{S&&!S.done&&(T=b.return)&&T.call(b)}finally{if(y)throw y.error}}t.prematureUpdates=null}}else g.update&&(t.pageData?t.onDataUpdate(g.update):(t.prematureUpdates||(t.prematureUpdates=[]),t.prematureUpdates.push(g.update)))}),t.subscriber.reconnect$.subscribe(function(){if(t.started){var g=t.entityDataSubscriptionOptions.isPaginatedDataSubscription?t.dataCommand:t.subsCommand;if(!t.history&&(t.entityDataSubscriptionOptions.type===bt.timeseries&&t.tsFields.length||t.aggTsValues.length>0&&!t.isFloatingTimewindow)){var y=t.listener.updateRealtimeSubscription();t.subsTw=y,t.entityDataSubscriptionOptions.type===bt.timeseries&&t.tsFields.length&&(g.tsCmd.startTs=t.subsTw.startTs,g.tsCmd.timeWindow=t.subsTw.aggregation.timeWindow,typeof t.subsTw.aggregation.interval=="number"?(g.tsCmd.interval=t.subsTw.aggregation.interval,g.tsCmd.intervalType=xs.MILLISECONDS):g.tsCmd.intervalType=t.subsTw.aggregation.interval,g.tsCmd.timeZoneId=t.subsTw.timezone,g.tsCmd.limit=t.subsTw.aggregation.limit,g.tsCmd.agg=t.subsTw.aggregation.type,g.tsCmd.fetchLatestPreviousPoint=t.subsTw.aggregation.stateData,t.dataAggregators.forEach(function(T){T.reset(y)})),t.aggTsValues.length>0&&!t.isFloatingTimewindow&&(g.aggTsCmd.startTs=t.subsTw.startTs,g.aggTsCmd.timeWindow=t.subsTw.aggregation.timeWindow,t.tsLatestDataAggregators.forEach(function(T){T.reset(y)}))}t.entityDataSubscriptionOptions.type===bt.timeseries?t.subscriber.setTsOffset(t.subsTw.tsOffset):t.subscriber.setTsOffset(t.latestTsOffset),g.query=t.dataCommand.query,t.subscriber.subscriptionCommands=[g]}else t.subscriber.subscriptionCommands=[t.dataCommand]}),t.subscriber.subscribe()}else if(t.datasourceType===Ct.function){var s=0;t.entityDataSubscriptionOptions.type===bt.latest?s=t.entityDataSubscriptionOptions.latestTsOffset:t.entityDataSubscriptionOptions.subscriptionTimewindow&&(s=t.entityDataSubscriptionOptions.subscriptionTimewindow.tsOffset);var o={entityId:{id:Ln,entityType:wt.DEVICE},timeseries:{},latest:{}},l=Ct.function;o.latest[Pt.ENTITY_FIELD]={name:{ts:Date.now()+s,value:l}};var h={data:[o],hasNext:!1,totalElements:1,totalPages:1};t.onPageData(h)}else if(t.datasourceType===Ct.entityCount){t.latestTsOffset=t.entityDataSubscriptionOptions.latestTsOffset,t.subscriber=new fn(t.telemetryService),t.subscriber.setTsOffset(t.latestTsOffset),t.countCommand=new o0,a=t.entityDataSubscriptionOptions.keyFilters,t.entityDataSubscriptionOptions.additionalKeyFilters&&(a=a?a.concat(t.entityDataSubscriptionOptions.additionalKeyFilters):t.entityDataSubscriptionOptions.additionalKeyFilters),t.countCommand.query={entityFilter:t.entityDataSubscriptionOptions.entityFilter,keyFilters:a},t.subscriber.subscriptionCommands.push(t.countCommand);var c={id:Ln,entityType:null},u=t.dataKeysList[0],d=!1;t.subscriber.entityCount$.subscribe(function(g){var y,T,b,S;if(d){var I=[{entityId:c,latest:(b={},b[Pt.COUNT]=(S={},S[u.name]={ts:Date.now()+t.latestTsOffset,value:g.count+""},S),b),timeseries:{}}];t.onDataUpdate(I)}else{var D={data:[{entityId:c,latest:(y={},y[Pt.ENTITY_FIELD]={name:{ts:Date.now()+t.latestTsOffset,value:Ct.entityCount}},y[Pt.COUNT]=(T={},T[u.name]={ts:Date.now()+t.latestTsOffset,value:g.count+""},T),y),timeseries:{}}],hasNext:!1,totalElements:1,totalPages:1};t.onPageData(D),d=!0}}),t.subscriber.subscribe()}else if(t.datasourceType===Ct.alarmCount){t.latestTsOffset=t.entityDataSubscriptionOptions.latestTsOffset,t.subscriber=new fn(t.telemetryService),t.subscriber.setTsOffset(t.latestTsOffset),t.alarmCountCommand=new c0,a=t.entityDataSubscriptionOptions.keyFilters,t.entityDataSubscriptionOptions.additionalKeyFilters&&(a=a?a.concat(t.entityDataSubscriptionOptions.additionalKeyFilters):t.entityDataSubscriptionOptions.additionalKeyFilters),t.alarmCountCommand.query={entityFilter:t.entityDataSubscriptionOptions.entityFilter,keyFilters:a},t.entityDataSubscriptionOptions.alarmFilter&&(t.alarmCountCommand.query=lr(lr({},t.alarmCountCommand.query),t.entityDataSubscriptionOptions.alarmFilter)),t.subscriber.subscriptionCommands.push(t.alarmCountCommand);var f={id:Ln,entityType:null},m=t.dataKeysList[0],p=!1;t.subscriber.alarmCount$.subscribe(function(g){var y,T,b,S;if(p){var I=[{entityId:f,latest:(b={},b[Pt.COUNT]=(S={},S[m.name]={ts:Date.now()+t.latestTsOffset,value:g.count+""},S),b),timeseries:{}}];t.onDataUpdate(I)}else{var D={data:[{entityId:f,latest:(y={},y[Pt.ENTITY_FIELD]={name:{ts:Date.now()+t.latestTsOffset,value:Ct.alarmCount}},y[Pt.COUNT]=(T={},T[m.name]={ts:Date.now()+t.latestTsOffset,value:g.count+""},T),y),timeseries:{}}],hasNext:!1,totalElements:1,totalPages:1};t.onPageData(D),p=!0}}),t.subscriber.subscribe()}}),i.pipe(Da(function(){return t.entityDataSubscriptionOptions.isPaginatedDataSubscription?sn(null):t.entityDataResolveSubject.asObservable()}))},e.prototype.start=function(){if(!this.entityDataSubscriptionOptions.isPaginatedDataSubscription){if(this.prepareSubscriptionTimewindow(),this.prepareData(!0),this.datasourceType===Ct.entity){this.subsCommand=new qs,this.subsCommand.cmdId=this.dataCommand.cmdId,this.prepareSubscriptionCommands(this.subsCommand);var t=!1;this.entityDataSubscriptionOptions.type===bt.timeseries?this.subscriber.setTsOffset(this.subsTw.tsOffset):t=this.subscriber.setTsOffset(this.latestTsOffset),t?this.listener.forceReInit&&this.listener.forceReInit():this.subsCommand.isEmpty()||(this.subscriber.subscriptionCommands=[this.subsCommand],this.subscriber.update())}else this.datasourceType===Ct.entityCount||this.datasourceType===Ct.alarmCount?this.subscriber.setTsOffset(this.latestTsOffset)&&this.listener.forceReInit&&this.listener.forceReInit():this.datasourceType===Ct.function&&this.startFunction();this.started=!0}},e.prototype.prepareSubscriptionTimewindow=function(){this.subsTw=this.entityDataSubscriptionOptions.subscriptionTimewindow,this.latestTsOffset=this.entityDataSubscriptionOptions.latestTsOffset,this.history=this.entityDataSubscriptionOptions.subscriptionTimewindow&&uo(this.entityDataSubscriptionOptions.subscriptionTimewindow.fixedWindow),this.realtime=this.entityDataSubscriptionOptions.subscriptionTimewindow&&ze(this.entityDataSubscriptionOptions.subscriptionTimewindow.realtimeWindowMs),this.isFloatingTimewindow=this.entityDataSubscriptionOptions.subscriptionTimewindow&&!this.entityDataSubscriptionOptions.subscriptionTimewindow.quickInterval&&!this.history},e.prototype.prepareSubscriptionCommands=function(t){var i,r,n=[];if(this.entityDataSubscriptionOptions.type===bt.timeseries?(this.tsFields.length>0&&(this.history?(t.historyCmd={keys:on([],$e(new Set(this.tsFields.map(function(u){return u.key}))),!1),startTs:this.subsTw.fixedWindow.startTimeMs,endTs:this.subsTw.fixedWindow.endTimeMs,interval:0,intervalType:xs.MILLISECONDS,limit:this.subsTw.aggregation.limit,timeZoneId:this.subsTw.timezone,agg:this.subsTw.aggregation.type,fetchLatestPreviousPoint:this.subsTw.aggregation.stateData},typeof this.subsTw.aggregation.interval=="number"?t.historyCmd.interval=this.subsTw.aggregation.interval:t.historyCmd.intervalType=this.subsTw.aggregation.interval):(t.tsCmd={keys:on([],$e(new Set(this.tsFields.map(function(u){return u.key}))),!1),startTs:this.subsTw.startTs,timeWindow:this.subsTw.aggregation.timeWindow,interval:0,intervalType:xs.MILLISECONDS,limit:this.subsTw.aggregation.limit,timeZoneId:this.subsTw.timezone,agg:this.subsTw.aggregation.type,fetchLatestPreviousPoint:this.subsTw.aggregation.stateData},typeof this.subsTw.aggregation.interval=="number"?t.tsCmd.interval=this.subsTw.aggregation.interval:t.tsCmd.intervalType=this.subsTw.aggregation.interval)),n=this.latestValues):this.entityDataSubscriptionOptions.type===bt.latest&&(n=this.latestValues),this.history&&(this.aggTsValues.length>0||this.aggTsComparisonValues.length>0)){try{for(var a=kt(this.aggTsComparisonValues),s=a.next();!s.done;s=a.next()){var o=s.value,l=this.dataKeyByIndex(o.id),h=Zy(this.subsTw,l.timeForComparison,l.comparisonCustomIntervalValue);o.previousStartTs=h.fixedWindow.startTimeMs,o.previousEndTs=h.fixedWindow.endTimeMs}}catch(u){i={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}t.aggHistoryCmd={keys:on(on([],$e(this.aggTsValues),!1),$e(this.aggTsComparisonValues),!1),startTs:this.subsTw.fixedWindow.startTimeMs,endTs:this.subsTw.fixedWindow.endTimeMs}}else if(!this.isFloatingTimewindow&&this.aggTsValues.length>0&&(t.aggTsCmd={keys:this.aggTsValues,startTs:this.subsTw.startTs,timeWindow:this.subsTw.aggregation.timeWindow},n.length>0)){var c=this.aggTsValues.map(function(u){return u.key});n=n.filter(function(u){return u.type!==Pt.TIME_SERIES||!c.includes(u.key)})}n.length>0&&(t.latestCmd={keys:n})},e.prototype.startFunction=function(){this.frequency=1e3,this.latestFrequency=1e3,this.entityDataSubscriptionOptions.type===bt.timeseries&&(this.frequency=Math.min(Ar.numberValue(this.entityDataSubscriptionOptions.subscriptionTimewindow.aggregation.interval),5e3)),this.tickScheduledTime=this.utils.currentPerfTime(),this.generateData(!0)},e.prototype.prepareData=function(t){var i=this;if(this.timeseriesTimer&&(clearTimeout(this.timeseriesTimer),this.timeseriesTimer=null),this.latestTimer&&(clearTimeout(this.latestTimer),this.latestTimer=null),this.dataAggregators&&this.dataAggregators.forEach(function(o){o.destroy()}),this.dataAggregators=[],this.tsLatestDataAggregators&&this.tsLatestDataAggregators.forEach(function(o){o.destroy()}),this.tsLatestDataAggregators=[],this.resetData(),this.entityDataSubscriptionOptions.type===bt.timeseries){var r=void 0;r=this.datasourceType===Ct.function?this.dataKeysList.filter(function(o){return!o.latest}).map(function(o){return o.index}):this.dataKeysList.filter(function(o){return!(o.type!==Qt.timeseries||o.aggregationType&&o.aggregationType!==Lt.NONE||o.latest)}).map(function(o){return o.index});var n=r.map(function(o){return{id:o,key:o+"",agg:i.subsTw.aggregation.type}});if(n.length)for(var a=0;a<this.pageData.data.length;a++)this.dataAggregators[a]=this.createRealtimeDataAggregator(this.subsTw,n,!1,a,this.notifyListener.bind(this))}if(this.aggTsValues&&this.aggTsValues.length)if(this.isFloatingTimewindow)this.reportNotSupported(this.aggTsValues,t);else{var s=Kt(this.subsTw);for(s.aggregation.stateData=!1,s.aggregation.interval=s.aggregation.timeWindow,a=0;a<this.pageData.data.length;a++)this.tsLatestDataAggregators[a]=this.createRealtimeDataAggregator(s,this.aggTsValues,!0,a,this.notifyListener.bind(this))}!this.history&&this.aggTsComparisonValues&&this.aggTsComparisonValues.length&&this.reportNotSupported(this.aggTsComparisonValues,t)},e.prototype.reportNotSupported=function(t,i){var r,n,a=this,s=[];try{for(var o=kt(t),l=o.next();!l.done;l=o.next())s[l.value.id]=[[0,s0,[0,0]]]}catch(c){r={error:c}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}for(var h=0;h<this.pageData.data.length;h++)this.onIndexedData(s,h,!0,this.entityDataSubscriptionOptions.type===bt.timeseries,function(c,u,d,f,m){a.data[u]||(a.data[u]=[]),a.data[u][d]=c,i&&a.notifyListener(c,u,d,f,m)})},e.prototype.resetData=function(){var t,i,r,n,a,s;this.data=[],this.datasourceData=[],this.entityIdToDataIndex={};for(var o=0;o<this.pageData.data.length;o++){var l=this.pageData.data[o];this.entityIdToDataIndex[l.entityId.id]=o,this.datasourceData[o]={};try{for(var h=(t=void 0,kt(Object.keys(this.dataKeys))),c=h.next();!c.done;c=h.next()){var u=c.value,d=this.dataKeys[u];if(this.datasourceType===Ct.entity||this.datasourceType===Ct.entityCount||this.datasourceType===Ct.alarmCount||this.entityDataSubscriptionOptions.type===bt.timeseries)for(var f=d,m=0;m<f.length;m++){var p="".concat(u,"_").concat(m);this.datasourceData[o][p]={data:[]}}else this.datasourceData[o][u]={data:[]}}}catch(S){t={error:S}}finally{try{c&&!c.done&&(i=h.return)&&i.call(h)}finally{if(t)throw t.error}}}if(this.datasourceOrigData=Kt(this.datasourceData),this.entityDataSubscriptionOptions.type===bt.timeseries)try{for(var g=kt(Object.keys(this.dataKeys)),y=g.next();!y.done;y=g.next())u=y.value,this.dataKeys[u].forEach(function(S){delete S.lastUpdateTime})}catch(S){r={error:S}}finally{try{y&&!y.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}else if(this.entityDataSubscriptionOptions.type===bt.latest)try{for(var T=kt(Object.keys(this.dataKeys)),b=T.next();!b.done;b=T.next())u=b.value,delete this.dataKeys[u].lastUpdateTime}catch(S){a={error:S}}finally{try{b&&!b.done&&(s=T.return)&&s.call(T)}finally{if(a)throw a.error}}},e.prototype.onPageData=function(t){var i=this,r=!this.pageData;if(r||this.entityDataSubscriptionOptions.isPaginatedDataSubscription||!pO(this.pageData,t)){this.pageData=t,this.entityDataSubscriptionOptions.isPaginatedDataSubscription?this.prepareData(!1):r&&this.resetData();for(var n=0;n<t.data.length;n++){var a=t.data[n];this.processEntityData(a,n,!1,function(s,o,l){i.data[o]||(i.data[o]=[]),i.data[o][l]=s})}this.dataResolved?((r||this.entityDataSubscriptionOptions.isPaginatedDataSubscription)&&this.listener.dataLoaded(t,this.data,this.listener.configDatasourceIndex,this.entityDataSubscriptionOptions.pageLink),this.entityDataSubscriptionOptions.isPaginatedDataSubscription&&r&&(this.datasourceType===Ct.function&&this.startFunction(),this.entityDataResolveSubject.next({pageData:t,data:this.data,datasourceIndex:this.listener.configDatasourceIndex,pageLink:this.entityDataSubscriptionOptions.pageLink}),this.entityDataResolveSubject.complete())):(this.dataResolved=!0,this.entityDataResolveSubject.next({pageData:t,data:this.data,datasourceIndex:this.listener.configDatasourceIndex,pageLink:this.entityDataSubscriptionOptions.pageLink}),this.entityDataResolveSubject.complete())}else this.listener.initialPageDataChanged&&this.listener.initialPageDataChanged(t)},e.prototype.onDataUpdate=function(t){var i,r;try{for(var n=kt(t),a=n.next();!a.done;a=n.next()){var s=a.value,o=this.entityIdToDataIndex[s.entityId.id];Ye(o)&&o>=0&&this.processEntityData(s,o,!0,this.notifyListener.bind(this))}}catch(l){i={error:l}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.notifyListener=function(t,i,r,n,a){this.listener.dataUpdated(t,this.listener.configDatasourceIndex,i,r,n,a)},e.prototype.processEntityData=function(t,i,r,n){var a,s,o,l,h,c,u=this;if(this.entityDataSubscriptionOptions.type===bt.latest||this.entityDataSubscriptionOptions.type===bt.timeseries){if(t.aggLatest){var d=[];try{for(var f=kt(Object.keys(t.aggLatest)),m=f.next();!m.done;m=f.next()){var p=m.value,g=Number(p),y=this.dataKeyByIndex(g),T=t.aggLatest[g];if(y.comparisonEnabled){var b=e.calculateComparisonValue(y,T);this.onKeyData(b,y.name,g,y.type,i,!0,this.entityDataSubscriptionOptions.type===bt.timeseries,!0,n)}else d[g]=[[T.current.ts,T.current.value,T.current.count]]}}catch(X){a={error:X}}finally{try{m&&!m.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}if(Object.keys(d).length>0&&this.tsLatestDataAggregators&&this.tsLatestDataAggregators[i]){var S=this.tsLatestDataAggregators[i],I=void 0;r||(I=S.updateOnDataCb(function(X,et){u.onIndexedData(X,i,et,u.entityDataSubscriptionOptions.type===bt.timeseries,n)})),S.onData(d,!1,this.history,!0),I&&S.updateOnDataCb(I)}}if(t.latest){var D=function(X){var et,z,W,$,L=O.toSubscriptionData(t.latest[X],!1),N=mO(Pt[X]);if(r&&Pt[X]===Pt.TIME_SERIES){var V=Object.keys(L),H=O.latestValues.filter(function(nt){return nt.type===Pt.TIME_SERIES&&V.includes(nt.key)});if(H.length){var Q={};try{for(var rt=(et=void 0,kt(H)),tt=rt.next();!tt.done;tt=rt.next()){var it=tt.value;Q[it.key]=L[it.key]}}catch(nt){et={error:nt}}finally{try{tt&&!tt.done&&(z=rt.return)&&z.call(rt)}finally{if(et)throw et.error}}O.onData(Q,N,i,!0,O.entityDataSubscriptionOptions.type===bt.timeseries,n)}var w=O.aggTsValues.filter(function(nt){return V.includes(nt.key)});if(!O.history&&w.length&&O.tsLatestDataAggregators&&O.tsLatestDataAggregators[i]){var _=O.tsLatestDataAggregators[i],C=[];try{for(var F=(W=void 0,kt(w)),j=F.next();!j.done;j=F.next()){var K=j.value;C[K.id]=L[K.key]}}catch(nt){W={error:nt}}finally{try{j&&!j.done&&($=F.return)&&$.call(F)}finally{if(W)throw W.error}}_.onData(C,!0,!1,!0)}}else O.onData(L,N,i,!0,O.entityDataSubscriptionOptions.type===bt.timeseries,n)},O=this;try{for(var P=kt(Object.keys(t.latest)),q=P.next();!q.done;q=P.next())D(q.value)}catch(X){o={error:X}}finally{try{q&&!q.done&&(l=P.return)&&l.call(P)}finally{if(o)throw o.error}}}}if(this.entityDataSubscriptionOptions.type===bt.timeseries&&t.timeseries){var J=this.toSubscriptionData(t.timeseries,!0);if(this.dataAggregators&&this.dataAggregators[i]){S=this.dataAggregators[i];var A=Object.keys(J),x=this.timeseriesDataKeysByKeyNames(A),R=[];try{for(var M=kt(x),Y=M.next();!Y.done;Y=M.next())R[(y=Y.value).index]=J[y.name]}catch(X){h={error:X}}finally{try{Y&&!Y.done&&(c=M.return)&&c.call(M)}finally{if(h)throw h.error}}I=void 0,r||(I=S.updateOnDataCb(function(X,et){u.onIndexedData(X,i,et,!1,n)})),S.onData(R,!1,this.history,!0),I&&S.updateOnDataCb(I)}else this.history||r||this.onData(J,Qt.timeseries,i,!0,!1,n)}},e.prototype.onData=function(t,i,r,n,a,s){var o,l;try{for(var h=kt(Object.keys(t)),c=h.next();!c.done;c=h.next()){var u=c.value,d=t[u];this.onKeyData(d.map(function(f){return[f[0],f[1],[f[0],f[0]]]}),u,0,i,r,n,a,!1,s)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(l=h.return)&&l.call(h)}finally{if(o)throw o.error}}},e.prototype.onIndexedData=function(t,i,r,n,a){var s,o;try{for(var l=kt(Object.keys(t)),h=l.next();!h.done;h=l.next()){var c=h.value,u=Number(c),d=this.dataKeyByIndex(u),f=d.aggregationType&&d.aggregationType!==Lt.NONE,m=t[u],p=d.name;d.type===Qt.function&&(p+="_".concat(d.index)),this.onKeyData(m,p,u,d.type,i,r,n,f,a)}}catch(g){s={error:g}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(s)throw s.error}}},e.prototype.onKeyData=function(t,i,r,n,a,s,o,l,h){for(var c=this,u=l?"_".concat(r):"",d="".concat(i,"_").concat(n).concat(u).concat(o?"_latest":""),f=this.dataKeys[d],m=function(y){var T="".concat(d,"_").concat(y);if(p.datasourceData[a][T].data){var b,S,I=f[y],D=[],O=void 0,P=void 0,q=!1;if(p.realtime&&!o?(O=[],P=[]):(O=p.datasourceData[a][T].data,P=p.datasourceOrigData[a][T].data),O.length>0?(b=O[O.length-1],S=P[P.length-1]):(b=[0,0,[0,0]],S=[0,0,[0,0]]),p.datasourceOrigData[a][T].data=[],p.entityDataSubscriptionOptions.type!==bt.timeseries||o){if(p.entityDataSubscriptionOptions.type===bt.latest||o){if(t.length>0){var J=t[0],A=J[0];p.datasourceOrigData[a][T].data.push([J[0],J[1],J[2]]);var x=e.convertValue(J[1]);I.postFunc&&(x=I.postFunc.execute(A,x,b[1],S[0],S[1])),J=[A,x,J[2]],D.push([J[0],J[1],J[2]])}q=!0}}else t.forEach(function(R){var M=R,Y=M[0];c.datasourceOrigData[a][T].data.push([M[0],M[1],M[2]]);var X=e.convertValue(M[1]);I.postFunc&&(X=I.postFunc.execute(Y,X,b[1],S[0],S[1])),S=[M[0],M[1],M[2]],M=[M[0],X,M[2]],D.push([M[0],M[1],M[2]]),b=[M[0],M[1],M[2]]}),q=!0;q&&(p.datasourceData[a][T].data=D,h(p.datasourceData[a][T],a,I.index,s,o))}},p=this,g=0;f&&g<f.length;g++)m(g)},e.prototype.toSubscriptionData=function(t,i){var r,n,a={},s=function(h){var c=t[h],u=[];if(i)c.forEach(function(f){u.push([f.ts,f.value,f.count])});else{var d=c;u.push([d.ts,d.value,d.count])}a[h]=u};try{for(var o=kt(Object.keys(t)),l=o.next();!l.done;l=o.next())s(l.value)}catch(h){r={error:h}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},e.prototype.createRealtimeDataAggregator=function(t,i,r,n,a){var s=this;return new XO(function(o,l){s.onIndexedData(o,n,l,r&&s.entityDataSubscriptionOptions.type===bt.timeseries,a)},i,r,t,this.utils,this.entityDataSubscriptionOptions.ignoreDataUpdateOnIntervalTick||r)},e.prototype.dataKeyByIndex=function(t){return this.dataKeysList.find(function(i){return i.index===t})},e.prototype.timeseriesDataKeysByKeyNames=function(t){var i,r,n=[];try{for(var a=kt(t),s=a.next();!s.done;s=a.next()){var o=s.value,l="".concat(o,"_").concat(Qt.timeseries),h=this.dataKeys[l];n.push.apply(n,on([],$e(h),!1))}}catch(c){i={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return n},e.prototype.generateSeries=function(t,i,r){var n,a=[],s="".concat(t.key,"_").concat(t.listIndex),o=this.datasourceData[0][s].data;if(o.length>0){var l=o[o.length-1];n=[l[0],l[1]]}else n=[0,0];for(var h=i;h<=r&&(this.timeseriesTimer||this.history);h+=this.frequency){var c=[h,t.func.execute(h,n[1])];a.push(c),n=c}return a.length>0&&(t.lastUpdateTime=a[a.length-1][0]),a},e.prototype.generateLatest=function(t,i){var r,n=t.latest?"".concat(t.key,"_").concat(t.listIndex):t.key,a=this.datasourceData[0][n].data;r=a.length>0?a[a.length-1]:[0,0];var s=Date.now()+this.latestTsOffset,o=[s,t.func.execute(s,r[1])];this.datasourceData[0][n].data=[o],this.listener.dataUpdated(this.datasourceData[0][n],this.listener.configDatasourceIndex,0,t.index,i,t.latest)},e.prototype.generateData=function(t){var i,r,n,a,s,o=[],l=[];if(this.entityDataSubscriptionOptions.type===bt.timeseries)try{for(var h=kt(Object.keys(this.dataKeys)),c=h.next();!c.done;c=h.next()){s=c.value;var u=this.dataKeys[s];o=o.concat(u.filter(function(m){return!m.latest})),l=l.concat(u.filter(function(m){return m.latest}))}}catch(m){i={error:m}}finally{try{c&&!c.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}else if(this.entityDataSubscriptionOptions.type===bt.latest)try{for(var d=kt(Object.keys(this.dataKeys)),f=d.next();!f.done;f=d.next())s=f.value,l.push(this.dataKeys[s])}catch(m){n={error:m}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}o.length&&(this.history?this.onTimeseriesTick(o,!0):this.timeseriesTimer=setTimeout(this.onTimeseriesTick.bind(this,o,!0),0)),l.length&&this.onLatestTick(l,t)},e.prototype.onTimeseriesTick=function(t,i){var r,n,a,s=this.utils.currentPerfTime();this.tickElapsed+=s-this.tickScheduledTime,this.tickScheduledTime=s,this.timeseriesTimer&&clearTimeout(this.timeseriesTimer);var o=[];this.history||(a=Math.floor(this.tickElapsed/this.frequency));var l=this.history?this.frequency:a*this.frequency;this.tickElapsed=this.tickElapsed-l;for(var h=0;h<t.length&&(this.timeseriesTimer||this.history);h++){var c=t[h];if(!r){if(this.realtime){if(c.lastUpdateTime)r=c.lastUpdateTime+this.frequency,n=c.lastUpdateTime+l;else if(n=(r=this.entityDataSubscriptionOptions.subscriptionTimewindow.startTs+this.entityDataSubscriptionOptions.subscriptionTimewindow.tsOffset)+this.entityDataSubscriptionOptions.subscriptionTimewindow.realtimeWindowMs+this.frequency,this.entityDataSubscriptionOptions.subscriptionTimewindow.aggregation.type===Lt.NONE){var u=n-this.frequency*this.entityDataSubscriptionOptions.subscriptionTimewindow.aggregation.limit;r=Math.max(u,r)}}else r=this.entityDataSubscriptionOptions.subscriptionTimewindow.fixedWindow.startTimeMs+this.entityDataSubscriptionOptions.subscriptionTimewindow.tsOffset,n=this.entityDataSubscriptionOptions.subscriptionTimewindow.fixedWindow.endTimeMs+this.entityDataSubscriptionOptions.subscriptionTimewindow.tsOffset;if(this.entityDataSubscriptionOptions.subscriptionTimewindow.quickInterval){var d=Ci().valueOf()+this.entityDataSubscriptionOptions.subscriptionTimewindow.tsOffset;n=Math.min(d,n)}}o[c.index]=this.generateSeries(c,r,n)}this.dataAggregators&&this.dataAggregators.length&&this.dataAggregators[0].onData(o,!0,this.history,i),this.history||(this.timeseriesTimer=setTimeout(this.onTimeseriesTick.bind(this,t,!0),this.frequency))},e.prototype.onLatestTick=function(t,i){var r=this;this.latestTimer&&clearTimeout(this.latestTimer),t.forEach(function(n){r.generateLatest(n,i)}),this.latestTimer=setTimeout(this.onLatestTick.bind(this,t,!0),this.latestFrequency)},e})(),R0=(function(){function e(i,r){this.telemetryService=i,this.utils=r}var t;return t=e,e.isUnresolvedDatasource=function(i,r){return i.type===Ct.entity?!i.entityFilter||!r:i.type===Ct.entityCount&&!i.entityFilter},e.toSubscriptionDataKey=function(i,r){return{name:i.name,type:i.type,aggregationType:i.aggregationType,comparisonEnabled:i.comparisonEnabled,timeForComparison:i.timeForComparison,comparisonCustomIntervalValue:i.comparisonCustomIntervalValue,comparisonResultType:i.comparisonResultType,funcBody:i.funcBody,postFuncBody:i.postFuncBody,latest:r}},e.prototype.prepareSubscription=function(i,r){r===void 0&&(r=!1);var n=i.configDatasource;return i.subscriptionOptions=this.createSubscriptionOptions(n,i.subscriptionType,n.pageLink,n.keyFilters,null,!1,r),t.isUnresolvedDatasource(n,n.pageLink)?sn(null):(i.subscription=new ep(i,this.telemetryService,this.utils),i.subscription.subscribe())},e.prototype.startSubscription=function(i){i.subscription&&(i.useTimewindow&&(i.subscriptionOptions.subscriptionTimewindow=Kt(i.subscriptionTimewindow)),i.subscriptionType!==bt.timeseries&&i.subscriptionType!==bt.latest||(i.subscriptionOptions.latestTsOffset=i.latestTsOffset),i.subscription.start())},e.prototype.subscribeForPaginatedData=function(i,r,n,a){a===void 0&&(a=!1);var s=i.configDatasource;return i.subscriptionOptions=this.createSubscriptionOptions(s,i.subscriptionType,r,s.keyFilters,n,!0,a),t.isUnresolvedDatasource(s,r)?(i.dataLoaded({data:[],totalPages:0,totalElements:0,hasNext:!1},[],i.configDatasourceIndex,i.subscriptionOptions.pageLink),sn(null)):(i.subscription=new ep(i,this.telemetryService,this.utils),i.useTimewindow&&(i.subscriptionOptions.subscriptionTimewindow=Kt(i.subscriptionTimewindow)),i.subscriptionType!==bt.timeseries&&i.subscriptionType!==bt.latest||(i.subscriptionOptions.latestTsOffset=i.latestTsOffset),i.subscription.subscribe())},e.prototype.stopSubscription=function(i){i.subscription&&i.subscription.unsubscribe()},e.prototype.createSubscriptionOptions=function(i,r,n,a,s,o,l){var h=[];i.dataKeys.forEach(function(u){h.push(t.toSubscriptionDataKey(u,!1))}),i.latestDataKeys&&i.latestDataKeys.forEach(function(u){h.push(t.toSubscriptionDataKey(u,!0))});var c={datasourceType:i.type,dataKeys:h,type:r};return c.datasourceType!==Ct.entity&&c.datasourceType!==Ct.entityCount&&c.datasourceType!==Ct.alarmCount||(c.entityFilter=i.entityFilter,c.alarmFilter=i.alarmFilter,c.keyFilters=a,c.additionalKeyFilters=s,c.datasourceType===Ct.entity&&(c.pageLink=n)),c.isPaginatedDataSubscription=o,c.ignoreDataUpdateOnIntervalTick=l,c},e=t=bi([Ti(),ie(0,re(Nt.TelemetryWebsocketService)),ie(1,re(Nt.UtilsService)),wi("design:paramtypes",[mo,Zu])],e)})(),QO=(function(){function e(t){this.dashboard=t}return Object.defineProperty(e.prototype,"aliasController",{get:function(){return this.dashboard.aliasController},enumerable:!1,configurable:!0}),e})(),JO={METRIC:{units:{"Gy/s":{name:"unit.gy-per-second",tags:["radiation dose rate"],to_anchor:1}}}},ZO={METRIC:{ratio:3.28084,units:{"g₀":{name:"unit.g-force",tags:["gravity","load"],to_anchor:9.80665},"m/s²":{name:"unit.meters-per-second-squared",tags:["peak to peak","root mean square (RMS)","vibration"],to_anchor:1},Gal:{name:"unit.gal",tags:["gravity","g-force"],to_anchor:1},"km/h²":{name:"unit.kilometer-per-hour-squared",tags:["rate of change of velocity"],to_anchor:1/12960}}},IMPERIAL:{ratio:1/3.28084,units:{"ft/s²":{name:"unit.foot-per-second-squared",tags:["rate of change of velocity"],to_anchor:1}}}},tM={METRIC:{units:{pH:{name:"unit.ph-level",tags:["alkalinity","neutral","acid","base","soil pH","water quality","water pH"],to_anchor:1}}}},eM={METRIC:{units:{aqi:{name:"unit.aqi",tags:["pollutant concentration"],to_anchor:1}}}},iM={METRIC:{units:{mol:{name:"unit.mole",tags:["chemical amount"],to_anchor:1},nmol:{name:"unit.nanomole",tags:["chemical amount"],to_anchor:1e-9},μmol:{name:"unit.micromole",tags:["chemical amount"],to_anchor:1e-6},mmol:{name:"unit.millimole",tags:["chemical amount"],to_anchor:.001},kmol:{name:"unit.kilomole",tags:["chemical amount"],to_anchor:1e3}}}},rM={METRIC:{units:{rad:{name:"unit.rad",tags:["radians"],to_anchor:180/Math.PI},deg:{name:"unit.degree",tags:["degrees"],to_anchor:1},grad:{name:"unit.gradian",tags:["grades"],to_anchor:.9},arcmin:{name:"unit.arcminute",tags:["arcminutes"],to_anchor:1/60},arcsec:{name:"unit.arcsecond",tags:["arcseconds"],to_anchor:1/3600},mrad:{name:"unit.milliradian",tags:["military angle","angular mil","mil"],to_anchor:9/(50*Math.PI)},rev:{name:"unit.revolution",tags:["full circle","complete turn"],to_anchor:360}}}},nM={METRIC:{ratio:30/Math.PI,units:{"rad/s²":{name:"unit.radian-per-second-squared",tags:["rotation rate of change"],to_anchor:1}}},IMPERIAL:{ratio:Math.PI/30,units:{"rpm/s":{name:"unit.revolutions-per-minute-per-second",tags:["rotation rate of change"],to_anchor:1}}}},aM={METRIC:{ratio:10.7639,units:{"mm²":{name:"unit.square-millimeter",tags:["lot","zone","space","region","square millimeters","sq-mm"],to_anchor:1e-6},"cm²":{name:"unit.square-centimeter",tags:["lot","zone","space","region","square centimeters","sq-cm"],to_anchor:1e-4},"m²":{name:"unit.square-meter",tags:["lot","zone","space","region","square meters","sq-m"],to_anchor:1},a:{name:"unit.are",tags:["land measurement"],to_anchor:100},ha:{name:"unit.hectare",tags:["lot","zone","space","region","hectares"],to_anchor:1e4},"km²":{name:"unit.square-kilometer",tags:["lot","zone","space","region","square kilometers","sq-km"],to_anchor:1e6},barn:{name:"unit.barn",tags:["cross-sectional area","particle physics","nuclear physics"],to_anchor:1e-28}}},IMPERIAL:{ratio:1/10.7639,units:{"in²":{name:"unit.square-inch",tags:["lot","zone","space","region","square inches","sq-in"],to_anchor:1/144},"yd²":{name:"unit.square-yard",tags:["lot","zone","space","region","square yards","sq-yd"],to_anchor:9},"ft²":{name:"unit.square-foot",tags:["lot","zone","space","region","square feet","sq-ft"],to_anchor:1},ac:{name:"unit.acre",tags:["lot","zone","space","region","acres","a"],to_anchor:43560},"ml²":{name:"unit.square-mile",tags:["lot","zone","space","region","square mile","sq-mi"],to_anchor:27878400},cin:{name:"unit.circular-inch",tags:["circular measurement","circin"],to_anchor:Math.PI/576}}}},sM={METRIC:{units:{"kg/m²":{name:"unit.kilogram-per-square-meter",tags:["surface density","mass per unit area"],to_anchor:1}}}},oM={METRIC:{units:{F:{name:"unit.farad",tags:["electric capacitance"],to_anchor:1},mF:{name:"unit.millifarad",tags:["electric capacitance"],to_anchor:.001},μF:{name:"unit.microfarad",tags:["electric capacitance"],to_anchor:1e-6},nF:{name:"unit.nanofarad",tags:["electric capacitance"],to_anchor:1e-9},pF:{name:"unit.picofarad",tags:["electric capacitance"],to_anchor:1e-12},kF:{name:"unit.kilofarad",tags:["electric capacitance"],to_anchor:1e3},MF:{name:"unit.megafarad",tags:["electric capacitance"],to_anchor:1e6},GF:{name:"unit.gigafarad",tags:["electric capacitance"],to_anchor:1e9},TF:{name:"unit.terfarad",tags:["electric capacitance"],to_anchor:1e12}}}},lM={METRIC:{units:{kat:{name:"unit.katal",tags:["catalytic activity","enzyme activity"],to_anchor:1}}}},cM={METRIC:{units:{"kat/m³":{name:"unit.katal-per-cubic-metre",tags:["enzyme concentration"],to_anchor:1}}}},hM={METRIC:{units:{c:{name:"unit.coulomb",tags:["electricity","electrostatics"],to_anchor:1},mC:{name:"unit.millicoulomb",tags:["electricity","electrostatics"],to_anchor:.001},μC:{name:"unit.microcoulomb",tags:["electricity","electrostatics"],to_anchor:1e-6},nC:{name:"unit.nanocoulomb",tags:["electricity","electrostatics"],to_anchor:1e-9},pC:{name:"unit.picocoulomb",tags:["electricity","electrostatics"],to_anchor:1e-12},mAh:{name:"unit.milliampere-hour",tags:["electric current","current flow","electric charge","current capacity","flow of electricity","electrical flow","milliampere-hours"],to_anchor:3.6},Ah:{name:"unit.ampere-hours",tags:["electric current","current flow","electric charge","current capacity","flow of electricity","electrical flow","ampere"],to_anchor:3600},kAh:{name:"unit.kiloampere-hours",tags:["electric current","current flow","electric charge","current capacity","flow of electricity","electrical flow","kiloampere-hours"],to_anchor:36e5}}}},uM={METRIC:{units:{"µA/cm²":{name:"unit.microampere-per-square-centimeter",tags:["current per unit area"],to_anchor:1e4},"A/m²":{name:"unit.ampere-per-square-meter",tags:["current per unit area"],to_anchor:1}}}},dM={METRIC:{units:{bps:{name:"unit.bit-per-second",to_anchor:1},kbps:{name:"unit.kilobit-per-second",to_anchor:1e3},Mbps:{name:"unit.megabit-per-second",to_anchor:1e6},Gbps:{name:"unit.gigabit-per-second",to_anchor:1e9},Tbps:{name:"unit.terabit-per-second",to_anchor:1e12},"B/s":{name:"unit.byte-per-second",to_anchor:8},"KB/s":{name:"unit.kilobyte-per-second",to_anchor:8e3},"MB/s":{name:"unit.megabyte-per-second",to_anchor:8e6},"GB/s":{name:"unit.gigabyte-per-second",to_anchor:8e9}}}},fM={METRIC:{ratio:.062428,units:{"kg/m³":{name:"unit.kilogram-per-cubic-meter",tags:["mass per unit volume"],to_anchor:1},"g/cm³":{name:"unit.gram-per-cubic-centimeter",tags:["mass per unit volume"],to_anchor:1e3},"mg/dL":{name:"unit.milligrams-per-deciliter",tags:["glucose","blood sugar","glucose level","concentration"],to_anchor:.01},"g/m³":{name:"unit.gram-per-cubic-meter",tags:["humidity","moisture","absolute humidity","concentration"],to_anchor:.001},"mg/L":{name:"unit.mg-per-liter",tags:["dissolved oxygen","water quality","mg/L","concentration"],to_anchor:.001},"mg/mL":{name:"unit.milligram-per-milliliter",tags:["mass per unit volume","concentration"],to_anchor:1},"mg/m³":{name:"unit.milligram-per-cubic-meter",tags:["mass per unit volume","concentration"],to_anchor:1e-6},"µg/m³":{name:"unit.micrograms-per-cubic-meter",tags:["coarse particulate matter","pm10","fine particulate matter","pm2.5","aqi","air quality","total volatile organic compounds","tvoc","concentration"],to_anchor:1e-9}}},IMPERIAL:{ratio:1/.062428,units:{"lb/ft³":{name:"unit.pound-per-cubic-foot",tags:["mass per unit volume"],to_anchor:1},"oz/in³":{name:"unit.ounces-per-cubic-inch",tags:["mass per unit volume"],to_anchor:1728},"ton/yd³":{name:"unit.tons-per-cubic-yard",tags:["mass per unit volume"],to_anchor:74.074}}}},mM={METRIC:{units:{bit:{name:"unit.bit",tags:["data","binary digit","information"],to_anchor:.125},B:{name:"unit.byte",tags:["data","information","storage","memory"],to_anchor:1},KB:{name:"unit.kilobyte",tags:["data"],to_anchor:1024},MB:{name:"unit.megabyte",tags:["data"],to_anchor:Math.pow(1024,2)},GB:{name:"unit.gigabyte",tags:["data"],to_anchor:Math.pow(1024,3)},TB:{name:"unit.terabyte",tags:["data"],to_anchor:Math.pow(1024,4)},PB:{name:"unit.petabyte",tags:["data"],to_anchor:Math.pow(1024,5)},EB:{name:"unit.exabyte",tags:["data"],to_anchor:Math.pow(1024,6)},ZB:{name:"unit.zettabyte",tags:["data"],to_anchor:Math.pow(1024,7)},YB:{name:"unit.yottabyte",tags:["data"],to_anchor:Math.pow(1024,8)}}}},gM={METRIC:{units:{"%":{name:"unit.percent",tags:["power source","state of charge (SoC)","battery","battery level","level","humidity","moisture","relative humidity","water content","soil moisture","irrigation","water in soil","soil water content","VWC","Volumetric Water Content","Total Harmonic Distortion","THD","power quality","UV Transmittance","capacity"],to_anchor:1},"m/m":{name:"unit.meter-per-meter",tags:["ratio of length to length"],to_anchor:1}}}},pM={METRIC:{ratio:2419.0883293091,units:{"Pa·s":{name:"unit.pascal-second",tags:["fluid mechanics"],to_anchor:1},cP:{name:"unit.centipoise",tags:["fluid mechanics"],to_anchor:.001},P:{name:"unit.poise",tags:["fluid mechanics"],to_anchor:.1},"N·s/m²":{name:"unit.newton-second-per-square-meter",tags:["fluid mechanics"],to_anchor:1},"dyn·s/cm²":{name:"unit.dyne-second-per-square-centimeter",tags:["fluid mechanics"],to_anchor:.1},"kg/(m·s)":{name:"unit.kilogram-per-meter-second",tags:["fluid mechanics"],to_anchor:1}}},IMPERIAL:{ratio:.00041337887,units:{"lb/(ft·h)":{name:"unit.pound-per-foot-hour",tags:["fluid mechanics"],to_anchor:1}}}},vM={METRIC:{units:{richter:{name:"unit.richter-scale",tags:["seismic activity"],to_anchor:1}}}},yM={METRIC:{units:{"C/m³":{name:"unit.coulomb-per-cubic-meter",to_anchor:1}}}},bM={METRIC:{units:{A:{name:"unit.ampere",tags:["current flow","flow of electricity","electrical flow","amperes","amperage"],to_anchor:1},pA:{name:"unit.picoampere",tags:["picoamperes"],to_anchor:1e-12},nA:{name:"unit.nanoampere",tags:["nanoamperes"],to_anchor:1e-9},μA:{name:"unit.microampere",tags:["microamperes"],to_anchor:1e-6},mA:{name:"unit.milliampere",tags:["milliamperes"],to_anchor:.001},kA:{name:"unit.kiloampere",tags:["kiloamperes"],to_anchor:1e3},MA:{name:"unit.megaampere",tags:["megaamperes"],to_anchor:1e6},GA:{name:"unit.gigaampere",tags:["gigaamperes"],to_anchor:1e9}}}},wM={METRIC:{units:{"C·m":{name:"unit.electric-dipole-moment",to_anchor:1},D:{name:"unit.debye",tags:["polarization"],to_anchor:333564e-35}}}},TM={METRIC:{units:{"V/m":{name:"unit.volts-per-meter",to_anchor:1},"mV/m":{name:"unit.millivolts-per-meter",to_anchor:.001},"kV/m":{name:"unit.kilovolts-per-meter",to_anchor:1e3}}}},EM={METRIC:{units:{"V·m":{name:"unit.volt-meter",to_anchor:1},"kV·m":{name:"unit.kilovolt-meter",to_anchor:1e3},"MV·m":{name:"unit.megavolt-meter",to_anchor:1e6},"µV·m":{name:"unit.microvolt-meter",to_anchor:1e-6},"mV·m":{name:"unit.millivolt-meter",to_anchor:.001},"nV·m":{name:"unit.nanovolt-meter",to_anchor:1e-9}}}},_M={METRIC:{units:{"F/m":{name:"unit.farad-per-meter",to_anchor:1}}}},SM={METRIC:{units:{"C·m²/V":{name:"unit.coulomb-per-square-meter-per-volt",tags:["electric field"],to_anchor:1}}}},AM={METRIC:{units:{S:{name:"unit.siemens",to_anchor:1},mS:{name:"unit.millisiemens",to_anchor:.001},μS:{name:"unit.microsiemens",to_anchor:1e-6},kS:{name:"unit.kilosiemens",to_anchor:1e3},MS:{name:"unit.megasiemens",to_anchor:1e6},GS:{name:"unit.gigasiemens",to_anchor:1e9}}}},xM={METRIC:{units:{"S/m":{name:"unit.siemens-per-meter",tags:["water quality","soil quality"],to_anchor:1},"µS/cm":{name:"unit.microsiemens-per-centimeter",tags:["water quality","soil quality"],to_anchor:1e-4},"mS/m":{name:"unit.millisiemens-per-meter",tags:["water quality","soil quality"],to_anchor:.001}}}},RM={METRIC:{ratio:1/4.184,units:{Wm:{name:"unit.watt-minute",to_anchor:60},Wh:{name:"unit.watt-hour",tags:["energy usage","power consumption","energy consumption","electricity usage"],to_anchor:3600},mWh:{name:"unit.milliwatt-hour",to_anchor:3.6},kWh:{name:"unit.kilowatt-hour",tags:["energy usage","power consumption","energy consumption","electricity usage"],to_anchor:36e5},MWh:{name:"unit.megawatt-hour",to_anchor:36e8},GWh:{name:"unit.gigawatt-hour",to_anchor:36e11},μJ:{name:"unit.microjoule",to_anchor:1e-6},mJ:{name:"unit.millijoule",to_anchor:.001},J:{name:"unit.joule",tags:["joule","joules","energy","work done","heat","electricity","mechanical work"],to_anchor:1},kJ:{name:"unit.kilojoule",to_anchor:1e3},MJ:{name:"unit.megajoule",to_anchor:1e6},GJ:{name:"unit.gigajoule",to_anchor:1e9},eV:{name:"unit.electron-volts",tags:["subatomic particles","radiation"],to_anchor:1602176634e-28}}},IMPERIAL:{ratio:4.184,units:{cal:{name:"unit.small-calorie",to_anchor:1},Cal:{name:"unit.calorie",tags:["food energy"],to_anchor:1e3},kcal:{name:"unit.kilocalorie",tags:["small calorie"],to_anchor:1e3},BTU:{name:"unit.british-thermal-unit",tags:["heat","work done"],to_anchor:252.1644007218},MBtu:{name:"unit.thousand-british-thermal-unit",tags:["heat","work done"],to_anchor:252164.4007218},MMBtu:{name:"unit.million-british-thermal-unit",tags:["heat","work done"],to_anchor:2521644007218e-4},"ft·lb":{name:"unit.foot-pound",tags:["ft⋅lbf"],to_anchor:.32404875717017},thm:{name:"unit.therm",tags:["natural gas consumption","BTU"],to_anchor:25219021687207e-6}}}},kM={METRIC:{units:{"J/m³":{name:"unit.joule-per-cubic-meter",to_anchor:1}}}},IM={METRIC:{ratio:.224809,units:{N:{name:"unit.newton",tags:["pressure","push","pull","weight"],to_anchor:1},kN:{name:"unit.kilonewton",to_anchor:1e3},dyn:{name:"unit.dyne",to_anchor:1e-5}}},IMPERIAL:{ratio:4.44822,units:{lbf:{name:"unit.pound-force",to_anchor:1},kgf:{name:"unit.kilogram-force",to_anchor:2.20462},klbf:{name:"unit.kilopound-force",to_anchor:1e3},pdl:{name:"unit.poundal",to_anchor:.031081},kip:{name:"unit.kip",to_anchor:1e3}}}},CM={METRIC:{ratio:2.35214583,units:{"km/L":{name:"unit.kilometers-per-liter",to_anchor:1},"L/100km":{name:"unit.liters-per-100-km",to_anchor:1,transform:function(e){return 100/e}}}},IMPERIAL:{ratio:.425144,units:{mpg:{name:"unit.miles-per-gallon",to_anchor:.425144},"gal/mi":{name:"unit.gallons-per-mile",to_anchor:2.35214583}}}},DM={METRIC:{units:{mHz:{name:"unit.millihertz",tags:["cycles per second"],to_anchor:.001},Hz:{name:"unit.hertz",tags:["cycles per second"],to_anchor:1},kHz:{name:"unit.kilohertz",tags:["cycles per second"],to_anchor:1e3},MHz:{name:"unit.megahertz",tags:["cycles per second"],to_anchor:1e6},GHz:{name:"unit.gigahertz",tags:["cycles per second"],to_anchor:1e9},THz:{name:"unit.terahertz",to_anchor:1e12},rpm:{name:"unit.rotation-per-minute",tags:["rotations per minute","angular velocity"],to_anchor:1/60},RPM:{name:"unit.rpm",tags:["rotational speed","angular velocity"],to_anchor:1/60},λ:{name:"unit.lambda",tags:["wavelength"],to_anchor:299792458},bpm:{name:"unit.beats-per-minute",tags:["heart rate","pulse"],to_anchor:.0167},"deg/s":{name:"unit.deg-per-second",tags:["angular velocity"],to_anchor:1/360},"rad/s":{name:"unit.radian-per-second",tags:["angular velocity"],to_anchor:1/(2*Math.PI)}}}},OM={METRIC:{units:{"J/K":{name:"unit.joule-per-kelvin",tags:["heat capacity per unit temperature"],to_anchor:1}}}},MM={METRIC:{ratio:1/10.76391,units:{lx:{name:"unit.lux",tags:["light level on a surface","illuminance","Lux","lx"],to_anchor:1},"cd/m²":{name:"unit.candela-per-square-meter",tags:["brightness","light level","Luminance"],to_anchor:1},"lm/m²":{name:"unit.lumen-per-square-meter",tags:["light level"],to_anchor:1}}},IMPERIAL:{ratio:10.76391,units:{fc:{name:"unit.foot-candle",tags:["illuminance","light level"],to_anchor:1}}}},PM={METRIC:{units:{H:{name:"unit.henry",tags:["inductance","magnetic induction","H"],to_anchor:1},mH:{name:"unit.millihenry",tags:["inductance","millihenry","mH"],to_anchor:.001},µH:{name:"unit.microhenry",tags:["inductance","microhenry","µH"],to_anchor:1e-6},nH:{name:"unit.nanohenry",tags:["inductance","nanohenry","nH"],to_anchor:1e-9},"T·m/A":{name:"unit.tesla-meter-per-ampere",tags:["magnetic field","Tesla Meter per Ampere","T·m/A","magnetic flux"],to_anchor:1}}}},NM={METRIC:{ratio:10.7639104167097,units:{"m²/s":{name:"unit.square-meter-per-second",to_anchor:1},"cm²/s":{name:"unit.square-centimeter-per-second",to_anchor:1e-4},St:{name:"unit.stoke",to_anchor:1e-4},cSt:{name:"unit.centistokes",to_anchor:1e-6}}},IMPERIAL:{ratio:.09290304,units:{"ft²/s":{name:"unit.square-foot-per-second",to_anchor:.09290304},"in²/s":{name:"unit.square-inch-per-second",to_anchor:64516e-8}}}},LM={METRIC:{ratio:3.28084,units:{nm:{name:"unit.nanometer",tags:["level","height","distance","width","gap","depth","nanoscale","atomic scale","molecular scale"],to_anchor:1e-9},μm:{name:"unit.micrometer",tags:["level","height","distance","width","gap","depth","microns"],to_anchor:1e-6},mm:{name:"unit.millimeter",tags:["level","height","distance","width","gap","depth","rainfall","precipitation","displacement","position","movement","transition"],to_anchor:.001},cm:{name:"unit.centimeter",tags:["level","height","distance","width","gap","depth","rainfall","precipitation","displacement","position","movement","transition"],to_anchor:.01},dm:{name:"unit.decimeter",tags:["level","height","distance","width","gap","depth"],to_anchor:.1},m:{name:"unit.meter",tags:["level","height","distance","width","gap","depth"],to_anchor:1},km:{name:"unit.kilometer",tags:["distance","height","width","gap","depth"],to_anchor:1e3},angstrom:{name:"unit.angstrom",tags:["level","height","distance","width","gap","depth","atomic scale","atomic distance","nanoscale"],to_anchor:1e-10}}},IMPERIAL:{ratio:1/3.28084,units:{in:{name:"unit.inch",tags:["level","height","distance","width","gap","depth"],to_anchor:1/12},yd:{name:"unit.yard",tags:["level","height","distance","width","gap","depth"],to_anchor:3},"ft-us":{name:"unit.foot-us",tags:["us survey foot","us survey feet","ft-us","surveying"],to_anchor:1.000002},ft:{name:"unit.foot",tags:["level","height","distance","width","gap","depth","feet"],to_anchor:1},fathom:{name:"unit.fathom",tags:["depth","nautical measurement"],to_anchor:6},mi:{name:"unit.mile",tags:["level","height","distance","width","gap","depth"],to_anchor:5280},nmi:{name:"unit.nautical-mile",tags:["level","height","distance","width","gap","depth","nautical mile"],to_anchor:6076.12},pouce:{name:"unit.paris-inch",tags:["level","height","distance","width","gap","depth","nautical mile"],to_anchor:1.0657},thou:{name:"unit.thou",tags:["measurement"],to_anchor:.001/12},barleycorn:{name:"unit.barleycorn",tags:["shoe size"],to_anchor:1/36},hand:{name:"unit.hand",tags:["horse measurement"],to_anchor:4/12},ch:{name:"unit.chain",tags:["land surveying"],to_anchor:66},fur:{name:"unit.furlong",tags:["land surveying"],to_anchor:660},league:{name:"unit.league",tags:["historical measurement"],to_anchor:15840},link:{name:"unit.link",tags:["land surveying"],to_anchor:.66},rod:{name:"unit.rod",tags:["land surveying"],to_anchor:16.5},cable:{name:"unit.cable",tags:["distance","nautical measurement"],to_anchor:600},AU:{name:"unit.astronomical-unit",tags:["distance","celestial bodies","solar system"],to_anchor:490806678107388e-3}}}},UM={METRIC:{units:{"lx·s":{name:"unit.lux-second",tags:["illuminance over time"],to_anchor:1}}}},FM={METRIC:{units:{"C/m":{name:"unit.coulomb-per-meter",tags:["electric displacement field per length"],to_anchor:1}}}},BM={METRIC:{units:{dB:{name:"unit.decibel",tags:["noise level","sound level","volume","acoustics"],to_anchor:1},bel:{name:"unit.bel",tags:["power ratio","intensity ratio"],to_anchor:10},Np:{name:"unit.neper",tags:["gain","loss","attenuation"],to_anchor:8.685889638}}}},jM={METRIC:{units:{"lm/W":{name:"unit.lumens-per-watt",tags:["lighting efficiency"],to_anchor:1}}}},WM={METRIC:{units:{lm:{name:"unit.lumen",tags:["total light output"],to_anchor:1}}}},zM={METRIC:{units:{cd:{name:"unit.candela",tags:["light intensity"],to_anchor:1}}}},VM={METRIC:{units:{"T/m":{name:"unit.tesla-per-meter",to_anchor:1},"G/cm":{name:"unit.gauss-per-centimeter",to_anchor:.01}}}},HM={METRIC:{units:{Wb:{name:"unit.weber",to_anchor:1},µWb:{name:"unit.microweber",to_anchor:1e-6},mWb:{name:"unit.milliweber",to_anchor:.001},Mx:{name:"unit.maxwell",tags:["magnetic field"],to_anchor:1e-8},"G·cm²":{name:"unit.gauss-square-centimeter",to_anchor:1e-8},"kG·cm²":{name:"unit.kilogauss-square-centimeter",to_anchor:1e-5}}}},YM={METRIC:{units:{T:{name:"unit.tesla",tags:["magnetic field strength"],to_anchor:1},mT:{name:"unit.millitesla",tags:["magnetic field strength"],to_anchor:.001},μT:{name:"unit.microtesla",tags:["magnetic field strength"],to_anchor:1e-6},nT:{name:"unit.nanotesla",tags:["magnetic field strength"],to_anchor:1e-9},kT:{name:"unit.kilotesla",tags:["magnetic field strength"],to_anchor:1e3},MT:{name:"unit.megatesla",tags:["magnetic field strength"],to_anchor:1e6},G:{name:"unit.gauss",tags:["magnetic field strength"],to_anchor:1e-4},kG:{name:"unit.kilogauss",tags:["magnetic field strength"],to_anchor:.1},γ:{name:"unit.gamma",to_anchor:1e-9},"A/m":{name:"unit.ampere-per-meter",tags:["magnetic field strength","magnetic field intensity"],to_anchor:125663706143591e-20},Oe:{name:"unit.oersted",tags:["magnetic field strength"],to_anchor:1e-4}}}},qM={METRIC:{units:{"A·m²":{name:"unit.magnetic-dipole-moment",tags:["magnetic dipole moment"],to_anchor:1},μB:{name:"unit.bohr-magneton",tags:["atomic physics"],to_anchor:9274e-27}}}},KM={METRIC:{units:{"H/m":{name:"unit.henry-per-meter",to_anchor:1},"G/Oe":{name:"unit.gauss-per-oersted",tags:["magnetic field"],to_anchor:1/795774.715}}}},GM={METRIC:{ratio:1/453.59237,units:{ng:{name:"unit.nanogram",tags:["weight","heaviness","load"],to_anchor:1e-9},mcg:{name:"unit.microgram",tags:["weight","heaviness","load"],to_anchor:1e-6},mg:{name:"unit.milligram",tags:["weight","heaviness","load"],to_anchor:.001},g:{name:"unit.gram",tags:["weight","heaviness","load"],to_anchor:1},kg:{name:"unit.kilogram",tags:["weight","heaviness","load"],to_anchor:1e3},t:{name:"unit.tonne",tags:["weight","heaviness","load"],to_anchor:1e6},Da:{name:"unit.dalton",tags:["atomic mass unit","AMU","unified atomic mass unit"],to_anchor:16605390666e-34},ct:{name:"unit.carat",tags:["gemstone","pearl","jewelry","carat","ct"],to_anchor:.2}}},IMPERIAL:{ratio:453.59237,units:{oz:{name:"unit.ounce",tags:["weight","heaviness","load"],to_anchor:1/16},lb:{name:"unit.pound",tags:["weight","heaviness","load"],to_anchor:1},st:{name:"unit.stone",tags:["weight","heaviness","load"],to_anchor:14},"short tons":{name:"unit.short-tons",tags:["weight","heaviness","load"],to_anchor:2e3},gr:{name:"unit.grain",tags:["measurement"],to_anchor:1/7e3},dr:{name:"unit.drachm",tags:["measurement"],to_anchor:1/256},qr:{name:"unit.quarter",tags:["measurement"],to_anchor:28},cwt:{name:"unit.hundredweight-count",tags:["weight","heaviness","load"],to_anchor:100},slug:{name:"unit.slug",tags:["measurement"],to_anchor:32.174}}}},$M={METRIC:{units:{"°Bx":{name:"unit.degrees-brix",tags:["sugar content","fruit ripeness"],to_anchor:1}}}},XM={METRIC:{units:{"mol/m³":{name:"unit.mole-per-cubic-meter",tags:["amount of substance per unit volume"],to_anchor:1}}}},QM={METRIC:{units:{"J/mol":{name:"unit.joule-per-mole",to_anchor:1}}}},JM={METRIC:{units:{"J/(mol·K)":{name:"unit.joule-per-mole-kelvin",to_anchor:1}}}},ZM={METRIC:{units:{"g/mol":{name:"unit.gram-per-mole",to_anchor:1},"kg/mol":{name:"unit.kilogram-per-mole",to_anchor:1e3},"mg/mol":{name:"unit.milligram-per-mole",to_anchor:.001}}}},tP={METRIC:{units:{"particles/mL":{name:"unit.particle-density",tags:["particle concentration","count"],to_anchor:1}}}},eP={METRIC:{units:{ppm:{name:"unit.ppm",tags:["carbon dioxide","co²","carbon monoxide","co","aqi","air quality","total volatile organic compounds","tvoc"],to_anchor:1},ppb:{name:"unit.ppb",tags:["ozone","o³","nitrogen dioxide","no²","sulfur dioxide","so²","aqi","air quality","tvoc"],to_anchor:.001}}}},iP={METRIC:{ratio:.737562149,units:{W:{name:"unit.watt",tags:["horsepower","performance","electricity"],to_anchor:1},μW:{name:"unit.microwatt",tags:["horsepower","performance","electricity"],to_anchor:1e-6},mW:{name:"unit.milliwatt",tags:["horsepower","performance","electricity"],to_anchor:.001},kW:{name:"unit.kilowatt",tags:["horsepower","performance","electricity"],to_anchor:1e3},MW:{name:"unit.megawatt",tags:["horsepower","performance","electricity"],to_anchor:1e6},GW:{name:"unit.gigawatt",tags:["horsepower","performance","electricity"],to_anchor:1e9},PS:{name:"unit.metric-horsepower",tags:["performance"],to_anchor:735.49875}}},IMPERIAL:{ratio:1/.737562149,units:{"ft-lb/s":{name:"unit.foot-pound-per-second",tags:["mechanical power"],to_anchor:1},hp:{name:"unit.horsepower",tags:["performance","electricity"],to_anchor:550},"BTU/s":{name:"unit.btu-per-second",tags:["heat transfer","thermal energy"],to_anchor:778.16937},"BTU/h":{name:"unit.btu-per-hour",tags:["heat transfer","thermal energy","HVAC"],to_anchor:.216158},"BTU/d":{name:"unit.btu-per-day",tags:["heat transfer","thermal energy"],to_anchor:.00900613},"MBtu/s":{name:"unit.btu-per-second",tags:["heat transfer","thermal energy"],to_anchor:778169.37},"MBtu/h":{name:"unit.btu-per-hour",tags:["heat transfer","thermal energy"],to_anchor:216.158},"MBtu/d":{name:"unit.btu-per-day",tags:["heat transfer","thermal energy"],to_anchor:9.00613},"MMBtu/s":{name:"unit.btu-per-second",tags:["heat transfer","thermal energy"],to_anchor:778169370},"MMBtu/h":{name:"unit.btu-per-hour",tags:["heat transfer","thermal energy"],to_anchor:216158},"MMBtu/d":{name:"unit.btu-per-day",tags:["heat transfer","thermal energy"],to_anchor:9006.13}}}},rP={METRIC:{ratio:64516e-8,units:{"mW/cm²":{name:"unit.milliwatt-per-square-centimeter",tags:["radiation intensity","sunlight intensity","signal power","intensity","UV Intensity"],to_anchor:1e4},"W/cm²":{name:"unit.watt-per-square-centimeter",tags:["intensity of power"],to_anchor:1e4},"kW/cm²":{name:"unit.kilowatt-per-square-centimeter",tags:["intensity of power"],to_anchor:1e7},"mW/m²":{name:"unit.milliwatt-per-square-meter",tags:["intensity of power"],to_anchor:.001},"W/m²":{name:"unit.watt-per-square-meter",tags:["intensity of power"],to_anchor:1},"kW/m²":{name:"unit.kilowatt-per-square-meter",tags:["intensity of power"],to_anchor:1e3}}},IMPERIAL:{ratio:1/64516e-8,units:{"W/in²":{name:"unit.watt-per-square-inch",tags:["intensity of power"],to_anchor:1},"kW/in²":{name:"unit.kilowatt-per-square-inch",tags:["intensity of power"],to_anchor:1e3}}}},nP={METRIC:{ratio:.00014503768078,units:{Pa:{name:"unit.pascal",tags:["force","compression","tension","atmospheric pressure","air pressure","weather","altitude","flight"],to_anchor:.001},kPa:{name:"unit.kilopascal",tags:["force","compression","tension"],to_anchor:1},MPa:{name:"unit.megapascal",tags:["force","compression","tension"],to_anchor:1e3},GPa:{name:"unit.gigapascal",tags:["force","compression","tension"],to_anchor:1e6},hPa:{name:"unit.hectopascal",tags:["force","compression","tension","atmospheric pressure"],to_anchor:.1},mbar:{name:"unit.millibar",tags:["force","compression","tension"],to_anchor:.1},mb:{name:"unit.millibar",tags:["atmospheric pressure","air pressure","weather","altitude","flight"],to_anchor:.1},bar:{name:"unit.bar",tags:["force","compression","tension"],to_anchor:100},kbar:{name:"unit.kilobar",tags:["force","compression","tension"],to_anchor:1e5},Torr:{name:"unit.torr",tags:["force","compression","tension","vacuum pressure"],to_anchor:101325/76e4},mmHg:{name:"unit.millimeters-of-mercury",tags:["force","compression","tension","vacuum pressure"],to_anchor:.133322},atm:{name:"unit.atmospheres",tags:["force","compression","tension","atmospheric pressure"],to_anchor:101.325},"Pa/m²":{name:"unit.pascal-per-square-meter",tags:["stress","mechanical strength"],to_anchor:.001},"N/mm²":{name:"unit.newton-per-square-millimeter",tags:["stress","mechanical strength"],to_anchor:1e3},"N/m²":{name:"unit.newton-per-square-meter",tags:["stress","mechanical strength"],to_anchor:.001},"kN/m²":{name:"unit.kilonewton-per-square-meter",tags:["stress","mechanical strength"],to_anchor:1},"kgf/m²":{name:"unit.kilogram-force-per-square-meter",tags:["stress","mechanical strength"],to_anchor:.00980665},"Pa/cm²":{name:"unit.pascal-per-square-centimeter",tags:["stress","mechanical strength"],to_anchor:.1}}},IMPERIAL:{ratio:6894.76000045014,units:{psi:{name:"unit.pounds-per-square-inch",tags:["force","compression","tension"],to_anchor:.001},ksi:{name:"unit.kilopound-per-square-inch",tags:["force","compression","tension"],to_anchor:1},inHg:{name:"unit.inch-of-mercury",tags:["force","compression","tension","vacuum pressure","atmospheric pressure","barometric pressure"],to_anchor:491154e-9},"psi/in²":{name:"unit.pound-per-square-inch",tags:["stress","mechanical strength"],to_anchor:.001},"tonf/in²":{name:"unit.ton-force-per-square-inch",tags:["stress","mechanical strength"],to_anchor:2}}}},aP={METRIC:{units:{"W/(m²·sr)":{name:"unit.watt-per-square-metre-steradian",tags:["radiant flux density"],to_anchor:1}}}},sP={METRIC:{units:{"W/sr":{name:"unit.watt-per-steradian",tags:["power per unit solid angle"],to_anchor:1}}}},oP={METRIC:{units:{Sv:{name:"unit.sievert",tags:["sievert","radiation dose equivalent","Sv"],to_anchor:1},Gy:{name:"unit.gray",tags:["absorbed dose","gray","Gy"],to_anchor:1},Rad:{name:"unit.rad",tags:["rad"],to_anchor:.01},Rem:{name:"unit.rem",tags:["radiation dose equivalent"],to_anchor:.01},R:{name:"unit.roentgen",tags:["radiation exposure"],to_anchor:.0093},"C/kg":{name:"unit.coulombs-per-kilogram",tags:["radiation exposure","electric charge-to-mass ratio"],to_anchor:34},cps:{name:"unit.cps",tags:["radiation detection"],to_anchor:1}}}},lP={METRIC:{units:{"Bq/s":{name:"unit.becquerels-per-second",to_anchor:1},"Ci/s":{name:"unit.curies-per-second",to_anchor:37e9}}}},cP={METRIC:{units:{Bq:{name:"unit.becquerel",tags:["radioactivity","decay rate"],to_anchor:1},Ci:{name:"unit.curie",tags:["radiation"],to_anchor:37e9},Rd:{name:"unit.rutherford",tags:["radioactive decay"],to_anchor:37e3},dps:{name:"unit.dps",tags:["radioactive decay"],to_anchor:1}}}},hP={METRIC:{units:{"Bq/m³":{name:"unit.becquerels-per-cubic-meter",tags:["radiation"],to_anchor:1},"Ci/L":{name:"unit.curies-per-liter",tags:["radiation"],to_anchor:37e12}}}},uP={METRIC:{units:{"m⁻¹":{name:"unit.reciprocal-metre",tags:["wavenumber","wave density","wave frequency"],to_anchor:1}}}},dP={METRIC:{units:{Ω:{name:"unit.ohm",tags:["electrical resistance","impedance"],to_anchor:1},μΩ:{name:"unit.microohm",tags:["electrical resistance"],to_anchor:1e-6},mΩ:{name:"unit.milliohm",tags:["electrical resistance"],to_anchor:.001},kΩ:{name:"unit.kilohm",tags:["electrical resistance"],to_anchor:1e3},MΩ:{name:"unit.megohm",tags:["electrical resistance"],to_anchor:1e6},GΩ:{name:"unit.gigohm",tags:["electrical resistance"],to_anchor:1e9}}}},fP={METRIC:{units:{Re:{name:"unit.reynolds",tags:["fluid flow regime","fluid mechanics"],to_anchor:1}}}},mP={METRIC:{units:{dBmV:{name:"unit.dbmV",tags:["decibels millivolt","voltage level"],to_anchor:1},dBm:{name:"unit.dbm",tags:["decibel milliwatts","output power"],to_anchor:1},rssi:{name:"unit.rssi",tags:["signal strength","received signal strength indicator"],to_anchor:1}}}},gP={METRIC:{units:{sr:{name:"unit.steradian",tags:["spatial extent"],to_anchor:1}}}},pP={METRIC:{units:{"J/kg":{name:"unit.joule-per-kilogram",to_anchor:1}}}},vP={METRIC:{units:{"J/(kg·K)":{name:"unit.joule-per-kilogram-kelvin",tags:["heat capacity per unit mass and temperature"],to_anchor:1}}}},yP={METRIC:{units:{"g/kg":{name:"unit.gram-per-kilogram",tags:["humidity","moisture"],to_anchor:1}}}},bP={METRIC:{units:{"m³/kg":{name:"unit.cubic-meter-per-kilogram",tags:["volume per unit mass"],to_anchor:1}}}},wP={METRIC:{ratio:1/1.609344,units:{"m/s":{name:"unit.meter-per-second",tags:["velocity","pace","peak","peak to peak","root mean square (RMS)","vibration","wind speed","weather"],to_anchor:3.6},"km/h":{name:"unit.kilometer-per-hour",tags:["velocity","pace"],to_anchor:1},"mm/min":{name:"unit.millimeters-per-minute",tags:["feed rate","cutting feed rate"],to_anchor:6e-5},"m/min":{name:"unit.meter-per-minute",tags:["velocity","pace"],to_anchor:.06},"mm/s":{name:"unit.millimeters-per-second",tags:["velocity","vibration rate"],to_anchor:.0036}}},IMPERIAL:{ratio:1.609344,units:{mph:{name:"unit.mile-per-hour",tags:["velocity","pace"],to_anchor:1},kt:{name:"unit.knot",tags:["velocity","pace"],to_anchor:1.150779},"ft/s":{name:"unit.foot-per-second",tags:["velocity","pace"],to_anchor:.681818},"ft/min":{name:"unit.foot-per-minute",tags:["velocity","pace"],to_anchor:.0113636},"in/s":{name:"unit.inch-per-second",tags:["velocity","pace"],to_anchor:.0568182},"in/h":{name:"unit.inch-per-hour",tags:["velocity","pace"],to_anchor:1578e-8}}}},TP={METRIC:{units:{"C/m²":{name:"unit.coulomb-per-square-meter",tags:["electric surface charge density"],to_anchor:1}}}},EP={METRIC:{units:{"N/m":{name:"unit.newton-per-meter",tags:["linear density","force per unit length"],to_anchor:1}}}},_P={METRIC:{transform:function(e){return e/(5/9)+32},units:{"°C":{name:"unit.celsius",tags:["heat","cold","warmth","degrees","shipment condition"],to_anchor:1},K:{name:"unit.kelvin",tags:["heat","cold","warmth","degrees","color quality","white balance","color temperature"],to_anchor:1,anchor_shift:273.15}}},IMPERIAL:{transform:function(e){return 5/9*(e-32)},units:{"°F":{name:"unit.fahrenheit",tags:["heat","cold","warmth","degrees"],to_anchor:1},"°R":{name:"unit.rankine",tags:["heat","cold","warmth"],to_anchor:1,anchor_shift:459.67}}}},SP={METRIC:{units:{"W/(m·K)":{name:"unit.watt-per-meter-kelvin",to_anchor:1}}}},AP={METRIC:{units:{ns:{name:"unit.nanosecond",tags:["duration","interval"],to_anchor:1e-9},μs:{name:"unit.microsecond",tags:["duration","interval"],to_anchor:1e-6},ms:{name:"unit.millisecond",tags:["duration","interval"],to_anchor:.001},s:{name:"unit.second",tags:["duration","interval"],to_anchor:1},min:{name:"unit.minute",tags:["duration","interval"],to_anchor:60},h:{name:"unit.hour",tags:["duration","interval"],to_anchor:3600},d:{name:"unit.day",tags:["duration","interval"],to_anchor:86400},wk:{name:"unit.week",tags:["duration","interval"],to_anchor:604800},mo:{name:"unit.month",tags:["duration","interval"],to_anchor:2629800},yr:{name:"unit.year",tags:["duration","interval"],to_anchor:31557600}}}},xP={METRIC:{ratio:1/1.355818,units:{Nm:{name:"unit.newton-meter",tags:["rotational force","newton meter","Nm"],to_anchor:1}}},IMPERIAL:{ratio:1.355818,units:{"lbf-ft":{name:"unit.foot-pounds",tags:["rotational force"],to_anchor:1},"in·lbf":{name:"unit.inch-pounds",tags:["rotational force"],to_anchor:1/12}}}},RP={METRIC:{units:{NTU:{name:"unit.turbidity",tags:["water turbidity","water clarity","Nephelometric Turbidity Units"],to_anchor:1}}}},kP={METRIC:{units:{pV:{name:"unit.picovolt",tags:["volts"],to_anchor:1e-12},nV:{name:"unit.nanovolt",tags:["volts"],to_anchor:1e-9},μV:{name:"unit.microvolt",tags:["electric potential","electric tension"],to_anchor:1e-6},mV:{name:"unit.millivolt",tags:["electric potential","electric tension"],to_anchor:.001},V:{name:"unit.volt",tags:["electric potential","electric tension","power source","battery","battery level"],to_anchor:1},kV:{name:"unit.kilovolt",tags:["electric potential","electric tension"],to_anchor:1e3},MV:{name:"unit.megavolt",tags:["electric potential","electric tension"],to_anchor:1e6}}}},IP={METRIC:{ratio:33.8140226,units:{"mm³":{name:"unit.cubic-millimeter",tags:["capacity","extent"],to_anchor:1e-6},"cm³":{name:"unit.cubic-centimeter",tags:["capacity","extent"],to_anchor:.001},µL:{name:"unit.microliter",tags:["liquid measurement"],to_anchor:1e-6},mL:{name:"unit.milliliter",tags:["capacity","extent"],to_anchor:.001},L:{name:"unit.liter",tags:["capacity","extent"],to_anchor:1},hL:{name:"unit.hectoliter",tags:["capacity","extent"],to_anchor:100},"m³":{name:"unit.cubic-meter",tags:["capacity","extent"],to_anchor:1e3},"km³":{name:"unit.cubic-kilometer",tags:["capacity","extent"],to_anchor:1e12}}},IMPERIAL:{ratio:1/33.8140226,units:{tsp:{name:"unit.teaspoon",tags:["cooking measurement"],to_anchor:1/6},tbsp:{name:"unit.tablespoon",tags:["cooking measurement"],to_anchor:.5},"in³":{name:"unit.cubic-inch",tags:["capacity","extent"],to_anchor:.55411},"fl-oz":{name:"unit.fluid-ounce",tags:["capacity","extent"],to_anchor:1},cup:{name:"unit.cup",tags:["cooking measurement"],to_anchor:8},pt:{name:"unit.pint",tags:["capacity","extent"],to_anchor:16},qt:{name:"unit.quart",tags:["capacity","extent"],to_anchor:32},gal:{name:"unit.gallon",tags:["capacity","extent"],to_anchor:128},"ft³":{name:"unit.cubic-foot",tags:["capacity","extent"],to_anchor:957.506},"yd³":{name:"unit.cubic-yard",tags:["capacity","extent"],to_anchor:25852.7},bbl:{name:"unit.oil-barrels",tags:["capacity","extent"],to_anchor:5376},gi:{name:"unit.gill",tags:["liquid measurement"],to_anchor:4},hhd:{name:"unit.hogshead",tags:["liquid measurement"],to_anchor:8064}}}},CP={METRIC:{ratio:33.8140227,units:{"L/s":{name:"unit.liter-per-second",tags:["airflow","ventilation","HVAC","gas flow rate"],to_anchor:1},"dm³/s":{name:"unit.cubic-decimeter-per-second",tags:["cubic decimeter per second"],to_anchor:1},"mL/min":{name:"unit.milliliters-per-minute",tags:["flow rate","fluid dynamics"],to_anchor:1/6e4},"L/min":{name:"unit.liter-per-minute",tags:["airflow","ventilation","HVAC","gas flow rate"],to_anchor:1/60},"L/hr":{name:"unit.liters-per-hour",tags:["fuel consumption"],to_anchor:1/3600},"m³/s":{name:"unit.cubic-meters-per-second",tags:["airflow","ventilation","HVAC","gas flow rate"],to_anchor:1e3},"m³/hr":{name:"unit.cubic-meters-per-hour",tags:["airflow","ventilation","HVAC","gas flow rate"],to_anchor:5/18}}},IMPERIAL:{ratio:1/33.8140227,units:{"fl-oz/s":{name:"unit.fluid-ounce-per-second",tags:["fluid ounce per second","fl-oz/s"],to_anchor:1},"ft³/s":{name:"unit.cubic-foot-per-second",tags:["flow rate","fluid flow"],to_anchor:957.506},"ft³/min":{name:"unit.cubic-foot-per-minute",tags:["airflow","ventilation","HVAC","gas flow rate","CFM","flow rate","fluid flow"],to_anchor:957.506/60},"gal/hr":{name:"unit.gallons-per-hour",tags:["fuel consumption"],to_anchor:128/3600},GPM:{name:"unit.gallons-per-minute",tags:["airflow","ventilation","HVAC","gas flow rate"],to_anchor:128/60}}}},ip=Object.freeze({temperature:_P,pressure:nP,voltage:kP,"current-density":uM,"electric-current":bM,power:iP,energy:RM,speed:wP,length:LM,mass:GM,time:AP,area:aM,volume:IP,"volume-flow":CP,density:fM,acceleration:ZO,"air-quality-index":eM,illuminance:MM,"signal-level":mP,"fuel-efficiency":CM,frequency:DM,capacitance:oM,inductance:PM,resistance:dP,torque:xP,force:IM,"magnetic-flux-density":YM,"magnetic-flux":HM,radioactivity:cP,"radioactive-decay":lP,"specific-energy":pP,"specific-heat-capacity":vP,"kinematic-viscosity":NM,"dynamic-viscosity":pM,"thermal-conductivity":SP,turbidity:RP,"earthquake-magnitude":vM,"data-transfer-rate":dM,"parts-per-million":eP,"molar-concentration":XM,"number-concentration":tP,"catalytic-activity":lM,"catalytic-concentration":cM,charge:hM,"electric-charge-density":yM,"electric-dipole-moment":wM,"electric-field-strength":TM,"electric-flux":EM,"electric-permittivity":_M,"electric-polarizability":SM,"electrical-conductance":AM,"electrical-conductivity":xM,"magnetic-field-gradient":VM,"magnetic-moment":qM,"magnetic-permeability":KM,radiance:aP,"radiant-intensity":sP,"radiation-dose":oP,"radioactivity-concentration":hP,"reciprocal-length":uP,"reynolds-number":fP,"surface-charge-density":TP,"surface-tension":EP,"specific-volume":bP,"specific-humidity":yP,"angular-acceleration":nM,angle:rM,"solid-angle":gP,"light-exposure":UM,"luminous-intensity":zM,"luminous-flux":WM,"luminous-efficacy":jM,"molar-energy":QM,"molar-heat-capacity":JM,"molar-mass":ZM,"mass-fraction":$M,"logarithmic-ratio":BM,"dimension-ratio":gM,"absorbed-dose-rate":JO,acidity:tM,"amount-of-substance":iM,digital:mM,"area-density":sM,"energy-density":kM,"heat-capacity":OM,"linear-charge-density":FM,"power-density":rP});(function(e){e.METRIC="METRIC",e.IMPERIAL="IMPERIAL",e.HYBRID="HYBRID"})(Or||(Or={})),Object.values(Or);var DP=(function(){function e(t,i){this.measureData=t,this.unitCache=i}return e.prototype.getUnitConverter=function(t,i){var r=this;return function(n){return r.convert(n,t,i)}},e.prototype.convert=function(t,i,r){var n=this.getUnit(i),a=this.getUnit(r);if(!n)throw new Error("Unsupported unit: ".concat(i));if(!a)throw new Error("Unsupported unit: ".concat(r));if(n.abbr===a.abbr)return t;if(a.measure!==n.measure)throw Error("Cannot convert incompatible measures: ".concat(n.measure," to ").concat(a.measure));var s=t*n.unit.to_anchor;if(n.unit.anchor_shift&&(s-=n.unit.anchor_shift),typeof n.unit.transform=="function"&&(s=n.unit.transform(s)),n.system!==a.system){var o=this.measureData[n.measure][n.system],l=o==null?void 0:o.transform,h=o==null?void 0:o.ratio;if(typeof l=="function")s=l(s);else{if(typeof h!="number")throw Error("System anchor requires a defined ratio or transform function");s*=h}}return a.unit.anchor_shift&&(s+=a.unit.anchor_shift),typeof a.unit.transform=="function"&&(s=a.unit.transform(s)),s/a.unit.to_anchor},e.prototype.getDefaultUnit=function(t,i){var r,n;if(!this.isMeasure(t))return null;var a=this.getUnitsForMeasure(t,i);if(!a)return null;try{for(var s=kt(Object.entries(a)),o=s.next();!o.done;o=s.next()){var l=$e(o.value,2),h=l[0],c=l[1];if(c.to_anchor===1&&(!c.anchor_shift||c.anchor_shift===0))return h}}catch(u){r={error:u}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return null},e.prototype.getUnit=function(t){var i;return(i=this.unitCache.get(t))!==null&&i!==void 0?i:null},e.prototype.describe=function(t){var i=this.getUnit(t);return i?this.describeUnit(i):null},e.prototype.listUnits=function(t,i){var r,n,a,s,o,l,h,c=[],u=t?((r={})[t]=this.measureData[t],r):this.measureData;try{for(var d=kt(Object.entries(u)),f=d.next();!f.done;f=d.next()){var m=$e(f.value,2),p=m[0],g=m[1];if(this.isMeasure(p)){var y=i?[i]:Object.keys(g);try{for(var T=(s=void 0,kt(y)),b=T.next();!b.done;b=T.next()){var S=b.value,I=this.getUnitsForMeasure(p,S);if(I)try{for(var D=(l=void 0,kt(Object.keys(I))),O=D.next();!O.done;O=D.next()){var P=O.value;c.push(this.describe(P))}}catch(q){l={error:q}}finally{try{O&&!O.done&&(h=D.return)&&h.call(D)}finally{if(l)throw l.error}}}}catch(q){s={error:q}}finally{try{b&&!b.done&&(o=T.return)&&o.call(T)}finally{if(s)throw s.error}}}}}catch(q){n={error:q}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return c},e.prototype.unitsGroupByMeasure=function(t,i,r){var n,a,s,o,l,h,c,u={},d=t?((n={})[t]=this.measureData[t],n):this.measureData;try{for(var f=kt(Object.entries(d)),m=f.next();!m.done;m=f.next()){var p=$e(m.value,2),g=p[0],y=p[1];if(this.isMeasure(g)){u[g]=[];var T=i?[i]:Object.keys(y);try{for(var b=(o=void 0,kt(T)),S=b.next();!S.done;S=b.next()){var I=S.value,D=this.getUnitsForMeasure(g,I);if(D)try{for(var O=(h=void 0,kt(Object.keys(D))),P=O.next();!P.done;P=O.next()){var q=P.value,J=this.describe(q);r&&!J.tags.includes(r)||u[g].push(J)}}catch(A){h={error:A}}finally{try{P&&!P.done&&(c=O.return)&&c.call(O)}finally{if(h)throw h.error}}}}catch(A){o={error:A}}finally{try{S&&!S.done&&(l=b.return)&&l.call(b)}finally{if(o)throw o.error}}u[g].length||delete u[g]}}}catch(A){a={error:A}}finally{try{m&&!m.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}return u},e.prototype.describeUnit=function(t){return{abbr:t.abbr,measure:t.measure,system:t.system,name:t.unit.name,tags:t.unit.tags}},e.prototype.isMeasure=function(t){return t in this.measureData},e.prototype.getUnitsForMeasure=function(t,i){var r,n,a=this.measureData[t],s=i,o=(r=a[s])===null||r===void 0?void 0:r.units;return o||i!==Or.IMPERIAL||(o=(n=a[s=Or.METRIC])===null||n===void 0?void 0:n.units),o??null},e})();function OP(e){var t=(function(i,r){var n,a,s,o,l,h,c,u=new Map;try{for(var d=kt(Object.entries(i)),f=d.next();!f.done;f=d.next()){var m=$e(f.value,2),p=m[0],g=m[1];try{for(var y=(s=void 0,kt(Object.entries(g))),T=y.next();!T.done;T=y.next()){var b=$e(T.value,2),S=b[0],I=b[1];try{for(var D=(l=void 0,kt(Object.entries(I.units))),O=D.next();!O.done;O=D.next()){var P=$e(O.value,2),q=P[0],J=P[1];J.name=r.instant(J.name);var A=r.instant("unit.measures."+p);J.tags=(c=J.tags)!==null&&c!==void 0?c:[],J.tags.push(q,J.name,A),u.set(q,{measure:p,system:S,abbr:q,unit:J})}}catch(x){l={error:x}}finally{try{O&&!O.done&&(h=D.return)&&h.call(D)}finally{if(l)throw l.error}}}}catch(x){s={error:x}}finally{try{T&&!T.done&&(o=y.return)&&o.call(y)}finally{if(s)throw s.error}}}}catch(x){n={error:x}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return u})(Kt(ip),e);return new DP(ip,t)}var rp=function(e){return typeof e=="object"&&e!==null&&rr(e.from)},td=(function(){function e(t){this.settings=t}return e.fromSettings=function(t,i){return i.units!==null&&typeof i.units=="object"?new MP(t,i):new PP(i)},e.prototype.formatValue=function(t){var i=t;return this.isDefinedDecimals&&(i=i.toFixed(this.settings.decimals)),this.hideZeroDecimals&&(i=Number(i)),i=i.toString(),this.unitSymbol&&(i+=" ".concat(this.unitSymbol)),i},e})(),MP=(function(e){function t(i,r){var n=e.call(this,r)||this;n.unitServiceOrInjector=i,n.settings=r;var a=n.unitServiceOrInjector,s=r.units;return n.unitSymbol=r.ignoreUnitSymbol?null:a.getTargetUnitSymbol(s),n.unitConverter=a.geUnitConverter(s),n.isDefinedDecimals=ze(r.decimals),n.hideZeroDecimals=!r.showZeroDecimals,n}return Le(t,e),t.prototype.format=function(i){if(ze(i)&&dn(i)){var r=this.unitConverter(Number(i));return this.formatValue(r)}return i??""},t})(td),PP=(function(e){function t(i){var r=e.call(this,i)||this;return r.settings=i,r.unitSymbol=!i.ignoreUnitSymbol&&rr(i.units)?i.units:null,r.isDefinedDecimals=ze(i.decimals),r.hideZeroDecimals=!i.showZeroDecimals,r}return Le(t,e),t.prototype.format=function(i){return ze(i)&&dn(i)&&(this.isDefinedDecimals||this.unitSymbol||Number(i).toString()===i)?this.formatValue(Number(i)):i??""},t})(td),NP=$y,np=function(e){if(e.length>0){var t=0;return e.forEach(function(i){t+=Number(i[1])}),t}return null},LP=(function(){function e(t,i){var r,n,a=this;this.options=i,this.tsOffset=0,this.cafs={},this.hasResolvedData=!1,this.subscribed=!1,this.hasLatestData=!1,this.widgetTimewindowChangedSubject=new be,this.widgetTimewindowChanged$=this.widgetTimewindowChangedSubject.asObservable().pipe(sr(function(o,l){var h=new Set;o.subscribe(Ni(l,function(c){var u=r?r(c):c;h.has(u)||(h.add(u),l.next(c))})),n&&Fr(n).subscribe(Ni(l,function(){return h.clear()},_l))}));var s=new be;this.init$=s.asObservable(),this.ctx=t,this.type=i.type,this.id=this.ctx.utils.guid(),this.callbacks=i.callbacks,this.type===bt.rpc?(this.callbacks.rpcStateChanged=this.callbacks.rpcStateChanged||function(){},this.callbacks.onRpcSuccess=this.callbacks.onRpcSuccess||function(){},this.callbacks.onRpcFailed=this.callbacks.onRpcFailed||function(){},this.callbacks.onRpcErrorCleared=this.callbacks.onRpcErrorCleared||function(){},this.targetDevice=i.targetDevice,kD(this.targetDevice)||(i.targetDeviceAliasIds&&i.targetDeviceAliasIds.length?this.targetDevice={type:Lr.entity,entityAliasId:i.targetDeviceAliasIds[0]}:i.targetDeviceIds&&i.targetDeviceIds.length&&(this.targetDevice={type:Lr.device,entityAliasId:i.targetDeviceIds[0]})),this.targetEntityId=null,this.targetEntityName=null,this.rpcRejection=null,this.rpcErrorText=null,this.rpcEnabled=!1,this.executingRpcRequest=!1,this.executingSubjects=[],this.initRpc().subscribe(function(){s.next(a),s.complete()})):this.type===bt.alarm?(this.callbacks.onDataUpdated=this.callbacks.onDataUpdated||function(){},this.callbacks.onDataUpdateError=this.callbacks.onDataUpdateError||function(){},this.callbacks.onSubscriptionMessage=this.callbacks.onSubscriptionMessage||function(){},this.callbacks.dataLoading=this.callbacks.dataLoading||function(){},this.callbacks.timeWindowUpdated=this.callbacks.timeWindowUpdated||function(){},this.alarmSource=i.alarmSource,this.datasourcesOptional=i.datasourcesOptional,this.alarmDataListener=null,this.alarms={data:[],totalPages:0,totalElements:0,hasNext:!1},this.originalTimewindow=null,this.timeWindow={},this.useDashboardTimewindow=i.useDashboardTimewindow,this.useTimewindow=!0,this.onTimewindowChangeFunction=i.onTimewindowChangeFunction||function(o){return o},this.useDashboardTimewindow?this.timeWindowConfig=Kt(i.dashboardTimewindow):this.timeWindowConfig=Kt(i.timeWindowConfig),this.subscriptionTimewindow=null,this.loadingData=!1,this.displayLegend=!1,this.initAlarmSubscription().subscribe({next:function(){s.next(a),s.complete()},error:function(){s.error(null)}})):(this.callbacks.onDataUpdated=this.callbacks.onDataUpdated||function(){},this.callbacks.onLatestDataUpdated=this.callbacks.onLatestDataUpdated||function(){},this.callbacks.onDataUpdateError=this.callbacks.onDataUpdateError||function(){},this.callbacks.onLatestDataUpdateError=this.callbacks.onLatestDataUpdateError||function(){},this.callbacks.onSubscriptionMessage=this.callbacks.onSubscriptionMessage||function(){},this.callbacks.onInitialPageDataChanged=this.callbacks.onInitialPageDataChanged||function(){},this.callbacks.forceReInit=this.callbacks.forceReInit||function(){},this.callbacks.dataLoading=this.callbacks.dataLoading||function(){},this.callbacks.legendDataUpdated=this.callbacks.legendDataUpdated||function(){},this.callbacks.timeWindowUpdated=this.callbacks.timeWindowUpdated||function(){},this.configuredDatasources=dg(i.datasources),this.datasourcesOptional=i.datasourcesOptional,this.entityDataListeners=[],this.hasDataPageLink=i.hasDataPageLink,this.singleEntity=i.singleEntity,this.pageSize=i.pageSize,this.warnOnPageDataOverflow=i.warnOnPageDataOverflow,this.ignoreDataUpdateOnIntervalTick=i.ignoreDataUpdateOnIntervalTick,this.datasourcePages=[],this.datasources=[],this.dataPages=[],this.data=[],this.latestData=[],this.hiddenData=[],this.originalTimewindow=null,this.timeWindow={},this.useDashboardTimewindow=i.useDashboardTimewindow,this.onTimewindowChangeFunction=i.onTimewindowChangeFunction||function(o){return o},this.stateData=i.stateData,this.useTimewindow=this.type===bt.timeseries||ID(this.configuredDatasources),this.useDashboardTimewindow?this.timeWindowConfig=Kt(i.dashboardTimewindow):this.timeWindowConfig=Kt(i.timeWindowConfig),this.type===bt.latest&&(this.timezone=this.useTimewindow?this.timeWindowConfig.timezone:i.dashboardTimewindow.timezone,this.updateTsOffset()),this.subscriptionTimewindow=null,this.comparisonEnabled=i.comparisonEnabled&&TD(this.timeWindowConfig),this.comparisonEnabled&&(this.timeForComparison=i.timeForComparison,this.comparisonCustomIntervalValue=i.comparisonCustomIntervalValue,this.comparisonTimeWindow={},this.timewindowForComparison=null),this.units=i.units||"",this.decimals=ze(i.decimals)?i.decimals:2,this.loadingData=!1,i.legendConfig?(this.legendConfig=i.legendConfig,this.legendData={keys:[],data:[]},this.displayLegend=!0):this.displayLegend=!1,this.caulculateLegendData=this.displayLegend&&this.type===bt.timeseries&&(this.legendConfig.showMin===!0||this.legendConfig.showMax===!0||this.legendConfig.showAvg===!0||this.legendConfig.showTotal===!0||this.legendConfig.showLatest===!0),this.initDataSubscription().subscribe({next:function(){s.next(a),s.complete()},error:function(){s.error(null)}}))}return Object.defineProperty(e.prototype,"firstDatasource",{get:function(){var t;return this.type===bt.alarm?this.alarmSource:!((t=this.datasources)===null||t===void 0)&&t.length?this.datasources[0]:null},enumerable:!1,configurable:!0}),e.prototype.initRpc=function(){var t=this,i=new be;return this.ctx.aliasController.resolveSingleEntityInfoForTargetDevice(this.targetDevice).subscribe({next:function(r){if(r!=null&&r.id&&(t.targetEntityId={id:r.id,entityType:r.entityType},t.targetEntityName=r.name),(r==null?void 0:r.entityType)===wt.DEVICE&&(t.targetDeviceId=r.id),t.targetDeviceId)t.rpcEnabled=!0;else if(t.rpcEnabled=t.ctx.utils.widgetEditMode,!t.rpcEnabled)if(t.targetEntityId){var n=t.ctx.translate.instant(D1.get(t.targetEntityId.entityType).type);t.rpcDisabledReason=t.ctx.translate.instant("rpc.error.invalid-target-entity",{entityType:n})}else t.rpcDisabledReason=t.ctx.translate.instant("rpc.error.target-device-is-not-set");t.hasResolvedData=!0,t.callbacks.rpcStateChanged(t),i.next(),i.complete()},error:function(){t.rpcEnabled=!1,t.rpcDisabledReason=t.ctx.translate.instant("rpc.error.failed-to-resolve-target-device"),t.callbacks.rpcStateChanged(t),i.next(),i.complete()}}),i.asObservable()},e.prototype.initAlarmSubscription=function(){var t=this,i=new be(1);return this.loadStDiff().subscribe(function(){t.ctx.aliasController?t.ctx.aliasController.resolveAlarmSource(t.alarmSource).subscribe({next:function(r){t.alarmSource=r,r&&(t.hasResolvedData=!0),t.configureAlarmsData(),i.next(),i.complete()},error:function(r){i.error(r)}}):(t.hasResolvedData=!0,t.configureAlarmsData(),i.next(null),i.complete())}),i.asObservable()},e.prototype.configureAlarmsData=function(){this.notifyDataLoaded()},e.prototype.initDataSubscription=function(){var t=this;this.notifyDataLoading();var i=new be(1);return this.loadStDiff().subscribe(function(){t.ctx.aliasController?t.ctx.aliasController.resolveDatasources(t.configuredDatasources,t.singleEntity,t.pageSize).subscribe({next:function(r){t.configuredDatasources=r,t.prepareDataSubscriptions().subscribe(function(){i.next(),i.complete()})},error:function(r){t.notifyDataLoaded(),i.error(r)}}):(t.configuredDatasources=Kt(t.configuredDatasources),t.hasResolvedData=!0,t.prepareDataSubscriptions().subscribe(function(){i.next(null),i.complete()}))}),i.asObservable()},e.prototype.prepareDataSubscriptions=function(){var t=this;if(this.hasDataPageLink||!this.configuredDatasources||!this.configuredDatasources.length)return this.hasResolvedData=!0,this.notifyDataLoaded(),sn(null);if(this.comparisonEnabled){var i=[];this.configuredDatasources.forEach(function(r,n){var a=[];if(r.dataKeys.forEach(function(o,l){if(sg(o.settings)&&o.settings.comparisonSettings.showValuesForComparison){var h=Kt(o);h.isAdditional=!0,h.origDataKeyIndex=l,a.push(h)}}),a.length){var s=Kt(r);s.dataKeys=a,s.isAdditional=!0,s.origDatasourceIndex=n,i.push(s)}}),this.configuredDatasources=this.configuredDatasources.concat(i)}return Jf(this.configuredDatasources.map(function(r,n){var a={subscriptionType:t.type,useTimewindow:t.useTimewindow,configDatasource:r,configDatasourceIndex:n,dataLoaded:function(s,o,l,h){t.dataLoaded(s,o,l,h,!0)},initialPageDataChanged:t.initialPageDataChanged.bind(t),forceReInit:t.forceReInit.bind(t),dataUpdated:t.dataUpdated.bind(t),updateRealtimeSubscription:function(){return t.updateRealtimeSubscription()},setRealtimeSubscription:function(s){t.updateRealtimeSubscription(Kt(s))}};return t.entityDataListeners.push(a),t.ctx.entityDataService.prepareSubscription(a,t.ignoreDataUpdateOnIntervalTick)})).pipe(Ua(function(r){r.forEach(function(n){n&&t.dataLoaded(n.pageData,n.data,n.datasourceIndex,n.pageLink,!1)}),t.configureLoadedData(),t.hasResolvedData=t.datasources.length>0,t.updateDataTimewindow(),t.notifyDataLoaded(),t.onDataUpdated(!0),t.hasLatestData&&t.onLatestDataUpdated(!0)}))},e.prototype.resetData=function(){this.data.length=0,this.latestData.length=0,this.hiddenData.length=0,this.displayLegend&&(this.legendData.keys.length=0,this.legendData.data.length=0),this.onDataUpdated(),this.hasLatestData&&this.onLatestDataUpdated()},e.prototype.getFirstEntityInfo=function(){var t,i,r,n,a,s;if(this.type===bt.rpc)this.targetEntityId&&(r=this.targetEntityId,n=this.targetEntityName,a=this.targetEntityName);else if(this.type===bt.alarm){if(this.alarmSource&&this.alarmSource.entityType&&this.alarmSource.entityId)r={entityType:this.alarmSource.entityType,id:this.alarmSource.entityId},n=this.alarmSource.entityName,a=this.alarmSource.entityLabel,s=this.alarmSource.entityDescription;else if(this.alarms&&this.alarms.data.length){var o=this.alarms.data[0];if(r=o.originator,n=o.originatorName,a=o.originatorLabel,o.latest&&o.latest[Pt.ENTITY_FIELD]){var l=o.latest[Pt.ENTITY_FIELD].additionalInfo;if(l){var h=l.value;if(h&&h.length)try{var c=JSON.parse(h);c&&c.description&&(s=c.description)}catch{}}}}}else try{for(var u=kt(this.datasources),d=u.next();!d.done;d=u.next()){var f=d.value;if(f&&f.entityType&&f.entityId){r={entityType:f.entityType,id:f.entityId},n=f.entityName,a=f.entityLabel,s=f.entityDescription;break}}}catch(m){t={error:m}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}return r?{entityId:r,entityName:n,entityLabel:a,entityDescription:s}:null},e.prototype.onAliasesChanged=function(t){return this.type===bt.rpc?this.checkRpcTarget(t):this.type===bt.alarm?this.checkAlarmSource(t):this.checkSubscriptions(t)},e.prototype.onFiltersChanged=function(t){return this.type!==bt.rpc&&(this.type===bt.alarm?this.checkAlarmSourceFilters(t):this.checkSubscriptionsFilters(t))},e.prototype.onDataUpdated=function(t){var i=this;this.cafs.dataUpdated&&(this.cafs.dataUpdated(),this.cafs.dataUpdated=null),this.cafs.dataUpdated=this.ctx.raf.raf(function(){try{i.callbacks.onDataUpdated(i,t)}catch(r){i.callbacks.onDataUpdateError(i,r)}})},e.prototype.onLatestDataUpdated=function(t){var i=this;this.cafs.latestDataUpdated&&(this.cafs.latestDataUpdated(),this.cafs.latestDataUpdated=null),this.cafs.latestDataUpdated=this.ctx.raf.raf(function(){try{i.callbacks.onLatestDataUpdated(i,t)}catch(r){i.callbacks.onLatestDataUpdateError(i,r)}})},e.prototype.onSubscriptionMessage=function(t){var i=this;this.cafs.message&&(this.cafs.message(),this.cafs.message=null),this.cafs.message=this.ctx.raf.raf(function(){i.callbacks.onSubscriptionMessage(i,t)})},e.prototype.onDashboardTimewindowChanged=function(t){var i=!1,r=!1;this.useTimewindow?this.useDashboardTimewindow&&(this.type===bt.latest&&t&&this.timezone!==t.timezone&&(this.timezone=t.timezone,i=this.updateTsOffset()),!i0(this.timeWindowConfig,t)&&t&&(r=Vo(this.timeWindowConfig,t),this.timeWindowConfig=Kt(t),i=!0)):this.type===bt.latest&&t&&this.timezone!==t.timezone&&(this.timezone=t.timezone,i=this.updateTsOffset()),i&&this.update(r)},e.prototype.updateDataVisibility=function(t){if(this.displayLegend){var i=this.legendData.keys.find(function(r){return r.dataIndex===t}).dataKey.hidden;i?(this.hiddenData[t].data=this.data[t].data,this.data[t].data=[]):(this.data[t].data=this.hiddenData[t].data,this.hiddenData[t].data=[]),this.onDataUpdated()}},e.prototype.updateTimewindowConfig=function(t){if(!this.useDashboardTimewindow){this.type===bt.latest&&t&&this.timezone!==t.timezone&&(this.timezone=t.timezone,this.updateTsOffset());var i=Vo(this.timeWindowConfig,t);this.timeWindowConfig=t,this.update(i)}},e.prototype.onResetTimewindow=function(){if(this.useDashboardTimewindow)this.ctx.dashboardTimewindowApi.onResetTimewindow();else if(this.originalTimewindow){var t=Vo(this.timeWindowConfig,this.originalTimewindow);this.timeWindowConfig=Kt(this.originalTimewindow),this.originalTimewindow=null,this.callbacks.timeWindowUpdated(this,this.timeWindowConfig),this.update(t)}},e.prototype.onUpdateTimewindow=function(t,i,r){if(this.useDashboardTimewindow)this.ctx.dashboardTimewindowApi.onUpdateTimewindow(t,i);else{this.originalTimewindow||(this.originalTimewindow=Kt(this.timeWindowConfig)),this.timeWindowConfig=bD(this.timeWindowConfig,t,i,r,this.ctx.timeService),this.callbacks.timeWindowUpdated(this,this.timeWindowConfig);var n=Vo(this.timeWindowConfig,this.originalTimewindow);this.update(n)}},e.prototype.sendOneWayCommand=function(t,i,r,n,a,s,o,l){return this.sendCommand(!0,t,i,r,n,a,s,o,l)},e.prototype.sendTwoWayCommand=function(t,i,r,n,a,s,o,l){return this.sendCommand(!1,t,i,r,n,a,s,o,l)},e.prototype.clearRpcError=function(){this.rpcRejection=null,this.rpcErrorText=null,this.callbacks.onRpcErrorCleared(this)},e.prototype.completedCommand=function(){this.executingSubjects.forEach(function(t){t.next(null),t.complete()})},e.prototype.sendCommand=function(t,i,r,n,a,s,o,l,h){var c=this;if(this.rpcEnabled){!this.rpcRejection||this.rpcRejection.status&&this.rpcRejection.status===504||(this.rpcRejection=null,this.rpcErrorText=null,this.callbacks.onRpcErrorCleared(this));var u={method:i,params:r,persistent:a,retries:o,additionalInfo:l,requestUUID:h};n&&n>0&&(u.timeout=n);var d=new or;return this.executingRpcRequest=!0,this.callbacks.rpcStateChanged(this),this.ctx.utils.widgetEditMode?setTimeout(function(){c.executingRpcRequest=!1,c.callbacks.rpcStateChanged(c),t?(d.next(),d.complete()):(d.next(u),d.complete())},500):(this.executingSubjects.push(d),(t?this.ctx.deviceService.sendOneWayRpcCommand(this.targetDeviceId,u):this.ctx.deviceService.sendTwoWayRpcCommand(this.targetDeviceId,u)).pipe(Da(function(f){if(a&&s>0){var m=Math.max(s,1e3);return XS(n?Math.min(n+1e3,m):m,m).pipe(Da(function(){return c.ctx.deviceService.getPersistedRpc(f.rpcId,!0)}),QS(function(g){return g.status!==Ee.DELIVERED&&g.status!==Ee.QUEUED}),Da(function(g){return[Ee.TIMEOUT,Ee.EXPIRED].includes(g.status)?Gc(function(){return{status:504}}):g.status===Ee.FAILED?Gc(function(){return{status:502,statusText:g.response.error}}):sn(g.response)}),(p=d,sr(function(g,y){Fr(p).subscribe(Ni(y,function(){return y.complete()},_l)),!y.closed&&g.subscribe(y)})))}var p;return sn(f)})).subscribe({next:function(f){c.rpcRejection=null,c.rpcErrorText=null;var m=c.executingSubjects.indexOf(d);m>=0&&c.executingSubjects.splice(m,1),c.executingRpcRequest=c.executingSubjects.length>0,c.callbacks.onRpcSuccess(c),d.next(f),d.complete()},error:function(f){var m=c.executingSubjects.indexOf(d);if(m>=0&&c.executingSubjects.splice(m,1),c.executingRpcRequest=c.executingSubjects.length>0,c.callbacks.rpcStateChanged(c),!c.executingRpcRequest||f.status===504){if(c.rpcRejection=f,f.status===504)c.rpcErrorText=c.ctx.translate.instant("rpc.error.request-timeout");else{c.rpcErrorText=c.ctx.translate.instant("rpc.error.rpc-http-error",{status:f.status,statusText:f.statusText});var p=FD(f,c.ctx.translate);p&&(c.rpcErrorText+="</br>",c.rpcErrorText+=p.message)}c.callbacks.onRpcFailed(c)}d.error(f)}})),d.asObservable()}return this.rpcErrorText=this.rpcDisabledReason,this.rpcRejection=new Error(this.rpcErrorText),Gc(function(){return c.rpcRejection})},e.prototype.update=function(t){t===void 0&&(t=!1),this.type!==bt.rpc&&(this.widgetTimewindowChangedSubject.next(this.timeWindowConfig),this.type===bt.alarm?this.updateAlarmDataSubscription():this.type===bt.timeseries&&this.options.comparisonEnabled&&t?this.forceReInit():this.hasDataPageLink?this.updateDataSubscriptions():(this.notifyDataLoading(),this.dataSubscribe()))},e.prototype.subscribe=function(){var t=this;this.subscribed||(this.subscribed=!0,this.cafs.subscribe&&(this.cafs.subscribe(),this.cafs.subscribe=null),this.cafs.subscribe=this.ctx.raf.raf(function(){t.doSubscribe()}))},e.prototype.stopSubscription=function(t){var i=this.entityDataListeners[t];i&&this.ctx.entityDataService.stopSubscription(i)},e.prototype.subscribeAllForPaginatedData=function(t,i){var r=this,n=[];return this.configuredDatasources.forEach(function(a,s){n.push(r.subscribeForPaginatedData(s,t,i))}),n.length?Jf(n):sn(null)},e.prototype.subscribeForPaginatedData=function(t,i,r){var n=this,a=this.entityDataListeners[t];a&&this.ctx.entityDataService.stopSubscription(a);var s=this.configuredDatasources[t];return s?(this.useTimewindow&&this.timeWindowConfig&&this.updateRealtimeSubscription(),a={subscriptionType:this.type,useTimewindow:this.useTimewindow,configDatasource:s,configDatasourceIndex:t,subscriptionTimewindow:this.subscriptionTimewindow,latestTsOffset:this.tsOffset,dataLoaded:function(o,l,h,c){n.dataLoaded(o,l,h,c,!0)},dataUpdated:this.dataUpdated.bind(this),updateRealtimeSubscription:function(){return n.updateRealtimeSubscription()},setRealtimeSubscription:function(o){n.updateRealtimeSubscription(Kt(o))}},this.entityDataListeners[t]=a,this.ctx.entityDataService.subscribeForPaginatedData(a,i,r,this.ignoreDataUpdateOnIntervalTick)):sn(null)},e.prototype.subscribeForAlarms=function(t,i){this.alarmDataListener&&this.ctx.alarmDataService.stopSubscription(this.alarmDataListener),this.timeWindowConfig&&this.updateRealtimeSubscription(),this.alarmDataListener={subscriptionTimewindow:this.subscriptionTimewindow,alarmSource:this.alarmSource,alarmsLoaded:this.alarmsLoaded.bind(this),alarmsUpdated:this.alarmsUpdated.bind(this)},this.alarms={data:[],totalPages:0,totalElements:0,hasNext:!1},this.ctx.alarmDataService.subscribeForAlarms(this.alarmDataListener,t,i);var r=!1;this.alarmSource.unresolvedStateEntity&&(r=!0),r&&this.onDataUpdated()},e.prototype.doSubscribe=function(){this.type!==bt.rpc&&this.type!==bt.alarm&&this.dataSubscribe()},e.prototype.updateDataTimewindow=function(){this.hasDataPageLink||this.useTimewindow&&this.timeWindowConfig&&(this.updateRealtimeSubscription(),this.comparisonEnabled&&this.updateSubscriptionForComparison())},e.prototype.dataSubscribe=function(){var t=this;if(this.updateDataTimewindow(),!this.hasDataPageLink){this.useTimewindow&&this.timeWindowConfig&&this.subscriptionTimewindow.fixedWindow&&this.onDataUpdated();var i=!this.datasources.length,r=!this.entityDataListeners.filter(function(n){return!!n.subscription}).length;this.entityDataListeners.forEach(function(n){t.comparisonEnabled&&n.configDatasource.isAdditional?n.subscriptionTimewindow=t.timewindowForComparison:(n.subscriptionTimewindow=t.subscriptionTimewindow,n.latestTsOffset=t.tsOffset),t.ctx.entityDataService.startSubscription(n)}),i&&this.onDataUpdated(),r&&this.notifyDataLoaded()}},e.prototype.unsubscribe=function(){var t=this;this.type!==bt.rpc&&(this.type===bt.alarm?this.alarmsUnsubscribe():(this.entityDataListeners.forEach(function(i){i!=null&&t.ctx.entityDataService.stopSubscription(i)}),this.entityDataListeners.length=0,this.resetData())),this.subscribed=!1},e.prototype.alarmsUnsubscribe=function(){this.alarmDataListener&&(this.ctx.alarmDataService.stopSubscription(this.alarmDataListener),this.alarmDataListener=null)},e.prototype.checkRpcTarget=function(t){var i;return((i=this.targetDevice)===null||i===void 0?void 0:i.type)===Lr.entity&&t.indexOf(this.targetDevice.entityAliasId)>-1},e.prototype.checkAlarmSource=function(t){return this.options.alarmSource&&this.options.alarmSource.entityAliasId&&t.indexOf(this.options.alarmSource.entityAliasId)>-1&&this.updateAlarmSubscription(),!1},e.prototype.checkAlarmSourceFilters=function(t){return this.options.alarmSource&&this.options.alarmSource.filterId&&t.indexOf(this.options.alarmSource.filterId)>-1&&this.updateAlarmSubscription(),!1},e.prototype.updateAlarmSubscription=function(){var t=this;this.alarmSource=this.options.alarmSource,this.ctx.aliasController?this.ctx.aliasController.resolveAlarmSource(this.alarmSource).subscribe({next:function(i){t.alarmSource=i,i&&(t.hasResolvedData=!0),t.configureAlarmsData(),t.updateAlarmDataSubscription()},error:function(){t.notifyDataLoaded()}}):(this.hasResolvedData=!0,this.configureAlarmsData(),this.updateAlarmDataSubscription())},e.prototype.updateAlarmDataSubscription=function(){if(this.alarmDataListener){var t=this.alarmDataListener.alarmDataSubscriptionOptions.pageLink,i=this.alarmDataListener.alarmDataSubscriptionOptions.additionalKeyFilters;this.subscribeForAlarms(t,i)}},e.prototype.checkSubscriptions=function(t){var i,r,n=!1,a=this.options.datasources;if(a)try{for(var s=kt(a),o=s.next();!o.done;o=s.next()){var l=o.value;if(l.entityAliasId&&t.indexOf(l.entityAliasId)>-1){n=!0;break}}}catch(h){i={error:h}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return n&&this.hasDataPageLink&&(n=!1,this.updateDataSubscriptions()),n},e.prototype.checkSubscriptionsFilters=function(t){var i,r,n=!1,a=this.options.datasources;if(a)try{for(var s=kt(a),o=s.next();!o.done;o=s.next()){var l=o.value;if(l.filterId&&t.indexOf(l.filterId)>-1){n=!0;break}}}catch(h){i={error:h}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return n&&this.hasDataPageLink&&(n=!1,this.updateDataSubscriptions()),n},e.prototype.updateDataSubscriptions=function(){var t=this;this.configuredDatasources=dg(this.options.datasources),this.ctx.aliasController?this.ctx.aliasController.resolveDatasources(this.configuredDatasources,this.singleEntity,this.pageSize).subscribe({next:function(i){t.configuredDatasources=i,t.prepareDataSubscriptions().subscribe(function(){t.updatePaginatedDataSubscriptions()})},error:function(){t.notifyDataLoaded()}}):(this.configuredDatasources=Kt(this.configuredDatasources),this.hasResolvedData=!0,this.prepareDataSubscriptions().subscribe(function(){t.updatePaginatedDataSubscriptions()}))},e.prototype.updatePaginatedDataSubscriptions=function(){for(var t=0;t<this.entityDataListeners.length;t++)this.stopSubscription(t);for(t=0;t<this.entityDataListeners.length;t++){var i=this.entityDataListeners[t];if(i){var r=i.subscriptionOptions.pageLink,n=i.subscriptionOptions.additionalKeyFilters;this.subscribeForPaginatedData(t,r,n)}}},e.prototype.isDataResolved=function(){return this.hasResolvedData},e.prototype.destroy=function(){var t,i;this.unsubscribe(),this.widgetTimewindowChangedSubject.complete();try{for(var r=kt(Object.keys(this.cafs)),n=r.next();!n.done;n=r.next()){var a=n.value;this.cafs[a]&&(this.cafs[a](),this.cafs[a]=null)}}catch(s){t={error:s}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.notifyDataLoading=function(){this.loadingData=!0,this.callbacks.dataLoading(this)},e.prototype.notifyDataLoaded=function(){this.loadingData=!1,this.callbacks.dataLoading(this)},e.prototype.updateTimewindow=function(){if(this.timeWindow.interval=this.subscriptionTimewindow.aggregation.interval||1e3,this.timeWindow.timezone=this.subscriptionTimewindow.timezone,this.timeWindow.tsOffset=this.subscriptionTimewindow.tsOffset,this.subscriptionTimewindow.realtimeWindowMs)if(this.subscriptionTimewindow.quickInterval){var t=Qu(this.subscriptionTimewindow.quickInterval,this.subscriptionTimewindow.timezone);this.timeWindow.maxTime=t[1]+this.subscriptionTimewindow.tsOffset,this.timeWindow.minTime=t[0]+this.subscriptionTimewindow.tsOffset}else{var i=NP().valueOf()+this.subscriptionTimewindow.tsOffset+this.timeWindow.stDiff;(!this.timeWindow.maxTime||Math.abs(i-this.timeWindow.maxTime)>500)&&(this.timeWindow.maxTime=i,this.timeWindow.maxTime-=this.timeWindow.maxTime%1e3,this.timeWindow.minTime=this.timeWindow.maxTime-this.subscriptionTimewindow.realtimeWindowMs)}else this.subscriptionTimewindow.fixedWindow&&(this.timeWindow.maxTime=this.subscriptionTimewindow.fixedWindow.endTimeMs+this.subscriptionTimewindow.tsOffset,this.timeWindow.minTime=this.subscriptionTimewindow.fixedWindow.startTimeMs+this.subscriptionTimewindow.tsOffset)},e.prototype.updateTsOffset=function(){var t=Ol(this.timezone);return this.tsOffset!==t&&(this.tsOffset=t,!0)},e.prototype.updateRealtimeSubscription=function(t){return this.subscriptionTimewindow=t||ED(this.timeWindowConfig,this.timeWindow.stDiff,this.stateData,this.ctx.timeService),this.updateTimewindow(),this.subscriptionTimewindow},e.prototype.updateComparisonTimewindow=function(){this.comparisonTimeWindow.interval=this.timewindowForComparison.aggregation.interval||1e3,this.comparisonTimeWindow.timezone=this.timewindowForComparison.timezone,this.timewindowForComparison.fixedWindow&&(this.comparisonTimeWindow.maxTime=this.timewindowForComparison.fixedWindow.endTimeMs+this.timewindowForComparison.tsOffset,this.comparisonTimeWindow.minTime=this.timewindowForComparison.fixedWindow.startTimeMs+this.timewindowForComparison.tsOffset)},e.prototype.updateSubscriptionForComparison=function(){return this.timewindowForComparison=Zy(this.subscriptionTimewindow,this.timeForComparison,this.comparisonCustomIntervalValue),this.updateComparisonTimewindow(),this.timewindowForComparison},e.prototype.initialPageDataChanged=function(t){this.callbacks.onInitialPageDataChanged(this,t)},e.prototype.forceReInit=function(){this.callbacks.forceReInit()},e.prototype.dataLoaded=function(t,i,r,n,a){var s=this,o=this.configuredDatasources[r];o.dataReceived=!0;var l=t.data.map(function(u,d){return s.entityDataToDatasource(o,u,d)});this.datasourcePages[r]={data:l,hasNext:t.hasNext,totalElements:t.totalElements,totalPages:t.totalPages};var h=l.map(function(u,d){return s.entityDataToDatasourceData(u,i[d])});if(this.dataPages[r]={data:h,hasNext:t.hasNext,totalElements:t.totalElements,totalPages:t.totalPages},o.type===Ct.entity&&t.hasNext&&!this.singleEntity&&this.warnOnPageDataOverflow){var c=this.ctx.translate.instant("widget.data-overflow",{count:t.data.length,total:t.totalElements});this.onSubscriptionMessage({severity:"warn",message:c})}a&&(this.configureLoadedData(),this.onDataUpdated(!0),this.hasLatestData&&this.onLatestDataUpdated(!0))},e.prototype.configureLoadedData=function(){var t=this;this.datasources.length=0,this.data.length=0,this.latestData.length=0,this.hiddenData.length=0,this.hasLatestData=!1,this.displayLegend&&(this.legendData.keys.length=0,this.legendData.data.length=0);var i=0,r=0;this.configuredDatasources.forEach(function(a,s){a.dataKeyStartIndex=i,a.latestDataKeyStartIndex=r;var o=t.datasourcePages[s],l=t.dataPages[s];o&&o.data.forEach(function(h,c){h.dataKeys.forEach(function(u,d){var f,m=l.data[c][d];if(t.data.push(m),t.hiddenData.push({data:[]}),t.displayLegend){var p=ze(u.decimals)?u.decimals:t.decimals,g=typeof(f=u.units)=="object"&&f!==null&&rr(f==null?void 0:f.from)||rr(f)?u.units:t.units,y=td.fromSettings(t.ctx.unitService,{decimals:p,units:g}),T={dataKey:u,dataIndex:i,valueFormat:y};t.legendData.keys.push(T),t.legendData.data.push({min:null,max:null,avg:null,total:null,latest:null,hidden:!1})}i++}),h.latestDataKeys&&h.latestDataKeys.length&&(t.hasLatestData=!0,h.latestDataKeys.forEach(function(u,d){var f=h.dataKeys.length+d,m=l.data[c][f];t.latestData.push(m),r++})),t.datasources.push(h)})});var n=0;this.datasources.forEach(function(a){a.dataKeys.forEach(function(s){(a.generated||a.isAdditional)&&(s._hash=Math.random(),s.color=t.ctx.utils.getMaterialColor(n)),n++}),a.latestDataKeys&&a.latestDataKeys.forEach(function(s){(a.generated||a.isAdditional)&&(s._hash=Math.random())})}),this.comparisonEnabled&&this.datasourcePages.forEach(function(a){a.data.forEach(function(s,o){if(s.isAdditional){var l=t.datasourcePages[s.origDatasourceIndex].data[o];s.dataKeys.forEach(function(h){h.settings.comparisonSettings.color&&(h.color=h.settings.comparisonSettings.color),l.dataKeys[h.origDataKeyIndex].settings.comparisonSettings.color=h.color})}})}),this.caulculateLegendData&&(this.data.forEach(function(a,s){t.updateLegend(s,a.data,!1)}),this.callbacks.legendDataUpdated(this,!0))},e.prototype.entityDataToDatasourceData=function(t,i){var r=this,n=[];n=n.concat(t.dataKeys.map(function(u,d){u.hidden=!!u.settings.hideDataByDefault,u.inLegend=u.settings.showInLegend||pn(u.settings.showInLegend)&&!u.settings.removeFromLegend,u.label=r.ctx.utils.customTranslation(u.label,u.label);var f={datasource:t,dataKey:u,data:[]};return i&&i[d]&&i[d].data&&(f.data=i[d].data),f})),t.latestDataKeys&&(n=n.concat(t.latestDataKeys.map(function(u,d){u.label=r.ctx.utils.customTranslation(u.label,u.label);var f={datasource:t,dataKey:u,data:[]},m=t.dataKeys.length+d;return i&&i[m]&&i[m].data&&(f.data=i[m].data),f})));var a,s,o,l,h=(a=n,l===void 0&&(l=function(u){return u.datasource.entityName+u.datasource.entityType}),Object.values(JI(a,l)).map(function(u,d){var f=(function(m,p){return{entityName:m.entityName,deviceName:m.entityName,entityId:m.entityId,entityType:m.entityType,entityLabel:m.entityLabel||m.entityName,entityDescription:m.entityDescription,aliasName:m.aliasName,$datasource:m,dsIndex:p,dsName:m.name,deviceType:null}})(u[0].datasource,d);return u.filter(function(m){return m.data.length}).forEach(function(m){var p=Ye(s)?s:m.data.length-1,g=Ye(o)?m.data.find(function(y){return y[0]===o}):m.data[p];g===void 0||f.hasOwnProperty(m.dataKey.label)&&g[1]===""||(f[m.dataKey.label]=g[1],f[m.dataKey.label+"|ts"]=g[0],m.dataKey.label.toLowerCase()==="type"&&(f.deviceType=g[1]))}),f})),c=(function(u){var d,f,m={};if(u.length){try{for(var p=kt(u),g=p.next();!g.done;g=p.next()){var y=g.value;m=lr(lr({},m),y)}}catch(b){d={error:b}}finally{try{g&&!g.done&&(f=p.return)&&f.call(p)}finally{if(d)throw d.error}}var T=u[0];m.entityName=T.entityName,m.deviceName=T.deviceName,m.entityId=T.entityId,m.entityType=T.entityType,m.entityLabel=T.entityLabel,m.entityDescription=T.entityDescription,m.aliasName=T.aliasName,m.$datasource=T.$datasource,m.dsIndex=T.dsIndex,m.dsName=T.dsName,m.deviceType=T.deviceType}return m})(h);return t.dataKeys.forEach(function(u){r.comparisonEnabled&&u.isAdditional&&sg(u.settings)&&u.settings.comparisonSettings.comparisonValuesLabel?u.label=ug(u.settings.comparisonSettings.comparisonValuesLabel,c):(r.comparisonEnabled&&u.isAdditional&&(u.label=u.label+" "+r.ctx.translate.instant("legend.comparison-time-ago."+r.timeForComparison)),u.pattern=u.label,u.label=ug(u.pattern,c))}),n},e.prototype.entityDataToDatasource=function(t,i,r){var n=Kt(t);return yO(n,vO(i)),n.generated=r>0,n},e.prototype.dataUpdated=function(t,i,r,n,a,s){s?this.processLatestDataUpdated(t,i,r,n,a):this.processDataUpdated(t,i,r,n,a)},e.prototype.processDataUpdated=function(t,i,r,n,a){var s,o=this.configuredDatasources[i],l=o.dataKeyStartIndex+r*o.dataKeys.length+n,h=!0;if(s=this.displayLegend&&this.legendData.keys.find(function(f){return f.dataIndex===l}).dataKey.hidden?this.hiddenData[l]:this.data[l],this.type===bt.latest){var c=s.data;if(t.data.length||c.length){if(c&&c[0]&&c[0].length>1&&t.data.length>0){var u=c[0][0],d=c[0][1];u===t.data[0][0]&&d===t.data[0][1]&&t.data[0][1]!==s0&&(h=!1)}}else h=!1}h?(this.subscriptionTimewindow&&this.subscriptionTimewindow.realtimeWindowMs&&(this.updateTimewindow(),this.timewindowForComparison&&this.timewindowForComparison.realtimeWindowMs&&this.updateComparisonTimewindow()),s.data=t.data,this.caulculateLegendData&&this.updateLegend(l,t.data,a),this.notifyDataLoaded(),this.onDataUpdated(a)):this.loadingData&&this.notifyDataLoaded()},e.prototype.processLatestDataUpdated=function(t,i,r,n,a){var s=this.configuredDatasources[i],o=s.latestDataKeyStartIndex+r*s.latestDataKeys.length+n-s.dataKeys.length,l=!0,h=this.latestData[o],c=h.data;if(t.data.length){if(c&&c[0]&&c[0].length>1&&t.data.length>0){var u=c[0][0],d=c[0][1];u===t.data[0][0]&&d===t.data[0][1]&&(l=!1)}}else l=!1;l&&(h.data=t.data,this.onLatestDataUpdated(a))},e.prototype.alarmsLoaded=function(t,i,r){if(this.alarms=t,r>i){var n=this.ctx.translate.instant("widget.alarm-data-overflow",{allowedEntities:i,totalEntities:r});this.onSubscriptionMessage({severity:"warn",message:n})}this.subscriptionTimewindow&&this.subscriptionTimewindow.realtimeWindowMs&&this.updateTimewindow(),this.onDataUpdated()},e.prototype.alarmsUpdated=function(t,i){this.alarmsLoaded(i,0,0)},e.prototype.updateLegend=function(t,i,r){var n=this.legendData.keys.find(function(s){return s.dataIndex===t}).valueFormat,a=this.legendData.data[t];this.legendConfig.showMin&&(a.min=n.format((function(s){if(s.length>0){for(var o=Number(s[0][1]),l=1;l<s.length;l++)o=Math.min(o,Number(s[l][1]));return o}return null})(i))),this.legendConfig.showMax&&(a.max=n.format((function(s){if(s.length>0){for(var o=Number(s[0][1]),l=1;l<s.length;l++)o=Math.max(o,Number(s[l][1]));return o}return null})(i))),this.legendConfig.showAvg&&(a.avg=n.format((function(s){return s.length>0?np(s)/s.length:null})(i))),this.legendConfig.showTotal&&(a.total=n.format(np(i))),this.legendConfig.showLatest&&(a.latest=n.format((function(s){return s.length>0?Number(s[s.length-1][1]):null})(i))),this.callbacks.legendDataUpdated(this,r!==!1)},e.prototype.loadStDiff=function(){var t=this,i=new be(1);return this.ctx.getServerTimeDiff&&this.timeWindow?this.ctx.getServerTimeDiff().subscribe({next:function(r){t.timeWindow.stDiff=r,i.next(),i.complete()},error:function(){t.timeWindow.stDiff=0,i.next(),i.complete()}}):(this.timeWindow&&(this.timeWindow.stDiff=0),i.next(),i.complete()),i.asObservable()},e})(),hh=hn,Qo=7300*un,k0=(function(){function e(){this.maxDatapointsLimit=500}return e.prototype.setMaxDatapointsLimit=function(t){this.maxDatapointsLimit=t,(!this.maxDatapointsLimit||this.maxDatapointsLimit<=1)&&(this.maxDatapointsLimit=2)},e.prototype.matchesExistingInterval=function(t,i,r,n){return n===void 0&&(n=!1),this.getIntervals(t,i,n).findIndex(function(a){return a.value===r})>-1},e.prototype.getIntervals=function(t,i,r){return r===void 0&&(r=!1),t=this.boundMinInterval(t),i=this.boundMaxInterval(i),SD.filter(function(n){return(r||typeof n.value=="number")&&Ar.numberValue(n.value)>=t&&Ar.numberValue(n.value)<=i})},e.prototype.boundMinInterval=function(t){return Ye(t)&&(t=1e3*Math.ceil(t/1e3)),this.toBound(t,hh,Qo,hh)},e.prototype.boundMaxInterval=function(t){return Ye(t)&&(t=1e3*Math.floor(t/1e3)),this.toBound(t,hh,Qo,Qo)},e.prototype.boundToPredefinedInterval=function(t,i,r,n){n===void 0&&(n=!1);var a=this.getIntervals(t,i,n),s=Qo,o=r||t;if(!a.length)return o;var l=a.find(function(c){return c.value===o});if(l)return l.value;var h=a[0];return a.forEach(function(c){var u=Math.abs(Ar.numberValue(c.value)-Ar.numberValue(o));u<=s&&(h=c,s=u)}),h.value},e.prototype.boundIntervalToTimewindow=function(t,i,r){if(r===Lt.NONE)return hn;var n=this.minIntervalLimit(t),a=this.maxIntervalLimit(t);return i?this.toIntervalBound(i,n,a,i):this.boundToPredefinedInterval(n,a,this.avgInterval(t))},e.prototype.getMaxDatapointsLimit=function(){return this.maxDatapointsLimit},e.prototype.getMinDatapointsLimit=function(){return 1},e.prototype.avgInterval=function(t){var i=t/200;return this.boundMinInterval(i)},e.prototype.minIntervalLimit=function(t){var i=t/500;return this.boundMinInterval(i)},e.prototype.maxIntervalLimit=function(t){var i=t/1;return this.boundMaxInterval(i)},e.prototype.defaultTimewindow=function(){return yD(this)},e.prototype.toBound=function(t,i,r,n){return Ye(t)?(t=Math.max(t,i),t=Math.min(t,r)):n},e.prototype.toIntervalBound=function(t,i,r,n){return Ye(t)?(t=Ar.max(t,i),t=Ar.min(t,r)):n},e=bi([Ti(),wi("design:paramtypes",[])],e)})(),I0=(function(){function e(t,i){this.window=t,this.ngZone=i;var r=this.window.requestAnimationFrame||this.window.webkitRequestAnimationFrame,n=this.window.cancelAnimationFrame||this.window.webkitCancelAnimationFrame||this.window.webkitCancelRequestAnimationFrame;this.rafSupported=!!r,this.rafSupported?this.rafFunction=function(a){var s=r(a);return function(){n(s)}}:this.rafFunction=function(a){var s=setTimeout(a,16.66);return function(){clearTimeout(s)}}}return e.prototype.raf=function(t,i){var r=this;return i===void 0&&(i=!1),i?this.rafFunction(t):this.ngZone.runOutsideAngular(function(){return r.rafFunction(t)})},e=bi([Ti(),ie(0,re(Nt.Window)),ie(1,re(Nt.NgZone)),wi("design:paramtypes",[Object,oo])],e)})(),UP=(function(){function e(t,i,r,n,a,s,o,l,h,c){this.utils=t,this.timeService=i,this.deviceService=r,this.entityDataService=n,this.alarmDataService=a,this.rafService=s,this.translate=o,this.http=l,this.window=h,this.telemetryService=c}return e.prototype.createEntityAttributesSubscription=function(t,i,r){var n=fn.createEntityAttributesSubscription(this.telemetryService,t,i,null,r);return n.subscribe(),n.attributeData$().pipe(Jv(function(){try{n.unsubscribe()}catch{}}))},e.prototype.createSubscriptionContext=function(){var t=new QO({aliasController:void 0});return t.dashboardTimewindowApi={onResetTimewindow:function(){},onUpdateTimewindow:function(){}},t.timeService=this.timeService,t.deviceService=this.deviceService,t.translate=this.translate,t.entityDataService=this.entityDataService,t.alarmDataService=this.alarmDataService,t.utils=this.utils,t.raf=this.rafService,t.widgetUtils={formatValue:MD,getEntityDetailsPageURL:UD},t.getServerTimeDiff=this.getServerTimeDiff.bind(this),t},e.prototype.subscribeForLatestTelemetry=function(t,i){return this.createEntityAttributesSubscription(t,vn.LATEST_TELEMETRY,i)},e.prototype.subscribeForLatestAttributes=function(t,i){return this.createEntityAttributesSubscription(t,yi.SERVER_SCOPE,i)},e.prototype.createDefaultSubscription=function(t){var i,r=new be;return t.type!==bt.rpc&&t.type!==bt.static?(i={type:t.type,stateData:!1,datasourcesOptional:!1,hasDataPageLink:t.hasDataPageLink,singleEntity:!1,warnOnPageDataOverflow:!1,ignoreDataUpdateOnIntervalTick:!0,pageSize:t.pageSize,useDashboardTimewindow:!1,dashboardTimewindow:{timezone:this.window.timezone},timeWindowConfig:t.timeWindowConfig||{},callbacks:t.callbacks||{}},t.type===bt.alarm?i.alarmSource=Kt(t.alarmSource):i.datasources=Kt(t.datasources),this.createSubscription(i).subscribe(function(n){r.next(n),r.complete()},function(n){r.error(n)})):t.type===bt.rpc?((i={type:t.type,targetDevice:t.targetDevice}).callbacks={rpcStateChanged:function(n){},onRpcSuccess:function(n){},onRpcFailed:function(n){},onRpcErrorCleared:function(n){}},this.createSubscription(i).subscribe(function(n){r.next(n),r.complete()},function(n){r.error(n)})):(t.type,bt.static,r.next(null),r.complete()),r.asObservable()},e.prototype.createSubscription=function(t,i){var r=new be,n=this.createSubscriptionContext(),a=new LP(n,t);return a.init$.subscribe(function(){i&&a.subscribe(),r.next(a),r.complete()},function(s){r.error(s)}),r.asObservable()},e.prototype.subscribeForAlarms=function(t,i,r,n){var a=new or,s={alarmSource:{type:Ct.entity,dataKeys:[{type:Qt.alarm,name:"createdTime"},{type:Qt.alarm,name:"originator"},{type:Qt.alarm,name:"type"},{type:Qt.alarm,name:"severity"},{type:Qt.alarm,name:"status"}],entityFilter:t},alarmsLoaded:function(o,l,h){a.next({pageData:o})},alarmsUpdated:function(o,l){a.next({pageData:l,update:o})},subscriptionTimewindow:n};return this.alarmDataService.subscribeForAlarms(s,i,r),a.asObservable()},e.prototype.getServerTimeDiff=function(){if(!this.stDiffObservable){var t=Date.now();this.stDiffObservable=this.http.fetchServerTime().pipe(Ua(function(i){var r=Date.now();return Math.ceil(i-(t+r)/2)}),Zv(1),_u())}return this.stDiffObservable},e=bi([Ti(),ie(0,re(Nt.UtilsService)),ie(1,re(Nt.TimeService)),ie(2,re(Nt.DeviceService)),ie(3,re(Nt.EntityDataService)),ie(4,re(Nt.AlarmDataService)),ie(5,re(Nt.RafService)),ie(6,re(Nt.TranslateService)),ie(7,re(Nt.HttpClient)),ie(8,re(Nt.Window)),ie(9,re(Nt.TelemetryWebsocketService)),wi("design:paramtypes",[Zu,k0,Object,R0,v0,I0,lc,Object,Object,mo])],e)})(),FP=(function(){function e(t,i){this.window=t,this.ngZone=i}return e.prototype.getItem=function(t){return window&&window.XMLHttpRequest?localStorage.getItem(t):wx.getStorageSync(t)},e.prototype.setItem=function(t,i){return window&&window.XMLHttpRequest?localStorage.setItem(t,i):wx.setStorageSync(t,i)},e.prototype.removeItem=function(t){return window&&window.XMLHttpRequest?localStorage.removeItem(t):wx.removeStorageSync(t)},e=bi([Ti(),ie(0,re(Nt.Window)),ie(1,re(Nt.NgZone)),wi("design:paramtypes",[Object,oo])],e)})(),BP=(function(e){function t(i,r,n,a){var s=e.call(this,r,n,"api/ws/plugins/telemetry",new m0,a)||this;return s.telemetryWebsocketService=i,s.authService=r,s.ngZone=n,s.window=a,s}return Le(t,e),t.prototype.subscribe=function(i){this.telemetryWebsocketService.subscribe(i)},t.prototype.update=function(i){this.telemetryWebsocketService.update(i)},t.prototype.unsubscribe=function(i){this.telemetryWebsocketService.unsubscribe(i)},t.prototype.processOnMessage=function(i){this.telemetryWebsocketService.processOnMessage(i)},t=bi([Ti(),ie(0,re(Nt.TelemetryWebsocketService)),ie(1,re(Nt.AuthService)),ie(2,re(Nt.NgZone)),ie(3,re(Nt.Window)),wi("design:paramtypes",[mo,Object,oo,Object])],t)})(p0),jP=(function(){function e(t,i){this.translate=t,this.store=i,this.currentUnitSystem=Or.METRIC,this.converter=OP(this.translate)}return e.prototype.getUnitSystem=function(){return this.currentUnitSystem},e.prototype.setUnitSystem=function(t){rr(t)?this.currentUnitSystem=t:this.currentUnitSystem=this.getUnitSystemByTimezone()},e.prototype.getUnits=function(t,i){var r;return(r=this.converter)===null||r===void 0?void 0:r.listUnits(t,i)},e.prototype.getUnitsGroupedByMeasure=function(t,i,r){var n;return(n=this.converter)===null||n===void 0?void 0:n.unitsGroupByMeasure(t,i,r)},e.prototype.getUnitInfo=function(t){return this.converter.describe(t)},e.prototype.getDefaultUnit=function(t,i){return this.converter.getDefaultUnit(t,i)},e.prototype.geUnitConverter=function(t,i){try{if(rp(t)){var r=this.getTargetUnitSymbol(t);return this.converter.getUnitConverter(t.from,r)}return rr(i)?this.converter.getUnitConverter(t,i):function(n){return n}}catch(n){return console.warn(n),function(a){return a}}},e.prototype.getTargetUnitSymbol=function(t){return uo(t)?rr(t[this.currentUnitSystem])?t[this.currentUnitSystem]:t.from:typeof t=="string"?t:null},e.prototype.convertUnitValue=function(t,i,r){try{if(rp(i)){var n=this.getTargetUnitSymbol(i);return this.converter.convert(t,i.from,n)}return rr(r)?this.converter.convert(t,i,r):t}catch(a){return console.warn(a),t}},e.prototype.getUnitSystemByTimezone=function(){var t=rh.tz.guess(!0);return rh.tz.zonesForCountry("GB").includes(t)?Or.HYBRID:["US","LR","MM"].some(function(i){return rh.tz.zonesForCountry(i).includes(t)})?Or.IMPERIAL:Or.METRIC},e=bi([Ti(),ie(0,re(Nt.TranslateService)),wi("design:paramtypes",[lc,Object])],e)})(),ke=new Cl;ke.bind(Nt.TelemetryWebsocketService).to(mo).inSingletonScope(),ke.bind(Nt.LocalStorage).to(FP),ke.bind(Nt.NgZone).to(oo),ke.bind(Nt.AlarmDataService).to(v0),ke.bind(Nt.EntityDataService).to(R0),ke.bind(Nt.DataSubscriptionService).to(UP),ke.bind(Nt.UtilsService).to(Zu),ke.bind(Nt.UnitService).to(jP),ke.bind(Nt.TimeService).to(k0),ke.bind(Nt.RafService).to(I0),ke.bind(Nt.TranslateService).to(lc),ke.bind(Nt.NotificationWebsocketService).to(BP);var nu={},WP=Object.prototype.hasOwnProperty;function ap(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function sp(e){try{return encodeURIComponent(e)}catch{return null}}nu.stringify=function(e,t){t=t||"";var i,r,n=[];for(r in typeof t!="string"&&(t="?"),e)if(WP.call(e,r)){if((i=e[r])||i!=null&&!isNaN(i)||(i=""),r=sp(r),i=sp(i),r===null||i===null)continue;n.push(r+"="+i)}return n.length?t+n.join("&"):""},nu.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,r={};t=i.exec(e);){var n=ap(t[1]),a=ap(t[2]);n===null||a===null||n in r||(r[n]=a)}return r};var C0=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},sl=nu,zP=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,D0=/[\n\r\t]/g,VP=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,op=/:\d+$/,HP=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,YP=/^[a-zA-Z]:/;function ed(e){return(e||"").toString().replace(zP,"")}var au=[["#","hash"],["?","query"],function(e,t){return ar(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],lp={hash:1,query:1};function O0(e){var t,i=(typeof window<"u"?window:Mi!==void 0?Mi:typeof self<"u"?self:{}).location||{},r={},n=typeof(e=e||i);if(e.protocol==="blob:")r=new er(unescape(e.pathname),{});else if(n==="string")for(t in r=new er(e,{}),lp)delete r[t];else if(n==="object"){for(t in e)t in lp||(r[t]=e[t]);r.slashes===void 0&&(r.slashes=VP.test(e.href))}return r}function ar(e){return e==="file:"||e==="ftp:"||e==="http:"||e==="https:"||e==="ws:"||e==="wss:"}function M0(e,t){e=(e=ed(e)).replace(D0,""),t=t||{};var i,r=HP.exec(e),n=r[1]?r[1].toLowerCase():"",a=!!r[2],s=!!r[3],o=0;return a?s?(i=r[2]+r[3]+r[4],o=r[2].length+r[3].length):(i=r[2]+r[4],o=r[2].length):s?(i=r[3]+r[4],o=r[3].length):i=r[4],n==="file:"?o>=2&&(i=i.slice(2)):ar(n)?i=r[4]:n?a&&(i=i.slice(2)):o>=2&&ar(t.protocol)&&(i=r[4]),{protocol:n,slashes:a||ar(n),slashesCount:o,rest:i}}function er(e,t,i){if(e=(e=ed(e)).replace(D0,""),!(this instanceof er))return new er(e,t,i);var r,n,a,s,o,l,h=au.slice(),c=typeof t,u=this,d=0;for(c!=="object"&&c!=="string"&&(i=t,t=null),i&&typeof i!="function"&&(i=sl.parse),r=!(n=M0(e||"",t=O0(t))).protocol&&!n.slashes,u.slashes=n.slashes||r&&t.slashes,u.protocol=n.protocol||t.protocol||"",e=n.rest,(n.protocol==="file:"&&(n.slashesCount!==2||YP.test(e))||!n.slashes&&(n.protocol||n.slashesCount<2||!ar(u.protocol)))&&(h[3]=[/(.*)/,"pathname"]);d<h.length;d++)typeof(s=h[d])!="function"?(a=s[0],l=s[1],a!=a?u[l]=e:typeof a=="string"?~(o=a==="@"?e.lastIndexOf(a):e.indexOf(a))&&(typeof s[2]=="number"?(u[l]=e.slice(0,o),e=e.slice(o+s[2])):(u[l]=e.slice(o),e=e.slice(0,o))):(o=a.exec(e))&&(u[l]=o[1],e=e.slice(0,o.index)),u[l]=u[l]||r&&s[3]&&t[l]||"",s[4]&&(u[l]=u[l].toLowerCase())):e=s(e,u);i&&(u.query=i(u.query)),r&&t.slashes&&u.pathname.charAt(0)!=="/"&&(u.pathname!==""||t.pathname!=="")&&(u.pathname=(function(f,m){if(f==="")return m;for(var p=(m||"/").split("/").slice(0,-1).concat(f.split("/")),g=p.length,y=p[g-1],T=!1,b=0;g--;)p[g]==="."?p.splice(g,1):p[g]===".."?(p.splice(g,1),b++):b&&(g===0&&(T=!0),p.splice(g,1),b--);return T&&p.unshift(""),y!=="."&&y!==".."||p.push(""),p.join("/")})(u.pathname,t.pathname)),u.pathname.charAt(0)!=="/"&&ar(u.protocol)&&(u.pathname="/"+u.pathname),C0(u.port,u.protocol)||(u.host=u.hostname,u.port=""),u.username=u.password="",u.auth&&(~(o=u.auth.indexOf(":"))?(u.username=u.auth.slice(0,o),u.username=encodeURIComponent(decodeURIComponent(u.username)),u.password=u.auth.slice(o+1),u.password=encodeURIComponent(decodeURIComponent(u.password))):u.username=encodeURIComponent(decodeURIComponent(u.auth)),u.auth=u.password?u.username+":"+u.password:u.username),u.origin=u.protocol!=="file:"&&ar(u.protocol)&&u.host?u.protocol+"//"+u.host:"null",u.href=u.toString()}er.prototype={set:function(e,t,i){var r=this;switch(e){case"query":typeof t=="string"&&t.length&&(t=(i||sl.parse)(t)),r[e]=t;break;case"port":r[e]=t,C0(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=t,r.port&&(t+=":"+r.port),r.host=t;break;case"host":r[e]=t,op.test(t)?(t=t.split(":"),r.port=t.pop(),r.hostname=t.join(":")):(r.hostname=t,r.port="");break;case"protocol":r.protocol=t.toLowerCase(),r.slashes=!i;break;case"pathname":case"hash":if(t){var n=e==="pathname"?"/":"#";r[e]=t.charAt(0)!==n?n+t:t}else r[e]=t;break;case"username":case"password":r[e]=encodeURIComponent(t);break;case"auth":var a=t.indexOf(":");~a?(r.username=t.slice(0,a),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=t.slice(a+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(t))}for(var s=0;s<au.length;s++){var o=au[s];o[4]&&(r[o[1]]=r[o[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&ar(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function(e){e&&typeof e=="function"||(e=sl.stringify);var t,i=this,r=i.host,n=i.protocol;n&&n.charAt(n.length-1)!==":"&&(n+=":");var a=n+(i.protocol&&i.slashes||ar(i.protocol)?"//":"");return i.username?(a+=i.username,i.password&&(a+=":"+i.password),a+="@"):i.password?(a+=":"+i.password,a+="@"):i.protocol!=="file:"&&ar(i.protocol)&&!r&&i.pathname!=="/"&&(a+="@"),(r[r.length-1]===":"||op.test(i.hostname)&&!i.port)&&(r+=":"),a+=r+i.pathname,(t=typeof i.query=="object"?e(i.query):i.query)&&(a+=t.charAt(0)!=="?"?"?"+t:t),i.hash&&(a+=i.hash),a}},er.extractProtocol=M0,er.location=O0,er.trimLeft=ed,er.qs=sl;var qP=er,cp=(function(){function e(){}return e.prototype.run=function(t){return t()},e})(),KP=(function(){function e(t){var i=this;this.options=t,ke.bind(Nt.Window).toDynamicValue(function(){return{location:new qP(t.wsUrl),timezone:t.timezone||"Asia/Shanghai"}}).inSingletonScope(),ke.bind(Nt.AuthService).toDynamicValue(function(){return{getJwtToken:t.getJwtToken,isJwtTokenValid:function(){var r=localStorage.getItem("jwt_token_expiration");return r&&Number(r)>new Date().valueOf()+2e3},refreshJwtToken:function(){return xn(t.refreshJwtToken())},onRefreshJwtTokenError:t.onRefreshJwtTokenError,authenticationChange:function(r){i.notifyResetCallback=r}}}).inSingletonScope(),ke.bind(Nt.HttpClient).toDynamicValue(function(){return{fetchServerTime:function(){return xn(t.fetchServerTime())}}}).inSingletonScope(),ke.bind(Nt.DeviceService).toDynamicValue(function(){return{sendOneWayRpcCommand:function(r,n){return xn(t.sendOneWayRpcCommand(r,n))},sendTwoWayRpcCommand:function(r,n){return xn(t.sendTwoWayRpcCommand(r,n))},getPersistedRpc:function(r){return xn(t.getPersistedRpc(r))}}}).inSingletonScope()}return e.prototype.getNotificationWebsocketService=function(){var t=ke.get(Nt.NotificationWebsocketService);return{createNotificationCountSubscription:function(){return ps.createNotificationCountSubscription(t,new cp)},createNotificationsSubscription:function(i){return ps.createNotificationsSubscription(t,new cp,i)},markAsRead:function(i){return ps.createMarkAsReadCommand(t,i)},markAllAsRead:function(){return ps.createMarkAllAsReadCommand(t)}}},e.prototype.createWidgetSubscription=function(t){return ke.get(Nt.DataSubscriptionService).createDefaultSubscription(t)},e.prototype.getAlarmDataSubscriptionService=function(){var t=ke.get(Nt.DataSubscriptionService),i=this;return{subscribeForLatestPaginatedAlarmsData:function(r,n,a){return t.subscribeForAlarms(r,n,a)},subscribeForHistoryPaginatedAlarmsData:function(r,n,a,s){var o={fixedWindow:s,realtimeWindowMs:null,timezone:i.options.timezone,tsOffset:Ol(i.options.timezone)};return t.subscribeForAlarms(r,n,a,o)},subscribeForRealtimePaginatedAlarmsData:function(r,n,a,s){var o={fixedWindow:null,realtimeWindowMs:s,timezone:i.options.timezone,tsOffset:Ol(i.options.timezone)};return t.subscribeForAlarms(r,n,a,o)}}},e.prototype.getRpcService=function(){var t=ke.get(Nt.DataSubscriptionService);return{sendOneWayCommand:function(i,r,n,a,s,o,l,h,c){var u;return(u={type:bt.rpc,targetDevice:{type:Lr.device,deviceId:i},targetDeviceIds:[i]}).callbacks={rpcStateChanged:function(d){},onRpcSuccess:function(d){},onRpcFailed:function(d){},onRpcErrorCleared:function(d){}},t.createSubscription(u).pipe(Da(function(d){return d.sendOneWayCommand(r,n,a,s,o,l,h,c)}))},sendTwoWayCommand:function(i,r,n,a,s,o,l,h,c){var u;return(u={type:bt.rpc,targetDevice:{type:Lr.device,deviceId:i},targetDeviceIds:[i]}).callbacks={rpcStateChanged:function(d){},onRpcSuccess:function(d){},onRpcFailed:function(d){},onRpcErrorCleared:function(d){}},t.createSubscription(u).pipe(Da(function(d){return d.sendTwoWayCommand(r,n,a,s,o,l,h,c)}))}}},e.prototype.notifyReset=function(){this.notifyResetCallback&&this.notifyResetCallback()},e})();const P0=async()=>{if(Tb(),!Eb())return Promise.reject("刷新token无效");const e=await GP();ph(e.token),_b(e.refreshToken),Ws()?window.parent.postMessage({type:"refreshTokenInfo",data:{jwt_token:e.token,refresh_token:e.refreshToken}},"*"):meta2d.emit("refreshTokenInfo",{jwt_token:e.token,refresh_token:e.refreshToken})};let uh;const hp=e=>{const t=new KP({wsUrl:e,getJwtToken:cl,refreshJwtToken:P0,onRefreshJwtTokenError:async()=>{cl()&&await N0(),t.notifyReset(),Ws()?window.parent.postMessage({type:"login"},"*"):meta2d.store.emitter.emit("login")},fetchServerTime:async()=>(uh||(uh=$P()),uh),sendOneWayRpcCommand:(i,r)=>XP(i,r),sendTwoWayRpcCommand:(i,r)=>QP(i,r),getPersistedRpc:i=>JP(i)});return t},Xn=Ae.create({timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"}});Xn.interceptors.request.use(e=>{const t=cl();return t&&(e.headers.Authorization=`Bearer ${t}`,e.headers["X-Authorization"]=`Bearer ${t}`),e},e=>Promise.reject(e));Xn.interceptors.response.use(e=>{const t=e.data;return t.code&&t.code!==200?(Kr.error(t.msg||"Error"),Promise.reject(new Error(t.msg||"Error"))):t},e=>{var t;if(e.response)switch(e.response.status){case 401:P0().then(()=>{location.reload()}).catch(async()=>{cl()&&await N0(),Kr.error("Unauthorized, please log in again"),Ws()?window.parent.postMessage({type:"login"},"*"):meta2d.store.emitter.emit("login")});break;case 403:Kr.error("Access denied");break;case 404:Kr.error("Request resource not found");break;case 500:Kr.error("Server error");break;default:Kr.error(((t=e.response.data)==null?void 0:t.msg)||"Request failed")}else e.request?Kr.error("No response from server"):Kr.error(e.message||"Request error");return Promise.reject(e)});const Bi=e=>Xn(e);Bi.get=(e,t)=>Xn.get(e,t);Bi.post=(e,t,i)=>Xn.post(e,t,i);Bi.put=(e,t,i)=>Xn.put(e,t,i);Bi.delete=(e,t)=>Xn.delete(e,t);const sU=(e,t)=>Bi({method:"post",url:"/api/auth/login",data:{username:e,password:t}}),GP=()=>Bi({method:"post",url:"/api/auth/token",data:{refreshToken:Sb()}}),N0=()=>Bi.post("/api/auth/logout"),$P=()=>Bi({method:"get",url:"/api/dashboard/serverTime"}),XP=(e,t)=>Bi.post(`/api/rpc/oneway/${e}`,t),QP=(e,t)=>Bi.post(`/api/rpc/twoway/${e}`,t),JP=e=>Bi.get(`/api/rpc/persistent/${e}`);function ZP(e,t){const{x:i,y:r,width:n,height:a}=t.calculative.worldRect;e.beginPath(),e.ellipse(i+n/2,r+a/2,n/2,a/2,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.fillStyle=e.strokeStyle,e.ellipse(i+n/2,r+a/2,n/4,a/4,0,0,Math.PI*2),e.fill()}function tN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s,ey:o}=e.calculative.worldRect,l=e.calculative.lineLeft||.08;let h=e.calculative.borderRadius||0,c=h;h<1&&(h=a*h,c=s*h);let u=h<c?h:c;if(a<2*u&&(u=a/2),s<2*u&&(u=s/2),i.moveTo(r+u,n),i.arcTo(r+a,n,r+a,n+s,u),i.arcTo(r+a,n+s,r,n+s,u),i.arcTo(r,n+s,r,n,u),i.arcTo(r,n,r+a,n,u),i.closePath(),i.moveTo(r+l*a,n),i.lineTo(r+l*a,o),i instanceof Path2D)return i}function eN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s,ex:o}=e.calculative.worldRect,l=e.calculative.lineTop||.08;let h=e.calculative.borderRadius||0,c=h;h<1&&(h=a*h,c=s*c);let u=h<c?h:c;if(a<2*u&&(u=a/2),s<2*u&&(u=s/2),i.moveTo(r+u,n),i.arcTo(r+a,n,r+a,n+s,u),i.arcTo(r+a,n+s,r,n+s,u),i.arcTo(r,n+s,r,n,u),i.arcTo(r,n,r+a,n,u),i.closePath(),i.moveTo(r,n+l*s),i.lineTo(o,n+l*s),i instanceof Path2D)return i}function iN(){return{forkV:Bn,forkH:Bn,swimlaneH:tN,swimlaneV:eN}}function rN(){return{activityFinal:ZP}}var js;(function(e){e[e.Add=0]="Add",e[e.Replace=1]="Replace",e[e.ReplaceAll=2]="ReplaceAll"})(js||(js={}));let su=["fontSize","nameGap","margin","width","symbolSize","itemWidth","itemHeight","fontWeight","top","left","right","bottom","zoom","edgeSymbolSize","nodeWidth","nodeGap","distance","length","length2","offsetCenter","size","symbolOffset","padding","barWidth","symbolOffset","shadowOffsetY","shadowOffsetX","itemGap"];function nN(e){var n,a;let t=globalThis.echarts;if(!e.echarts||!t)return;if(typeof e.echarts=="string")try{e.echarts=JSON.parse(e.echarts)}catch{}su=((n=e.calculative.canvas.store.options.diagramOptions.chart)==null?void 0:n.keyWords)||su,e.onDestroy||(e.onDestroy=sN,e.onMove=ol,e.onResize=oN,e.onRotate=ol,e.onValue=cN,e.onBeforeValue=hN,e.onBinds=dN,e.onMouseEnter=ol,e.onRenderPenRaw=dh,e.onScale=lN),e.calculative.singleton||(e.calculative.singleton={});const i=new Path2D,r=e.calculative.worldRect;if(!e.calculative.singleton.div){const s=document.createElement("div");s.style.position="absolute",s.style.outline="none",s.style.left="-9999px",s.style.top="-9999px",s.style.width=r.width+"px",s.style.height=r.height+"px",document.body.appendChild(s),(a=e.calculative.canvas.externalElements)==null||a.parentElement.appendChild(s),Se(e,s),e.calculative.singleton.div=s,e.calculative.singleton.echart=t.init(s,e.echarts.theme),aN(e),e.calculative.singleton.echartsReady=!0,e.echarts.geoName&&!t.getMap(e.echarts.geoName)&&(e.echarts.geoJson?t.registerMap(e.echarts.geoName,e.echarts.geoJson):e.echarts.geoUrl&&(e.calculative.singleton.echartsReady=!1,fetch(e.echarts.geoUrl).then(o=>{o.text().then(l=>{if(typeof l=="string")try{l=JSON.parse(l)}catch{}if(l.constructor!==Object&&l.constructor!==Array){console.warn("Invalid data:",l);return}t.registerMap(e.echarts.geoName,l),e.calculative.singleton.echartsReady=!0,e.calculative.singleton.echart.setOption(Xl(e.echarts.option,e.calculative.canvas.store.data.scale),!0),e.calculative.singleton.echart.resize(),setTimeout(()=>{dh(e)},300)})}))),e.calculative.singleton.echartsReady&&setTimeout(()=>{var o;(o=e.calculative.singleton.echart)==null||o.setOption(Xl(e.echarts.option,e.calculative.canvas.store.data.scale),!0),setTimeout(()=>dh(e),300)})}return i}function aN(e){var r;const t=e.calculative.singleton.echart,i=["click","dblclick","mousedown","mousemove","mouseup","mouseover","mouseout","globalout","contextmenu"];i.forEach(n=>{t.off(n)}),(r=e.events)==null||r.forEach(n=>{n.actions&&n.actions.length&&i.includes(n.name)&&t.on(n.name,a=>{let s=!1;n.conditions&&n.conditions.length?n.conditionType==="and"?s=n.conditions.every(o=>e.calculative.canvas.parent.judgeCondition(e,o.key,o)):n.conditionType==="or"&&(s=n.conditions.some(o=>e.calculative.canvas.parent.judgeCondition(e,o.key,o))):s=!0,s&&n.actions.forEach(o=>{if(o.timeout){let l=setTimeout(()=>{e.calculative.canvas.parent.events[o.action]&&(e.calculative.canvas.parent.events[o.action](e,o,a),clearTimeout(l),l=null)},o.timeout)}else e.calculative.canvas.parent.events[o.action]&&e.calculative.canvas.parent.events[o.action](e,o,a)})})})}function sN(e){if(e.calculative.singleton&&e.calculative.singleton.div){e.calculative.singleton.div.remove();let t=globalThis.echarts;t&&t.dispose(e.calculative.singleton.echart),delete e.calculative.singleton.div,delete e.calculative.singleton.echart}}function ol(e){e.calculative.singleton.div&&Se(e,e.calculative.singleton.div)}function oN(e){var t;ol(e),(t=e.calculative.singleton)!=null&&t.echart&&e.calculative.singleton.echart.resize()}function lN(e){var i,r;if(!e.calculative.singleton.echart)return;let t=globalThis.echarts;if(Se(e,e.calculative.singleton.div),!(e.echarts.geoName&&!t.getMap(e.echarts.geoName))){if(!(e.echarts.diabled||e.echarts.disabled)){if((i=e.echarts.option)!=null&&i.dataZoom){const n=e.calculative.singleton.echart.getOption();if(n!=null&&n.dataZoom){const a=n.dataZoom;(r=e.echarts.option.dataZoom)==null||r.forEach((s,o)=>{a[o]&&(s.start=a[o].start,s.end=a[o].end)})}}e.calculative.singleton.echart.setOption(Xl(e.echarts.option,e.calculative.canvas.store.data.scale),!0)}e.calculative.singleton.echart.resize()}}function cN(e){var t,i;if(e.calculative.singleton.echart&&(Se(e,e.calculative.singleton.div),e.calculative.singleton.echartsReady))if(e.calculative.partialOption){const r=e.calculative.partialOption.echarts.option;(Array.isArray((t=e.echarts)==null?void 0:t.replaceMerge)?(i=e.echarts)==null?void 0:i.replaceMerge.some(a=>r[a]):!1)?e.calculative.singleton.echart.setOption(lt(r),{replaceMerge:e.echarts.replaceMerge}):e.calculative.singleton.echart.setOption(lt(r))}else e.calculative.singleton.echart.setOption(Xl(e.echarts.option,e.calculative.canvas.store.data.scale),!0)}function hN(e,t){if(e.calculative.partialOption=null,t.echarts){let m=globalThis.echarts;return t.echarts.geoName&&!m.getMap(t.echarts.geoName)&&(t.echarts.geoJson?m.registerMap(t.echarts.geoName,t.echarts.geoJson):t.echarts.geoUrl&&(e.calculative.singleton.echartsReady=!1,fetch(t.echarts.geoUrl).then(p=>{p.text().then(g=>{if(typeof g=="string")try{g=JSON.parse(g)}catch{}if(g.constructor!==Object&&g.constructor!==Array){console.warn("Invalid data:",g);return}return m.registerMap(t.echarts.geoName,g),e.calculative.singleton.echartsReady=!0,e.onValue(e),!1})}))),t}if(e.realTimes&&e.realTimes.length){e.echarts.dataMap&&t.data&&(t=uN(e,t));let m=Object.keys(t);const{xAxis:p,yAxis:g}=e.echarts.option,{max:y,replaceMode:T,timeFormat:b,autoGetTime:S=!0}=e.echarts;let I=[],D=!1;for(let O in t)if(O.includes("echarts.option")){D=!0;let P=Zi(e,O);if(Array.isArray(P)&&T===js.Add&&(P.push(t[O]),y&&P.splice(0,P.length-y),t[O]=P,S&&!m.includes("echarts.option.xAxis.data"))){let q="echarts.option.xAxis.data";Array.isArray(p)&&p.length&&(q="echarts.option.xAxis.0.data");let J=Zi(e,q),A=wh(b||"`${hours}:${minutes}:${seconds}`");J.push(A),y&&J.splice(0,J.length-y),t[q]=J}if(O.includes(".data.")){let q=O.substring(0,O.indexOf(".data.")+5);I.includes(q)||I.push(q)}}if(D){const O=lt(t);e.calculative.partialOption=fN(O,e),I.forEach(P=>{let q=Zi(e,P);ml(e.calculative.partialOption,P,q)})}return t}if(!t.dataX&&!t.dataY)return t;const i=e.echarts,{max:r,replaceMode:n}=i;let a=t.dataX,s=t.dataY,o=[];s&&o.push("echarts.option.series");const l=i.option.series,h=l.length,{xAxis:c,yAxis:u}=i.option;Array.isArray(c)&&c.length>1&&console.warn("echarts 只支持单 x 轴，多 x 轴将被忽略");const d=Array.isArray(c)?c[0]:c,f=Array.isArray(u)?u[0]:u;if(n)if(n===js.Replace){if(!d&&!f)s&&(h===1?(!Array.isArray(s)&&(s=[s]),s.forEach((m,p)=>{const g=l[0].data.find(y=>y.name===m.name);g&&(g.value=m.value)})):l.forEach((m,p)=>{Array.isArray(s[p])||(s[p]=[s[p]]),s[p].forEach((g,y)=>{const T=m.data.find(b=>b.name===g.name);T&&(T.value=g.value)})}));else if((d.type==="category"||f.type==="category")&&a&&s){const m=d.type==="category"?d.data:f.data;!Array.isArray(a)&&(a=[a]),!Array.isArray(s)&&(s=[s]),d.type==="category"?o.push("echarts.option.xAxis"):o.push("echarts.option.yAxis"),h===1?s.forEach((p,g)=>{const y=m.indexOf(a[g]);l[0].data[y]=p}):l.forEach((p,g)=>{s[g].forEach((y,T)=>{const b=m.indexOf(a[T]);p.data[b]=y})})}}else n===js.ReplaceAll&&(a&&(d.data=a,d.data.splice(0,d.data.length-r),o.push("echarts.option.xAxis")),s&&(h===1?(l[0].data=s,l[0].data.splice(0,l[0].data.length-r)):l.forEach((m,p)=>{m.data=s[p],m.data.splice(0,m.data.length-r)})));else{if(a){!Array.isArray(a)&&(a=[a]);const m=d.data;m.push(...a),m.splice(0,m.length-r),o.push("echarts.option.xAxis")}if(s)if(h===1){!Array.isArray(s)&&(s=[s]);const m=l[0].data;m.push(...s),m.splice(0,m.length-r)}else l.forEach((m,p)=>{Array.isArray(s[p])||(s[p]=[s[p]]);const g=m.data;g.push(...s[p]),g.splice(0,g.length-r)})}return e.calculative.partialOption={},o.forEach(m=>{let p=Zi(e,m);ml(e.calculative.partialOption,m,p)}),delete t.dataX,delete t.dataY,Object.assign(t,{echarts:i})}function uN(e,t){var i,r;if(!e.echarts.dataMap||!t.data)return t;if(t.data){let n={};if(Array.isArray(t.data))for(const a in e.echarts.dataMap)e.echarts.dataMap.hasOwnProperty(a)&&((i=e.echarts.timeKeys)!=null&&i.length&&e.echarts.timeKeys.includes(e.echarts.dataMap[a])?n[a]=t.data.map(s=>wh(e.echarts.timeFormat,s[e.echarts.dataMap[a]])):n[a]=t.data.map(s=>s[e.echarts.dataMap[a]]));else for(const a in e.echarts.dataMap)e.echarts.dataMap.hasOwnProperty(a)&&((r=e.echarts.timeKeys)!=null&&r.length&&e.echarts.timeKeys.includes(e.echarts.dataMap[a])?n[a]=wh(e.echarts.timeFormat,t.data[e.echarts.dataMap[a]]):n[a]=t.data[e.echarts.dataMap[a]]);return delete t.data,Object.assign(t,n),t}}function dN(e,t,i){if(i.key!=="dataY")return;const r=e.echarts,{xAxis:n,yAxis:a}=r.option;Array.isArray(n)&&n.length>1&&console.warn("echarts 只支持单 x 轴，多 x 轴将被忽略");const s=Array.isArray(n)?n[0]:n,o=Array.isArray(a)?a[0]:a,l=r.option.series;if(!s&&!o){const h=[];if(Array.isArray(l)&&l.length===1)return l[0].data.forEach(c=>{const{dataId:u}=i.dataIds.find(d=>d.name===c.name);if(u){const d=t.find(f=>f.dataId===u);d&&h.push({name:c.name,value:d.value})}}),{id:e.id,dataY:h}}else if(s.type==="category"||o.type==="category"){const h=[],c=[],u=s.type==="category"?s.data:o.data;return u==null||u.forEach(d=>{const{dataId:f}=i.dataIds.find(m=>m.name===d);if(f){const m=t.find(p=>p.dataId===f);m&&(c.push(d),h.push(m.value))}}),{id:e.id,dataY:h,dataX:c}}else if(s.type==="time"){const h=[],c=+new Date;let u=!1;if(l.forEach((d,f)=>{const m=[],{dataId:p}=i.dataIds.find(g=>g.name===d.name);if(p){const g=t.find(y=>y.dataId===p);g&&(m.push([c,g.value]),u=!0)}h[f]=m}),u)h.forEach((d,f)=>{if(!d||d.length===0){const m=l[f].data[l[f].data.length-1];h[f]=[[c,m[1]]]}});else return;return{id:e.id,dataY:h.length===1?h[0]:h}}}function dh(e){var i,r;const t=new Image;t.src=(r=(i=e.calculative.singleton)==null?void 0:i.echart)==null?void 0:r.getDataURL({pixelRatio:2}),e.calculative.img=t}function Xl(e,t){const i=lt(e);if(i.dataZoom){let r=["right","top","width","height","left","bottom"];for(let n=0;n<r.length;n++)i.dataZoom.forEach(a=>{isNaN(a[r[n]])||(a[r[n]]*=t)})}return yh(i,su,t),i}function fN(e,t){const i={};return Object.keys(e).forEach(r=>{const n=r.split(".");let a=i;n.forEach((s,o)=>{const l=!isNaN(parseInt(s));if(o===6){let h=n.slice(0,7).join(".");ml(t,r,e[r]);let c=Zi(t,h);a[n[o]]=c}else{if(o>6)return;if(o===n.length-1)l?(Array.isArray(a)||(a=[]),a[parseInt(s)]=e[r]):a[s]=e[r];else if(l){const h=parseInt(s);if(Array.isArray(a)||a[n[o-1]],a[h]||(a[h]={}),Array.isArray(a))for(let c=0;c<parseInt(s);c++)a[c]||(a[c]={});a=a[h]}else a[s]||(s==="series"?a[s]=[]:a[s]={}),a=a[s]}})}),i}function mN(e){Tr({echarts:nN})}function gN(e,t){e.onDestroy||(e.onDestroy=vN,e.onAdd=pN);const i=t||new Path2D,{x:r,y:n,width:a,height:s,ex:o}=e.calculative.worldRect;let l=e.calculative.borderRadius||0,h=l;l<1&&(l*=a,h*=s);let c=l<h?l:h;a<2*c&&(c=a/2),s<2*c&&(c=s/2),i.moveTo(r+c,n),i.arcTo(r+a,n,r+a,n+s,c),i.arcTo(r+a,n+s,r,n+s,c),i.arcTo(r,n+s,r,n,c),i.arcTo(r,n,r+a,n,c);const u=.2*s;i.moveTo(r,n+u),i.lineTo(o,n+u);const d=n+u+(s-u)/2;if(i.moveTo(r,d),i.lineTo(o,d),i.closePath(),i instanceof Path2D)return i}function pN(e){const{x:t,y:i,width:r,height:n}=e.calculative.worldRect,a=e.list,s={name:"text",x:t,y:i+.2*n,width:r,height:.4*n,textAlign:"left",textBaseline:"top",textLeft:10,textTop:10},o={name:"text",x:t,y:i+.6*n,width:r,height:.4*n,textAlign:"left",textBaseline:"top",textLeft:10,textTop:10};Object.assign(s,a[0]),Object.assign(o,a[1]),e.calculative.canvas.makePen(s),e.calculative.canvas.makePen(o),e.calculative.canvas.parent.pushChildren(e,[s]),e.calculative.canvas.parent.pushChildren(e,[o])}function vN(e){const t=e.calculative.canvas.store;e.children.forEach(i=>{const r=t.data.pens.findIndex(n=>n.id===i);r>-1&&(t.data.pens.splice(r,1),t.pens[i]=void 0)}),e.children=void 0}function yN(e,t){e.onDestroy||(e.onDestroy=wN,e.onAdd=bN);const i=t||new Path2D,{x:r,y:n,width:a,height:s,ex:o}=e.calculative.worldRect;let l=e.calculative.borderRadius||0,h=l;l<1&&(l=a*l,h=s*h);let c=l<h?l:h;a<2*c&&(c=a/2),s<2*c&&(c=s/2),i.moveTo(r+c,n),i.arcTo(r+a,n,r+a,n+s,c),i.lineTo(r+a,n+s-c),i.arcTo(r+a,n+s,r,n+s,c),i.arcTo(r,n+s,r,n,c),i.arcTo(r,n,r+a,n,c);const u=.2*s;if(i.moveTo(r,n+u),i.lineTo(o,n+u),i.closePath(),i instanceof Path2D)return i}function bN(e){const{x:t,y:i,width:r,height:n}=e.calculative.worldRect,a=e.list;let s={name:"text",x:t,y:i+.2*n,width:r,height:.8*n,textAlign:"left",textBaseline:"top",textLeft:10,textTop:10};Object.assign(s,a[0]),e.calculative.canvas.makePen(s),e.calculative.canvas.parent.pushChildren(e,[s])}function wN(e){const t=e.calculative.canvas.store;e.children.forEach(i=>{const r=t.data.pens.findIndex(n=>n.id===i);r>-1&&(t.data.pens.splice(r,1),t.pens[i]=void 0)}),e.children=[]}function TN(){return{interfaceClass:gN,simpleClass:yN}}function EN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,ey:s}=e.calculative.worldRect,o=a/4;if(i.moveTo(r+o,n),i.lineTo(r,n),i.lineTo(r,s),i.lineTo(r+o,s),i instanceof Path2D)return i}function _N(e){const t=[{x:.25,y:0},{x:.25,y:1},{x:0,y:.5}];e.anchors=t.map(({x:i,y:r},n)=>({id:n+"",x:i,y:r,penId:e.id}))}function SN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,ex:s,ey:o}=e.calculative.worldRect,l=e.offsetX;let h=a/7;if(l>1?h=l:l>0&&(h=a*l),i.moveTo(r+h,n),i.lineTo(s,n),i.lineTo(r+a-h,o),i.lineTo(r,o),i.closePath(),i instanceof Path2D)return i}function AN(e){const t=[{x:.5,y:0},{x:.9285714285714286,y:.5},{x:.5,y:1},{x:.07142857142857142,y:.5}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function xN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s,ex:o,ey:l}=e.calculative.worldRect,h=a/8;if(i.moveTo(r+h,n),i.lineTo(o-h,n),i.bezierCurveTo(o+h/3,n,o+h/3,l,o-h,l),i.lineTo(r+h,l),i.lineTo(r,n+s/2),i.closePath(),i instanceof Path2D)return i}function RN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s,ex:o,center:l}=e.calculative.worldRect,h=l.x,c=n+s*6/7,u=s/6;if(i.moveTo(r,n),i.lineTo(o,n),i.lineTo(o,c),i.bezierCurveTo(o-20,c-u,h+a/5,c-u,h,c),i.bezierCurveTo(h-a/5,c+u,r,c+u,r,c),i.closePath(),i instanceof Path2D)return i}function kN(e){const t=[{x:.5,y:0},{x:1,y:.5},{x:.5,y:.8571428571428571},{x:0,y:.5}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function IN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,ex:s,ey:o}=e.calculative.worldRect,l=a/10;if(i.moveTo(r+l*2,n),i.bezierCurveTo(r-l*2/3,n,r-l*2/3,o,r+l*2,o),i.lineTo(s,o),i.bezierCurveTo(s-l,o,s-l,n,s,n),i.closePath(),i instanceof Path2D)return i}function CN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,ex:s,ey:o}=e.calculative.worldRect;i.moveTo(r,n),i.lineTo(s,n),i.lineTo(s,o),i.lineTo(r,o),i.closePath();const l=a/7;if(i.moveTo(r,n+l),i.lineTo(s,n+l),i.moveTo(r+l,n),i.lineTo(r+l,o),i instanceof Path2D)return i}function DN(e,t){const i=t||new Path2D,{x:r,y:n,height:a,ex:s,ey:o}=e.calculative.worldRect,l=a/4;if(i.moveTo(r,n+l),i.lineTo(s,n),i.lineTo(s,o),i.lineTo(r,o),i.closePath(),i instanceof Path2D)return i}function ON(e){const t=[{x:.5,y:.125},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function MN(e,t){const i=t||new Path2D,{x:r,y:n,ex:a,ey:s}=e.calculative.worldRect;if(i.moveTo(r,n),i.lineTo(a,n),i.moveTo(r,s),i.lineTo(a,s),i instanceof Path2D)return i}function PN(e){const t=[{x:.5,y:0},{x:.5,y:1}];e.anchors=t.map(({x:i,y:r},n)=>({id:n+"",x:i,y:r,penId:e.id}))}function NN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s,ex:o,ey:l}=e.calculative.worldRect;if(i.ellipse(r+a/2,n+s/2,a/2,s/2,0,0,Math.PI*2),i.moveTo(r+a/2,l),i.lineTo(o,l),i.closePath(),i instanceof Path2D)return i}function LN(e,t){const i=t||new Path2D,{x:r,y:n,width:a,ex:s,ey:o}=e.calculative.worldRect,l=a/7;if(i.moveTo(r,n),i.lineTo(s,n),i.lineTo(s,o),i.lineTo(r,o),i.closePath(),i.moveTo(r+l,n),i.lineTo(r+l,o),i.moveTo(s-l,n),i.lineTo(s-l,o),i instanceof Path2D)return i}function UN(e,t){const i=t||new Path2D,{x:r,y:n,height:a,ex:s,ey:o}=e.calculative.worldRect,l=a/7;if(i.moveTo(r,n+l),i.bezierCurveTo(r,n-l/2|0,s,n-l/2|0,s,n+l),i.lineTo(s,o-l),i.bezierCurveTo(s,o+l/2|0,r,o+l/2|0,r,o-l),i.closePath(),i.moveTo(r,o-l),i.bezierCurveTo(r,o-l*2|0,s,o-l*2|0,s,o-l),i instanceof Path2D)return i}function FN(){return{flowComment:EN,flowData:SN,flowDb:UN,flowDisplay:xN,flowDocument:RN,flowExternStorage:IN,flowInternalStorage:CN,flowManually:DN,flowParallel:MN,flowQueue:NN,flowSubprocess:LN}}function BN(){return{flowDocument:kN,flowManually:ON,flowParallel:PN,flowComment:_N,flowData:AN}}var Ql;(function(e){e[e.Add=0]="Add",e[e.Replace=1]="Replace",e[e.ReplaceAll=2]="ReplaceAll"})(Ql||(Ql={}));function L0(e,t){const i=t.calculative.worldRect.height*14/16,n=(e.match(/[\u4e00-\u9fa5]/g)||"").length;return(e.length-n)*i*.6+n*i}function U0(e){if(e.direction=="horizontal"){const t=[];let i=0;const r=e.height;e.checkboxHeight=r,e.options.forEach((a,s)=>{t.push(s*(40+r)+i),i+=L0(a.text,e)}),e.optionPos=t;const n=t.length*(40+r)+i;e.checkboxWidth=n,e.width=n,e.calculative.width=n,e.calculative.worldRect={x:e.x,y:e.y,height:e.height,width:e.width,center:{x:e.x+e.width/2,y:e.y+e.height/2}},le(e.calculative.worldRect)}else if(e.direction=="vertical"){e.optionInterval==null&&(e.optionInterval=20),e.optionHeight||(e.optionHeight=20);const t=[];e.options.forEach((r,n)=>{t.push(n*(e.optionInterval+e.optionHeight))}),e.optionPos=t;const i=t[t.length-1]+e.optionHeight;e.checkboxHeight=i,e.width||(e.height=i,e.calculative.height=i,e.calculative.worldRect={x:e.x,y:e.y,height:e.height,width:e.width,center:{x:e.x+e.width/2,y:e.y+e.height/2}},le(e.calculative.worldRect))}}function up(e,t){t.onAdd||(t.onAdd=F0,(!t.rowPos||!t.colPos||!t.calculative.maxOffsetY)&&t.onAdd(t),t.onMouseMove=qN,t.onMouseLeave=KN,t.onMouseDown=GN,t.onShowInput=HN,t.onInput=YN,t.onValue=QN,t.onBeforeValue=JN,t.onMouseEnter=rL,t.onWheel=ZN,t.onDestroy=eL),t.data.length!==t.rowPos.length&&(t.initWorldRect=null,t.calculative.isUpdateData=!0,t.onValue(t)),t.data[0].length!==t.colPos.length&&(t.initWorldRect=null,t.calculative.isUpdateData=!0,t.onValue(t));const i=t.calculative.canvas.store;if(t.calculative.canvas.store.data,t.calculative.canvas.store.options,t.color=t.color||i.styles.color,t.textColor=t.textColor||t.color||i.styles.textColor,t.activeColor=t.activeColor||i.styles.activeColor,t.hoverColor=t.hoverColor||i.styles.hoverColor,t.activeBackground=t.activeBackground||i.styles.activeBackground,t.hoverBackground=t.hoverBackground||i.styles.hoverBackground,!t.hasHeader){e.save(),e.beginPath();const{x:r,y:n,width:a,height:s}=t.calculative.worldRect;e.fillStyle="#fff0",e.rect(r-1,n-1,a+2,s+2),e.fill(),e.clip()}zN(e,t),VN(e,t),jN(e,t),e.restore(),t.isFirstTime=!1}function jN(e,t){if(!t.calculative.hover||!t.calculative.hoverCell||t.calculative.isInput||!t.calculative.isHover)return;let i=t.calculative.worldRect,r=t.calculative.canvas.mousePos;if(!(r.x>i.x&&r.x<i.x+i.width&&r.y>i.y&&r.y<i.y+i.height)){t.calculative.hover=!1,t.calculative.isHover=!1,t.calculative.hoverCell=void 0;return}const{row:n,col:a}=t.calculative.hoverCell,{x:s,y:o}=t.calculative.canvas.mousePos;if(!t.data[n])return;let l=t.data[n][a];if(typeof l=="object"||!l)return;e.save(),e.beginPath(),e.textAlign="start",e.textBaseline="middle",e.font=e.font=(t.calculative.fontStyle||"")+" normal "+(t.calculative.fontWeight||"")+" "+(t.calculative.fontSize||12)+"px "+t.calculative.fontFamily;const h=e.measureText(l).width;e.beginPath(),e.fillStyle="#fff",e.strokeStyle="#000",e.moveTo(s,o),e.rect(s-10,o,h+20,20),e.fill(),e.stroke(),e.beginPath(),e.fillStyle="#000",e.fillText(l,s,o+10),e.restore()}function WN(e){const t=[],i=[],r={};e.rowHeight||(e.rowHeight=40),e.colWidth||(e.colWidth=150);let n=0;const a=e.styles&&e.styles.filter(g=>g.col!==void 0&&g.row===void 0&&g.width);let s={};a&&a.forEach(g=>{s[g.col]=g.width});for(let g=0;g<e.data[0].length;g++){n+=(s[g]||e.colWidth)*e.calculative.canvas.store.data.scale,t.push(n);let y=e.styles&&e.styles.filter(T=>T.col===g&&T.row===void 0);y&&(r[g]=y[0])}let o=0;const l=e.styles&&e.styles.filter(g=>g.col===void 0&&g.row!==void 0&&g.height);let h={};l&&l.forEach(g=>{h[g.row]=g.height});let c=o;for(let g=0;g<e.data.length;g++)o+=(h[g]||e.rowHeight)*e.calculative.canvas.store.data.scale,i.push(o),g<e.maxNum&&(c=o);if(e.calculative.maxOffsetY=(o-c)/e.calculative.canvas.store.data.scale,e.initWorldRect)return;e.colPos=t,e.rowPos=i,e.colStyle=r,e.initScale=e.calculative.canvas.store.data.scale,e.tableWidth=n,e.tableHeight=c||o;let u=c||o,d=n,f=u;e.parentId&&(n=d/e.calculative.canvas.parent.store.pens[e.parentId].calculative.worldRect.width,f=u/e.calculative.canvas.parent.store.pens[e.parentId].calculative.worldRect.height),e.calculative.width=n,e.calculative.height=f,e.calculative.width=n,e.calculative.height=f,e.height||(e.height=e.calculative.height),e.width||(e.width=e.calculative.width);let m=e.x,p=e.y;if(e.parentId){let g=e.calculative.canvas.store.pens[e.parentId];m=g.calculative.worldRect.x+g.calculative.worldRect.width*e.x,p=g.calculative.worldRect.y+g.calculative.worldRect.height*e.y}e.calculative.worldRect={x:m,y:p,height:u,width:d},e.width=e.calculative.width,e.height=e.calculative.height,e.initWorldRect||(e.initWorldRect={width:e.calculative.worldRect.width,height:e.calculative.worldRect.height}),le(e.calculative.worldRect)}function zN(e,t){if(!t.colPos)return;const{x:i,y:r,width:n,height:a,ex:s,ey:o}=t.calculative.worldRect;e.save(),e.beginPath(),e.strokeStyle=t.color;let l=t.calculative.borderRadius||0,h=l;l<1&&(l=n*l,h=a*h);let c=l<h?l:h;if(n<2*c&&(c=n/2),a<2*c&&(c=a/2),e.moveTo(i+c,r),e.arcTo(s,r,s,o,c),e.arcTo(s,o,i,o,c),e.arcTo(i,o,i,r,c),e.arcTo(i,r,s,r,c),t.background&&(e.fillStyle=t.background,e.fill()),t.bordered!==!1&&(e.strokeStyle=t.borderColor||t.color||"#424B61",e.stroke()),t.hLine!==!1){let u=t.rowPos[t.rowPos.length-1];t.hasHeader&&(e.beginPath(),e.moveTo(t.calculative.worldRect.x,t.calculative.worldRect.y+t.rowPos[0]*t.calculative.worldRect.height/t.tableHeight),e.lineTo(t.calculative.worldRect.ex,t.calculative.worldRect.y+t.rowPos[0]*t.calculative.worldRect.height/t.tableHeight),e.strokeStyle=t.borderColor||t.color||"#424B61",e.stroke());for(const d of t.rowPos){if(d===u)continue;const f=d*t.calculative.worldRect.height/t.tableHeight-t.offsetY*t.calculative.canvas.store.data.scale;if(t.hasHeader){if(f<0+t.rowPos[0]||f>t.calculative.worldRect.height)continue}else if(f<0||f>t.calculative.worldRect.height)continue;e.beginPath(),e.moveTo(t.calculative.worldRect.x,t.calculative.worldRect.y+f),e.lineTo(t.calculative.worldRect.ex,t.calculative.worldRect.y+f),e.strokeStyle=t.borderColor||t.color||"#424B61",e.stroke()}}if(t.vLine!==!1){let u=t.colPos[t.colPos.length-1];t.colPos.forEach((d,f)=>{if(d===u)return;const m=d*t.calculative.worldRect.width/t.tableWidth;e.beginPath(),e.moveTo(t.calculative.worldRect.x+m,t.calculative.worldRect.y),e.lineTo(t.calculative.worldRect.x+m,t.calculative.worldRect.ey),e.strokeStyle=t.borderColor||t.color||"#424B61",e.stroke()})}e.restore()}function VN(e,t){var r,n,a,s,o;if(!t.colPos)return;t.calculative.texts||(t.calculative.texts=[]);const i=1;for(let l=0;l<t.rowPos.length;l++){if(t.hasHeader&&l===1){e.save(),e.beginPath();const{x:c,y:u,width:d,height:f}=t.calculative.worldRect;e.fillStyle="#fff0",e.rect(c-1,u+t.rowPos[0]*t.calculative.worldRect.height/t.tableHeight-1,d+2,f-t.rowPos[0]*t.calculative.worldRect.height/t.tableHeight+2),e.fill(),e.clip()}let{style:h}=$N(t,l);for(let c=0;c<t.colPos.length;c++){let{value:u,style:d}=j0(t,l,c),f=!0;if(Array.isArray(d)&&d.length>0){let P=0;d.forEach((q,J)=>{q.wheres&&q.wheres.every(x=>{let R=new Function("attr",`return attr ${x.comparison} ${x.value}`);const M=R(u);return R=null,M})&&(P=J)}),d=d[P]}else d.wheres&&Array.isArray(d.wheres)&&(f=!1,f=d.wheres.every(function(P){let q=new Function("attr",`return attr ${P.comparison} ${P.value}`);const J=q(u);return q=null,J}));let m=t.color,p=t.textColor||t.color,g=null,y=null,T=null,b=null;f&&(m=d.color||h.color||t.color,p=d.textColor||h.textColor||t.textColor,g=d.background||h.background,y=(d.fontSize||h.fontSize||0)*t.calculative.canvas.store.data.scale,T=d.fontWeight||h.fontWeight,b=d.fontStyle||h.fontStyle);let S;t.stripe&&(t.hasHeader!==!1?l%2===1&&(g=g||t.stripeColor||"#407FFF1F"):l%2===0&&(g=g||t.stripeColor||"#407FFF1F")),t.calculative.active&&((r=t.calculative.activeCell)==null?void 0:r.row)===l&&((n=t.calculative.activeCell)==null?void 0:n.col)===c&&(m=t.activeColor,g=t.activeBackground,S=m,p=t.activeTextColor||t.activeColor),t.calculative.hover&&((a=t.calculative.hoverCell)==null?void 0:a.row)===l&&((s=t.calculative.hoverCell)==null?void 0:s.col)===c&&(m=t.hoverColor,g=t.hoverBackground,p=t.hoverTextColor||t.hoverColor,S=m);const I=z0(t,l,c);if(I.y+I.height<t.calculative.worldRect.y||I.y>t.calculative.worldRect.height+t.calculative.worldRect.y)continue;g&&(e.save(),e.beginPath(),e.fillStyle=g,e.fillRect(I.x,I.y,I.width+.25*t.calculative.canvas.store.data.scale,I.height),e.restore()),S&&(e.save(),e.beginPath(),e.strokeStyle=S,e.strokeRect(I.x,I.y,I.width,I.height),e.restore()),t.calculative.worldTextRect=I;let D=t.calculative.texts[l];if(t.calculative.texts[l]||(D=[],t.calculative.texts.push(D)),D[c]==null){if(typeof u=="object"){const P=t.styles&&t.styles.filter(q=>q.col===c&&q.row===void 0&&q.pens);if(P.length>0){if(D[c]="",t.isFirstTime){t.maxNum&&t.hasHeader&&l>=t.maxNum&&(u.visible=!1);let q=JSON.parse(JSON.stringify(P[0].pens));q.forEach(J=>{Object.assign(J,{row:l,col:c},u),J.activeBackground=J.background,J.hoverBackground=J.background,J.activeColor=J.color,J.hoverColor=J.color,J.activeTextColor=J.textColor,J.hoverTextColor=J.textColor,J.height*=t.calculative.canvas.store.data.scale,J.width*=t.calculative.canvas.store.data.scale}),XN(t,I,q),t.calculative.canvas.parent.pushChildren(t,q)}continue}}else u===void 0?D[c]="":D[c]=u.text||u+"";if(!D[c])continue;D[c]=to(t,D[c])}if(!D[c])continue;e.save(),e.beginPath(),e.fillStyle=p,e.textAlign="center",e.textBaseline="middle",e.font=(b||t.calculative.fontStyle||"")+" normal "+(T||t.calculative.fontWeight||"")+" "+(y||t.calculative.fontSize||12)*i+"px "+t.calculative.fontFamily;let O=t.colStyle&&((o=t.colStyle[c])==null?void 0:o.textAlign);if(O&&(e.textAlign=O),D[c].length===1)O==="left"?e.fillText(D[c][0],I.x,I.y+I.height/2):O==="right"?e.fillText(D[c][0],I.x+I.width,I.y+I.height/2):e.fillText(D[c][0],I.x+I.width/2,I.y+I.height/2);else{const q=(y||t.calculative.fontSize)*t.calculative.lineHeight*i,J=D[c].length*q;let A=(I.height-J)/2;O==="left"?D[c].forEach((x,R)=>{e.fillText(x,I.x,I.y+A+(R+.55)*q)}):O==="right"?D[c].forEach((x,R)=>{e.fillText(x,I.x+I.width,I.y+A+(R+.55)*q)}):D[c].forEach((x,R)=>{e.fillText(x,I.x+I.width/2,I.y+A+(R+.55)*q)})}e.restore()}}}function F0(e){var t;rd(e),(t=e.children)!=null&&t.length||(e.isFirstTime=!0),e.offsetY||(e.offsetY=0),WN(e)}function HN(e,t){if(!e.calculative.hoverCell)return;const{value:i}=j0(e,e.calculative.hoverCell.row,e.calculative.hoverCell.col);if(typeof i=="object")return;e.calculative.isHover=!1,e.calculative.isInput=!0,e.calculative.canvas.render(),e.calculative.inputCell=e.calculative.hoverCell;const r=z0(e,e.calculative.hoverCell.row,e.calculative.hoverCell.col);e.calculative.tempText=i.text||i+"",e.calculative.canvas.showInput(e,r,"#ffffff")}function YN(e,t){e.calculative.inputCell&&(W0(e,e.calculative.inputCell.row,e.calculative.inputCell.col,t),e.calculative.isInput=!1,e.calculative.isHover=!0,e.calculative.canvas.render())}function qN(e,t){e.timer&&(e.calculative.isHover=!1,clearTimeout(e.timer)),e.timer=setTimeout(()=>{e.calculative.isHover=!0,e.calculative.canvas.render()},500),e.calculative.hoverCell=B0(e,t),e.calculative.canvas.render()}function KN(e,t){rd(e),e.calculative.hoverCell=void 0,e.calculative.canvas.render()}function GN(e,t){e.calculative.activeCell=B0(e,t),e.calculative.canvas.render()}function B0(e,t){const i=e.calculative.worldRect.width/e.tableWidth,r=e.calculative.worldRect.height/e.tableHeight,n={row:0,col:0};for(let a=0;a<e.colPos.length;a++)t.x>e.calculative.worldRect.x+e.colPos[a]*i&&(n.col=a+1);for(let a=0;a<e.rowPos.length;a++)t.y>e.calculative.worldRect.y+e.rowPos[a]*r-e.offsetY*e.calculative.canvas.store.data.scale&&(n.row=a+1);return n}function j0(e,t,i){if(!e.data||!Array.isArray(e.data))return;const r=e.data[t],n=e.styles&&e.styles.filter(a=>a.row===t&&a.col===i);if(Array.isArray(r))return{value:r[i],style:(n==null?void 0:n.length)>0?n.length>1?n:n[0]:{}};if(!r.data||!Array.isArray(r.data))return}function $N(e,t){if(!e.data||!Array.isArray(e.data))return;const i=e.data[t],r=e.styles&&e.styles.filter(n=>n.row===t&&n.col===void 0);if(Array.isArray(i))return{value:i,style:(r==null?void 0:r.length)>0?r[0]:{}};if(!i.data||!Array.isArray(i.data))return}function W0(e,t,i,r){if(!e.data||!Array.isArray(e.data))return;e.isFirstTime=!1,e.calculative.texts=void 0;let n=e.data[t];n&&(n[i]instanceof Object||(n[i]=r),e.calculative.canvas.store.emitter.emit("valueUpdate",e))}function z0(e,t,i){const r=e.calculative.worldRect.width/e.tableWidth,n=e.calculative.worldRect.height/e.tableHeight;let a=0,s=e.colPos[i]*r;i>0&&(a=e.colPos[i-1]*r);let o=0,l=e.rowPos[t]*n;t>0&&(o=e.rowPos[t-1]*n);let h=e.offsetY*e.calculative.canvas.store.data.scale;return t===0&&e.hasHeader&&(h=0),{x:e.calculative.worldRect.x+a,y:e.calculative.worldRect.y+o-h,ex:e.calculative.worldRect.x+s,ey:e.calculative.worldRect.y+l-h,width:s-a,height:l-o}}function XN(e,t,i){if(!(i&&i.length))return;const r=e.calculative.worldRect.width/e.tableWidth,n=e.calculative.worldRect.height/e.tableHeight;let a=1,s=1;e.initWorldRect&&(e.calculative.worldRect.width!==e.initWorldRect.width&&(a=e.calculative.worldRect.width/e.initWorldRect.width),e.calculative.worldRect.height!==e.initWorldRect.height&&(s=e.calculative.worldRect.height/e.initWorldRect.height));let o=0,l=0,h=0;const c=e.calculative.canvas.store.data.scale;if(i.length>1){for(const u of i)l+u.width*r+20*c*r<t.width?(u.x=t.x+l+10*c*r,u.y=t.y+h+10*c*n,l+=(u.width+10*c)*r,o=Math.max(o,h+(u.height+10*c)*n)):(l=0,h=o,u.x=t.x+l+10*c*r,u.y=t.y+h+10*c*n,o+=(u.height+10*c)*n);if(o+20*c*n<t.height){const u=(t.height-o-10*c*n)/2;for(const d of i)d.y+=u}}else i[0].x=t.x+(t.width-i[0].width)/2,i[0].y=t.y+(t.height-i[0].height)/2;i.forEach(u=>{u.width=u.width*a,u.height=u.height*s})}function QN(e){if(e.calculative.isUpdateData){delete e.calculative.isUpdateData;let t=lt(e.children);e.children=[],F0(e),t&&t.forEach(i=>{e.calculative.canvas.delForce(e.calculative.canvas.findOne(i))}),e.calculative.texts=void 0}}function JN(e,t){if(e.calculative.isUpdateData=!1,e.swiper!==void 0&&(e.swiper?rd(e):id(e)),t.styles&&(e.initWorldRect=void 0),t.table||t.col==null&&t.row==null){if(t.dataY){const r=e.replaceMode;let n=[];return r?r===Ql.Replace?(n=e.data,t.dataX&&t.dataX.forEach((a,s)=>{n[a]=t.dataY[s]})):r===Ql.ReplaceAll&&(t.dataX?n[0]=t.dataX:n[0]=e.data[0],n=n.concat(t.dataY)):n=e.data.concat(t.dataY),delete t.dataX,delete t.dataY,e.calculative.isUpdateData=!0,Object.assign(t,{data:n})}(t.data||t.styles||t.maxNum||t.rowHeight||t.colWidth)&&(e.calculative.isUpdateData=!0,e.initWorldRect=null);for(let r of Object.keys(t))r.includes("data.")&&(e.calculative.isUpdateData=!0);return t}let i=e.data[t.row];return i&&(i[t.col]instanceof Object||(i[t.col]=t.value),W0(e,t.row,t.col,t.value),e.calculative.canvas.render(),delete t.col,delete t.row),t}function ZN(e,t){if(!e.locked&&!e.calculative.canvas.store.data.locked||!e.maxNum)return;let i=0;t.deltaY>0?i=4:i=-4,ou(e,i)}function ou(e,t){var i;e.offsetY||(e.offsetY=0),e.offsetY+=t,e.offsetY>e.calculative.maxOffsetY&&(e.offsetY=e.calculative.maxOffsetY),e.offsetY<0&&(e.offsetY=0),(i=e.children)==null||i.forEach(r=>{const n=e.calculative.canvas.store.pens[r];tL(e,n)}),e.calculative.canvas.render()}function tL(e,t){if(!t)return;t.oldY||(t.oldY=t.y);const{y:i,height:r}=t.calculative.worldRect,{y:n,height:a}=e.calculative.worldRect,s=e.calculative.canvas.store.data.scale;e.calculative.worldRect.height/e.tableHeight;const o=e.rowHeight;t.y=t.oldY-e.offsetY*s/e.calculative.worldRect.height;const l=o*(e.initScale||1)/e.tableHeight*e.maxNum;if(e.calculative.canvas.updatePenRect(t),e.hasHeader)if(t.y<e.rowPos[0]/e.tableHeight){if(t.calculative.visible=!1,t.visible=!1,t.y<e.rowPos[0]/e.tableHeight/2){t.oldY+=l;let h=t.row+e.maxNum;if(!e.data[h])return;let c=lt(e.data[h][t.col]);c.background&&(c.activeBackground=c.background,c.hoverBackground=c.background),c.color&&(c.hoverColor=c.color,c.activeColor=c.color),c.textColor&&(c.activeTextColor=c.textColor,c.hoverTextColor=c.textColor),Object.assign(t,c,{row:h}),Object.assign(t.calculative,c,{row:h})}}else if(t.y+t.height>1){if(t.calculative.visible=!1,t.visible=!1,t.y+t.height/2>1){t.oldY-=l;let h=t.row-e.maxNum;if(!e.data[h])return;let c=lt(e.data[h][t.col]);c.background&&(c.activeBackground=c.background,c.hoverBackground=c.background),c.color&&(c.hoverColor=c.color,c.activeColor=c.color),c.textColor&&(c.activeTextColor=c.textColor,c.hoverTextColor=c.textColor),Object.assign(t,c,{row:h}),Object.assign(t.calculative,c,{row:h})}}else t.visible=!0,t.calculative.visible=!0;else if(t.y<0){if(t.calculative.visible=!1,t.visible=!1,t.y<-o/e.tableHeight/2){t.oldY+=l;let h=t.row+e.maxNum;if(!e.data[h])return;let c=lt(e.data[h][t.col]);c.background&&(c.activeBackground=c.background,c.hoverBackground=c.background),c.color&&(c.hoverColor=c.color,c.activeColor=c.color),c.textColor&&(c.activeTextColor=c.textColor,c.hoverTextColor=c.textColor),Object.assign(t,c,{row:h}),Object.assign(t.calculative,c,{row:h})}}else if(t.y+t.height>1){if(t.calculative.visible=!1,t.visible=!1,t.y+t.height/2>1){t.oldY-=l;let h=t.row-e.maxNum;if(!e.data[h])return;let c=lt(e.data[h][t.col]);c.background&&(c.activeBackground=c.background,c.hoverBackground=c.background),c.color&&(c.hoverColor=c.color,c.activeColor=c.color),c.textColor&&(c.activeTextColor=c.textColor,c.hoverTextColor=c.textColor),Object.assign(t,c,{row:h}),Object.assign(t.calculative,c,{row:h})}}else t.calculative.visible=!0,t.visible=!0}function eL(e){id(e)}function id(e){e.interval&&(globalThis.clearInterval(e.interval),e.interval=null)}function rd(e){if(e.maxNum&&e.swiper){if(e.interval)return;e.interval=globalThis.setInterval(()=>{e.offsetY>=e.calculative.maxOffsetY?(e.offsetY=0,iL(e)):e.offsetY%e.rowHeight?ou(e,1):(e.calculative.stap||(e.calculative.stap=0),e.calculative.stap+=1,e.calculative.stap==12&&(e.calculative.stap=0,ou(e,1)))},50)}}function iL(e){var t;(t=e.children)==null||t.forEach(i=>{const r=e.rowHeight,n=e.calculative.canvas.store.pens[i];if(!n)return;const a=r*(e.initScale||1)/e.tableHeight*e.maxNum;n.oldY-=a;const s=n.row-e.maxNum;if(!e.data[s])return;let o=lt(e.data[s][n.col]);o.background&&(o.activeBackground=o.background,o.hoverBackground=o.background),o.color&&(o.hoverColor=o.color,o.activeColor=o.color),o.textColor&&(o.activeTextColor=o.textColor,o.hoverTextColor=o.textColor),n.calculative.visible=!0,n.visible=!0,Object.assign(n,o,{row:s}),Object.assign(n.calculative,o,{row:s})}),e.calculative.canvas.render()}function rL(e){id(e)}function nL(e,t){t.onClick||(t.onClick=aL,t.setTheme=sL);let i=t.calculative.worldRect.x,r=t.calculative.worldRect.y,n=t.calculative.worldRect.width,a=t.calculative.worldRect.height;n<a*1.5&&(n=1.5*a),e.beginPath(),e.arc(i+a/2,r+a/2,a/2,Math.PI/2,Math.PI*3/2),e.lineTo(i+n-a/2,r),e.arc(i+n-a/2,r+a/2,a/2,-Math.PI/2,Math.PI/2),e.lineTo(i+a/2,r+a),t.checked?(e.fillStyle=t.onColor,(t.disabled||t.disable)&&(e.fillStyle=t.disableOnColor||We(.6,t.onColor)),t.lineWidth&&(e.strokeStyle=t.onStrokeColor,e.stroke()),e.fill(),e.closePath(),e.beginPath(),e.fillStyle="#ffffff",e.moveTo(i+a*2,r+a/2),e.arc(i+n-a/2,r+a/2,a/2>2?a/2-2:1,0,Math.PI*2),e.fill()):(e.fillStyle=t.offColor,(t.disabled||t.disable)&&(e.fillStyle=t.disableOffColor||We(.6,t.offColor)),t.lineWidth&&(e.strokeStyle=t.offStrokeColor,e.stroke()),e.fill(),e.closePath(),e.beginPath(),e.fillStyle="#ffffff",e.moveTo(i+a,r+a/2),e.arc(i+a/2,r+a/2,a/2>2?a/2-2:1,0,Math.PI*2),e.fill()),e.closePath()}function aL(e){e.disableDefaultClick||e.disabled||e.disable||(e.checked=!e.checked,e.calculative.canvas.store.emitter.emit("valueUpdate",e),e.calculative.canvas.render())}function sL(e,t){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const r=t[i];e.hasOwnProperty(i)&&(e[i]=r),e.calculative.hasOwnProperty(i)&&(e.calculative[i]=r)}e.onStrokeColor=t.borderColor,e.offStrokeColor=t.borderColor}function oL(e,t){t.onAdd||(t.onAdd=ys,t.onResize=ys,t.onMove=ys,t.onMouseMove=lL,t.onMouseDown=V0,t.onValue=cL,t.onBeforeValue=hL,t.setTheme=uL),t.calculative.barRect||ys(t);const i=t.calculative.canvas.store;t.calculative.canvas.store.options;let r=t.background;t.disabled&&(r=t.disabledBackground||We(.6,r)),e.fillStyle=r,e.beginPath();let n=t.calculative.worldRect.x+t.calculative.barRect.x,a=t.calculative.worldRect.y+t.calculative.barRect.y,s=t.calculative.barRect.width,o=t.calculative.barRect.height,l=o/2;e.moveTo(n+l,a),e.arcTo(n+s,a,n+s,a+o,l),e.arcTo(n+s,a+o,n,a+o,l),e.arcTo(n,a+o,t.x,t.y,l),e.arcTo(n,a,n+s,a,l),e.fill();let h=t.activeColor||i.styles.activeColor;t.disabled&&(h=t.disabledColor||We(.6,h)),e.fillStyle=h,e.beginPath(),s=t.calculative.ballRect.x,e.moveTo(n+l,a),e.arcTo(n+s,a,n+s,a+o,l),e.arcTo(n+s,a+o,n,a+o,l),e.arcTo(n,a+o,t.x,t.y,l),e.arcTo(n,a,n+s,a,l),e.fill(),e.fillStyle=t.btnBackground||"#fff",e.strokeStyle=h,e.lineWidth=2,e.beginPath(),n=t.calculative.worldRect.x+t.calculative.ballRect.x,a=t.calculative.worldRect.y+t.calculative.ballRect.y+t.calculative.ballRect.height/2,e.lineWidth=t.calculative.ballRect.width/10,e.arc(n,a,t.calculative.ballRect.width/2,0,Math.PI*2),e.fill(),e.stroke()}function ys(e){if(e._textWidth||(e._textWidth=e.textWidth||50,e._fontSize=e.fontSize||12),e.textWidth=e.calculative.worldRect.width,e.calculative.textWidth=e.textWidth,e.unit||(e.unit="%"),e.sliderWidth||(e.sliderWidth=e.width),e.sliderHeight||(e.sliderHeight=e.height),!e.calculative.worldRect)return;const t=e.calculative.worldRect.width/e.sliderWidth,i=e.calculative.worldRect.height/e.sliderHeight,r=Math.min(t,i);e.fontSize=e._fontSize*r;const n=e.calculative.worldRect.width-e._textWidth*r;e.textLeft=n+10*r,e.calculative.textLeft=e.textLeft,e.calculative.barRect={x:0,y:(e.calculative.worldRect.height-e.barHeight*i)/2,width:n,height:e.barHeight*i},le(e.calculative.barRect),nd(e)}function nd(e){const t=e.calculative.barRect.height*3.5,i=e.calculative.barRect.width*e.value/100;e.calculative.ballRect={x:i,y:(e.calculative.worldRect.height-t)/2,width:t,height:t},le(e.calculative.ballRect),e.calculative.text=e.value+e.unit,Ji(e)}function V0(e,t){if(e.disabled)return;const i=t.x-e.calculative.worldRect.x;if(i>e.calculative.barRect.width)return;let r=Math.round(i/e.calculative.barRect.width*100);r<e.min||r>e.max||r<0||r>100||(e.value=r,nd(e),e.calculative.text=e.value+e.unit,Ji(e),e.calculative.canvas.store.emitter.emit("valueUpdate",e),e.calculative.canvas.render())}function lL(e,t){e.calculative.canvas.mouseDown&&V0(e,t)}function cL(e){e.calculative.isUpdateData&&(delete e.calculative.isUpdateData,ys(e)),nd(e)}function hL(e,t){return e.calculative.isUpdateData=!1,(t.textWidth||t.barHeight)&&(t.textWidth&&(e._textWidth=0),e.calculative.isUpdateData=!0),t}function uL(e,t){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const r=t[i];e.hasOwnProperty(i)&&(e[i]=r),e.calculative.hasOwnProperty(i)&&(e.calculative[i]=r)}e.background=t.sliderBg,e.calculative.background=t.sliderBg,e.btnBackground=t.sliderBtnBg,e.calculative.btnBackground=t.sliderBtnBg,e.activeColor=t.tabActiveBg,e.calculative.activeColor=t.tabActiveBg}function dL(e,t){t.onMouseDown||(t.onMouseDown=fL),t.options||(t.options=t.data);let i=t.calculative.worldRect.x,r=t.calculative.worldRect.y,n=t.calculative.worldRect.height;t.calculative.worldRect.width;const{fontStyle:a,fontWeight:s,fontSize:o,fontFamily:l,lineHeight:h}=t.calculative;let c=2;e.beginPath(),e.moveTo(i,r),e.arcTo(i+n,r,i+n,r+n,c),e.arcTo(i+n,r+n,i,r+n,c),e.arcTo(i,r+n,i,r,c),e.arcTo(i,r,i+n,r,c),e.strokeStyle="#d9d9d9",e.fillStyle="#ffffff00",t.checked&&(e.fillStyle=t.background||"#1890ff",e.strokeStyle=t.background||"#1890ff"),(t.isForbidden||t.disabled)&&(e.fillStyle=t.disabledBackground||We(.6,t.background)||"#ebebeb",e.strokeStyle=t.disabledColor||We(.6,t.color)||"#d9d9d9"),e.closePath(),e.fill(),e.stroke(),e.save(),t.checked&&(e.beginPath(),e.lineWidth=n/10,e.strokeStyle="#ffffff",e.moveTo(i+102/506*n,r+n/2),e.lineTo(i+220/506*n,r+346/460*n),e.lineTo(i+404/506*n,r+142/460*n),e.stroke()),e.restore(),e.save(),e.fillStyle=t.disabled||t.isForbidden?t.disabledTextColor||We(.6,t.textColor||t.color)||"#00000040":Ur(t,t.calculative.canvas.parent.store)||"#000000d9",e.textAlign="start",e.textBaseline="middle",e.font=Ne({fontStyle:a,fontWeight:s,fontFamily:l||t.calculative.canvas.parent.store.options.fontFamily,fontSize:o,lineHeight:h}),e.fillText(t.value+"",i+n+10,r+n/2),e.restore()}function fL(e,t){e.isForbidden||(e.checked=!e.checked,e.calculative.canvas.store.emitter.emit("valueUpdate",e),e.calculative.canvas.render())}function mL(e,t){t.options||(t.options=t.data),t.onAdd||(t.onAdd=gL,t.optionPos||(t.onAdd(t),t.calculative.canvas.parent.active([t])),t.onMouseDown=pL,t.onValue=vL,t.onBeforeValue=yL);let i=t.calculative.worldRect.x,r=t.calculative.worldRect.y,n=t.calculative.worldRect.height,a=t.calculative.worldRect.width;if(!t.optionPos)return;const{fontStyle:s,fontWeight:o,fontSize:l,fontFamily:h,lineHeight:c}=t.calculative;if(t.direction=="horizontal")for(let u=0;u<t.optionPos.length;u++){const d=t.optionPos[u]*a/t.checkboxWidth,f=t.options[u].isForbidden||t.disabled;e.beginPath(),e.arc(i+d+n/2,r+n/2,n/2,0,Math.PI*2),e.strokeStyle="#d9d9d9",e.fillStyle="#ffffff00",t.options[u].text===t.checked&&(e.strokeStyle=t.options[u].background||t.background||"#1890ff"),f&&(e.fillStyle=t.disabledBackground||We(.6,t.background)||"#ebebeb",e.strokeStyle=t.disabledColor||We(.6,t.color)||"#d9d9d9",t.options[u].text===t.checked&&(e.fillStyle="#ffffff00")),e.closePath(),e.fill(),e.stroke(),e.save(),t.options[u].text===t.checked&&(e.beginPath(),e.strokeStyle=t.options[u].background?t.options[u].background+"20":t.background||"#1890ff20",f&&(e.strokeStyle=t.disabledBackground||We(.6,t.background)||"#ebebeb"),e.arc(i+n/2+d,r+n/2,n/2+1.5,0,Math.PI*2),e.stroke(),e.closePath(),e.beginPath(),e.fillStyle=t.options[u].background||t.background||"#1890ff",f&&(e.fillStyle=t.disabledBackground||We(.6,t.background)||"#ebebeb"),e.arc(i+n/2+d,r+n/2,n/4,0,Math.PI*2),e.fill(),e.closePath()),e.restore(),e.save(),e.fillStyle=f?t.disabledTextColor||"#00000040":Ur(t,t.calculative.canvas.parent.store)||"#000000d9";const m=t.calculative.worldRect.height*14/16;e.textAlign="start",e.textBaseline="middle",e.font=Ne({fontStyle:s,fontWeight:o,fontFamily:h||t.calculative.canvas.parent.store.options.fontFamily,fontSize:m,lineHeight:c}),e.fillText(t.options[u].text,i+n+d+10/t.checkboxWidth*a,r+n/2),e.restore()}else if(t.direction=="vertical"){const u=t.optionHeight*n/t.checkboxHeight;for(let d=0;d<t.optionPos.length;d++){const f=t.optionPos[d]*n/t.checkboxHeight,m=t.options[d].isForbidden;e.beginPath(),e.arc(i+u/2,r+u/2+f,u/2,0,Math.PI*2),e.strokeStyle="#d9d9d9",e.fillStyle="#ffffff00",t.options[d].text===t.checked&&(e.strokeStyle=t.options[d].background||"#1890ff"),m&&(e.fillStyle="#ebebeb",e.strokeStyle="#d9d9d9"),e.closePath(),e.fill(),e.stroke(),e.save(),!m&&t.options[d].text===t.checked&&(e.beginPath(),e.strokeStyle=t.options[d].background?t.options[d].background+"20":"#1890ff20",e.arc(i+u/2,r+u/2+f,u/2+1.5,0,Math.PI*2),e.stroke(),e.closePath(),e.beginPath(),e.fillStyle=t.options[d].background||"#1890ff",e.arc(i+u/2,r+u/2+f,u/4,0,Math.PI*2),e.fill(),e.closePath()),e.restore(),e.save(),e.fillStyle=m?"#00000040":Ur(t,t.calculative.canvas.parent.store)||"#000000d9";const p=14*t.calculative.worldRect.height/t.checkboxHeight;e.textAlign="start",e.textBaseline="middle",e.font=Ne({fontStyle:s,fontWeight:o,fontFamily:h||t.calculative.canvas.parent.store.options.fontFamily,fontSize:p,lineHeight:c}),e.fillText(t.options[d].text,i+u+10,r+u/2+f),e.restore()}}}function gL(e){U0(e)}function pL(e,t){if(e.direction=="horizontal")for(let i=0;i<e.optionPos.length;i++)!e.options[i].isForbidden&&t.x>e.calculative.worldRect.x+e.optionPos[i]*e.calculative.worldRect.width/e.checkboxWidth&&t.x<e.calculative.worldRect.x+(e.optionPos[i]+e.height)/e.checkboxWidth*e.calculative.worldRect.width+L0(e.options[i].text,e)+10/e.checkboxWidth*e.calculative.worldRect.width&&(e.checked=e.options[i].text,e.calculative.canvas.store.emitter.emit("valueUpdate",e));else if(e.direction=="vertical"){const i=e.calculative.worldRect.height/e.checkboxHeight;for(let r=0;r<e.optionPos.length;r++)!e.options[r].isForbidden&&t.y>e.calculative.worldRect.y+e.optionPos[r]*i&&t.y<e.calculative.worldRect.y+(e.optionPos[r]+e.optionHeight)*i&&(e.checked=e.options[r].text,e.calculative.canvas.store.emitter.emit("valueUpdate",e))}e.calculative.canvas.render()}function vL(e){e.calculative.flag&&U0(e)}function yL(e,t){return e.calculative.flag=!1,(t.options!==void 0||t.direction!==void 0||t.optionInterval!==void 0||t.optionHeight!==void 0)&&(e.calculative.flag=!0),t}function bL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.rect(r,n,a,s),e.onAdd||(e.onAdd=TL,e.onDestroy=EL,e.interval&&(e.onDestroy(e),e.onAdd(e))),e.interval||e.onAdd(e),i instanceof Path2D)return i}function wL(e){const t=["天","一","二","三","四","五","六"],i=new Date,r=i.getFullYear();let n="";e.fillZero&&(n="0");const a=(i.getMonth()+1+"").padStart(2,n),s=(i.getDate()+"").padStart(2,n),o=i.getDay(),l=(i.getHours()+"").padStart(2,n),h=(i.getMinutes()+"").padStart(2,n),c=(i.getSeconds()+"").padStart(2,n);let u=new Function("year","month","day","week","hours","minutes","seconds",e.timeFormat?`return ${e.timeFormat}`:"return `${year}:${month}:${day} ${hours}:${minutes}:${seconds} 星期${week}`");const d=u(r,a,s,t[o],l,h,c);return u=null,d}function TL(e){e.interval=setInterval(()=>{const t=wL(e);e.calculative.canvas.parent.setValue({id:e.id,text:t},{history:!1,doEvent:!1,render:!1}),e.calculative.canvas.render()},e.timeout||1e3)}function EL(e){e.interval&&(clearInterval(e.interval),e.interval=void 0)}function _L(){return{radio:mL,switch:nL,slider:oL,checkbox:dL,table:up,table2:up}}function SL(){return{time:bL}}function AL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/6,l=a/4;if(i.moveTo(r+l*2,n+0),i.lineTo(r+l*2,n+o),i.moveTo(r,n+o+l*2),i.arc(r+l*2,n+o+l*2,l*2,Math.PI*1,Math.PI*2,!1),i.lineTo(r+l*4,n+o*5),i.lineTo(r,n+o*5),i.lineTo(r,n+o+l*2),i.moveTo(r+l,n+o*5),i.lineTo(r+l,n+o*6),i.moveTo(r+l*2,n+o*5),i.lineTo(r+l*2,n+o*6),i.moveTo(r+l*3,n+o*5),i.lineTo(r+l*3,n+o*6),i.closePath(),i instanceof Path2D)return i}function dp(e){const t=[{x:.5,y:0},{x:.25,y:1},{x:.5,y:1},{x:.75,y:1}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function xL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s-a,l=.5*a;if(i.moveTo(r+a/2,n),i.lineTo(r+a/2,n+o),i.moveTo(r+a,n+l+o),i.arc(r+a/2,n+l+o,l,0,Math.PI*2,!1),i.closePath(),i instanceof Path2D)return i}function fp(e){const t=[{x:.5,y:0},{x:.5,y:1}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function RL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/2,l=a/5;if(i.moveTo(r,n+o),i.lineTo(r+l,n+o),i.moveTo(r+l*5,n+o),i.ellipse(r+l*3,n+o,2*l,o,0,0,Math.PI*2),i.closePath(),i instanceof Path2D)return i}function kL(e){const t=[{x:.6,y:0},{x:1,y:.5},{x:.6,y:1},{x:0,y:.5}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function IL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/4,l=.5*a;if(i.moveTo(r+l,n),i.lineTo(r+l,n+o),i.moveTo(r,n+o),i.rect(r,n+o,l*2,o*2),i.moveTo(r+l,n+3*o),i.lineTo(r+l,n+4*o),i.closePath(),i instanceof Path2D)return i}function CL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/8,l=.25*a;if(i.moveTo(r+l*2,n),i.lineTo(r+l*2,n+o*2),i.lineTo(r+l*3,n+o*3),i.lineTo(r+l*3,n+o*5),i.lineTo(r+l*2,n+o*6),i.lineTo(r+l*1,n+o*5),i.lineTo(r+l*1,n+o*3),i.lineTo(r+l*2,n+o*2),i.moveTo(r+l*3,n+o*4),i.lineTo(r+l*4,n+o*4),i.moveTo(r+l*2,n+o*6),i.lineTo(r+l*2,n+o*8),i.closePath(),i instanceof Path2D)return i}function DL(e){const t=[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function OL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=a/2,l=s/10;if(i.moveTo(r+o,n),i.lineTo(r+o,n+l),i.moveTo(r+o,n+l),i.quadraticCurveTo(r+o*2,n+l,r+o*2,n+l*9),i.moveTo(r+o,n+l),i.quadraticCurveTo(r,n+l,r,n+l*9),i.quadraticCurveTo(r+o,n+l*6,r+o*2,n+l*9),i.moveTo(r+o,n+s*3/4),i.lineTo(r+o,n+s),i.moveTo(r+o*2/5,n+s*201/250),i.lineTo(r+o*2/5,n+s),i.moveTo(r+o*8/5,n+s*201/250),i.lineTo(r+o*8/5,n+s),i.closePath(),i instanceof Path2D)return i}function mp(e){const t=[{x:.5,y:0},{x:.2,y:1},{x:.5,y:1},{x:.8,y:1}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function ML(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/6,l=a/4;if(i.moveTo(r+l*2,n+0),i.lineTo(r+l*2,n+o),i.moveTo(r,n+o+l*2),i.arc(r+l*2,n+o+l*2,l*2,Math.PI*1,Math.PI*2,!1),i.lineTo(r+l*4,n+o*5),i.lineTo(r,n+o*5),i.lineTo(r,n+o+l*2),i.moveTo(r,n+o*5-o/3),i.lineTo(r+l*4,n+o*5-o/3),i.moveTo(r+l,n+o*5),i.lineTo(r+l,n+o*6),i.moveTo(r+l*2,n+o*5),i.lineTo(r+l*2,n+o*6),i.moveTo(r+l*3,n+o*5),i.lineTo(r+l*3,n+o*6),i.closePath(),i instanceof Path2D)return i}function PL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/4,l=.5*a;if(i.moveTo(r+l,n),i.lineTo(r+l,n+o),i.lineTo(r+l*2,n+o*2),i.lineTo(r+l*2,n+o*4),i.lineTo(r,n+o*4),i.lineTo(r,n+o*2),i.lineTo(r+l,n+o),i.closePath(),i instanceof Path2D)return i}function NL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/4,l=a/2;if(i.moveTo(r+l,n),i.lineTo(r+l,n+o),i.lineTo(r+l*2,n+o*4),i.lineTo(r,n+o*4),i.lineTo(r+l,n+o),i.closePath(),i instanceof Path2D)return i}function LL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect,o=s/3,l=.5*a;if(i.moveTo(r+l,n),i.lineTo(r+l,n+o),i.lineTo(r+a,n+2*o),i.lineTo(r+l,n+s),i.lineTo(r,n+2*o),i.lineTo(r+l,n+o),i.closePath(),i instanceof Path2D)return i}function UL(e){const t=[{x:.5,y:0},{x:1,y:.6666666666666666},{x:.5,y:1},{x:0,y:.6666666666666666}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function FL(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;let o=a/2,l=s/10;if(i.moveTo(r+o,n),i.lineTo(r+o,n+l),i.moveTo(r+o,n+l),i.quadraticCurveTo(r+o*2,n+l,r+o*2,n+l*9),i.moveTo(r+o,n+l),i.quadraticCurveTo(r,n+l,r,n+l*9),i.quadraticCurveTo(r+o,n+l*6,r+o*2,n+l*9),i.moveTo(r,n+l*10),i.quadraticCurveTo(r+o,n+l*7,r+o*2,n+l*10),i.moveTo(r+o*2/5,n+s*201/250+l),i.lineTo(r+o*2/5,n+s),i.moveTo(r+o*8/5,n+s*201/250+l),i.lineTo(r+o*8/5,n+s),i.closePath(),i instanceof Path2D)return i}function BL(e){const t=[{x:.5,y:0},{x:.2,y:1},{x:.8,y:1}];e.anchors=t.map(({x:i,y:r},n)=>({id:`${n}`,penId:e.id,x:i,y:r}))}function jL(e,t){const{x:i,y:r,width:n,height:a}=t.calculative.worldRect,s=n/2,o=a/10;e.beginPath(),e.moveTo(i+s,r),e.lineTo(i+s,r+o),e.moveTo(i+s,r+o),e.quadraticCurveTo(i+s*2,r+o,i+s*2,r+o*9),e.moveTo(i+s,r+o),e.quadraticCurveTo(i,r+o,i,r+o*9),e.quadraticCurveTo(i+s,r+o*6,i+s*2,r+o*9),e.moveTo(i+s,r+a*3/4),e.lineTo(i+s,r+a*9/10),e.moveTo(i+s*2/5,r+a*201/250),e.lineTo(i+s*2/5,r+a*9/10),e.moveTo(i+s*8/5,r+a*201/250),e.lineTo(i+s*8/5,r+a*9/10),e.stroke(),e.closePath(),e.beginPath();const l=s*2>o*10?o:s/5;e.fillStyle="#333333",e.font=l+"px Arial",e.textBaseline="bottom",e.textAlign="center",e.fillText("o",i+s,r+a),e.fillText("m",i+s*2/5,r+a),e.fillText("o",i+s*8/5,r+a),e.closePath()}function WL(){return{andGate:AL,basicEvent:xL,conditionalEvent:RL,event:IL,forbiddenGate:CL,orGate:OL,priorityAndGate:ML,switchEvent:PL,transferSymbol:NL,unexpandedEvent:LL,xorGate:FL}}function zL(){return{votingGate:jL}}function VL(){return{andGate:dp,orGate:mp,priorityAndGate:dp,votingGate:mp,xorGate:BL,forbiddenGate:DL,basicEvent:fp,unexpandedEvent:UL,conditionalEvent:kL,transferSymbol:fp}}const HL=15;function Tn(e,t=HL){let i=""+e;return i.indexOf(".")>=0&&(i=Number.parseFloat(i).toFixed(t)),Number.parseFloat(i)}function fh(e){return typeof e=="number"&&Number.isFinite(e)}function YL(e){e={max:null,min:null,splitNumber:4,symmetrical:!1,deviation:!1,preferZero:!1,...e};const t=[10,15,20,25,30,40,50,60,70,80,90,100,150];let{max:i,min:r,splitNumber:n,symmetrical:a,deviation:s,preferZero:o}=e;if(!fh(i)||!fh(r)||i<r)return{splitNumber:n};if(i===r&&i===0)return{max:Tn(t[0]*n),min:r,interval:t[0],splitNumber:n};i===r&&(o=!0),(!fh(n)||n<=0)&&(n=4),o&&i*r>0&&(i<0?i=0:r=0);const l=(i-r)/n;let h=Math.floor(Math.log10(l)-1);h=Math.pow(10,h);const c=l/h;let u=t[0]*h,d=-1,f;for(f=0;f<t.length;f++)if(t[f]>c){u=t[f]*h;break}let m=i,p=r;function g(T){if(m=parseInt(""+(i/T+1))*T,p=parseInt(""+(r/T-1))*T,i===0&&(m=0),r===0&&(p=0),a&&m*p<0){const b=Math.max(Math.abs(m),Math.abs(p));m=b,p=-b}}if(g(u),s)return{max:Tn(m),min:Tn(p),interval:Tn(u),splitNumber:Math.round((m-p)/u)};if(!a||m*p>0){let T;t:do{if(T=Math.round((m-p)/u),(f-d)*(T-n)<0){for(;T<n;)if(p-r<=m-i&&p!==0||m===0?p-=u:m+=u,T++,T===n)break t}if(f>=t.length-1||f<=0||T===n)break;d=f,T>n?u=t[++f]*h:u=t[--f]*h,g(u)}while(T!==n)}m=Tn(m),p=Tn(p);const y=Tn((m-p)/n);return{max:m,min:p,interval:y,splitNumber:n}}function H0(e,t){var g,y,T,b,S,I,D,O,P,q,J,A,x,R,M,Y,X,et,z,W,$,L,N,V,H,Q,rt,tt;const i=t.calculative.worldRect.x,r=t.calculative.worldRect.y,n=t.calculative.worldRect.width,a=t.calculative.worldRect.height;let s=t.calculative.canvas.store.data.scale,o=[];if(t.echarts)for(let it=0;it<t.echarts.option.series.length;it++)o.push(t.echarts.option.series[it].data);else o=t.data;let l=[];for(let it=0;it<o.length;it++)l=l.concat(o[it]);let h={max:Math.max.apply(null,l),min:Math.min.apply(null,l),splitNumber:5},c=YL(h),u=t.echarts?t.echarts.option.xAxis.data.length:t.xAxisData.length;e.beginPath(),e.strokeStyle="#BFBFBF",e.lineWidth=6*s,e.lineCap="butt";let d=(n-1*(u+1))/u;e.setLineDash([1,d]),e.moveTo(i,r+a+3*s),e.lineTo(i+n,r+a+3*s),e.stroke(),e.closePath(),e.beginPath(),e.lineWidth=1*s,e.setLineDash([]),e.moveTo(i,r+a),e.lineTo(i+n,r+a),e.stroke(),e.closePath(),e.beginPath(),e.fillStyle="#BFBFBF",e.strokeStyle="#E9E9E9",e.setLineDash([2,2]);let f={fontStyle:((y=(g=t.yAxis)==null?void 0:g.axisLabel)==null?void 0:y.fontStyle)||t.fontStyle,textDecoration:(b=(T=t.yAxis)==null?void 0:T.axisLabel)==null?void 0:b.textDecoration,fontWeight:((I=(S=t.yAxis)==null?void 0:S.axisLabel)==null?void 0:I.fontWeight)||t.fontWeight,fontFamily:((O=(D=t.yAxis)==null?void 0:D.axisLabel)==null?void 0:O.fontFamily)||t.fontFamily,fontSize:((q=(P=t.yAxis)==null?void 0:P.axisLabel)==null?void 0:q.fontSize)||t.fontSize,lineHeight:((A=(J=t.yAxis)==null?void 0:J.axisLabel)==null?void 0:A.lineHeight)||t.lineHeight};e.fillStyle=((R=(x=t.yAxis)==null?void 0:x.axisLabel)==null?void 0:R.fontColor)||t.color;for(let it=0;it<c.splitNumber+1;it++){let w=it*a/c.splitNumber;e.textAlign="right",e.textBaseline="middle",e.font=Ne(f),e.fillText(c.max-it*c.interval+"",i-10*s,r+w),e.fill(),it<c.splitNumber&&(e.beginPath(),e.moveTo(i,r+w),e.lineTo(i+n,r+w),e.stroke())}e.closePath(),e.beginPath(),e.strokeStyle="#BFBFBF";let m=t.echarts?t.echarts.option.xAxis.data:t.xAxisData,p=0;for(let it=0;it<m.length;it++){p=i+(1+d/2)+(d+1)*it,e.textAlign="center",e.textBaseline="top";let w={fontStyle:((Y=(M=t.xAxis)==null?void 0:M.axisLabel)==null?void 0:Y.fontStyle)||t.calculative.fontStyle,textDecoration:(et=(X=t.xAxis)==null?void 0:X.axisLabel)==null?void 0:et.textDecoration,fontWeight:((W=(z=t.xAxis)==null?void 0:z.axisLabel)==null?void 0:W.fontWeight)||t.calculative.fontWeight,fontFamily:((L=($=t.xAxis)==null?void 0:$.axisLabel)==null?void 0:L.fontFamily)||t.calculative.fontFamily,fontSize:((V=(N=t.xAxis)==null?void 0:N.axisLabel)==null?void 0:V.fontSize)||t.calculative.fontSize,lineHeight:((Q=(H=t.xAxis)==null?void 0:H.axisLabel)==null?void 0:Q.lineHeight)||t.calculative.lineHeight};e.font=Ne(w),e.fillStyle=((tt=(rt=t.xAxis)==null?void 0:rt.axisLabel)==null?void 0:tt.fontColor)||t.calculative.color,e.fillText(m[it],p,r+a+10*s),e.fill()}return e.closePath(),e.setLineDash([]),{dash:d,normalizedOption:c}}function qL(e,t){if(!isNaN(e))return Math.round(Number(e)*1e3)/1e3}var za;(function(e){e[e.Add=0]="Add",e[e.Replace=1]="Replace",e[e.ReplaceAll=2]="ReplaceAll"})(za||(za={}));function KL(e,t){t.onBeforeValue||(t.onBeforeValue=Y0);const i=t.calculative.worldRect.x,r=t.calculative.worldRect.y;t.calculative.worldRect.width;const n=t.calculative.worldRect.height;let a=t.calculative.canvas.store.data.scale,s=[];t.echarts&&!t.echarts.option.color&&(t.echarts.option.color=["#1890ff","#2FC25B","#FACC14","#c23531","#2f4554","#61a0a8","#d48265"]);let o=H0(e,t),l=o.dash,h=o.normalizedOption;const c=!!(t.echarts?t.echarts.option.series[0].smooth:t.smooth);let u=[];if(t.echarts)for(let d=0;d<t.echarts.option.series.length;d++)s.push(t.echarts.option.series[d].data);else s=t.data;for(let d=0;d<s.length;d++){e.beginPath();let f=s[d];e.strokeStyle=t.echarts?t.echarts.option.color[d]:t.chartsColor[d],e.fillStyle=t.echarts?t.echarts.option.color[d]:t.chartsColor[d];let m=i+(1+l/2),p=r+n-(f[0]-h.min)/(h.max-h.min)*n;if(e.moveTo(m,p),u.push({x:m,y:p}),c)if(f.length<=2)for(let g=1;g<f.length;g++)m=i+(1+l/2)+(l+1)*g,p=r+n-(f[g]-h.min)/(h.max-h.min)*n,e.lineTo(m,p),u.push({x:m,y:p});else{let g,y,T,b;f.forEach((S,I)=>{m=i+(1+l/2)+(l+1)*I,p=r+n-(f[I]-h.min)/(h.max-h.min)*n;let D=i+(1+l/2)+(l+1)*(I+1),O=r+n-(f[I+1]-h.min)/(h.max-h.min)*n,P=i+(1+l/2)+(l+1)*(I-1),q=r+n-(f[I-1]-h.min)/(h.max-h.min)*n,J=i+(1+l/2)+(l+1)*(I+2),A=r+n-(f[I+2]-h.min)/(h.max-h.min)*n;I===0?(P=i+(1+l/2)+(l+1)*I,q=r+n-(f[I]-h.min)/(h.max-h.min)*n):I===f.length-2&&(J=i+(1+l/2)+(l+1)*(I+1),A=r+n-(f[I+1]-h.min)/(h.max-h.min)*n),u.push({x:m,y:p}),g=m+(D-P)/4,y=p+(O-q)/4,T=D-(J-m)/4,b=O-(A-p)/4,e.bezierCurveTo(g,y,T,b,D,O)})}else for(let g=1;g<f.length;g++)m=i+(1+l/2)+(l+1)*g,p=r+n-(f[g]-h.min)/(h.max-h.min)*n,e.lineTo(m,p),u.push({x:m,y:p});e.stroke(),e.closePath(),e.save(),u.forEach((g,y)=>{e.beginPath(),e.strokeStyle="#fff",e.lineWidth=2*a,e.arc(g.x,g.y,4*a,0,Math.PI*2),e.stroke(),e.fill(),e.closePath()}),e.restore(),u=[]}}function Y0(e,t){if(t.xAxisData||t.data||!t.dataX&&!t.dataY)return t;const i=e.xAxisData,r=e.data,n=e.replaceMode;let a=[],s=[];return n?n===za.Replace?(t.dataX.forEach((o,l)=>{let h=i.indexOf(o);r.forEach((c,u)=>{c[h]=t.dataY[u][l]})}),a=i,s=r):n===za.ReplaceAll&&(a=t.dataX,s=t.dataY):(a=[...i,...t.dataX],r.forEach((o,l)=>{let h=[...o,...t.dataY[l]];s.push(h)})),delete t.dataX,delete t.dataY,Object.assign(t,{xAxisData:a,data:s})}function GL(e,t){var c,u;t.onBeforeValue||(t.onBeforeValue=$L);let i=t.calculative.canvas.store.data.scale;const r=t.calculative.worldRect.x,n=t.calculative.worldRect.y,a=t.calculative.worldRect.width,s=t.calculative.worldRect.height,o=!!t.echarts;t.echarts?(t.echarts.option.color||(t.echarts.option.color=["#1890ff","#2FC25B","#FACC14","#c23531","#2f4554","#61a0a8","#d48265"]),t.chartsColor=t.echarts.option.color):t.chartsColor||(t.chartsColor=["#1890ff","#2FC25B","#FACC14","#c23531","#2f4554","#61a0a8","#d48265"]);const l=o?t.echarts.option.series:t.data;let h=0;for(let d=0;d<l.length;d++){let f=l[d],m=a/2;s<a&&(m=s/2);const p=r+a/2,g=n+s/2;let y=0;o?y=f.data.reduce((O,P)=>O+P.value,0):y=f.reduce((O,P)=>O+P.value,0);const T=m*parseFloat(o?f.radius[0]:t.chartsRadius[d][0])/100,b=m*parseFloat(o?f.radius[1]:t.chartsRadius[d][1])/100;if(T>b)return;let S=0,I=0;e.strokeStyle=o&&((c=f.itemStyle)==null?void 0:c.borderColor)||"#fff",e.lineWidth=(o&&((u=f.itemStyle)==null?void 0:u.borderWidth)||2)*i;const D=o?f.data:f;D.forEach((O,P)=>{var Y,X,et,z,W,$,L,N,V,H;I+=Math.PI*2*O.value/y,e.beginPath();let q=h+P;q>=t.chartsColor.length&&(q=q%t.chartsColor.length),e.fillStyle=o?t.echarts.option.color[q]:t.chartsColor[q],e.moveTo(p+T*Math.sin(I),g-T*Math.cos(I)),e.arc(p,g,T,-Math.PI/2+I,-Math.PI/2+S,!0),e.lineTo(p+b*Math.sin(S),g-b*Math.cos(S)),e.arc(p,g,b,-Math.PI/2+S,-Math.PI/2+I),e.lineTo(p+T*Math.sin(I),g-T*Math.cos(I)),e.stroke(),e.fill(),e.closePath();let J=(S+I)/2,A=p+(b+10*i)*Math.sin(J),x=g-(b+10*i)*Math.cos(J),R=e.fillStyle;f.label||(f.label={position:"outside",show:!0}),o&&["inner","inside"].includes(f.label.position)?(e.fillStyle="#ffffff",A=p+(b-T)/2*Math.sin(J),x=g-(b-T)/2*Math.cos(J)):o&&f.label.position=="outside",f.labelLine||(f.labelLine={show:!0}),(o&&f.labelLine.show!==!1||!o)&&(e.beginPath(),e.strokeStyle=o?t.echarts.option.color[h+P]:t.chartsColor[h+P],e.moveTo(p+b*Math.sin(J),g-b*Math.cos(J)),e.lineTo(A,x));let M={fontStyle:((Y=t.tickLabel)==null?void 0:Y.fontStyle)||t.calculative.fontStyle,fontWeight:((X=t.tickLabel)==null?void 0:X.fontWeight)||t.calculative.fontWeight,fontFamily:((et=t.tickLabel)==null?void 0:et.fontFamily)||t.calculative.fontFamily,lineHeight:((z=t.tickLabel)==null?void 0:z.lineHeight)||t.calculative.lineHeight,fontSize:(((W=t.tickLabel)==null?void 0:W.fontSize)||t.calculative.fontSize)*i};e.font=Ne(M),e.textBaseline="middle",e.textAlign="center",J>Math.PI?((o&&f.label.position==="outside"||!o)&&(e.textAlign="end"),(o&&f.labelLine.show!==!1||!o&&(((L=($=t.tickLabel)==null?void 0:$.labelLine)==null?void 0:L.show)??!0))&&e.lineTo(A-5*i,x),(o&&f.label.show!==!1||!o&&(((N=t.tickLabel)==null?void 0:N.show)??!0))&&e.fillText(O.name,A-5*i,x)):((o&&f.label.position==="outside"||!o)&&(e.textAlign="start"),(o&&f.labelLine.show!==!1||!o)&&e.lineTo(A+5*i,x),(o&&f.label.show!==!1||!o&&(((V=t.tickLabel)==null?void 0:V.show)??!0))&&e.fillText(O.name,A+5*i,x)),e.stroke(),e.closePath(),e.fillStyle=R,e.strokeStyle=o&&((H=f.itemStyle)==null?void 0:H.borderColor)||"#fff",S=I}),h+=D.length}}function $L(e,t){if(t.data||!t.dataX&&!t.dataY)return t;const i=e.data,r=e.replaceMode;let n=[];return r?r===za.Replace?(t.dataY.forEach((a,s)=>{a.forEach((o,l)=>{let h=i[s].filter(c=>c.name===o.name);h.length>0&&(h[0].value=o.value)})}),n=i):r===za.ReplaceAll&&(n=t.dataY):i.forEach((a,s)=>{let o=[...a,...t.dataY[s]];n.push(o)}),delete t.dataX,delete t.dataY,Object.assign(t,{data:n})}function XL(e,t){t.onBeforeValue||(t.onBeforeValue=Y0);let i=t.calculative.canvas.store.data.scale;const r=t.calculative.worldRect.x,n=t.calculative.worldRect.y;t.calculative.worldRect.width;const a=t.calculative.worldRect.height;let s=[];if(t.echarts&&!t.echarts.option.color&&(t.echarts.option.color=["#1890ff","#2FC25B","#FACC14","#c23531","#2f4554","#61a0a8","#d48265"]),t.echarts)for(let u=0;u<t.echarts.option.series.length;u++)s.push(t.echarts.option.series[u].data);else s=t.data;let o=H0(e,t),l=o.dash,h=o.normalizedOption,c=l*4/5/s.length;for(let u=0;u<s.length;u++){e.beginPath();let d=s[u];e.fillStyle=t.echarts?t.echarts.option.color[u]:t.chartsColor[u],e.strokeStyle="#ffffff",e.lineWidth=1*i;let f=0,m=0,p=0;for(let g=0;g<d.length;g++)f=r+(1+.1*l)+(l+1)*g+c*u,p=(d[g]-h.min)/(h.max-h.min)*a,m=n+a-p,e.rect(f,m,c-1,p-1),e.stroke(),e.fill();e.closePath()}}function QL(e,t){var z,W,$,L,N,V,H,Q,rt,tt,it,w,_,C;t.onAdd||(t.onAdd=JL,t.onDestroy=ZL,t.onClick=t2,t.clockInterval&&(t.onDestroy(t),t.onAdd(t)));const i=t.calculative.worldRect.x,r=t.calculative.worldRect.y,n=t.calculative.worldRect.width,a=t.calculative.worldRect.height;let s=t.calculative.canvas.store.data.scale,o={startAngle:225,endAngle:-45,min:0,max:100,splitNumber:10};if(t.echarts&&t.echarts.option){let F=t.echarts.option.series[0];t.startAngle=F.startAngle||o.startAngle,t.endAngle=F.endAngle||o.endAngle,t.min=F.min||o.min,t.max=F.max||o.max,t.axisLine=F.axisLine.lineStyle.color,t.unit=F.detail.formatter.replace("{value}",""),t.value=F.data[0].value,t.splitNumber=F.splitNumber||o.splitNumber}t={...o,...t};let l=n>a?a/2*9/10:n/2*9/10,h=i+n/2,c=r+a/2,u=t.echarts?t.echarts.option.series[0].data[0].value:t.value,d,f=t.startAngle-t.endAngle,m=t.background||"#E6EBF8";e.strokeStyle=m;let p=l/10;e.lineWidth=p,e.beginPath(),e.lineCap="round",e.arc(h,c,l,-t.startAngle/180*Math.PI,-t.endAngle/180*Math.PI),e.stroke(),e.closePath();let g=0;if(t.axisLine&&!t.isClock)for(let F=t.axisLine.length-1;F>=0;F--)t.axisLine[F][0]*(t.max-t.min)<u?g=t.axisLine[F][0]:(g=(u-t.min)/(t.max-t.min),d=t.axisLine[F][1]),e.beginPath(),e.strokeStyle=t.axisLine[F][1],e.arc(h,c,l,-t.startAngle/180*Math.PI,(-t.startAngle+g*f)/180*Math.PI),e.stroke(),e.closePath();e.lineCap="butt";let y=2*s,T=l-p;T<0&&(T=0);let b=f/180*Math.PI*T,S=(b-y*t.splitNumber)/t.splitNumber,I=f/180*Math.PI*y/2/b;e.beginPath(),e.strokeStyle=t.color||"#999999",e.lineWidth=l/20,e.setLineDash([y,S]),e.arc(h,c,T,-t.startAngle/180*Math.PI-I,-t.endAngle/180*Math.PI+I),e.stroke(),e.closePath();let D=1*s,O=l-p;O<0&&(O=0);let P=f/180*Math.PI*O,q=(P-D*5*t.splitNumber)/5/t.splitNumber,J=f/180*Math.PI*D/2/P;e.beginPath(),e.strokeStyle=t.color||"#999999",e.lineWidth=l/40,e.setLineDash([D,q]),e.arc(h,c,O,-t.startAngle/180*Math.PI-J,-t.endAngle/180*Math.PI+J),e.stroke(),e.closePath(),e.beginPath();let A=t.max-t.min,x=A/t.splitNumber,R={fontStyle:((z=t.tickLabel)==null?void 0:z.fontStyle)||t.calculative.fontStyle,textDecoration:((W=t.tickLabel)==null?void 0:W.textDecoration)||t.textDecoration,fontWeight:(($=t.tickLabel)==null?void 0:$.fontWeight)||t.calculative.fontWeight,fontFamily:((L=t.tickLabel)==null?void 0:L.fontFamily)||t.calculative.fontFamily,fontSize:(((N=t.tickLabel)==null?void 0:N.fontSize)||t.calculative.fontSize)*s,lineHeight:((V=t.tickLabel)==null?void 0:V.lineHeight)||t.calculative.lineHeight};e.font=Ne(R);let M=l-p-l/20;for(let F=0;F<=t.splitNumber;F++){if(Math.abs(t.startAngle)+Math.abs(t.endAngle)===360&&F==0)continue;let j=t.startAngle-x*F/A*f,K=Math.cos(j/180*Math.PI),nt=Math.sin(j/180*Math.PI);e.fillStyle=((H=t.tickLabel)==null?void 0:H.color)||"#999999",K>.02?e.textAlign="end":K<-.02?e.textAlign="start":e.textAlign="center",nt>.02?e.textBaseline="top":nt<-.02?e.textBaseline="bottom":e.textBaseline="middle",e.fillText(qL(x*F+t.min),h+M*K,c-M*nt),e.fill()}e.closePath();let Y=1,X=["value"];if(t.isClock&&(Y=3,X=["hourvalue","minutevalue","secondvalue"]),t.isClock)for(let F=0;F<Y;F++){let j=(t.startAngle-(t[X[F]]-t.min)/(t.max-t.min)*f)/180*Math.PI;F>0&&(j=(t.startAngle-(t[X[F]]-t.min)/(t.max*5-t.min)*f)/180*Math.PI);let K=4/5*l;X[F]==="hourvalue"&&(K=3/5*l),X[F]==="minutevalue"&&(K=3.5/5*l);let nt=l*1/40;e.beginPath(),e.setLineDash([]),e.lineWidth=l/(F+1)/20,e.strokeStyle=t.color||"#999999",e.moveTo(h-nt*3*Math.cos(j),c+nt*3*Math.sin(j)),e.lineTo(h+K*Math.cos(j),c-K*Math.sin(j)),e.stroke()}else{let F=(t.startAngle-(u-t.min)/(t.max-t.min)*f)/180*Math.PI,j=4/5*l,K=l*1/40;e.beginPath(),e.setLineDash([]),e.lineWidth=2,e.fillStyle=d,e.moveTo(h-K*3*Math.cos(F),c+K*3*Math.sin(F)),e.lineTo(h+K*Math.cos(F-Math.PI/2),c-K*Math.sin(F-Math.PI/2)),e.lineTo(h+j*Math.cos(F),c-j*Math.sin(F)),e.lineTo(h+K*Math.cos(F+Math.PI/2),c-K*Math.sin(F+Math.PI/2)),e.lineTo(h-K*3*Math.cos(F),c+K*3*Math.sin(F)),e.fill()}e.beginPath(),e.textAlign="center",e.textBaseline="middle";let et={fontStyle:((Q=t.titleLabel)==null?void 0:Q.fontStyle)||t.calculative.fontStyle,textDecoration:((rt=t.titleLabel)==null?void 0:rt.textDecoration)||t.textDecoration,fontWeight:((tt=t.titleLabel)==null?void 0:tt.fontWeight)||t.calculative.fontWeight,fontFamily:((it=t.titleLabel)==null?void 0:it.fontFamily)||t.calculative.fontFamily,fontSize:(((w=t.titleLabel)==null?void 0:w.fontSize)||t.calculative.fontSize)*s,lineHeight:((_=t.titleLabel)==null?void 0:_.lineHeight)||t.calculative.lineHeight};e.font=Ne(et),e.fillStyle=((C=t.titleLabel)==null?void 0:C.color)||d,t.isClock?e.fillText(("0"+parseInt(t.hourvalue)).slice(-2)+":"+("0"+parseInt(t.minutevalue)).slice(-2)+":"+("0"+parseInt(t.secondvalue)).slice(-2),h,c+l/2):e.fillText(u+" "+(t.unit||""),h,c+l/2),e.fill(),t.isClock&&(e.beginPath(),e.fillStyle=t.color||"#999999",e.strokeStyle="#ffffff",e.arc(h,c,l/20,0,Math.PI*2),e.stroke(),e.fill(),e.closePath())}function JL(e){if(e.isClock)e.clockInterval=setInterval(()=>{let t=new Date,i=t.getSeconds(),r=t.getMinutes()+i/60,n=t.getHours()%12+r/60;e.calculative.canvas.parent.setValue({id:e.id,hourvalue:n,minutevalue:r,secondvalue:i},{render:!0,doEvent:!1})},1e3);else{const t=e.value;e.value=0,e.frames=[{duration:2e3,value:t}],e.calculative.canvas.parent.startAnimate(e.id),setTimeout(()=>{e.value=t},1e3)}}function ZL(e){e.clockInterval&&(clearInterval(e.clockInterval),e.clockInterval=void 0)}function t2(e){e.isClock&&(e.onDestroy(e),e.onAdd(e))}function e2(){return{lineChart:KL,histogram:XL,pieChart:GL,gauge:QL}}function i2(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;if(i.rect(r,n,a,s),i.closePath(),i instanceof Path2D)return i}function r2(e,t){const i=t.headHeight??50,{x:r,y:n,width:a,height:s,ey:o}=t.calculative.worldRect;let l=t.calculative.borderRadius||0,h=l;t.calculative.borderRadius<1&&(l*=a,h*=s);let c=l<h?l:h;a<2*c&&(c=a/2),i<2*c&&(c=i/2),e.beginPath(),e.moveTo(r+c,n),e.arcTo(r+a,n,r+a,n+i,c),e.arcTo(r+a,n+i,r,n+i,c),e.arcTo(r,n+i,r,n,c),e.arcTo(r,n,r+a,n,c),e.closePath(),e.stroke(),e.save(),e.beginPath(),e.lineWidth=1,e.setLineDash([7,7]);const u=r+a/2;e.moveTo(u,n+i+1),e.lineTo(u,o),e.stroke(),e.restore()}function n2(){return{sequenceFocus:i2}}function a2(){return{lifeline:r2}}const ai={},ll=['<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M473.088 125.44L256 256H52.224C23.552 256 0 279.552 0 308.224V716.8c0 28.16 23.04 51.2 51.2 51.2h204.8l217.088 130.56c16.896 10.24 38.912-2.048 38.912-22.016V147.456c0-19.968-21.504-32.256-38.912-22.016zM699.904 320.512c-20.992-18.944-53.248-17.408-72.192 3.584-18.944 20.992-17.408 53.248 3.584 72.192 0.512 0.512 58.368 54.784 58.368 121.344 0 37.888-19.456 74.752-58.368 110.08-20.992 18.944-22.528 51.2-3.584 72.192 10.24 11.264 24.064 16.896 37.888 16.896 12.288 0 24.576-4.608 34.304-13.312 61.44-55.296 92.16-117.76 92.16-185.856 0-112.64-88.576-193.536-92.16-197.12z" fill="" p-id="2434"></path><path d="M853.504 166.4c-20.992-18.944-53.248-16.896-72.192 4.096-18.944 20.992-16.896 53.248 4.096 72.192 1.536 1.024 135.68 122.88 135.68 280.576 0 90.624-45.568 177.152-135.68 257.536-20.992 18.944-23.04 51.2-4.096 72.192 10.24 11.264 24.064 16.896 38.4 16.896 12.288 0 24.576-4.096 34.304-12.8 112.64-100.864 169.984-212.992 169.984-333.824-1.024-202.752-163.84-350.208-170.496-356.864z"></path></svg>','<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" ><path d="M256 768H51.2c-28.16 0-51.2-23.04-51.2-51.2V308.224C0 279.552 23.552 256 52.224 256H256v512zM512 147.456v728.576c0 19.968-21.504 32.256-38.912 22.016L256 768V256l217.088-130.56c17.408-10.24 38.912 2.048 38.912 22.016zM623.104 656.896c-19.968-19.968-19.968-52.224 0-72.192l217.088-217.088c19.968-19.968 52.224-19.968 72.192 0 19.968 19.968 19.968 52.224 0 72.192l-217.088 217.088c-19.456 19.968-52.224 19.968-72.192 0z" fill="" p-id="2582"></path><path d="M623.104 367.104c19.968-19.968 52.224-19.968 72.192 0l217.088 217.088c19.968 19.968 19.968 52.224 0 72.192-19.968 19.968-52.224 19.968-72.192 0l-217.088-217.088c-19.968-19.456-19.968-52.224 0-72.192z"></path></svg>'];function s2(e){e.onDestroy||(e.onDestroy=o2,e.onMove=mh,e.onResize=mh,e.onRotate=mh,e.onClick=gp,e.onValue=c2,e.onChangeId=l2);const i=e.calculative.canvas.store.id+"-"+e.id;if(ai[i])e.video&&e.calculative.media&&e.video!==e.calculative.video&&(console.warn("video 更改, 此处是否执行？"),e.calculative.video=e.video);else{const r=document.createElement("div"),n=document.createElement("div");n.innerHTML=ll[1],n.style.position="absolute",n.style.right="0",n.style.bottom="0",n.style.width="20px",n.style.height="20px",n.style.fill="hsla(0, 0%, 100%, .8)",n.style.zIndex="1",n.style.display="none",r.appendChild(n),n.onclick=s=>{s.stopPropagation(),e.calculative.media.muted?(n.innerHTML=ll[0],e.calculative.media.muted=!1):(n.innerHTML=ll[1],e.calculative.media.muted=!0)},e.calculative.singleton||(e.calculative.singleton={}),e.calculative.singleton.muted=n,r.onmouseenter=s=>{e.hideMuted||(n.style.display="block")},r.onmouseleave=s=>{n.style.display="none"},r.onclick=s=>{s.stopPropagation(),gp(e)};let a;if(a=document.createElement("video"),a.setAttribute("controls",""),flvjs.isSupported()){const s=e.mediaDataSource||{type:"flv",url:e.video},o=e.flvConfig||void 0,l=flvjs.createPlayer(s,o);console.log(l,"media"),l.attachMediaElement(a),l.load(),l.play()}a.onended=()=>{e.calculative.onended&&e.calculative.onended(e)},e.calculative.media=a,a.style.position="absolute",a.style.outline="none",a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.style.objectFit=e.objectFit||"contain",r.appendChild(a),ai[i]=r,e.calculative.canvas.externalElements.parentElement.appendChild(r),Se(e,r)}return e.calculative.patchFlags&&Se(e,ai[i]),new Path2D}function o2(e){const i=e.calculative.canvas.store.id+"-"+e.id;ai[i]&&(ai[i].onclick=null,ai[i].remove(),ai[i]=void 0)}function mh(e){const i=e.calculative.canvas.store.id+"-"+e.id;ai[i]&&Se(e,ai[i])}function gp(e){e.calculative.media&&(e.calculative.media.muted=!1,e.calculative.singleton.muted.innerHTML=ll[0],e.calculative.media.paused?e.calculative.media.play():e.calculative.media.pause())}function l2(e,t,i){const r=e.calculative.canvas.store.id,n=r+"-"+t,a=r+"-"+i;ai[n]&&(ai[a]=ai[n],delete ai[n])}function c2(e){const i=e.calculative.canvas.store.id+"-"+e.id,r=ai[i];if(!r)return;Se(e,r),e.calculative.media||(e.calculative.media=r.querySelector("video"));const n=e.calculative.media.getAttribute("src");e.video&&e.video}const ti={},ua={};function h2(e,t){const i=t||new Path2D,{x:r,y:n,width:a,height:s}=e.calculative.worldRect;return i.rect(r,n,a,s),e.onAdd||(e.onAdd=m2,e.onDestroy=d2,e.onValue=g2,e.onChangeId=f2,e.interval&&(e.onDestroy(e),e.onAdd(e))),e.interval||e.onAdd(e),i instanceof Path2D?i:new Path2D}function ad(e){return`${e.calculative.canvas.store.id}-${e.id}`}function u2(e){if(!e)return;const i=new Date(e).getTime();return Number.isNaN(i)?void 0:i}function pp(e,t){const i=Math.max(0,Math.floor(t/1e3)),r=Math.floor(i/86400),n=Math.floor(i%86400/3600),a=Math.floor(i%3600/60),s=i%60,o=c=>c<10?`0${c}`:`${c}`,l={day:`${r}`,hours:o(n),hour:`${n}`,minutes:o(a),minute:`${a}`,seconds:o(s),second:`${s}`};let h=e||"${day}天${hours}时${minutes}分${seconds}秒";return Object.keys(l).forEach(c=>{const u=new RegExp(`\\$\\{${c}\\}`,"g");h=h.replace(u,l[c])}),h.startsWith("`")&&h.endsWith("`")&&(h=h.slice(1,-1)),h}function q0(e){const t=ad(e);if(!e.calculative)return;ti[t]&&(clearInterval(ti[t]),delete ti[t]);const i=e,r=i.deadline,n=u2(r);if(!n)return;const a=i.interval||1e3,s=i.timeFormat||"";ua[t]||(ua[t]={}),ua[t].deadline=r,ua[t].interval=a,ua[t].timeFormat=s;const o=()=>{var d,f,m,p,g,y,T,b;const h=Date.now(),c=n-h;if(c<=0){const S=pp(s,0);(f=(d=e.calculative)==null?void 0:d.canvas)==null||f.parent.setValue({id:e.id,text:S},{history:!1,doEvent:!1,render:!1}),(p=(m=e.calculative)==null?void 0:m.canvas)==null||p.render(),ti[t]&&(clearInterval(ti[t]),delete ti[t]);return}const u=pp(s,c);(y=(g=e.calculative)==null?void 0:g.canvas)==null||y.parent.setValue({id:e.id,text:u},{history:!1,doEvent:!1,render:!1}),(b=(T=e.calculative)==null?void 0:T.canvas)==null||b.render()};o();const l=window.setInterval(o,a);ti[t]=l}function d2(e){const t=ad(e);ti[t]&&(clearInterval(ti[t]),delete ti[t])}function f2(e,t,i){const r=e.calculative.canvas.store.id,n=`${r}-${t}`,a=`${r}-${i}`;ti[n]&&(ti[a]=ti[n],delete ti[n])}function m2(e){console.log(111),q0(e)}function g2(e){const t=ad(e),i=ua[t],r=e;i.deadline===r.deadline&&i.timeFormat===r.timeFormat&&i.interval===r.interval||q0(e)}function p2(e,t){var d;if(t.onAdd||(t.onAdd=v2,t.onMouseDown=y2,t.onValue=b2,t.onResize=T2,t.onBeforeValue=w2,t.onAdd(t)),!t.data||!((d=t.calculative)!=null&&d.worldRect))return;let i=t.calculative.worldRect.x||0,r=t.calculative.worldRect.y||0;t.calculative.worldRect.height,t.calculative.worldRect.width;const{fontStyle:n,fontWeight:a,fontSize:s,fontFamily:o,lineHeight:l}=t.calculative;let h=t.btnWidth||100,c=t.btnHeight||32,u=t.gap||8;t.direction==="horizontal"?t.data.forEach((f,m)=>{var T,b,S;const p=i+m*(h+u),g=r+u,y=f.isForbidden||t.disabled;e.fillStyle=t.background||"transparent",e.strokeStyle=t.color||"transparent",m===t.active&&(e.fillStyle=t.activeBackground||"transparent",e.strokeStyle=t.activeColor||"transparent"),y&&(e.fillStyle=t.disabledBackground||"transparent",e.strokeStyle=t.disabledColor||"transparent"),e.beginPath(),e.rect(p,g,h,c),e.fill(),e.stroke(),e.fillStyle=t.textColor||"transparent",m===t.active&&(e.fillStyle=t.activeTextColor||"transparent"),y&&(e.fillStyle=t.disabledTextColor||"#5A5E68"),e.font=Ne({fontStyle:n,fontWeight:a,fontFamily:o||((b=(T=t.calculative)==null?void 0:T.canvas)==null?void 0:b.parent.store.options.fontFamily),fontSize:s||((S=t.calculative)==null?void 0:S.fontSize),lineHeight:l}),e.textAlign="center",e.textBaseline="middle",t.textDirection==="horizontal"?e.fillText(f.text,p+h/2,g+c/2):vp(e,f.text,p,g,h,c)}):t.data.forEach((f,m)=>{var T,b,S;const p=i+u,g=r+m*(c+u),y=f.isForbidden||t.disabled;e.fillStyle=t.background||"transparent",e.strokeStyle=t.color||"transparent",m===t.active&&(e.fillStyle=t.activeBackground||"transparent",e.strokeStyle=t.activeColor||"transparent"),y&&(e.fillStyle=t.disabledBackground||"transparent",e.strokeStyle=t.disabledColor||"transparent"),e.beginPath(),e.rect(p,g,h,c),e.fill(),e.stroke(),e.fillStyle=t.textColor||"transparent",m===t.active&&(e.fillStyle=t.activeTextColor||"transparent"),y&&(e.fillStyle=t.disabledTextColor||"#5A5E68"),e.font=Ne({fontStyle:n,fontWeight:a,fontFamily:o||((b=(T=t.calculative)==null?void 0:T.canvas)==null?void 0:b.parent.store.options.fontFamily),fontSize:s||((S=t.calculative)==null?void 0:S.fontSize),lineHeight:l}),e.textAlign="center",e.textBaseline="middle",t.textDirection==="horizontal"?e.fillText(f.text,p+h/2,g+c/2):vp(e,f.text,p,g,h,c)})}function sd(e){var l;if(!((l=e.calculative)!=null&&l.worldRect))return;const t=e.data||[],i=e.btnWidth||100,r=e.btnHeight||32,n=e.gap||8,a=e.direction||"horizontal";let s=0,o=0;a==="horizontal"?(s=t.length*i+(t.length-1)*n,o=r+2*n):(s=i+2*n,o=t.length*r+(t.length-1)*n),(e.width!==s||e.height!==o)&&(e.width=s,e.height=o,e.calculative&&(e.calculative.width=s,e.calculative.height=o,e.calculative.worldRect={x:e.x||0,y:e.y||0,width:s,height:o,center:{x:(e.x||0)+s/2,y:(e.y||0)+o/2}},le(e.calculative.worldRect)))}function v2(e){sd(e)}function y2(e,t){var o,l,h,c,u,d,f,m,p,g;if(!e.data)return;const i=e.btnWidth||100,r=e.btnHeight||32,n=e.gap||8,a=((l=(o=e.calculative)==null?void 0:o.worldRect)==null?void 0:l.x)||0,s=((c=(h=e.calculative)==null?void 0:h.worldRect)==null?void 0:c.y)||0;if(e.direction=="horizontal")for(let y=0;y<e.data.length;y++)!e.data[y].isForbidden&&t.x>a+y*(i+n)&&t.x<a+y*(i+n)+i&&(e.active=y,(d=(u=e.calculative)==null?void 0:u.canvas)==null||d.store.emitter.emit("valueUpdate",e));else if(e.direction=="vertical")for(let y=0;y<e.data.length;y++)!e.data[y].isForbidden&&t.y>s+y*(r+n)&&t.y<s+y*(r+n)+r&&(e.active=y,(m=(f=e.calculative)==null?void 0:f.canvas)==null||m.store.emitter.emit("valueUpdate",e));(g=(p=e.calculative)==null?void 0:p.canvas)==null||g.render()}function b2(e){e.calculative.flag&&sd(e)}function w2(e,t){return e.calculative.flag=!1,(t.data!==void 0||t.direction!==void 0||t.gap!==void 0||t.btnWidth!==void 0||t.btnHeight!==void 0)&&(e.calculative.flag=!0),t}function T2(e){var t,i,r,n,a;if((i=(t=e.calculative)==null?void 0:t.worldRect)!=null&&i.width&&((n=(r=e.calculative)==null?void 0:r.worldRect)!=null&&n.height)&&((a=e.data)!=null&&a.length)){const s=e.gap||8,o=e.data.length;e.direction==="horizontal"?(e.btnWidth=(e.calculative.worldRect.width-(o-1)*s)/o,e.btnHeight=e.calculative.worldRect.height-2*s):(e.btnWidth=e.calculative.worldRect.width-2*s,e.btnHeight=(e.calculative.worldRect.height-(o-1)*s)/o)}sd(e)}function vp(e,t,i,r,n,a,s=14){e.textAlign="center",e.textBaseline="middle";const o=t.length*s,l=r+(a-o)/2,h=i+n/2;for(let c=0;c<t.length;c++)e.fillText(t[c],h,l+c*s)}function E2(e,t){var y;if(!((y=t.calculative)!=null&&y.worldRect))return;t.onAdd||(t.onAdd=_2,t.onValue=S2,t.onBeforeValue=A2,t.onAdd(t));const i=t.calculative.worldRect,r={x:i.x??t.x??0,y:i.y??t.y??0,width:i.width??t.width??0,height:i.height??t.height??0},{width:n,height:a}=r;if(n<=0||a<=0)return;const s=Math.min(n*.35,a*.25),o=Math.max(s/2,6),l=n/2,h=r.y+o,c=r.y+a-o,u=r.x+l,{percent:d,value:f}=x2(t),m=c-(c-h)*d,p=R2(t),g=k2(r,o);e.save(),e.clip(g),d>0&&I2(e,r,m,c,o,p),e.restore(),e.lineWidth=t.lineWidth||2,e.strokeStyle=p.tankBorder,e.stroke(g),C2(e,u,h,l,o,p.tankBorder),D2(e,u,c,l,o,p.tankBorder,p.waterBase),d>0&&d<1?yp(e,u,m,l,o,p.surfaceFill,p.surfaceBorder):d>=1&&yp(e,u,h,l,o,p.surfaceFill,p.surfaceBorder),t.showValue!==!1&&O2(e,t,r,f,d,p.textColor)}function _2(e){e.value===void 0&&(e.value=e.minValue??0)}function S2(e){var t,i;(i=(t=e.calculative)==null?void 0:t.canvas)==null||i.render()}function A2(e,t){return t}function x2(e){const t=e.minValue??0,i=e.maxValue??100;if(i===t)return{percent:0,value:t};const r=e.value??t,n=Math.min(Math.max(r,t),i);return{percent:(n-t)/(i-t),value:n}}function R2(e){return{tankBackground:e.tankBackground||"#061529",tankBorder:e.tankColor||"#3b516c",highlight:e.highlightColor||"rgba(255,255,255,0.35)",waterBase:e.waterColor||"#1E88FF",waterHighlight:e.waterGradientColor||"#63D5FF",surfaceFill:e.surfaceColor||"rgba(255,255,255,0.5)",surfaceBorder:e.surfaceBorderColor||"rgba(255,255,255,0.65)",textColor:e.textColor||"#FFFFFF",tickColor:e.tickColor||"rgba(255,255,255,0.35)"}}function k2(e,t){const i=new Path2D,r=e.width/2,n=e.y+t,a=e.y+e.height-t;return i.moveTo(e.x,n),i.lineTo(e.x,a),i.ellipse(e.x+r,a,r,t,0,Math.PI,0,!1),i.lineTo(e.x+e.width,n),i.ellipse(e.x+r,n,r,t,0,0,Math.PI,!0),i.closePath(),i}function I2(e,t,i,r,n,a){const s=e.createLinearGradient(t.x,i,t.x,r+n);s.addColorStop(0,a.waterHighlight),s.addColorStop(1,a.waterBase),e.fillStyle=a.waterBase,e.fillRect(t.x-t.width,i,t.width*3,r-i+n)}function C2(e,t,i,r,n,a){e.beginPath(),e.strokeStyle=a,e.ellipse(t,i,r,n,0,0,Math.PI),e.stroke()}function D2(e,t,i,r,n,a,s){e.beginPath(),e.ellipse(t,i,r,n,0,0,2*Math.PI),e.fillStyle=s,e.fill(),e.strokeStyle=s,e.stroke(),e.beginPath(),e.ellipse(t,i,r,n,0,0,Math.PI),e.strokeStyle=a,e.stroke()}function yp(e,t,i,r,n,a,s){e.beginPath(),e.ellipse(t,i,r,n,0,0,Math.PI*2),e.fill(),e.strokeStyle=s,e.stroke()}function O2(e,t,i,r,n,a){var p;const s=t.calculative;if(!s)return;const{fontStyle:o,fontWeight:l,fontSize:h,fontFamily:c,lineHeight:u}=s;e.fillStyle=a,e.font=Ne({fontStyle:o,fontWeight:l,fontFamily:c||((p=s.canvas)==null?void 0:p.parent.store.options.fontFamily),fontSize:h||s.fontSize||16,lineHeight:u}),e.textAlign="center",e.textBaseline="middle";const d=t.precision??(t.valueMode==="value"?1:0),f=t.unit??(t.valueMode==="value"?"":"%"),m=t.valueMode==="value"?`${r.toFixed(d)}${f}`:`${(n*100).toFixed(d)}${f}`;e.fillText(m,i.x+i.width/2,i.y+i.height/2)}function M2(){return{flvPlayerDom:s2,countdown:h2}}function P2(){return{tab:p2,waterTank:E2}}function oU(){Tr(FN()),vh(BN()),Tr(iN()),En(rN()),Tr(TN()),Tr(n2()),En(a2()),mN(),En(_L()),Tr(SL()),En(e2()),Tr(WL()),En(zL()),vh(VL()),Tr(M2()),En(P2())}const Ra=[];let Te=null,gh="";const N2=()=>{Ra.forEach(e=>{e==null||e.unsubscribe()}),Ra.length=0},L2=async e=>{Te||(gh=e.url,!Ws()&&e.token&&ph(e.token),Te=hp(e.url)),gh!==e.url&&(Te==null||Te.notifyReset(),await new Promise(t=>setTimeout(t,1e3)),gh=e.url,!Ws()&&e.token&&ph(e.token),Te=hp(e.url)),e.children&&e.children.length>0&&e.children.forEach((t,i)=>{if(t.dataSourceType==="latest"){const r=typeof t.dataSource=="string"?JSON.parse(t.dataSource):t.dataSource;r.dataKeys.forEach(n=>{n.settings={}}),Te==null||Te.createWidgetSubscription({type:"latest",hasDataPageLink:!1,datasources:[r],callbacks:{onDataUpdated:n=>{var h,c,u;if(!n)return;const a=(h=n.datasourcePages)==null?void 0:h[0],s=(c=n.dataPages)==null?void 0:c[0];let o=new Array;if(!a||!s)return;(u=a.data)==null||u.forEach((d,f)=>{const m={entityId:d.entityId||"",entityName:d.entityName||"",entityLabel:d.entityLabel||""};s.data[f].forEach(p=>{m[p.dataKey.name]=p.data}),o.push(m)});const l={data:o,totalPages:a.totalPages,totalElements:a.totalElements,hasNext:a.hasNext};if(meta2d.store.tbCacheData||(meta2d.store.tbCacheData={}),meta2d.store.tbCacheData[i]=l,console.log(l,"entitiesPageData"),t.filterFn){const d=new Function("res",t.filterFn)(l);meta2d.setDatas(d)}}}}).subscribe(n=>{Ra.push(n),n.subscribe()})}else if(t.dataSourceType==="timeseries"){const r=typeof t.dataSource=="string"?JSON.parse(t.dataSource):t.dataSource,n=typeof t.timeWindow=="string"?JSON.parse(t.timeWindow):t.timeWindow;r.dataKeys.forEach(a=>{a.settings={}}),Te==null||Te.createWidgetSubscription({type:"timeseries",hasDataPageLink:!1,datasources:[r],timeWindowConfig:n,callbacks:{onDataUpdated:a=>{var c,u,d;if(!a)return;const s=(c=a.datasourcePages)==null?void 0:c[0],o=(u=a.dataPages)==null?void 0:u[0];let l=new Array;if(!s||!o)return;(d=s.data)==null||d.forEach((f,m)=>{const p={entityId:f.entityId||"",entityName:f.entityName||"",entityLabel:f.entityLabel||""};o.data[m].forEach(g=>{p[g.dataKey.name]=g.data}),l.push(p)});const h={data:l,totalPages:s.totalPages,totalElements:s.totalElements,hasNext:s.hasNext};if(meta2d.store.tbCacheData||(meta2d.store.tbCacheData={}),meta2d.store.tbCacheData[i]=h,console.log(h,"entitiesPageData"),t.filterFn){const f=new Function("res",t.filterFn)(h);meta2d.setDatas(f)}}}}).subscribe(a=>{Ra.push(a),a.subscribe()})}else if(t.dataSourceType==="alarm"){const r=typeof t.dataSource=="string"?JSON.parse(t.dataSource):t.dataSource,n=typeof t.timeWindow=="string"?JSON.parse(t.timeWindow):t.timeWindow;r.dataKeys.forEach(a=>{a.settings={}}),Te==null||Te.createWidgetSubscription({type:"alarm",hasDataPageLink:!1,alarmSource:r,timeWindowConfig:n,callbacks:{onDataUpdated:a=>{if(a&&(meta2d.store.tbCacheData||(meta2d.store.tbCacheData={}),meta2d.store.tbCacheData[i]=a.alarms,t.filterFn)){const s=new Function("res",t.filterFn)(a.alarms);meta2d.setDatas(s)}}}}).subscribe(a=>{Ra.push(a),a.subscribeForAlarms(r.pageLink,[])})}else if(t.dataSourceType==="entityCount"||t.dataSourceType==="alarmCount"){const r=typeof t.dataSource=="string"?JSON.parse(t.dataSource):t.dataSource,n=typeof t.timeWindow=="string"?JSON.parse(t.timeWindow):t.timeWindow;r.dataKeys.forEach(a=>{a.settings={}}),r.type=t.dataSourceType==="entityCount"?Ct.entityCount:Ct.alarmCount,r.dataKeys=[{name:"count",type:"count",label:"totalDevices",settings:{}}],Te==null||Te.createWidgetSubscription({type:"latest",hasDataPageLink:!1,datasources:[r],timeWindowConfig:n,callbacks:{onDataUpdated:a=>{var s,o,l,h,c,u,d,f;if(a&&(meta2d.store.tbCacheData||(meta2d.store.tbCacheData={}),meta2d.store.tbCacheData[i]=(h=(l=(o=(s=a.data)==null?void 0:s[0])==null?void 0:o.data)==null?void 0:l[0])==null?void 0:h[1],t.filterFn)){const m=new Function("res",t.filterFn)((f=(d=(u=(c=a.data)==null?void 0:c[0])==null?void 0:u.data)==null?void 0:d[0])==null?void 0:f[1]);meta2d.setDatas(m)}}}}).subscribe(a=>{Ra.push(a),a.subscribe()})}})},lU=()=>{const e=localStorage.getItem("meta2d");if(!e)return;const t=JSON.parse(e);meta2d.store.emitter.on("connectNetwork",()=>{var r;Te==null||Te.notifyReset(),N2();const i=(r=t.networks)==null?void 0:r.find(n=>n.protocol==="thingsboard");i&&L2(i)})};export{mi as $,Me as A,Ks as B,wt as C,FE as D,ve as E,aU as G,bt as H,jt as L,LE as M,$t as P,cn as Q,Cn as R,Qt as V,Wa as Y,Mt as a,VE as b,Fo as c,lt as d,HE as e,B2 as f,qE as g,zE as h,BE as i,jE as j,WE as k,sU as l,YE as m,lU as n,Ct as o,Re as p,Bi as q,oU as r,$r as s,va as t,nU as u,FO as v,Lt as w,ct as x,Pt as y,gn as z};
