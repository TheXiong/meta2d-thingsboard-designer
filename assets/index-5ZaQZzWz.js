import{n as w,M as T,f as k,r as I}from"./thingsboard-an0m2ptl.js";import{d as b,r as f,ag as S,o as B,n as _,a as z,w as O,q as x,e as R,h as j,i as u}from"./index-DAjeGngP.js";const y={h:"100vh","w-full":"",class:"meta2d-app"},V=b({__name:"index",props:{json:{}},emits:["login","refreshTokenInfo","changeTheme"],setup(c,{emit:d}){const s=d,m=c;let e=null;const t=f(null),a=f(null);function v(){if(!e)return;const o=m.json||localStorage.getItem("meta2d");if(o){const n=JSON.parse(o);n.width=n.width??1920,n.height=n.height??1080,n.rule=!1,n.grid=!1,n.locked=1,n.disableScale=!1,e.open(n)}}const l=S(null);function h(){l.value&&(clearInterval(l.value),l.value=null)}function g(){e=new T("meta2d-preview",{...k(),grid:!1,disableScale:!1,rule:!1}),e.on("opened",()=>{e.setOptions({scroll:void 0,disableScale:void 0,disableTranslate:void 0}),e.fitSizeView(!0,0)}),a.value=new ResizeObserver(p);const o=document.getElementById("meta2d-preview");o&&a.value.observe(o),I()}const p=()=>{t.value&&window.clearTimeout(t.value),t.value=window.setTimeout(()=>{e&&e.fitSizeView(!0,0)},500)},i=()=>{s("login")},r=o=>{s("refreshTokenInfo",o)};return B(()=>{_(()=>{g(),v(),w(),e==null||e.on("login",i),e==null||e.on("refreshTokenInfo",r)})}),z(()=>{if(h(),a.value){const o=document.getElementById("meta2d-preview");o&&a.value.unobserve(o),a.value.disconnect()}t.value&&window.clearTimeout(t.value),e&&(e.destroy(),e.off("login",i),e.off("refreshTokenInfo",r))}),O(u,()=>{s("changeTheme",u.value?"dark":"light")}),(o,n)=>(R(),x("div",y,[...n[0]||(n[0]=[j("div",{id:"meta2d-preview","w-full":"","h-full":""},null,-1)])]))}});export{V as default};
